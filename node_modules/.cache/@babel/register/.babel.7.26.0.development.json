{"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\scripts\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\scripts\\\\allEndpointsTests.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const chai = require('chai');\nconst chaiHttp = require('chai-http');\nconst app = require('../server');\nconst {\n  expect\n} = chai;\nconst mongoose = require('mongoose');\nconst User = require('../models/User');\nconst Seller = require('../models/Seller');\nconst Horse = require('../models/Horse');\nconst Transaction = require('../models/Transaction');\nconst Inquiry = require('../models/Inquiry');\nconst Review = require('../models/Review');\nconst Message = require('../models/Message');\nconst Conversation = require('../models/Conversation');\nchai.use(chaiHttp);\ndescribe('Complete System Test Suite', () => {\n  let buyer, buyerToken;\n  let seller, sellerToken;\n  let admin, adminToken;\n  let horse, inquiry, conversation, review, transaction;\n  before(async () => {\n    // Connect to test database\n    await mongoose.connect(process.env.MONGODB_URI, {\n      useNewUrlParser: true,\n      useUnifiedTopology: true\n    });\n\n    // Clear test data\n    await Promise.all([User.deleteMany({}), Seller.deleteMany({}), Horse.deleteMany({}), Transaction.deleteMany({}), Inquiry.deleteMany({}), Review.deleteMany({}), Message.deleteMany({}), Conversation.deleteMany({})]);\n  });\n  after(async () => {\n    await mongoose.connection.close();\n  });\n  describe('1. Authentication & User Management', () => {\n    it('should register a buyer', async () => {\n      const res = await chai.request(app).post('/api/auth/register').send({\n        name: 'Test Buyer',\n        email: 'buyer@test.com',\n        password: 'test123',\n        role: 'user',\n        phone: '1234567890',\n        location: {\n          state: 'Maharashtra',\n          city: 'Mumbai',\n          pincode: '400001'\n        }\n      });\n      expect(res).to.have.status(201);\n      expect(res.body).to.have.property('token');\n      buyerToken = res.body.token;\n      buyer = res.body.user;\n    });\n    it('should register a seller', async () => {\n      const res = await chai.request(app).post('/api/auth/register').send({\n        name: 'Test Seller',\n        email: 'seller@test.com',\n        password: 'test123',\n        role: 'seller',\n        phone: '9876543210',\n        location: {\n          state: 'Karnataka',\n          city: 'Bangalore',\n          pincode: '560001'\n        }\n      });\n      expect(res).to.have.status(201);\n      expect(res.body).to.have.property('token');\n      sellerToken = res.body.token;\n      seller = res.body.user;\n    });\n    it('should register an admin', async () => {\n      const res = await chai.request(app).post('/api/auth/register').send({\n        name: 'Test Admin',\n        email: 'admin@test.com',\n        password: 'test123',\n        role: 'admin'\n      });\n      expect(res).to.have.status(201);\n      expect(res.body).to.have.property('token');\n      adminToken = res.body.token;\n      admin = res.body.user;\n    });\n    it('should login users', async () => {\n      const res = await chai.request(app).post('/api/auth/login').send({\n        email: 'buyer@test.com',\n        password: 'test123'\n      });\n      expect(res).to.have.status(200);\n      expect(res.body).to.have.property('token');\n    });\n    it('should get user profile', async () => {\n      const res = await chai.request(app).get('/api/auth/me').set('Authorization', `Bearer ${buyerToken}`);\n      expect(res).to.have.status(200);\n      expect(res.body.user.email).to.equal('buyer@test.com');\n    });\n  });\n  describe('2. Seller Profile & Verification', () => {\n    it('should create seller profile', async () => {\n      const res = await chai.request(app).post('/api/sellers/profile').set('Authorization', `Bearer ${sellerToken}`).send({\n        businessName: 'Premium Stables',\n        description: 'High-quality horse breeding and training',\n        contactDetails: {\n          phone: '9876543210',\n          email: 'contact@premiumstables.com',\n          whatsapp: '9876543210'\n        },\n        businessDocuments: {\n          gst: 'GSTIN123456',\n          pan: 'PANAB1234C'\n        }\n      });\n      expect(res).to.have.status(201);\n      expect(res.body.seller.businessName).to.equal('Premium Stables');\n    });\n    it('should submit verification documents', async () => {\n      const res = await chai.request(app).post('/api/verification/submit').set('Authorization', `Bearer ${sellerToken}`).send({\n        documents: [{\n          type: 'identity',\n          url: 'https://example.com/id.jpg',\n          public_id: 'id_123'\n        }, {\n          type: 'address',\n          url: 'https://example.com/address.jpg',\n          public_id: 'address_123'\n        }]\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.success).to.be.true;\n    });\n    it('should verify seller (admin)', async () => {\n      const res = await chai.request(app).put(`/api/admin/sellers/${seller._id}/verification`).set('Authorization', `Bearer ${adminToken}`).send({\n        status: 'verified',\n        level: 'professional'\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.seller.verification.status).to.equal('verified');\n    });\n  });\n  describe('3. Subscription Management', () => {\n    it('should create subscription payment', async () => {\n      const res = await chai.request(app).post('/api/payments/create').set('Authorization', `Bearer ${sellerToken}`).send({\n        amount: 9999,\n        currency: 'INR',\n        notes: {\n          type: 'subscription',\n          package: 'Royal Stallion',\n          duration: 12\n        }\n      });\n      expect(res).to.have.status(200);\n      expect(res.body).to.have.property('order');\n      transaction = res.body.transaction;\n    });\n    it('should verify subscription payment', async () => {\n      const res = await chai.request(app).post('/api/payments/verify').set('Authorization', `Bearer ${sellerToken}`).send({\n        razorpay_payment_id: 'pay_' + Date.now(),\n        razorpay_order_id: transaction.razorpayOrderId,\n        razorpay_signature: 'valid_signature'\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.transaction.status).to.equal('completed');\n    });\n    it('should update subscription package', async () => {\n      const res = await chai.request(app).put('/api/sellers/subscription').set('Authorization', `Bearer ${sellerToken}`).send({\n        subscriptionPackage: 'Royal Stallion'\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.success).to.be.true;\n      expect(res.body.subscription.package).to.equal('Royal Stallion');\n    });\n    it('should reject invalid subscription package', async () => {\n      const res = await chai.request(app).put('/api/sellers/subscription').set('Authorization', `Bearer ${sellerToken}`).send({\n        subscriptionPackage: 'Invalid Package'\n      });\n      expect(res).to.have.status(400);\n      expect(res.body.success).to.be.false;\n    });\n  });\n  describe('4. Horse Listing Management', () => {\n    it('should upload photos', async () => {\n      const res = await chai.request(app).post('/api/photos/upload').set('Authorization', `Bearer ${sellerToken}`).send({\n        photos: [{\n          url: 'https://example.com/horse1.jpg',\n          public_id: 'horse1',\n          thumbnail_url: 'https://example.com/horse1_thumb.jpg'\n        }]\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.photos).to.be.an('array');\n    });\n    it('should create horse listing', async () => {\n      const res = await chai.request(app).post('/api/horses').set('Authorization', `Bearer ${sellerToken}`).send({\n        name: 'Thunder',\n        breed: 'Thoroughbred',\n        age: {\n          years: 5,\n          months: 3\n        },\n        gender: 'Stallion',\n        color: 'Bay',\n        price: 500000,\n        description: 'Champion racehorse with excellent bloodline',\n        location: {\n          state: 'Karnataka',\n          city: 'Bangalore',\n          pincode: '560001'\n        },\n        specifications: {\n          training: 'Advanced',\n          discipline: ['Racing', 'Dressage'],\n          temperament: 'Calm',\n          healthStatus: 'Excellent',\n          vaccination: true,\n          papers: true\n        }\n      });\n      expect(res).to.have.status(201);\n      horse = res.body.horse;\n    });\n    it('should boost listing visibility', async () => {\n      const res = await chai.request(app).post(`/api/visibility/spotlight/${horse._id}`).set('Authorization', `Bearer ${sellerToken}`).send({\n        duration: 30 // days\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.horse.boost.active).to.be.true;\n    });\n  });\n  describe('5. Buyer Interaction', () => {\n    it('should search horses', async () => {\n      const res = await chai.request(app).post('/api/search').send({\n        filters: {\n          breed: 'Thoroughbred',\n          priceRange: {\n            min: 400000,\n            max: 600000\n          },\n          location: {\n            state: 'Karnataka'\n          }\n        },\n        page: 1,\n        limit: 10\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.data.horses).to.be.an('array');\n    });\n    it('should get recommendations', async () => {\n      const res = await chai.request(app).get('/api/recommendations/personalized').set('Authorization', `Bearer ${buyerToken}`);\n      expect(res).to.have.status(200);\n      expect(res.body.recommendations).to.be.an('array');\n    });\n    it('should create inquiry', async () => {\n      const res = await chai.request(app).post('/api/inquiries').set('Authorization', `Bearer ${buyerToken}`).send({\n        horse: horse._id,\n        message: 'Interested in viewing this horse',\n        contactPreference: 'email'\n      });\n      expect(res).to.have.status(201);\n      inquiry = res.body.inquiry;\n    });\n    it('should respond to inquiry', async () => {\n      const res = await chai.request(app).post(`/api/inquiries/${inquiry._id}/respond`).set('Authorization', `Bearer ${sellerToken}`).send({\n        message: 'Thank you for your interest. When would you like to visit?'\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.inquiry.status).to.equal('responded');\n    });\n  });\n  describe('6. Messaging System', () => {\n    it('should start conversation', async () => {\n      const res = await chai.request(app).post('/api/messaging/conversations').set('Authorization', `Bearer ${buyerToken}`).send({\n        recipientId: seller._id,\n        entityType: 'horse',\n        entityId: horse._id\n      });\n      expect(res).to.have.status(201);\n      conversation = res.body.conversation;\n    });\n    it('should send message', async () => {\n      const res = await chai.request(app).post('/api/messaging/messages').set('Authorization', `Bearer ${buyerToken}`).send({\n        conversationId: conversation._id,\n        content: 'Is the horse still available?'\n      });\n      expect(res).to.have.status(201);\n      expect(res.body.message.content).to.equal('Is the horse still available?');\n    });\n  });\n  describe('7. Review System', () => {\n    it('should create review', async () => {\n      const res = await chai.request(app).post('/api/reviews').set('Authorization', `Bearer ${buyerToken}`).send({\n        entityType: 'horse',\n        entityId: horse._id,\n        rating: {\n          overall: 5,\n          aspects: {\n            communication: 5,\n            accuracy: 4,\n            value: 5,\n            experience: 5\n          }\n        },\n        content: {\n          title: 'Excellent Horse',\n          description: 'Exactly as described. Very satisfied with the purchase.',\n          pros: ['Well trained', 'Good temperament'],\n          cons: ['None']\n        }\n      });\n      expect(res).to.have.status(201);\n      review = res.body.review;\n    });\n    it('should moderate review', async () => {\n      const res = await chai.request(app).put(`/api/reviews/${review._id}/moderate`).set('Authorization', `Bearer ${adminToken}`).send({\n        status: 'approved',\n        reason: 'Meets community guidelines'\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.review.status).to.equal('approved');\n    });\n  });\n  describe('8. Analytics & Reporting', () => {\n    it('should get seller dashboard stats', async () => {\n      const res = await chai.request(app).get('/api/seller/dashboard/stats').set('Authorization', `Bearer ${sellerToken}`);\n      expect(res).to.have.status(200);\n      expect(res.body.dashboard).to.have.property('listings');\n      expect(res.body.dashboard).to.have.property('inquiries');\n      expect(res.body.dashboard).to.have.property('transactions');\n    });\n    it('should get listing performance', async () => {\n      const res = await chai.request(app).get(`/api/analytics/listings/${horse._id}`).set('Authorization', `Bearer ${sellerToken}`);\n      expect(res).to.have.status(200);\n      expect(res.body.data).to.have.property('metrics');\n    });\n    it('should get buyer engagement analytics', async () => {\n      const res = await chai.request(app).get('/api/analytics/engagement').set('Authorization', `Bearer ${sellerToken}`);\n      expect(res).to.have.status(200);\n      expect(res.body.data).to.have.property('buyerMetrics');\n    });\n  });\n  describe('9. Admin Operations', () => {\n    it('should get platform stats', async () => {\n      const res = await chai.request(app).get('/api/admin/stats').set('Authorization', `Bearer ${adminToken}`);\n      expect(res).to.have.status(200);\n      expect(res.body.stats).to.have.property('users');\n      expect(res.body.stats).to.have.property('horses');\n      expect(res.body.stats).to.have.property('transactions');\n    });\n    it('should get all transactions', async () => {\n      const res = await chai.request(app).get('/api/admin/transactions').set('Authorization', `Bearer ${adminToken}`);\n      expect(res).to.have.status(200);\n      expect(res.body.transactions).to.be.an('array');\n    });\n  });\n  describe('10. Support System', () => {\n    it('should create support ticket', async () => {\n      const res = await chai.request(app).post('/api/support/tickets').set('Authorization', `Bearer ${buyerToken}`).send({\n        subject: 'Payment Issue',\n        category: 'payment',\n        priority: 'high',\n        description: 'Unable to complete payment transaction'\n      });\n      expect(res).to.have.status(201);\n      expect(res.body.ticket).to.have.property('ticketNumber');\n    });\n    it('should update ticket status', async () => {\n      const res = await chai.request(app).put(`/api/support/tickets/${res.body.ticket._id}`).set('Authorization', `Bearer ${adminToken}`).send({\n        status: 'in_progress',\n        message: 'We are looking into this issue'\n      });\n      expect(res).to.have.status(200);\n      expect(res.body.ticket.status).to.equal('in_progress');\n    });\n  });\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjaGFpIiwicmVxdWlyZSIsImNoYWlIdHRwIiwiYXBwIiwiZXhwZWN0IiwibW9uZ29vc2UiLCJVc2VyIiwiU2VsbGVyIiwiSG9yc2UiLCJUcmFuc2FjdGlvbiIsIklucXVpcnkiLCJSZXZpZXciLCJNZXNzYWdlIiwiQ29udmVyc2F0aW9uIiwidXNlIiwiZGVzY3JpYmUiLCJidXllciIsImJ1eWVyVG9rZW4iLCJzZWxsZXIiLCJzZWxsZXJUb2tlbiIsImFkbWluIiwiYWRtaW5Ub2tlbiIsImhvcnNlIiwiaW5xdWlyeSIsImNvbnZlcnNhdGlvbiIsInJldmlldyIsInRyYW5zYWN0aW9uIiwiYmVmb3JlIiwiY29ubmVjdCIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsInVzZU5ld1VybFBhcnNlciIsInVzZVVuaWZpZWRUb3BvbG9neSIsIlByb21pc2UiLCJhbGwiLCJkZWxldGVNYW55IiwiYWZ0ZXIiLCJjb25uZWN0aW9uIiwiY2xvc2UiLCJpdCIsInJlcyIsInJlcXVlc3QiLCJwb3N0Iiwic2VuZCIsIm5hbWUiLCJlbWFpbCIsInBhc3N3b3JkIiwicm9sZSIsInBob25lIiwibG9jYXRpb24iLCJzdGF0ZSIsImNpdHkiLCJwaW5jb2RlIiwidG8iLCJoYXZlIiwic3RhdHVzIiwiYm9keSIsInByb3BlcnR5IiwidG9rZW4iLCJ1c2VyIiwiZ2V0Iiwic2V0IiwiZXF1YWwiLCJidXNpbmVzc05hbWUiLCJkZXNjcmlwdGlvbiIsImNvbnRhY3REZXRhaWxzIiwid2hhdHNhcHAiLCJidXNpbmVzc0RvY3VtZW50cyIsImdzdCIsInBhbiIsImRvY3VtZW50cyIsInR5cGUiLCJ1cmwiLCJwdWJsaWNfaWQiLCJzdWNjZXNzIiwiYmUiLCJ0cnVlIiwicHV0IiwiX2lkIiwibGV2ZWwiLCJ2ZXJpZmljYXRpb24iLCJhbW91bnQiLCJjdXJyZW5jeSIsIm5vdGVzIiwicGFja2FnZSIsImR1cmF0aW9uIiwicmF6b3JwYXlfcGF5bWVudF9pZCIsIkRhdGUiLCJub3ciLCJyYXpvcnBheV9vcmRlcl9pZCIsInJhem9ycGF5T3JkZXJJZCIsInJhem9ycGF5X3NpZ25hdHVyZSIsInN1YnNjcmlwdGlvblBhY2thZ2UiLCJzdWJzY3JpcHRpb24iLCJmYWxzZSIsInBob3RvcyIsInRodW1ibmFpbF91cmwiLCJhbiIsImJyZWVkIiwiYWdlIiwieWVhcnMiLCJtb250aHMiLCJnZW5kZXIiLCJjb2xvciIsInByaWNlIiwic3BlY2lmaWNhdGlvbnMiLCJ0cmFpbmluZyIsImRpc2NpcGxpbmUiLCJ0ZW1wZXJhbWVudCIsImhlYWx0aFN0YXR1cyIsInZhY2NpbmF0aW9uIiwicGFwZXJzIiwiYm9vc3QiLCJhY3RpdmUiLCJmaWx0ZXJzIiwicHJpY2VSYW5nZSIsIm1pbiIsIm1heCIsInBhZ2UiLCJsaW1pdCIsImRhdGEiLCJob3JzZXMiLCJyZWNvbW1lbmRhdGlvbnMiLCJtZXNzYWdlIiwiY29udGFjdFByZWZlcmVuY2UiLCJyZWNpcGllbnRJZCIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsImNvbnZlcnNhdGlvbklkIiwiY29udGVudCIsInJhdGluZyIsIm92ZXJhbGwiLCJhc3BlY3RzIiwiY29tbXVuaWNhdGlvbiIsImFjY3VyYWN5IiwidmFsdWUiLCJleHBlcmllbmNlIiwidGl0bGUiLCJwcm9zIiwiY29ucyIsInJlYXNvbiIsImRhc2hib2FyZCIsInN0YXRzIiwidHJhbnNhY3Rpb25zIiwic3ViamVjdCIsImNhdGVnb3J5IiwicHJpb3JpdHkiLCJ0aWNrZXQiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXHNjcmlwdHNcXCIsInNvdXJjZXMiOlsiYWxsRW5kcG9pbnRzVGVzdHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgY2hhaSA9IHJlcXVpcmUoJ2NoYWknKTtcclxuY29uc3QgY2hhaUh0dHAgPSByZXF1aXJlKCdjaGFpLWh0dHAnKTtcclxuY29uc3QgYXBwID0gcmVxdWlyZSgnLi4vc2VydmVyJyk7XHJcbmNvbnN0IHsgZXhwZWN0IH0gPSBjaGFpO1xyXG5jb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xyXG5jb25zdCBTZWxsZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvU2VsbGVyJyk7XHJcbmNvbnN0IEhvcnNlID0gcmVxdWlyZSgnLi4vbW9kZWxzL0hvcnNlJyk7XHJcbmNvbnN0IFRyYW5zYWN0aW9uID0gcmVxdWlyZSgnLi4vbW9kZWxzL1RyYW5zYWN0aW9uJyk7XHJcbmNvbnN0IElucXVpcnkgPSByZXF1aXJlKCcuLi9tb2RlbHMvSW5xdWlyeScpO1xyXG5jb25zdCBSZXZpZXcgPSByZXF1aXJlKCcuLi9tb2RlbHMvUmV2aWV3Jyk7XHJcbmNvbnN0IE1lc3NhZ2UgPSByZXF1aXJlKCcuLi9tb2RlbHMvTWVzc2FnZScpO1xyXG5jb25zdCBDb252ZXJzYXRpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvQ29udmVyc2F0aW9uJyk7XHJcblxyXG5jaGFpLnVzZShjaGFpSHR0cCk7XHJcblxyXG5kZXNjcmliZSgnQ29tcGxldGUgU3lzdGVtIFRlc3QgU3VpdGUnLCAoKSA9PiB7XHJcbiAgICBsZXQgYnV5ZXIsIGJ1eWVyVG9rZW47XHJcbiAgICBsZXQgc2VsbGVyLCBzZWxsZXJUb2tlbjtcclxuICAgIGxldCBhZG1pbiwgYWRtaW5Ub2tlbjtcclxuICAgIGxldCBob3JzZSwgaW5xdWlyeSwgY29udmVyc2F0aW9uLCByZXZpZXcsIHRyYW5zYWN0aW9uO1xyXG5cclxuICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgLy8gQ29ubmVjdCB0byB0ZXN0IGRhdGFiYXNlXHJcbiAgICAgICAgYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSwge1xyXG4gICAgICAgICAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXHJcbiAgICAgICAgICAgIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBDbGVhciB0ZXN0IGRhdGFcclxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgICAgIFVzZXIuZGVsZXRlTWFueSh7fSksXHJcbiAgICAgICAgICAgIFNlbGxlci5kZWxldGVNYW55KHt9KSxcclxuICAgICAgICAgICAgSG9yc2UuZGVsZXRlTWFueSh7fSksXHJcbiAgICAgICAgICAgIFRyYW5zYWN0aW9uLmRlbGV0ZU1hbnkoe30pLFxyXG4gICAgICAgICAgICBJbnF1aXJ5LmRlbGV0ZU1hbnkoe30pLFxyXG4gICAgICAgICAgICBSZXZpZXcuZGVsZXRlTWFueSh7fSksXHJcbiAgICAgICAgICAgIE1lc3NhZ2UuZGVsZXRlTWFueSh7fSksXHJcbiAgICAgICAgICAgIENvbnZlcnNhdGlvbi5kZWxldGVNYW55KHt9KVxyXG4gICAgICAgIF0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgYWZ0ZXIoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGF3YWl0IG1vbmdvb3NlLmNvbm5lY3Rpb24uY2xvc2UoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCcxLiBBdXRoZW50aWNhdGlvbiAmIFVzZXIgTWFuYWdlbWVudCcsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGEgYnV5ZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucG9zdCgnL2FwaS9hdXRoL3JlZ2lzdGVyJylcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVGVzdCBCdXllcicsXHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6ICdidXllckB0ZXN0LmNvbScsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICd0ZXN0MTIzJyxcclxuICAgICAgICAgICAgICAgICAgICByb2xlOiAndXNlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgcGhvbmU6ICcxMjM0NTY3ODkwJyxcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogJ01haGFyYXNodHJhJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2l0eTogJ011bWJhaScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpbmNvZGU6ICc0MDAwMDEnXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzKS50by5oYXZlLnN0YXR1cygyMDEpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmhhdmUucHJvcGVydHkoJ3Rva2VuJyk7XHJcbiAgICAgICAgICAgIGJ1eWVyVG9rZW4gPSByZXMuYm9keS50b2tlbjtcclxuICAgICAgICAgICAgYnV5ZXIgPSByZXMuYm9keS51c2VyO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHJlZ2lzdGVyIGEgc2VsbGVyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnBvc3QoJy9hcGkvYXV0aC9yZWdpc3RlcicpXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1Rlc3QgU2VsbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogJ3NlbGxlckB0ZXN0LmNvbScsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICd0ZXN0MTIzJyxcclxuICAgICAgICAgICAgICAgICAgICByb2xlOiAnc2VsbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICBwaG9uZTogJzk4NzY1NDMyMTAnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAnS2FybmF0YWthJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2l0eTogJ0JhbmdhbG9yZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpbmNvZGU6ICc1NjAwMDEnXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzKS50by5oYXZlLnN0YXR1cygyMDEpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzLmJvZHkpLnRvLmhhdmUucHJvcGVydHkoJ3Rva2VuJyk7XHJcbiAgICAgICAgICAgIHNlbGxlclRva2VuID0gcmVzLmJvZHkudG9rZW47XHJcbiAgICAgICAgICAgIHNlbGxlciA9IHJlcy5ib2R5LnVzZXI7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmVnaXN0ZXIgYW4gYWRtaW4nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucG9zdCgnL2FwaS9hdXRoL3JlZ2lzdGVyJylcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVGVzdCBBZG1pbicsXHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6ICdhZG1pbkB0ZXN0LmNvbScsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICd0ZXN0MTIzJyxcclxuICAgICAgICAgICAgICAgICAgICByb2xlOiAnYWRtaW4nXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uaGF2ZS5wcm9wZXJ0eSgndG9rZW4nKTtcclxuICAgICAgICAgICAgYWRtaW5Ub2tlbiA9IHJlcy5ib2R5LnRva2VuO1xyXG4gICAgICAgICAgICBhZG1pbiA9IHJlcy5ib2R5LnVzZXI7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgbG9naW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucG9zdCgnL2FwaS9hdXRoL2xvZ2luJylcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogJ2J1eWVyQHRlc3QuY29tJyxcclxuICAgICAgICAgICAgICAgICAgICBwYXNzd29yZDogJ3Rlc3QxMjMnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keSkudG8uaGF2ZS5wcm9wZXJ0eSgndG9rZW4nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgdXNlciBwcm9maWxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLmdldCgnL2FwaS9hdXRoL21lJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YnV5ZXJUb2tlbn1gKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS51c2VyLmVtYWlsKS50by5lcXVhbCgnYnV5ZXJAdGVzdC5jb20nKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCcyLiBTZWxsZXIgUHJvZmlsZSAmIFZlcmlmaWNhdGlvbicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBzZWxsZXIgcHJvZmlsZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wb3N0KCcvYXBpL3NlbGxlcnMvcHJvZmlsZScpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3NlbGxlclRva2VufWApXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVzaW5lc3NOYW1lOiAnUHJlbWl1bSBTdGFibGVzJyxcclxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0hpZ2gtcXVhbGl0eSBob3JzZSBicmVlZGluZyBhbmQgdHJhaW5pbmcnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhY3REZXRhaWxzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBob25lOiAnOTg3NjU0MzIxMCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVtYWlsOiAnY29udGFjdEBwcmVtaXVtc3RhYmxlcy5jb20nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGF0c2FwcDogJzk4NzY1NDMyMTAnXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBidXNpbmVzc0RvY3VtZW50czoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBnc3Q6ICdHU1RJTjEyMzQ1NicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhbjogJ1BBTkFCMTIzNEMnXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzKS50by5oYXZlLnN0YXR1cygyMDEpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzLmJvZHkuc2VsbGVyLmJ1c2luZXNzTmFtZSkudG8uZXF1YWwoJ1ByZW1pdW0gU3RhYmxlcycpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHN1Ym1pdCB2ZXJpZmljYXRpb24gZG9jdW1lbnRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnBvc3QoJy9hcGkvdmVyaWZpY2F0aW9uL3N1Ym1pdCcpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3NlbGxlclRva2VufWApXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnRzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdpZGVudGl0eScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL2lkLmpwZycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWNfaWQ6ICdpZF8xMjMnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdhZGRyZXNzJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vZXhhbXBsZS5jb20vYWRkcmVzcy5qcGcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljX2lkOiAnYWRkcmVzc18xMjMnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5zdWNjZXNzKS50by5iZS50cnVlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHZlcmlmeSBzZWxsZXIgKGFkbWluKScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wdXQoYC9hcGkvYWRtaW4vc2VsbGVycy8ke3NlbGxlci5faWR9L3ZlcmlmaWNhdGlvbmApXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2FkbWluVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICd2ZXJpZmllZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgbGV2ZWw6ICdwcm9mZXNzaW9uYWwnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5zZWxsZXIudmVyaWZpY2F0aW9uLnN0YXR1cykudG8uZXF1YWwoJ3ZlcmlmaWVkJyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnMy4gU3Vic2NyaXB0aW9uIE1hbmFnZW1lbnQnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgc3Vic2NyaXB0aW9uIHBheW1lbnQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucG9zdCgnL2FwaS9wYXltZW50cy9jcmVhdGUnKVxyXG4gICAgICAgICAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHtzZWxsZXJUb2tlbn1gKVxyXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGFtb3VudDogOTk5OSxcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW5jeTogJ0lOUicsXHJcbiAgICAgICAgICAgICAgICAgICAgbm90ZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1YnNjcmlwdGlvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2U6ICdSb3lhbCBTdGFsbGlvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxMlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5KS50by5oYXZlLnByb3BlcnR5KCdvcmRlcicpO1xyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbiA9IHJlcy5ib2R5LnRyYW5zYWN0aW9uO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHZlcmlmeSBzdWJzY3JpcHRpb24gcGF5bWVudCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wb3N0KCcvYXBpL3BheW1lbnRzL3ZlcmlmeScpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3NlbGxlclRva2VufWApXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgcmF6b3JwYXlfcGF5bWVudF9pZDogJ3BheV8nICsgRGF0ZS5ub3coKSxcclxuICAgICAgICAgICAgICAgICAgICByYXpvcnBheV9vcmRlcl9pZDogdHJhbnNhY3Rpb24ucmF6b3JwYXlPcmRlcklkLFxyXG4gICAgICAgICAgICAgICAgICAgIHJhem9ycGF5X3NpZ25hdHVyZTogJ3ZhbGlkX3NpZ25hdHVyZSdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LnRyYW5zYWN0aW9uLnN0YXR1cykudG8uZXF1YWwoJ2NvbXBsZXRlZCcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHVwZGF0ZSBzdWJzY3JpcHRpb24gcGFja2FnZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wdXQoJy9hcGkvc2VsbGVycy9zdWJzY3JpcHRpb24nKVxyXG4gICAgICAgICAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHtzZWxsZXJUb2tlbn1gKVxyXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvblBhY2thZ2U6ICdSb3lhbCBTdGFsbGlvbidcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LnN1Y2Nlc3MpLnRvLmJlLnRydWU7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5zdWJzY3JpcHRpb24ucGFja2FnZSkudG8uZXF1YWwoJ1JveWFsIFN0YWxsaW9uJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgc3Vic2NyaXB0aW9uIHBhY2thZ2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucHV0KCcvYXBpL3NlbGxlcnMvc3Vic2NyaXB0aW9uJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7c2VsbGVyVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25QYWNrYWdlOiAnSW52YWxpZCBQYWNrYWdlJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzKS50by5oYXZlLnN0YXR1cyg0MDApO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzLmJvZHkuc3VjY2VzcykudG8uYmUuZmFsc2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnNC4gSG9yc2UgTGlzdGluZyBNYW5hZ2VtZW50JywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdzaG91bGQgdXBsb2FkIHBob3RvcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wb3N0KCcvYXBpL3Bob3Rvcy91cGxvYWQnKVxyXG4gICAgICAgICAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHtzZWxsZXJUb2tlbn1gKVxyXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHBob3RvczogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdodHRwczovL2V4YW1wbGUuY29tL2hvcnNlMS5qcGcnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljX2lkOiAnaG9yc2UxJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbF91cmw6ICdodHRwczovL2V4YW1wbGUuY29tL2hvcnNlMV90aHVtYi5qcGcnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBdXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5waG90b3MpLnRvLmJlLmFuKCdhcnJheScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBob3JzZSBsaXN0aW5nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnBvc3QoJy9hcGkvaG9yc2VzJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7c2VsbGVyVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVGh1bmRlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlZWQ6ICdUaG9yb3VnaGJyZWQnLFxyXG4gICAgICAgICAgICAgICAgICAgIGFnZTogeyB5ZWFyczogNSwgbW9udGhzOiAzIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZ2VuZGVyOiAnU3RhbGxpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnQmF5JyxcclxuICAgICAgICAgICAgICAgICAgICBwcmljZTogNTAwMDAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ2hhbXBpb24gcmFjZWhvcnNlIHdpdGggZXhjZWxsZW50IGJsb29kbGluZScsXHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICdLYXJuYXRha2EnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaXR5OiAnQmFuZ2Fsb3JlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGluY29kZTogJzU2MDAwMSdcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHNwZWNpZmljYXRpb25zOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWluaW5nOiAnQWR2YW5jZWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNjaXBsaW5lOiBbJ1JhY2luZycsICdEcmVzc2FnZSddLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wZXJhbWVudDogJ0NhbG0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWFsdGhTdGF0dXM6ICdFeGNlbGxlbnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWNjaW5hdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFwZXJzOiB0cnVlXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzKS50by5oYXZlLnN0YXR1cygyMDEpO1xyXG4gICAgICAgICAgICBob3JzZSA9IHJlcy5ib2R5LmhvcnNlO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGJvb3N0IGxpc3RpbmcgdmlzaWJpbGl0eScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wb3N0KGAvYXBpL3Zpc2liaWxpdHkvc3BvdGxpZ2h0LyR7aG9yc2UuX2lkfWApXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3NlbGxlclRva2VufWApXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDMwIC8vIGRheXNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LmhvcnNlLmJvb3N0LmFjdGl2ZSkudG8uYmUudHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCc1LiBCdXllciBJbnRlcmFjdGlvbicsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIHNlYXJjaCBob3JzZXMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucG9zdCgnL2FwaS9zZWFyY2gnKVxyXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlZWQ6ICdUaG9yb3VnaGJyZWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmljZVJhbmdlOiB7IG1pbjogNDAwMDAwLCBtYXg6IDYwMDAwMCB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogeyBzdGF0ZTogJ0thcm5hdGFrYScgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgICAgICAgICBsaW1pdDogMTBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LmRhdGEuaG9yc2VzKS50by5iZS5hbignYXJyYXknKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgcmVjb21tZW5kYXRpb25zJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLmdldCgnL2FwaS9yZWNvbW1lbmRhdGlvbnMvcGVyc29uYWxpemVkJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YnV5ZXJUb2tlbn1gKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5yZWNvbW1lbmRhdGlvbnMpLnRvLmJlLmFuKCdhcnJheScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBpbnF1aXJ5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnBvc3QoJy9hcGkvaW5xdWlyaWVzJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YnV5ZXJUb2tlbn1gKVxyXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgIGhvcnNlOiBob3JzZS5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0ludGVyZXN0ZWQgaW4gdmlld2luZyB0aGlzIGhvcnNlJyxcclxuICAgICAgICAgICAgICAgICAgICBjb250YWN0UHJlZmVyZW5jZTogJ2VtYWlsJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzKS50by5oYXZlLnN0YXR1cygyMDEpO1xyXG4gICAgICAgICAgICBpbnF1aXJ5ID0gcmVzLmJvZHkuaW5xdWlyeTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCByZXNwb25kIHRvIGlucXVpcnknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucG9zdChgL2FwaS9pbnF1aXJpZXMvJHtpbnF1aXJ5Ll9pZH0vcmVzcG9uZGApXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3NlbGxlclRva2VufWApXHJcbiAgICAgICAgICAgICAgICAuc2VuZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RoYW5rIHlvdSBmb3IgeW91ciBpbnRlcmVzdC4gV2hlbiB3b3VsZCB5b3UgbGlrZSB0byB2aXNpdD8nXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5pbnF1aXJ5LnN0YXR1cykudG8uZXF1YWwoJ3Jlc3BvbmRlZCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJzYuIE1lc3NhZ2luZyBTeXN0ZW0nLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBzdGFydCBjb252ZXJzYXRpb24nLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAucG9zdCgnL2FwaS9tZXNzYWdpbmcvY29udmVyc2F0aW9ucycpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2J1eWVyVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICByZWNpcGllbnRJZDogc2VsbGVyLl9pZCxcclxuICAgICAgICAgICAgICAgICAgICBlbnRpdHlUeXBlOiAnaG9yc2UnLFxyXG4gICAgICAgICAgICAgICAgICAgIGVudGl0eUlkOiBob3JzZS5faWRcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAxKTtcclxuICAgICAgICAgICAgY29udmVyc2F0aW9uID0gcmVzLmJvZHkuY29udmVyc2F0aW9uO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHNlbmQgbWVzc2FnZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wb3N0KCcvYXBpL21lc3NhZ2luZy9tZXNzYWdlcycpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2J1eWVyVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBjb252ZXJzYXRpb25JZDogY29udmVyc2F0aW9uLl9pZCxcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnSXMgdGhlIGhvcnNlIHN0aWxsIGF2YWlsYWJsZT8nXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5tZXNzYWdlLmNvbnRlbnQpLnRvLmVxdWFsKCdJcyB0aGUgaG9yc2Ugc3RpbGwgYXZhaWxhYmxlPycpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJzcuIFJldmlldyBTeXN0ZW0nLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBjcmVhdGUgcmV2aWV3JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnBvc3QoJy9hcGkvcmV2aWV3cycpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2J1eWVyVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBlbnRpdHlUeXBlOiAnaG9yc2UnLFxyXG4gICAgICAgICAgICAgICAgICAgIGVudGl0eUlkOiBob3JzZS5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgcmF0aW5nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJhbGw6IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzcGVjdHM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbW11bmljYXRpb246IDUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2N1cmFjeTogNCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiA1LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZXJpZW5jZTogNVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnRXhjZWxsZW50IEhvcnNlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFeGFjdGx5IGFzIGRlc2NyaWJlZC4gVmVyeSBzYXRpc2ZpZWQgd2l0aCB0aGUgcHVyY2hhc2UuJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvczogWydXZWxsIHRyYWluZWQnLCAnR29vZCB0ZW1wZXJhbWVudCddLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zOiBbJ05vbmUnXVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAxKTtcclxuICAgICAgICAgICAgcmV2aWV3ID0gcmVzLmJvZHkucmV2aWV3O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIG1vZGVyYXRlIHJldmlldycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wdXQoYC9hcGkvcmV2aWV3cy8ke3Jldmlldy5faWR9L21vZGVyYXRlYClcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YWRtaW5Ub2tlbn1gKVxyXG4gICAgICAgICAgICAgICAgLnNlbmQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2FwcHJvdmVkJyxcclxuICAgICAgICAgICAgICAgICAgICByZWFzb246ICdNZWV0cyBjb21tdW5pdHkgZ3VpZGVsaW5lcydcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LnJldmlldy5zdGF0dXMpLnRvLmVxdWFsKCdhcHByb3ZlZCcpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJzguIEFuYWx5dGljcyAmIFJlcG9ydGluZycsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGdldCBzZWxsZXIgZGFzaGJvYXJkIHN0YXRzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLmdldCgnL2FwaS9zZWxsZXIvZGFzaGJvYXJkL3N0YXRzJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7c2VsbGVyVG9rZW59YCk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzKS50by5oYXZlLnN0YXR1cygyMDApO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzLmJvZHkuZGFzaGJvYXJkKS50by5oYXZlLnByb3BlcnR5KCdsaXN0aW5ncycpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzLmJvZHkuZGFzaGJvYXJkKS50by5oYXZlLnByb3BlcnR5KCdpbnF1aXJpZXMnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LmRhc2hib2FyZCkudG8uaGF2ZS5wcm9wZXJ0eSgndHJhbnNhY3Rpb25zJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZ2V0IGxpc3RpbmcgcGVyZm9ybWFuY2UnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAuZ2V0KGAvYXBpL2FuYWx5dGljcy9saXN0aW5ncy8ke2hvcnNlLl9pZH1gKVxyXG4gICAgICAgICAgICAgICAgLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHtzZWxsZXJUb2tlbn1gKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5kYXRhKS50by5oYXZlLnByb3BlcnR5KCdtZXRyaWNzJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZ2V0IGJ1eWVyIGVuZ2FnZW1lbnQgYW5hbHl0aWNzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLmdldCgnL2FwaS9hbmFseXRpY3MvZW5nYWdlbWVudCcpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3NlbGxlclRva2VufWApO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LmRhdGEpLnRvLmhhdmUucHJvcGVydHkoJ2J1eWVyTWV0cmljcycpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJzkuIEFkbWluIE9wZXJhdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgcGxhdGZvcm0gc3RhdHMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNoYWkucmVxdWVzdChhcHApXHJcbiAgICAgICAgICAgICAgICAuZ2V0KCcvYXBpL2FkbWluL3N0YXRzJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YWRtaW5Ub2tlbn1gKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS5zdGF0cykudG8uaGF2ZS5wcm9wZXJ0eSgndXNlcnMnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LnN0YXRzKS50by5oYXZlLnByb3BlcnR5KCdob3JzZXMnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LnN0YXRzKS50by5oYXZlLnByb3BlcnR5KCd0cmFuc2FjdGlvbnMnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBnZXQgYWxsIHRyYW5zYWN0aW9ucycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5nZXQoJy9hcGkvYWRtaW4vdHJhbnNhY3Rpb25zJylcclxuICAgICAgICAgICAgICAgIC5zZXQoJ0F1dGhvcml6YXRpb24nLCBgQmVhcmVyICR7YWRtaW5Ub2tlbn1gKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS50cmFuc2FjdGlvbnMpLnRvLmJlLmFuKCdhcnJheScpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJzEwLiBTdXBwb3J0IFN5c3RlbScsICgpID0+IHtcclxuICAgICAgICBpdCgnc2hvdWxkIGNyZWF0ZSBzdXBwb3J0IHRpY2tldCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgY2hhaS5yZXF1ZXN0KGFwcClcclxuICAgICAgICAgICAgICAgIC5wb3N0KCcvYXBpL3N1cHBvcnQvdGlja2V0cycpXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2J1eWVyVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiAnUGF5bWVudCBJc3N1ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdwYXltZW50JyxcclxuICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVW5hYmxlIHRvIGNvbXBsZXRlIHBheW1lbnQgdHJhbnNhY3Rpb24nXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMpLnRvLmhhdmUuc3RhdHVzKDIwMSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXMuYm9keS50aWNrZXQpLnRvLmhhdmUucHJvcGVydHkoJ3RpY2tldE51bWJlcicpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHVwZGF0ZSB0aWNrZXQgc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjaGFpLnJlcXVlc3QoYXBwKVxyXG4gICAgICAgICAgICAgICAgLnB1dChgL2FwaS9zdXBwb3J0L3RpY2tldHMvJHtyZXMuYm9keS50aWNrZXQuX2lkfWApXHJcbiAgICAgICAgICAgICAgICAuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2FkbWluVG9rZW59YClcclxuICAgICAgICAgICAgICAgIC5zZW5kKHtcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdpbl9wcm9ncmVzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ1dlIGFyZSBsb29raW5nIGludG8gdGhpcyBpc3N1ZSdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgZXhwZWN0KHJlcykudG8uaGF2ZS5zdGF0dXMoMjAwKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcy5ib2R5LnRpY2tldC5zdGF0dXMpLnRvLmVxdWFsKCdpbl9wcm9ncmVzcycpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn0pOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQU0sQ0FBQztBQUM1QixNQUFNQyxRQUFRLEdBQUdELE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDckMsTUFBTUUsR0FBRyxHQUFHRixPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ2hDLE1BQU07RUFBRUc7QUFBTyxDQUFDLEdBQUdKLElBQUk7QUFDdkIsTUFBTUssUUFBUSxH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","map":{"version":3,"names":["chai","require","chaiHttp","app","expect","mongoose","User","Seller","Horse","Transaction","Inquiry","Review","Message","Conversation","use","describe","buyer","buyerToken","seller","sellerToken","admin","adminToken","horse","inquiry","conversation","review","transaction","before","connect","process","env","MONGODB_URI","useNewUrlParser","useUnifiedTopology","Promise","all","deleteMany","after","connection","close","it","res","request","post","send","name","email","password","role","phone","location","state","city","pincode","to","have","status","body","property","token","user","get","set","equal","businessName","description","contactDetails","whatsapp","businessDocuments","gst","pan","documents","type","url","public_id","success","be","true","put","_id","level","verification","amount","currency","notes","package","duration","razorpay_payment_id","Date","now","razorpay_order_id","razorpayOrderId","razorpay_signature","subscriptionPackage","subscription","false","photos","thumbnail_url","an","breed","age","years","months","gender","color","price","specifications","training","discipline","temperament","healthStatus","vaccination","papers","boost","active","filters","priceRange","min","max","page","limit","data","horses","recommendations","message","contactPreference","recipientId","entityType","entityId","conversationId","content","rating","overall","aspects","communication","accuracy","value","experience","title","pros","cons","reason","dashboard","stats","transactions","subject","category","priority","ticket"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\scripts\\","sources":["allEndpointsTests.js"],"sourcesContent":["const chai = require('chai');\r\nconst chaiHttp = require('chai-http');\r\nconst app = require('../server');\r\nconst { expect } = chai;\r\nconst mongoose = require('mongoose');\r\nconst User = require('../models/User');\r\nconst Seller = require('../models/Seller');\r\nconst Horse = require('../models/Horse');\r\nconst Transaction = require('../models/Transaction');\r\nconst Inquiry = require('../models/Inquiry');\r\nconst Review = require('../models/Review');\r\nconst Message = require('../models/Message');\r\nconst Conversation = require('../models/Conversation');\r\n\r\nchai.use(chaiHttp);\r\n\r\ndescribe('Complete System Test Suite', () => {\r\n    let buyer, buyerToken;\r\n    let seller, sellerToken;\r\n    let admin, adminToken;\r\n    let horse, inquiry, conversation, review, transaction;\r\n\r\n    before(async () => {\r\n        // Connect to test database\r\n        await mongoose.connect(process.env.MONGODB_URI, {\r\n            useNewUrlParser: true,\r\n            useUnifiedTopology: true\r\n        });\r\n\r\n        // Clear test data\r\n        await Promise.all([\r\n            User.deleteMany({}),\r\n            Seller.deleteMany({}),\r\n            Horse.deleteMany({}),\r\n            Transaction.deleteMany({}),\r\n            Inquiry.deleteMany({}),\r\n            Review.deleteMany({}),\r\n            Message.deleteMany({}),\r\n            Conversation.deleteMany({})\r\n        ]);\r\n    });\r\n\r\n    after(async () => {\r\n        await mongoose.connection.close();\r\n    });\r\n\r\n    describe('1. Authentication & User Management', () => {\r\n        it('should register a buyer', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/auth/register')\r\n                .send({\r\n                    name: 'Test Buyer',\r\n                    email: 'buyer@test.com',\r\n                    password: 'test123',\r\n                    role: 'user',\r\n                    phone: '1234567890',\r\n                    location: {\r\n                        state: 'Maharashtra',\r\n                        city: 'Mumbai',\r\n                        pincode: '400001'\r\n                    }\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            expect(res.body).to.have.property('token');\r\n            buyerToken = res.body.token;\r\n            buyer = res.body.user;\r\n        });\r\n\r\n        it('should register a seller', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/auth/register')\r\n                .send({\r\n                    name: 'Test Seller',\r\n                    email: 'seller@test.com',\r\n                    password: 'test123',\r\n                    role: 'seller',\r\n                    phone: '9876543210',\r\n                    location: {\r\n                        state: 'Karnataka',\r\n                        city: 'Bangalore',\r\n                        pincode: '560001'\r\n                    }\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            expect(res.body).to.have.property('token');\r\n            sellerToken = res.body.token;\r\n            seller = res.body.user;\r\n        });\r\n\r\n        it('should register an admin', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/auth/register')\r\n                .send({\r\n                    name: 'Test Admin',\r\n                    email: 'admin@test.com',\r\n                    password: 'test123',\r\n                    role: 'admin'\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            expect(res.body).to.have.property('token');\r\n            adminToken = res.body.token;\r\n            admin = res.body.user;\r\n        });\r\n\r\n        it('should login users', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/auth/login')\r\n                .send({\r\n                    email: 'buyer@test.com',\r\n                    password: 'test123'\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body).to.have.property('token');\r\n        });\r\n\r\n        it('should get user profile', async () => {\r\n            const res = await chai.request(app)\r\n                .get('/api/auth/me')\r\n                .set('Authorization', `Bearer ${buyerToken}`);\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.user.email).to.equal('buyer@test.com');\r\n        });\r\n    });\r\n\r\n    describe('2. Seller Profile & Verification', () => {\r\n        it('should create seller profile', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/sellers/profile')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    businessName: 'Premium Stables',\r\n                    description: 'High-quality horse breeding and training',\r\n                    contactDetails: {\r\n                        phone: '9876543210',\r\n                        email: 'contact@premiumstables.com',\r\n                        whatsapp: '9876543210'\r\n                    },\r\n                    businessDocuments: {\r\n                        gst: 'GSTIN123456',\r\n                        pan: 'PANAB1234C'\r\n                    }\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            expect(res.body.seller.businessName).to.equal('Premium Stables');\r\n        });\r\n\r\n        it('should submit verification documents', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/verification/submit')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    documents: [\r\n                        {\r\n                            type: 'identity',\r\n                            url: 'https://example.com/id.jpg',\r\n                            public_id: 'id_123'\r\n                        },\r\n                        {\r\n                            type: 'address',\r\n                            url: 'https://example.com/address.jpg',\r\n                            public_id: 'address_123'\r\n                        }\r\n                    ]\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.success).to.be.true;\r\n        });\r\n\r\n        it('should verify seller (admin)', async () => {\r\n            const res = await chai.request(app)\r\n                .put(`/api/admin/sellers/${seller._id}/verification`)\r\n                .set('Authorization', `Bearer ${adminToken}`)\r\n                .send({\r\n                    status: 'verified',\r\n                    level: 'professional'\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.seller.verification.status).to.equal('verified');\r\n        });\r\n    });\r\n\r\n    describe('3. Subscription Management', () => {\r\n        it('should create subscription payment', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/payments/create')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    amount: 9999,\r\n                    currency: 'INR',\r\n                    notes: {\r\n                        type: 'subscription',\r\n                        package: 'Royal Stallion',\r\n                        duration: 12\r\n                    }\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body).to.have.property('order');\r\n            transaction = res.body.transaction;\r\n        });\r\n\r\n        it('should verify subscription payment', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/payments/verify')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    razorpay_payment_id: 'pay_' + Date.now(),\r\n                    razorpay_order_id: transaction.razorpayOrderId,\r\n                    razorpay_signature: 'valid_signature'\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.transaction.status).to.equal('completed');\r\n        });\r\n\r\n        it('should update subscription package', async () => {\r\n            const res = await chai.request(app)\r\n                .put('/api/sellers/subscription')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    subscriptionPackage: 'Royal Stallion'\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.success).to.be.true;\r\n            expect(res.body.subscription.package).to.equal('Royal Stallion');\r\n        });\r\n\r\n        it('should reject invalid subscription package', async () => {\r\n            const res = await chai.request(app)\r\n                .put('/api/sellers/subscription')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    subscriptionPackage: 'Invalid Package'\r\n                });\r\n\r\n            expect(res).to.have.status(400);\r\n            expect(res.body.success).to.be.false;\r\n        });\r\n    });\r\n\r\n    describe('4. Horse Listing Management', () => {\r\n        it('should upload photos', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/photos/upload')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    photos: [\r\n                        {\r\n                            url: 'https://example.com/horse1.jpg',\r\n                            public_id: 'horse1',\r\n                            thumbnail_url: 'https://example.com/horse1_thumb.jpg'\r\n                        }\r\n                    ]\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.photos).to.be.an('array');\r\n        });\r\n\r\n        it('should create horse listing', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/horses')\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    name: 'Thunder',\r\n                    breed: 'Thoroughbred',\r\n                    age: { years: 5, months: 3 },\r\n                    gender: 'Stallion',\r\n                    color: 'Bay',\r\n                    price: 500000,\r\n                    description: 'Champion racehorse with excellent bloodline',\r\n                    location: {\r\n                        state: 'Karnataka',\r\n                        city: 'Bangalore',\r\n                        pincode: '560001'\r\n                    },\r\n                    specifications: {\r\n                        training: 'Advanced',\r\n                        discipline: ['Racing', 'Dressage'],\r\n                        temperament: 'Calm',\r\n                        healthStatus: 'Excellent',\r\n                        vaccination: true,\r\n                        papers: true\r\n                    }\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            horse = res.body.horse;\r\n        });\r\n\r\n        it('should boost listing visibility', async () => {\r\n            const res = await chai.request(app)\r\n                .post(`/api/visibility/spotlight/${horse._id}`)\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    duration: 30 // days\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.horse.boost.active).to.be.true;\r\n        });\r\n    });\r\n\r\n    describe('5. Buyer Interaction', () => {\r\n        it('should search horses', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/search')\r\n                .send({\r\n                    filters: {\r\n                        breed: 'Thoroughbred',\r\n                        priceRange: { min: 400000, max: 600000 },\r\n                        location: { state: 'Karnataka' }\r\n                    },\r\n                    page: 1,\r\n                    limit: 10\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.data.horses).to.be.an('array');\r\n        });\r\n\r\n        it('should get recommendations', async () => {\r\n            const res = await chai.request(app)\r\n                .get('/api/recommendations/personalized')\r\n                .set('Authorization', `Bearer ${buyerToken}`);\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.recommendations).to.be.an('array');\r\n        });\r\n\r\n        it('should create inquiry', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/inquiries')\r\n                .set('Authorization', `Bearer ${buyerToken}`)\r\n                .send({\r\n                    horse: horse._id,\r\n                    message: 'Interested in viewing this horse',\r\n                    contactPreference: 'email'\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            inquiry = res.body.inquiry;\r\n        });\r\n\r\n        it('should respond to inquiry', async () => {\r\n            const res = await chai.request(app)\r\n                .post(`/api/inquiries/${inquiry._id}/respond`)\r\n                .set('Authorization', `Bearer ${sellerToken}`)\r\n                .send({\r\n                    message: 'Thank you for your interest. When would you like to visit?'\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.inquiry.status).to.equal('responded');\r\n        });\r\n    });\r\n\r\n    describe('6. Messaging System', () => {\r\n        it('should start conversation', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/messaging/conversations')\r\n                .set('Authorization', `Bearer ${buyerToken}`)\r\n                .send({\r\n                    recipientId: seller._id,\r\n                    entityType: 'horse',\r\n                    entityId: horse._id\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            conversation = res.body.conversation;\r\n        });\r\n\r\n        it('should send message', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/messaging/messages')\r\n                .set('Authorization', `Bearer ${buyerToken}`)\r\n                .send({\r\n                    conversationId: conversation._id,\r\n                    content: 'Is the horse still available?'\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            expect(res.body.message.content).to.equal('Is the horse still available?');\r\n        });\r\n    });\r\n\r\n    describe('7. Review System', () => {\r\n        it('should create review', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/reviews')\r\n                .set('Authorization', `Bearer ${buyerToken}`)\r\n                .send({\r\n                    entityType: 'horse',\r\n                    entityId: horse._id,\r\n                    rating: {\r\n                        overall: 5,\r\n                        aspects: {\r\n                            communication: 5,\r\n                            accuracy: 4,\r\n                            value: 5,\r\n                            experience: 5\r\n                        }\r\n                    },\r\n                    content: {\r\n                        title: 'Excellent Horse',\r\n                        description: 'Exactly as described. Very satisfied with the purchase.',\r\n                        pros: ['Well trained', 'Good temperament'],\r\n                        cons: ['None']\r\n                    }\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            review = res.body.review;\r\n        });\r\n\r\n        it('should moderate review', async () => {\r\n            const res = await chai.request(app)\r\n                .put(`/api/reviews/${review._id}/moderate`)\r\n                .set('Authorization', `Bearer ${adminToken}`)\r\n                .send({\r\n                    status: 'approved',\r\n                    reason: 'Meets community guidelines'\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.review.status).to.equal('approved');\r\n        });\r\n    });\r\n\r\n    describe('8. Analytics & Reporting', () => {\r\n        it('should get seller dashboard stats', async () => {\r\n            const res = await chai.request(app)\r\n                .get('/api/seller/dashboard/stats')\r\n                .set('Authorization', `Bearer ${sellerToken}`);\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.dashboard).to.have.property('listings');\r\n            expect(res.body.dashboard).to.have.property('inquiries');\r\n            expect(res.body.dashboard).to.have.property('transactions');\r\n        });\r\n\r\n        it('should get listing performance', async () => {\r\n            const res = await chai.request(app)\r\n                .get(`/api/analytics/listings/${horse._id}`)\r\n                .set('Authorization', `Bearer ${sellerToken}`);\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.data).to.have.property('metrics');\r\n        });\r\n\r\n        it('should get buyer engagement analytics', async () => {\r\n            const res = await chai.request(app)\r\n                .get('/api/analytics/engagement')\r\n                .set('Authorization', `Bearer ${sellerToken}`);\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.data).to.have.property('buyerMetrics');\r\n        });\r\n    });\r\n\r\n    describe('9. Admin Operations', () => {\r\n        it('should get platform stats', async () => {\r\n            const res = await chai.request(app)\r\n                .get('/api/admin/stats')\r\n                .set('Authorization', `Bearer ${adminToken}`);\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.stats).to.have.property('users');\r\n            expect(res.body.stats).to.have.property('horses');\r\n            expect(res.body.stats).to.have.property('transactions');\r\n        });\r\n\r\n        it('should get all transactions', async () => {\r\n            const res = await chai.request(app)\r\n                .get('/api/admin/transactions')\r\n                .set('Authorization', `Bearer ${adminToken}`);\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.transactions).to.be.an('array');\r\n        });\r\n    });\r\n\r\n    describe('10. Support System', () => {\r\n        it('should create support ticket', async () => {\r\n            const res = await chai.request(app)\r\n                .post('/api/support/tickets')\r\n                .set('Authorization', `Bearer ${buyerToken}`)\r\n                .send({\r\n                    subject: 'Payment Issue',\r\n                    category: 'payment',\r\n                    priority: 'high',\r\n                    description: 'Unable to complete payment transaction'\r\n                });\r\n\r\n            expect(res).to.have.status(201);\r\n            expect(res.body.ticket).to.have.property('ticketNumber');\r\n        });\r\n\r\n        it('should update ticket status', async () => {\r\n            const res = await chai.request(app)\r\n                .put(`/api/support/tickets/${res.body.ticket._id}`)\r\n                .set('Authorization', `Bearer ${adminToken}`)\r\n                .send({\r\n                    status: 'in_progress',\r\n                    message: 'We are looking into this issue'\r\n                });\r\n\r\n            expect(res).to.have.status(200);\r\n            expect(res.body.ticket.status).to.equal('in_progress');\r\n        });\r\n    });\r\n}); "],"mappings":"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","ignoreList":[]}},"mtime":1734101665189},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\server.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst cors = require('cors');\nconst connectDB = require('./config/database');\nconst {\n  errorHandler,\n  notFound,\n  validationErrorHandler,\n  databaseErrorHandler,\n  jwtErrorHandler,\n  fileUploadErrorHandler\n} = require('./middlewares/error.middleware');\n\n// Route imports\nconst authRoutes = require('./routes/auth.routes');\nconst userRoutes = require('./routes/user.routes');\nconst sellerRoutes = require('./routes/seller.routes');\nconst horseRoutes = require('./routes/horse.routes');\nconst inquiryRoutes = require('./routes/inquiry.routes');\nconst transactionRoutes = require('./routes/transaction.routes');\nconst adminRoutes = require('./routes/admin.routes');\nconst sellerDashboardRoutes = require('./routes/seller.dashboard.routes');\nconst paymentRoutes = require('./routes/payment.routes');\nconst homeRoutes = require('./routes/home.routes');\nconst supportRoutes = require('./routes/support.routes');\nconst searchRoutes = require('./routes/search.routes');\nconst messagingRoutes = require('./routes/messaging.routes');\nconst reviewRoutes = require('./routes/review.routes');\nconst recommendationRoutes = require('./routes/recommendation.routes');\nconst app = express();\n\n// Connect to MongoDB\nif (process.env.NODE_ENV !== 'test') {\n  connectDB();\n}\n\n// Middleware\napp.use(cors());\napp.use(express.json());\napp.use(express.urlencoded({\n  extended: false\n}));\n\n// Health check endpoint\napp.get('/api/auth/health', (req, res) => {\n  res.json({\n    success: true,\n    message: 'Server is running and healthy'\n  });\n});\n\n// Routes\napp.use('/api/home', homeRoutes);\napp.use('/api/auth', authRoutes);\napp.use('/api/users', userRoutes);\napp.use('/api/sellers', sellerRoutes);\napp.use('/api/horses', horseRoutes);\napp.use('/api/inquiries', inquiryRoutes);\napp.use('/api/transactions', transactionRoutes);\napp.use('/api/admin', adminRoutes);\napp.use('/api/seller/dashboard', sellerDashboardRoutes);\napp.use('/api/payments', paymentRoutes);\napp.use('/api/support', supportRoutes);\napp.use('/api/search', searchRoutes);\napp.use('/api/messaging', messagingRoutes);\napp.use('/api/reviews', reviewRoutes);\napp.use('/api/recommendations', recommendationRoutes);\n\n// Error handlers\napp.use(notFound);\napp.use(validationErrorHandler);\napp.use(databaseErrorHandler);\napp.use(jwtErrorHandler);\napp.use(fileUploadErrorHandler);\napp.use(errorHandler);\n\n// Start server if not in test mode\nif (process.env.NODE_ENV !== 'test') {\n  const PORT = process.env.PORT || 5000;\n  app.listen(PORT, () => {\n    console.log(`Server is running on port ${PORT}`);\n  });\n}\n\n// Export for testing\nmodule.exports = app;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsImNvcnMiLCJjb25uZWN0REIiLCJlcnJvckhhbmRsZXIiLCJub3RGb3VuZCIsInZhbGlkYXRpb25FcnJvckhhbmRsZXIiLCJkYXRhYmFzZUVycm9ySGFuZGxlciIsImp3dEVycm9ySGFuZGxlciIsImZpbGVVcGxvYWRFcnJvckhhbmRsZXIiLCJhdXRoUm91dGVzIiwidXNlclJvdXRlcyIsInNlbGxlclJvdXRlcyIsImhvcnNlUm91dGVzIiwiaW5xdWlyeVJvdXRlcyIsInRyYW5zYWN0aW9uUm91dGVzIiwiYWRtaW5Sb3V0ZXMiLCJzZWxsZXJEYXNoYm9hcmRSb3V0ZXMiLCJwYXltZW50Um91dGVzIiwiaG9tZVJvdXRlcyIsInN1cHBvcnRSb3V0ZXMiLCJzZWFyY2hSb3V0ZXMiLCJtZXNzYWdpbmdSb3V0ZXMiLCJyZXZpZXdSb3V0ZXMiLCJyZWNvbW1lbmRhdGlvblJvdXRlcyIsImFwcCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInVzZSIsImpzb24iLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJnZXQiLCJyZXEiLCJyZXMiLCJzdWNjZXNzIiwibWVzc2FnZSIsIlBPUlQiLCJsaXN0ZW4iLCJjb25zb2xlIiwibG9nIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcIiwic291cmNlcyI6WyJzZXJ2ZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3QgY29ycyA9IHJlcXVpcmUoJ2NvcnMnKTtcclxuY29uc3QgY29ubmVjdERCID0gcmVxdWlyZSgnLi9jb25maWcvZGF0YWJhc2UnKTtcclxuY29uc3QgeyBcclxuICAgIGVycm9ySGFuZGxlciwgXHJcbiAgICBub3RGb3VuZCwgXHJcbiAgICB2YWxpZGF0aW9uRXJyb3JIYW5kbGVyLCBcclxuICAgIGRhdGFiYXNlRXJyb3JIYW5kbGVyLCBcclxuICAgIGp3dEVycm9ySGFuZGxlciwgXHJcbiAgICBmaWxlVXBsb2FkRXJyb3JIYW5kbGVyIFxyXG59ID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlcy9lcnJvci5taWRkbGV3YXJlJyk7XHJcblxyXG4vLyBSb3V0ZSBpbXBvcnRzXHJcbmNvbnN0IGF1dGhSb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9hdXRoLnJvdXRlcycpO1xyXG5jb25zdCB1c2VyUm91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvdXNlci5yb3V0ZXMnKTtcclxuY29uc3Qgc2VsbGVyUm91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvc2VsbGVyLnJvdXRlcycpO1xyXG5jb25zdCBob3JzZVJvdXRlcyA9IHJlcXVpcmUoJy4vcm91dGVzL2hvcnNlLnJvdXRlcycpO1xyXG5jb25zdCBpbnF1aXJ5Um91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvaW5xdWlyeS5yb3V0ZXMnKTtcclxuY29uc3QgdHJhbnNhY3Rpb25Sb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy90cmFuc2FjdGlvbi5yb3V0ZXMnKTtcclxuY29uc3QgYWRtaW5Sb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9hZG1pbi5yb3V0ZXMnKTtcclxuY29uc3Qgc2VsbGVyRGFzaGJvYXJkUm91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvc2VsbGVyLmRhc2hib2FyZC5yb3V0ZXMnKTtcclxuY29uc3QgcGF5bWVudFJvdXRlcyA9IHJlcXVpcmUoJy4vcm91dGVzL3BheW1lbnQucm91dGVzJyk7XHJcbmNvbnN0IGhvbWVSb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9ob21lLnJvdXRlcycpO1xyXG5jb25zdCBzdXBwb3J0Um91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvc3VwcG9ydC5yb3V0ZXMnKTtcclxuY29uc3Qgc2VhcmNoUm91dGVzID0gcmVxdWlyZSgnLi9yb3V0ZXMvc2VhcmNoLnJvdXRlcycpO1xyXG5jb25zdCBtZXNzYWdpbmdSb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9tZXNzYWdpbmcucm91dGVzJyk7XHJcbmNvbnN0IHJldmlld1JvdXRlcyA9IHJlcXVpcmUoJy4vcm91dGVzL3Jldmlldy5yb3V0ZXMnKTtcclxuY29uc3QgcmVjb21tZW5kYXRpb25Sb3V0ZXMgPSByZXF1aXJlKCcuL3JvdXRlcy9yZWNvbW1lbmRhdGlvbi5yb3V0ZXMnKTtcclxuXHJcbmNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcclxuXHJcbi8vIENvbm5lY3QgdG8gTW9uZ29EQlxyXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0Jykge1xyXG4gICAgY29ubmVjdERCKCk7XHJcbn1cclxuXHJcbi8vIE1pZGRsZXdhcmVcclxuYXBwLnVzZShjb3JzKCkpO1xyXG5hcHAudXNlKGV4cHJlc3MuanNvbigpKTtcclxuYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpO1xyXG5cclxuLy8gSGVhbHRoIGNoZWNrIGVuZHBvaW50XHJcbmFwcC5nZXQoJy9hcGkvYXV0aC9oZWFsdGgnLCAocmVxLCByZXMpID0+IHtcclxuICAgIHJlcy5qc29uKHtcclxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgaXMgcnVubmluZyBhbmQgaGVhbHRoeSdcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbi8vIFJvdXRlc1xyXG5hcHAudXNlKCcvYXBpL2hvbWUnLCBob21lUm91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS9hdXRoJywgYXV0aFJvdXRlcyk7XHJcbmFwcC51c2UoJy9hcGkvdXNlcnMnLCB1c2VyUm91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS9zZWxsZXJzJywgc2VsbGVyUm91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS9ob3JzZXMnLCBob3JzZVJvdXRlcyk7XHJcbmFwcC51c2UoJy9hcGkvaW5xdWlyaWVzJywgaW5xdWlyeVJvdXRlcyk7XHJcbmFwcC51c2UoJy9hcGkvdHJhbnNhY3Rpb25zJywgdHJhbnNhY3Rpb25Sb3V0ZXMpO1xyXG5hcHAudXNlKCcvYXBpL2FkbWluJywgYWRtaW5Sb3V0ZXMpO1xyXG5hcHAudXNlKCcvYXBpL3NlbGxlci9kYXNoYm9hcmQnLCBzZWxsZXJEYXNoYm9hcmRSb3V0ZXMpO1xyXG5hcHAudXNlKCcvYXBpL3BheW1lbnRzJywgcGF5bWVudFJvdXRlcyk7XHJcbmFwcC51c2UoJy9hcGkvc3VwcG9ydCcsIHN1cHBvcnRSb3V0ZXMpO1xyXG5hcHAudXNlKCcvYXBpL3NlYXJjaCcsIHNlYXJjaFJvdXRlcyk7XHJcbmFwcC51c2UoJy9hcGkvbWVzc2FnaW5nJywgbWVzc2FnaW5nUm91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS9yZXZpZXdzJywgcmV2aWV3Um91dGVzKTtcclxuYXBwLnVzZSgnL2FwaS9yZWNvbW1lbmRhdGlvbnMnLCByZWNvbW1lbmRhdGlvblJvdXRlcyk7XHJcblxyXG4vLyBFcnJvciBoYW5kbGVyc1xyXG5hcHAudXNlKG5vdEZvdW5kKTtcclxuYXBwLnVzZSh2YWxpZGF0aW9uRXJyb3JIYW5kbGVyKTtcclxuYXBwLnVzZShkYXRhYmFzZUVycm9ySGFuZGxlcik7XHJcbmFwcC51c2Uoand0RXJyb3JIYW5kbGVyKTtcclxuYXBwLnVzZShmaWxlVXBsb2FkRXJyb3JIYW5kbGVyKTtcclxuYXBwLnVzZShlcnJvckhhbmRsZXIpO1xyXG5cclxuLy8gU3RhcnQgc2VydmVyIGlmIG5vdCBpbiB0ZXN0IG1vZGVcclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAndGVzdCcpIHtcclxuICAgIGNvbnN0IFBPUlQgPSBwcm9jZXNzLmVudi5QT1JUIHx8IDUwMDA7XHJcbiAgICBhcHAubGlzdGVuKFBPUlQsICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgU2VydmVyIGlzIHJ1bm5pbmcgb24gcG9ydCAke1BPUlR9YCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuLy8gRXhwb3J0IGZvciB0ZXN0aW5nXHJcbm1vZHVsZS5l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","map":{"version":3,"names":["express","require","cors","connectDB","errorHandler","notFound","validationErrorHandler","databaseErrorHandler","jwtErrorHandler","fileUploadErrorHandler","authRoutes","userRoutes","sellerRoutes","horseRoutes","inquiryRoutes","transactionRoutes","adminRoutes","sellerDashboardRoutes","paymentRoutes","homeRoutes","supportRoutes","searchRoutes","messagingRoutes","reviewRoutes","recommendationRoutes","app","process","env","NODE_ENV","use","json","urlencoded","extended","get","req","res","success","message","PORT","listen","console","log","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\","sources":["server.js"],"sourcesContent":["const express = require('express');\r\nconst cors = require('cors');\r\nconst connectDB = require('./config/database');\r\nconst { \r\n    errorHandler, \r\n    notFound, \r\n    validationErrorHandler, \r\n    databaseErrorHandler, \r\n    jwtErrorHandler, \r\n    fileUploadErrorHandler \r\n} = require('./middlewares/error.middleware');\r\n\r\n// Route imports\r\nconst authRoutes = require('./routes/auth.routes');\r\nconst userRoutes = require('./routes/user.routes');\r\nconst sellerRoutes = require('./routes/seller.routes');\r\nconst horseRoutes = require('./routes/horse.routes');\r\nconst inquiryRoutes = require('./routes/inquiry.routes');\r\nconst transactionRoutes = require('./routes/transaction.routes');\r\nconst adminRoutes = require('./routes/admin.routes');\r\nconst sellerDashboardRoutes = require('./routes/seller.dashboard.routes');\r\nconst paymentRoutes = require('./routes/payment.routes');\r\nconst homeRoutes = require('./routes/home.routes');\r\nconst supportRoutes = require('./routes/support.routes');\r\nconst searchRoutes = require('./routes/search.routes');\r\nconst messagingRoutes = require('./routes/messaging.routes');\r\nconst reviewRoutes = require('./routes/review.routes');\r\nconst recommendationRoutes = require('./routes/recommendation.routes');\r\n\r\nconst app = express();\r\n\r\n// Connect to MongoDB\r\nif (process.env.NODE_ENV !== 'test') {\r\n    connectDB();\r\n}\r\n\r\n// Middleware\r\napp.use(cors());\r\napp.use(express.json());\r\napp.use(express.urlencoded({ extended: false }));\r\n\r\n// Health check endpoint\r\napp.get('/api/auth/health', (req, res) => {\r\n    res.json({\r\n        success: true,\r\n        message: 'Server is running and healthy'\r\n    });\r\n});\r\n\r\n// Routes\r\napp.use('/api/home', homeRoutes);\r\napp.use('/api/auth', authRoutes);\r\napp.use('/api/users', userRoutes);\r\napp.use('/api/sellers', sellerRoutes);\r\napp.use('/api/horses', horseRoutes);\r\napp.use('/api/inquiries', inquiryRoutes);\r\napp.use('/api/transactions', transactionRoutes);\r\napp.use('/api/admin', adminRoutes);\r\napp.use('/api/seller/dashboard', sellerDashboardRoutes);\r\napp.use('/api/payments', paymentRoutes);\r\napp.use('/api/support', supportRoutes);\r\napp.use('/api/search', searchRoutes);\r\napp.use('/api/messaging', messagingRoutes);\r\napp.use('/api/reviews', reviewRoutes);\r\napp.use('/api/recommendations', recommendationRoutes);\r\n\r\n// Error handlers\r\napp.use(notFound);\r\napp.use(validationErrorHandler);\r\napp.use(databaseErrorHandler);\r\napp.use(jwtErrorHandler);\r\napp.use(fileUploadErrorHandler);\r\napp.use(errorHandler);\r\n\r\n// Start server if not in test mode\r\nif (process.env.NODE_ENV !== 'test') {\r\n    const PORT = process.env.PORT || 5000;\r\n    app.listen(PORT, () => {\r\n        console.log(`Server is running on port ${PORT}`);\r\n    });\r\n}\r\n\r\n// Export for testing\r\nmodule.exports = app; "],"mappings":"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","ignoreList":[]}},"mtime":1734046144349},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\config\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\config\\\\database.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst connectDB = async () => {\n  try {\n    const conn = await mongoose.connect(process.env.MONGODB_URI, {\n      useNewUrlParser: true,\n      useUnifiedTopology: true\n    });\n    console.log(`MongoDB Connected: ${conn.connection.host}`);\n  } catch (error) {\n    console.error(`Error: ${error.message}`);\n    process.exit(1);\n  }\n};\nmodule.exports = connectDB;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJjb25uZWN0REIiLCJjb25uIiwiY29ubmVjdCIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsInVzZU5ld1VybFBhcnNlciIsInVzZVVuaWZpZWRUb3BvbG9neSIsImNvbnNvbGUiLCJsb2ciLCJjb25uZWN0aW9uIiwiaG9zdCIsImVycm9yIiwibWVzc2FnZSIsImV4aXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxjb25maWdcXCIsInNvdXJjZXMiOlsiZGF0YWJhc2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5cclxuY29uc3QgY29ubmVjdERCID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBjb25uID0gYXdhaXQgbW9uZ29vc2UuY29ubmVjdChwcm9jZXNzLmVudi5NT05HT0RCX1VSSSwge1xyXG4gICAgICAgICAgICB1c2VOZXdVcmxQYXJzZXI6IHRydWUsXHJcbiAgICAgICAgICAgIHVzZVVuaWZpZWRUb3BvbG9neTogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhgTW9uZ29EQiBDb25uZWN0ZWQ6ICR7Y29ubi5jb25uZWN0aW9uLmhvc3R9YCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xyXG4gICAgfVxyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBjb25uZWN0REI7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLFNBQVMsR0FBRyxNQUFBQSxDQUFBLEtBQVk7RUFDMUIsSUFBSTtJQUNBLE1BQU1DLElBQUksR0FBRyxNQUFNSCxRQUFRLENBQUNJLE9BQU8sQ0FBQ0MsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFdBQVcsRUFBRTtNQUN6REMsZUFBZSxFQUFFLElBQUk7TUFDckJDLGtCQUFrQixFQUFFO0lBQ3hCLENBQUMsQ0FBQztJQUVGQyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxzQkFBc0JSLElBQUksQ0FBQ1MsVUFBVSxDQUFDQyxJQUFJLEVBQUUsQ0FBQztFQUM3RCxDQUFDLENBQUMsT0FBT0MsS0FBSyxFQUFFO0lBQ1pKLE9BQU8sQ0FBQ0ksS0FBSyxDQUFDLFVBQVVBLEtBQUssQ0FBQ0MsT0FBTyxFQUFFLENBQUM7SUFDeENWLE9BQU8sQ0FBQ1csSUFBSSxDQUFDLENBQUMsQ0FBQztFQUNuQjtBQUNKLENBQUM7QUFFREMsTUFBTSxDQUFDQyxPQUFPLEdBQUdoQixTQUFTIiwiaWdub3JlTGlzdCI6W119","map":{"version":3,"names":["mongoose","require","connectDB","conn","connect","process","env","MONGODB_URI","useNewUrlParser","useUnifiedTopology","console","log","connection","host","error","message","exit","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\config\\","sources":["database.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst connectDB = async () => {\r\n    try {\r\n        const conn = await mongoose.connect(process.env.MONGODB_URI, {\r\n            useNewUrlParser: true,\r\n            useUnifiedTopology: true\r\n        });\r\n\r\n        console.log(`MongoDB Connected: ${conn.connection.host}`);\r\n    } catch (error) {\r\n        console.error(`Error: ${error.message}`);\r\n        process.exit(1);\r\n    }\r\n};\r\n\r\nmodule.exports = connectDB; "],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,SAAS,GAAG,MAAAA,CAAA,KAAY;EAC1B,IAAI;IACA,MAAMC,IAAI,GAAG,MAAMH,QAAQ,CAACI,OAAO,CAACC,OAAO,CAACC,GAAG,CAACC,WAAW,EAAE;MACzDC,eAAe,EAAE,IAAI;MACrBC,kBAAkB,EAAE;IACxB,CAAC,CAAC;IAEFC,OAAO,CAACC,GAAG,CAAC,sBAAsBR,IAAI,CAACS,UAAU,CAACC,IAAI,EAAE,CAAC;EAC7D,CAAC,CAAC,OAAOC,KAAK,EAAE;IACZJ,OAAO,CAACI,KAAK,CAAC,UAAUA,KAAK,CAACC,OAAO,EAAE,CAAC;IACxCV,OAAO,CAACW,IAAI,CAAC,CAAC,CAAC;EACnB;AACJ,CAAC;AAEDC,MAAM,CAACC,OAAO,GAAGhB,SAAS","ignoreList":[]}},"mtime":1734101527146},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\middlewares\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\middlewares\\\\error.middleware.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"// Error handling middleware\nconst errorHandler = (err, req, res, next) => {\n  // Log error for debugging\n  console.error(err.stack);\n\n  // Check if error has a status code, if not use 500\n  const statusCode = err.statusCode || 500;\n\n  // Send error response\n  res.status(statusCode).json({\n    success: false,\n    message: err.message || 'Internal Server Error',\n    ...(process.env.NODE_ENV === 'development' && {\n      stack: err.stack\n    })\n  });\n};\n\n// Not Found middleware\nconst notFound = (req, res, next) => {\n  const error = new Error(`Not Found - ${req.originalUrl}`);\n  error.statusCode = 404;\n  next(error);\n};\n\n// Async handler wrapper\nconst asyncHandler = fn => (req, res, next) => Promise.resolve(fn(req, res, next)).catch(next);\n\n// Validation error handler\nconst validationErrorHandler = (err, req, res, next) => {\n  if (err.name === 'ValidationError') {\n    return res.status(400).json({\n      success: false,\n      message: 'Validation Error',\n      errors: Object.values(err.errors).map(error => error.message)\n    });\n  }\n  next(err);\n};\n\n// Database error handler\nconst databaseErrorHandler = (err, req, res, next) => {\n  if (err.name === 'MongoError' || err.name === 'MongoServerError') {\n    if (err.code === 11000) {\n      return res.status(400).json({\n        success: false,\n        message: 'Duplicate field value entered'\n      });\n    }\n    return res.status(500).json({\n      success: false,\n      message: 'Database Error'\n    });\n  }\n  next(err);\n};\n\n// JWT error handler\nconst jwtErrorHandler = (err, req, res, next) => {\n  if (err.name === 'JsonWebTokenError') {\n    return res.status(401).json({\n      success: false,\n      message: 'Invalid token'\n    });\n  }\n  if (err.name === 'TokenExpiredError') {\n    return res.status(401).json({\n      success: false,\n      message: 'Token expired'\n    });\n  }\n  next(err);\n};\n\n// File upload error handler\nconst fileUploadErrorHandler = (err, req, res, next) => {\n  if (err.name === 'MulterError') {\n    return res.status(400).json({\n      success: false,\n      message: err.message\n    });\n  }\n  next(err);\n};\nmodule.exports = {\n  errorHandler,\n  notFound,\n  asyncHandler,\n  validationErrorHandler,\n  databaseErrorHandler,\n  jwtErrorHandler,\n  fileUploadErrorHandler\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlcnJvckhhbmRsZXIiLCJlcnIiLCJyZXEiLCJyZXMiLCJuZXh0IiwiY29uc29sZSIsImVycm9yIiwic3RhY2siLCJzdGF0dXNDb2RlIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwibm90Rm91bmQiLCJFcnJvciIsIm9yaWdpbmFsVXJsIiwiYXN5bmNIYW5kbGVyIiwiZm4iLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhdGNoIiwidmFsaWRhdGlvbkVycm9ySGFuZGxlciIsIm5hbWUiLCJlcnJvcnMiLCJPYmplY3QiLCJ2YWx1ZXMiLCJtYXAiLCJkYXRhYmFzZUVycm9ySGFuZGxlciIsImNvZGUiLCJqd3RFcnJvckhhbmRsZXIiLCJmaWxlVXBsb2FkRXJyb3JIYW5kbGVyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcbWlkZGxld2FyZXNcXCIsInNvdXJjZXMiOlsiZXJyb3IubWlkZGxld2FyZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBFcnJvciBoYW5kbGluZyBtaWRkbGV3YXJlXHJcbmNvbnN0IGVycm9ySGFuZGxlciA9IChlcnIsIHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICAvLyBMb2cgZXJyb3IgZm9yIGRlYnVnZ2luZ1xyXG4gICAgY29uc29sZS5lcnJvcihlcnIuc3RhY2spO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIGVycm9yIGhhcyBhIHN0YXR1cyBjb2RlLCBpZiBub3QgdXNlIDUwMFxyXG4gICAgY29uc3Qgc3RhdHVzQ29kZSA9IGVyci5zdGF0dXNDb2RlIHx8IDUwMDtcclxuXHJcbiAgICAvLyBTZW5kIGVycm9yIHJlc3BvbnNlXHJcbiAgICByZXMuc3RhdHVzKHN0YXR1c0NvZGUpLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlIHx8ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLFxyXG4gICAgICAgIC4uLihwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyAmJiB7IHN0YWNrOiBlcnIuc3RhY2sgfSlcclxuICAgIH0pO1xyXG59O1xyXG5cclxuLy8gTm90IEZvdW5kIG1pZGRsZXdhcmVcclxuY29uc3Qgbm90Rm91bmQgPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKGBOb3QgRm91bmQgLSAke3JlcS5vcmlnaW5hbFVybH1gKTtcclxuICAgIGVycm9yLnN0YXR1c0NvZGUgPSA0MDQ7XHJcbiAgICBuZXh0KGVycm9yKTtcclxufTtcclxuXHJcbi8vIEFzeW5jIGhhbmRsZXIgd3JhcHBlclxyXG5jb25zdCBhc3luY0hhbmRsZXIgPSAoZm4pID0+IChyZXEsIHJlcywgbmV4dCkgPT5cclxuICAgIFByb21pc2UucmVzb2x2ZShmbihyZXEsIHJlcywgbmV4dCkpLmNhdGNoKG5leHQpO1xyXG5cclxuLy8gVmFsaWRhdGlvbiBlcnJvciBoYW5kbGVyXHJcbmNvbnN0IHZhbGlkYXRpb25FcnJvckhhbmRsZXIgPSAoZXJyLCByZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgaWYgKGVyci5uYW1lID09PSAnVmFsaWRhdGlvbkVycm9yJykge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBFcnJvcicsXHJcbiAgICAgICAgICAgIGVycm9yczogT2JqZWN0LnZhbHVlcyhlcnIuZXJyb3JzKS5tYXAoZXJyb3IgPT4gZXJyb3IubWVzc2FnZSlcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG5leHQoZXJyKTtcclxufTtcclxuXHJcbi8vIERhdGFiYXNlIGVycm9yIGhhbmRsZXJcclxuY29uc3QgZGF0YWJhc2VFcnJvckhhbmRsZXIgPSAoZXJyLCByZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgaWYgKGVyci5uYW1lID09PSAnTW9uZ29FcnJvcicgfHwgZXJyLm5hbWUgPT09ICdNb25nb1NlcnZlckVycm9yJykge1xyXG4gICAgICAgIGlmIChlcnIuY29kZSA9PT0gMTEwMDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0R1cGxpY2F0ZSBmaWVsZCB2YWx1ZSBlbnRlcmVkJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdEYXRhYmFzZSBFcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG5leHQoZXJyKTtcclxufTtcclxuXHJcbi8vIEpXVCBlcnJvciBoYW5kbGVyXHJcbmNvbnN0IGp3dEVycm9ySGFuZGxlciA9IChlcnIsIHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICBpZiAoZXJyLm5hbWUgPT09ICdKc29uV2ViVG9rZW5FcnJvcicpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgdG9rZW4nXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoZXJyLm5hbWUgPT09ICdUb2tlbkV4cGlyZWRFcnJvcicpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1Rva2VuIGV4cGlyZWQnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBuZXh0KGVycik7XHJcbn07XHJcblxyXG4vLyBGaWxlIHVwbG9hZCBlcnJvciBoYW5kbGVyXHJcbmNvbnN0IGZpbGVVcGxvYWRFcnJvckhhbmRsZXIgPSAoZXJyLCByZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgaWYgKGVyci5uYW1lID09PSAnTXVsdGVyRXJyb3InKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVyci5tZXNzYWdlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBuZXh0KGVycik7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIGVycm9ySGFuZGxlcixcclxuICAgIG5vdEZvdW5kLFxyXG4gICAgYXN5bmNIYW5kbGVyLFxyXG4gICAgdmFsaWRhdGlvbkVycm9ySGFuZGxlcixcclxuICAgIGRhdGFiYXNlRXJyb3JIYW5kbGVyLFxyXG4gICAgand0RXJyb3JIYW5kbGVyLFxyXG4gICAgZmlsZVVwbG9hZEVycm9ySGFuZGxlclxyXG59OyAiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0EsTUFBTUEsWUFBWSxHQUFHQSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDMUM7RUFDQUMsT0FBTyxDQUFDQyxLQUFLLENBQUNMLEdBQUcsQ0FBQ00sS0FBSyxDQUFDOztFQUV4QjtFQUNBLE1BQU1DLFVBQVUsR0FBR1AsR0FBRyxDQUFDTyxVQUFVLElBQUksR0FBRzs7RUFFeEM7RUFDQUwsR0FBRyxDQUFDTSxNQUFNLENBQUNELFVBQVUsQ0FBQyxDQUFDRSxJQUFJLENBQUM7SUFDeEJDLE9BQU8sRUFBRSxLQUFLO0lBQ2RDLE9BQU8sRUFBRVgsR0FBRyxDQUFDVyxPQUFPLElB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","map":{"version":3,"names":["errorHandler","err","req","res","next","console","error","stack","statusCode","status","json","success","message","process","env","NODE_ENV","notFound","Error","originalUrl","asyncHandler","fn","Promise","resolve","catch","validationErrorHandler","name","errors","Object","values","map","databaseErrorHandler","code","jwtErrorHandler","fileUploadErrorHandler","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\middlewares\\","sources":["error.middleware.js"],"sourcesContent":["// Error handling middleware\r\nconst errorHandler = (err, req, res, next) => {\r\n    // Log error for debugging\r\n    console.error(err.stack);\r\n\r\n    // Check if error has a status code, if not use 500\r\n    const statusCode = err.statusCode || 500;\r\n\r\n    // Send error response\r\n    res.status(statusCode).json({\r\n        success: false,\r\n        message: err.message || 'Internal Server Error',\r\n        ...(process.env.NODE_ENV === 'development' && { stack: err.stack })\r\n    });\r\n};\r\n\r\n// Not Found middleware\r\nconst notFound = (req, res, next) => {\r\n    const error = new Error(`Not Found - ${req.originalUrl}`);\r\n    error.statusCode = 404;\r\n    next(error);\r\n};\r\n\r\n// Async handler wrapper\r\nconst asyncHandler = (fn) => (req, res, next) =>\r\n    Promise.resolve(fn(req, res, next)).catch(next);\r\n\r\n// Validation error handler\r\nconst validationErrorHandler = (err, req, res, next) => {\r\n    if (err.name === 'ValidationError') {\r\n        return res.status(400).json({\r\n            success: false,\r\n            message: 'Validation Error',\r\n            errors: Object.values(err.errors).map(error => error.message)\r\n        });\r\n    }\r\n    next(err);\r\n};\r\n\r\n// Database error handler\r\nconst databaseErrorHandler = (err, req, res, next) => {\r\n    if (err.name === 'MongoError' || err.name === 'MongoServerError') {\r\n        if (err.code === 11000) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: 'Duplicate field value entered'\r\n            });\r\n        }\r\n        return res.status(500).json({\r\n            success: false,\r\n            message: 'Database Error'\r\n        });\r\n    }\r\n    next(err);\r\n};\r\n\r\n// JWT error handler\r\nconst jwtErrorHandler = (err, req, res, next) => {\r\n    if (err.name === 'JsonWebTokenError') {\r\n        return res.status(401).json({\r\n            success: false,\r\n            message: 'Invalid token'\r\n        });\r\n    }\r\n    if (err.name === 'TokenExpiredError') {\r\n        return res.status(401).json({\r\n            success: false,\r\n            message: 'Token expired'\r\n        });\r\n    }\r\n    next(err);\r\n};\r\n\r\n// File upload error handler\r\nconst fileUploadErrorHandler = (err, req, res, next) => {\r\n    if (err.name === 'MulterError') {\r\n        return res.status(400).json({\r\n            success: false,\r\n            message: err.message\r\n        });\r\n    }\r\n    next(err);\r\n};\r\n\r\nmodule.exports = {\r\n    errorHandler,\r\n    notFound,\r\n    asyncHandler,\r\n    validationErrorHandler,\r\n    databaseErrorHandler,\r\n    jwtErrorHandler,\r\n    fileUploadErrorHandler\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734101546233},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\auth.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  body\n} = require('express-validator');\nconst {\n  protect\n} = require('../middlewares/auth.middleware');\nconst {\n  register,\n  login,\n  getMe,\n  healthCheck\n} = require('../controllers/auth.controller');\n\n// Validation middleware\nconst registerValidation = [body('name').notEmpty().withMessage('Name is required'), body('email').isEmail().withMessage('Please include a valid email'), body('password').isLength({\n  min: 6\n}).withMessage('Password must be at least 6 characters long'), body('role').isIn(['user', 'seller', 'admin']).withMessage('Invalid role')];\nconst loginValidation = [body('email').isEmail().withMessage('Please include a valid email'), body('password').exists().withMessage('Password is required')];\n\n// Health check\nrouter.get('/health', healthCheck);\n\n// Routes\nrouter.post('/register', registerValidation, register);\nrouter.post('/login', loginValidation, login);\nrouter.get('/me', protect, getMe);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsImJvZHkiLCJwcm90ZWN0IiwicmVnaXN0ZXIiLCJsb2dpbiIsImdldE1lIiwiaGVhbHRoQ2hlY2siLCJyZWdpc3RlclZhbGlkYXRpb24iLCJub3RFbXB0eSIsIndpdGhNZXNzYWdlIiwiaXNFbWFpbCIsImlzTGVuZ3RoIiwibWluIiwiaXNJbiIsImxvZ2luVmFsaWRhdGlvbiIsImV4aXN0cyIsImdldCIsInBvc3QiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsiYXV0aC5yb3V0ZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuY29uc3QgeyBib2R5IH0gPSByZXF1aXJlKCdleHByZXNzLXZhbGlkYXRvcicpO1xyXG5jb25zdCB7IHByb3RlY3QgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmVzL2F1dGgubWlkZGxld2FyZScpO1xyXG5jb25zdCB7XHJcbiAgICByZWdpc3RlcixcclxuICAgIGxvZ2luLFxyXG4gICAgZ2V0TWUsXHJcbiAgICBoZWFsdGhDaGVja1xyXG59ID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvYXV0aC5jb250cm9sbGVyJyk7XHJcblxyXG4vLyBWYWxpZGF0aW9uIG1pZGRsZXdhcmVcclxuY29uc3QgcmVnaXN0ZXJWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnbmFtZScpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ05hbWUgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2VtYWlsJykuaXNFbWFpbCgpLndpdGhNZXNzYWdlKCdQbGVhc2UgaW5jbHVkZSBhIHZhbGlkIGVtYWlsJyksXHJcbiAgICBib2R5KCdwYXNzd29yZCcpXHJcbiAgICAgICAgLmlzTGVuZ3RoKHsgbWluOiA2IH0pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdQYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDYgY2hhcmFjdGVycyBsb25nJyksXHJcbiAgICBib2R5KCdyb2xlJylcclxuICAgICAgICAuaXNJbihbJ3VzZXInLCAnc2VsbGVyJywgJ2FkbWluJ10pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdJbnZhbGlkIHJvbGUnKVxyXG5dO1xyXG5cclxuY29uc3QgbG9naW5WYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnZW1haWwnKS5pc0VtYWlsKCkud2l0aE1lc3NhZ2UoJ1BsZWFzZSBpbmNsdWRlIGEgdmFsaWQgZW1haWwnKSxcclxuICAgIGJvZHkoJ3Bhc3N3b3JkJykuZXhpc3RzKCkud2l0aE1lc3NhZ2UoJ1Bhc3N3b3JkIGlzIHJlcXVpcmVkJylcclxuXTtcclxuXHJcbi8vIEhlYWx0aCBjaGVja1xyXG5yb3V0ZXIuZ2V0KCcvaGVhbHRoJywgaGVhbHRoQ2hlY2spO1xyXG5cclxuLy8gUm91dGVzXHJcbnJvdXRlci5wb3N0KCcvcmVnaXN0ZXInLCByZWdpc3RlclZhbGlkYXRpb24sIHJlZ2lzdGVyKTtcclxucm91dGVyLnBvc3QoJy9sb2dpbicsIGxvZ2luVmFsaWRhdGlvbiwgbG9naW4pO1xyXG5yb3V0ZXIuZ2V0KCcvbWUnLCBwcm90ZWN0LCBnZXRNZSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU07RUFBRUM7QUFBSyxDQUFDLEdBQUdILE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUM3QyxNQUFNO0VBQUVJO0FBQVEsQ0FBQyxHQUFHSixPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDN0QsTUFBTTtFQUNGSyxRQUFRO0VBQ1JDLEtBQUs7RUFDTEMsS0FBSztFQUNMQztBQUNKLENBQUMsR0FBR1IsT0FBTyxDQUFDLGdDQUFnQyxDQUFDOztBQUU3QztBQUNBLE1BQU1TLGtCQUFrQixHQUFHLENBQ3ZCTixJQUFJLENBQUMsTUFBTSxDQUFDLENBQUNPLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxFQUN2RFIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDUyxPQUFPLENBQUMsQ0FBQyxDQUFDRCxXQUFXLENBQUMsOEJBQThCLENBQUMsRUFDbkVSLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FDWFUsUUFBUSxDQUFDO0VBQUVDLEdBQUcsRUFBRTtBQUFFLENBQUMsQ0FBQyxDQUNwQkgsV0FBVyxDQUFDLDZDQUE2QyxDQUFDLEVBQy9EUixJQUFJLENBQUMsTUFBTSxDQUFDLENBQ1BZLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FDakNKLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FDbkM7QUFFRCxNQUFNSyxlQUFlLEdBQUcsQ0FDcEJiLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQ1MsT0FBTyxDQUFDLENBQUMsQ0FBQ0QsV0FBVyxDQUFDLDhCQUE4QixDQUFDLEVBQ25FUixJQUFJLENBQUMsVUFBVSxDQUFDLENBQUNjLE1BQU0sQ0FBQyxDQUFDLENBQUNOLFdBQVcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUNoRTs7QUFFRDtBQUNBVixNQUFNLENBQUNpQixHQUFHLENBQUMsU0FBUyxFQUFFVixXQUFXLENBQUM7O0FBRWxDO0FBQ0FQLE1BQU0sQ0FBQ2tCLElBQUksQ0FBQyxXQUFXLEVBQUVWLGtCQUFrQixFQUFFSixRQUFRLENBQUM7QUFDdERKLE1BQU0sQ0FBQ2tCLElBQUksQ0FBQyxRQUFRLEVBQUVILGVBQWUsRUFBRVYsS0FBSyxDQUFDO0FBQzdDTCxNQUFNLENBQUNpQixHQUFHLENBQUMsS0FBSyxFQUFFZCxPQUFPLEVBQUVHLEtBQUssQ0FBQztBQUVqQ2EsTUFBTSxDQUFDQyxPQUFPLEdBQUdwQixNQUFNIiwiaWdub3JlTGlzdCI6W119","map":{"version":3,"names":["express","require","router","Router","body","protect","register","login","getMe","healthCheck","registerValidation","notEmpty","withMessage","isEmail","isLength","min","isIn","loginValidation","exists","get","post","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["auth.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { body } = require('express-validator');\r\nconst { protect } = require('../middlewares/auth.middleware');\r\nconst {\r\n    register,\r\n    login,\r\n    getMe,\r\n    healthCheck\r\n} = require('../controllers/auth.controller');\r\n\r\n// Validation middleware\r\nconst registerValidation = [\r\n    body('name').notEmpty().withMessage('Name is required'),\r\n    body('email').isEmail().withMessage('Please include a valid email'),\r\n    body('password')\r\n        .isLength({ min: 6 })\r\n        .withMessage('Password must be at least 6 characters long'),\r\n    body('role')\r\n        .isIn(['user', 'seller', 'admin'])\r\n        .withMessage('Invalid role')\r\n];\r\n\r\nconst loginValidation = [\r\n    body('email').isEmail().withMessage('Please include a valid email'),\r\n    body('password').exists().withMessage('Password is required')\r\n];\r\n\r\n// Health check\r\nrouter.get('/health', healthCheck);\r\n\r\n// Routes\r\nrouter.post('/register', registerValidation, register);\r\nrouter.post('/login', loginValidation, login);\r\nrouter.get('/me', protect, getMe);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC;AAAK,CAAC,GAAGH,OAAO,CAAC,mBAAmB,CAAC;AAC7C,MAAM;EAAEI;AAAQ,CAAC,GAAGJ,OAAO,CAAC,gCAAgC,CAAC;AAC7D,MAAM;EACFK,QAAQ;EACRC,KAAK;EACLC,KAAK;EACLC;AACJ,CAAC,GAAGR,OAAO,CAAC,gCAAgC,CAAC;;AAE7C;AACA,MAAMS,kBAAkB,GAAG,CACvBN,IAAI,CAAC,MAAM,CAAC,CAACO,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,kBAAkB,CAAC,EACvDR,IAAI,CAAC,OAAO,CAAC,CAACS,OAAO,CAAC,CAAC,CAACD,WAAW,CAAC,8BAA8B,CAAC,EACnER,IAAI,CAAC,UAAU,CAAC,CACXU,QAAQ,CAAC;EAAEC,GAAG,EAAE;AAAE,CAAC,CAAC,CACpBH,WAAW,CAAC,6CAA6C,CAAC,EAC/DR,IAAI,CAAC,MAAM,CAAC,CACPY,IAAI,CAAC,CAAC,MAAM,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC,CACjCJ,WAAW,CAAC,cAAc,CAAC,CACnC;AAED,MAAMK,eAAe,GAAG,CACpBb,IAAI,CAAC,OAAO,CAAC,CAACS,OAAO,CAAC,CAAC,CAACD,WAAW,CAAC,8BAA8B,CAAC,EACnER,IAAI,CAAC,UAAU,CAAC,CAACc,MAAM,CAAC,CAAC,CAACN,WAAW,CAAC,sBAAsB,CAAC,CAChE;;AAED;AACAV,MAAM,CAACiB,GAAG,CAAC,SAAS,EAAEV,WAAW,CAAC;;AAElC;AACAP,MAAM,CAACkB,IAAI,CAAC,WAAW,EAAEV,kBAAkB,EAAEJ,QAAQ,CAAC;AACtDJ,MAAM,CAACkB,IAAI,CAAC,QAAQ,EAAEH,eAAe,EAAEV,KAAK,CAAC;AAC7CL,MAAM,CAACiB,GAAG,CAAC,KAAK,EAAEd,OAAO,EAAEG,KAAK,CAAC;AAEjCa,MAAM,CAACC,OAAO,GAAGpB,MAAM","ignoreList":[]}},"mtime":1734029447003},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\middlewares\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\middlewares\\\\auth.middleware.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const jwt = require('jsonwebtoken');\nconst User = require('../models/User');\nconst Seller = require('../models/Seller');\n\n// Protect routes\nexports.protect = async (req, res, next) => {\n  try {\n    let token;\n    if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\n      token = req.headers.authorization.split(' ')[1];\n    }\n    if (!token) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n    try {\n      // Verify token\n      const decoded = jwt.verify(token, process.env.JWT_SECRET);\n      req.user = await User.findById(decoded.id).select('-password');\n      if (!req.user) {\n        return res.status(401).json({\n          success: false,\n          message: 'User not found'\n        });\n      }\n\n      // If user is a seller, attach seller info\n      if (req.user.role === 'seller') {\n        req.seller = await Seller.findOne({\n          user: req.user._id\n        });\n        if (!req.seller) {\n          // If seller profile doesn't exist, revert role to user\n          req.user.role = 'user';\n          await req.user.save();\n        }\n      }\n      next();\n    } catch (err) {\n      return res.status(401).json({\n        success: false,\n        message: 'Not authorized to access this route'\n      });\n    }\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// Grant access to specific roles\nexports.authorize = (...roles) => {\n  return async (req, res, next) => {\n    // Special case for seller profile creation\n    if (roles.includes('user') && req.path === '/profile' && req.method === 'POST') {\n      if (req.user.role !== 'user') {\n        return res.status(403).json({\n          success: false,\n          message: 'Only users can create seller profiles'\n        });\n      }\n      return next();\n    }\n\n    // Special case for seller role\n    if (roles.includes('seller')) {\n      // Check if user has seller role\n      if (req.user.role !== 'seller') {\n        return res.status(403).json({\n          success: false,\n          message: 'Seller role required'\n        });\n      }\n\n      // Check if seller profile exists\n      const seller = await Seller.findOne({\n        user: req.user._id\n      });\n      if (!seller) {\n        // Revert role to user if profile doesn't exist\n        req.user.role = 'user';\n        await req.user.save();\n        return res.status(403).json({\n          success: false,\n          message: 'Seller profile required'\n        });\n      }\n      req.seller = seller;\n      return next();\n    }\n\n    // For other roles\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({\n        success: false,\n        message: `User role ${req.user.role} is not authorized to access this route`\n      });\n    }\n    next();\n  };\n};\n\n// Check if seller's subscription is active\nexports.isSubscriptionActive = async (req, res, next) => {\n  try {\n    if (!req.seller) {\n      return res.status(403).json({\n        success: false,\n        message: 'Seller profile required'\n      });\n    }\n\n    // For Starter package, always consider active\n    if (req.seller.subscription.package === 'Starter') {\n      return next();\n    }\n    if (req.seller.subscription.status !== 'active') {\n      return res.status(403).json({\n        success: false,\n        message: 'Active subscription required'\n      });\n    }\n\n    // Check if subscription has expired\n    if (new Date() > new Date(req.seller.subscription.endDate)) {\n      // Downgrade to Starter package if subscription expires\n      req.seller.subscription = {\n        package: 'Starter',\n        status: 'active',\n        startDate: new Date(),\n        endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000),\n        // 1 year\n        features: {\n          maxListings: 1,\n          maxPhotos: 3,\n          commission: 6,\n          searchPlacement: 'basic',\n          paymentOptions: ['platform'],\n          customAgreements: false,\n          boostFeatures: false,\n          homepageVisibility: false,\n          badges: []\n        }\n      };\n      await req.seller.save();\n      return res.status(403).json({\n        success: false,\n        message: 'Subscription has expired. Downgraded to Starter package.'\n      });\n    }\n    next();\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwiVXNlciIsIlNlbGxlciIsImV4cG9ydHMiLCJwcm90ZWN0IiwicmVxIiwicmVzIiwibmV4dCIsInRva2VuIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzdGFydHNXaXRoIiwic3BsaXQiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJkZWNvZGVkIiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ1c2VyIiwiZmluZEJ5SWQiLCJpZCIsInNlbGVjdCIsInJvbGUiLCJzZWxsZXIiLCJmaW5kT25lIiwiX2lkIiwic2F2ZSIsImVyciIsImVycm9yIiwiYXV0aG9yaXplIiwicm9sZXMiLCJpbmNsdWRlcyIsInBhdGgiLCJtZXRob2QiLCJpc1N1YnNjcmlwdGlvbkFjdGl2ZSIsInN1YnNjcmlwdGlvbiIsInBhY2thZ2UiLCJEYXRlIiwiZW5kRGF0ZSIsInN0YXJ0RGF0ZSIsIm5vdyIsImZlYXR1cmVzIiwibWF4TGlzdGluZ3MiLCJtYXhQaG90b3MiLCJjb21taXNzaW9uIiwic2VhcmNoUGxhY2VtZW50IiwicGF5bWVudE9wdGlvbnMiLCJjdXN0b21BZ3JlZW1lbnRzIiwiYm9vc3RGZWF0dXJlcyIsImhvbWVwYWdlVmlzaWJpbGl0eSIsImJhZGdlcyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcbWlkZGxld2FyZXNcXCIsInNvdXJjZXMiOlsiYXV0aC5taWRkbGV3YXJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGp3dCA9IHJlcXVpcmUoJ2pzb253ZWJ0b2tlbicpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuY29uc3QgU2VsbGVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1NlbGxlcicpO1xyXG5cclxuLy8gUHJvdGVjdCByb3V0ZXNcclxuZXhwb3J0cy5wcm90ZWN0ID0gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGxldCB0b2tlbjtcclxuXHJcbiAgICAgICAgaWYgKHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24gJiYgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5zdGFydHNXaXRoKCdCZWFyZXInKSkge1xyXG4gICAgICAgICAgICB0b2tlbiA9IHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24uc3BsaXQoJyAnKVsxXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGlzIHJvdXRlJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFZlcmlmeSB0b2tlblxyXG4gICAgICAgICAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XHJcbiAgICAgICAgICAgIHJlcS51c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChkZWNvZGVkLmlkKS5zZWxlY3QoJy1wYXNzd29yZCcpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFyZXEudXNlcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gSWYgdXNlciBpcyBhIHNlbGxlciwgYXR0YWNoIHNlbGxlciBpbmZvXHJcbiAgICAgICAgICAgIGlmIChyZXEudXNlci5yb2xlID09PSAnc2VsbGVyJykge1xyXG4gICAgICAgICAgICAgICAgcmVxLnNlbGxlciA9IGF3YWl0IFNlbGxlci5maW5kT25lKHsgdXNlcjogcmVxLnVzZXIuX2lkIH0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFyZXEuc2VsbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgc2VsbGVyIHByb2ZpbGUgZG9lc24ndCBleGlzdCwgcmV2ZXJ0IHJvbGUgdG8gdXNlclxyXG4gICAgICAgICAgICAgICAgICAgIHJlcS51c2VyLnJvbGUgPSAndXNlcic7XHJcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcmVxLnVzZXIuc2F2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBuZXh0KCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byBhY2Nlc3MgdGhpcyByb3V0ZSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gR3JhbnQgYWNjZXNzIHRvIHNwZWNpZmljIHJvbGVzXHJcbmV4cG9ydHMuYXV0aG9yaXplID0gKC4uLnJvbGVzKSA9PiB7XHJcbiAgICByZXR1cm4gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlIGZvciBzZWxsZXIgcHJvZmlsZSBjcmVhdGlvblxyXG4gICAgICAgIGlmIChyb2xlcy5pbmNsdWRlcygndXNlcicpICYmIHJlcS5wYXRoID09PSAnL3Byb2ZpbGUnICYmIHJlcS5tZXRob2QgPT09ICdQT1NUJykge1xyXG4gICAgICAgICAgICBpZiAocmVxLnVzZXIucm9sZSAhPT0gJ3VzZXInKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdPbmx5IHVzZXJzIGNhbiBjcmVhdGUgc2VsbGVyIHByb2ZpbGVzJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZSBmb3Igc2VsbGVyIHJvbGVcclxuICAgICAgICBpZiAocm9sZXMuaW5jbHVkZXMoJ3NlbGxlcicpKSB7XHJcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIHNlbGxlciByb2xlXHJcbiAgICAgICAgICAgIGlmIChyZXEudXNlci5yb2xlICE9PSAnc2VsbGVyJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU2VsbGVyIHJvbGUgcmVxdWlyZWQnXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgc2VsbGVyIHByb2ZpbGUgZXhpc3RzXHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGxlciA9IGF3YWl0IFNlbGxlci5maW5kT25lKHsgdXNlcjogcmVxLnVzZXIuX2lkIH0pO1xyXG4gICAgICAgICAgICBpZiAoIXNlbGxlcikge1xyXG4gICAgICAgICAgICAgICAgLy8gUmV2ZXJ0IHJvbGUgdG8gdXNlciBpZiBwcm9maWxlIGRvZXNuJ3QgZXhpc3RcclxuICAgICAgICAgICAgICAgIHJlcS51c2VyLnJvbGUgPSAndXNlcic7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCByZXEudXNlci5zYXZlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdTZWxsZXIgcHJvZmlsZSByZXF1aXJlZCdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXEuc2VsbGVyID0gc2VsbGVyO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRm9yIG90aGVyIHJvbGVzXHJcbiAgICAgICAgaWYgKCFyb2xlcy5pbmNsdWRlcyhyZXEudXNlci5yb2xlKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiBgVXNlciByb2xlICR7cmVxLnVzZXIucm9sZX0gaXMgbm90IGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoaXMgcm91dGVgXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbmV4dCgpO1xyXG4gICAgfTtcclxufTtcclxuXHJcbi8vIENoZWNrIGlmIHNlbGxlcidzIHN1YnNjcmlwdGlvbiBpcyBhY3RpdmVcclxuZXhwb3J0cy5pc1N1YnNjcmlwdGlvbkFjdGl2ZSA9IGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBpZiAoIXJlcS5zZWxsZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1NlbGxlciBwcm9maWxlIHJlcXVpcmVkJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEZvciBTdGFydGVyIHBhY2thZ2UsIGFsd2F5cyBjb25zaWRlciBhY3RpdmVcclxuICAgICAgICBpZiAocmVxLnNlbGxlci5zdWJzY3JpcHRpb24ucGFja2FnZSA9PT0gJ1N0YXJ0ZXInKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAocmVxLnNlbGxlci5zdWJzY3JpcHRpb24uc3RhdHVzICE9PSAnYWN0aXZlJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQWN0aXZlIHN1YnNjcmlwdGlvbiByZXF1aXJlZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiBzdWJzY3JpcHRpb24gaGFzIGV4cGlyZWRcclxuICAgICAgICBpZiAobmV3IERhdGUoKSA+IG5ldyBEYXRlKHJlcS5zZWxsZXIuc3Vic2NyaXB0aW9uLmVuZERhdGUpKSB7XHJcbiAgICAgICAgICAgIC8vIERvd25ncmFkZSB0byBTdGFydGVyIHBhY2thZ2UgaWYgc3Vic2NyaXB0aW9uIGV4cGlyZXNcclxuICAgICAgICAgICAgcmVxLnNlbGxlci5zdWJzY3JpcHRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBwYWNrYWdlOiAnU3RhcnRlcicsXHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxyXG4gICAgICAgICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgZW5kRGF0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2NSAqIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAxIHllYXJcclxuICAgICAgICAgICAgICAgIGZlYXR1cmVzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbWF4TGlzdGluZ3M6IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgbWF4UGhvdG9zOiAzLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbW1pc3Npb246IDYsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUGxhY2VtZW50OiAnYmFzaWMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb25zOiBbJ3BsYXRmb3JtJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tQWdyZWVtZW50czogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgYm9vc3RGZWF0dXJlczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgaG9tZXBhZ2VWaXNpYmlsaXR5OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBiYWRnZXM6IFtdXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGF3YWl0IHJlcS5zZWxsZXIuc2F2ZSgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1N1YnNjcmlwdGlvbiBoYXMgZXhwaXJlZC4gRG93bmdyYWRlZCB0byBTdGFydGVyIHBhY2thZ2UuJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG5leHQoKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbkMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDdEMsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsa0JBQWtCLENBQUM7O0FBRTFDO0FBQ0FHLE9BQU8sQ0FBQ0MsT0FBTyxHQUFHLE9BQU9DLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDeEMsSUFBSTtJQUNBLElBQUlDLEtBQUs7SUFFVCxJQUFJSCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYSxJQUFJTCxHQUFHLENBQUNJLE9BQU8sQ0FBQ0MsYUFBYSxDQUFDQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQUU7TUFDN0VILEtBQUssR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUNDLGFBQWEsQ0FBQ0UsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNuRDtJQUVBLElBQUksQ0FBQ0osS0FBSyxFQUFFO01BQ1IsT0FBT0YsR0FBRyxDQUFDTyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQztRQUN4QkMsT0FBTyxFQUFFLEtBQUs7UUFDZEMsT0FBTyxFQUFFO01BQ2IsQ0FBQyxDQUFDO0lBQ047SUFFQSxJQUFJO01BQ0E7TUFDQSxNQUFNQyxPQUFPLEdBQUdsQixHQUFHLENBQUNtQixNQUFNLENBQUNWLEtBQUssRUFBRVcsT0FBTyxDQUFDQyxHQUFHLENBQUNDLFVBQVUsQ0FBQztN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QzdDLE9BQU9QLEdBQUcsQ0FBQ08sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7UUFDeEJDLE9BQU8sRUFBRSxLQUFLO1FBQ2RDLE9BQU8sRUFBRTtNQUNiLENBQUMsQ0FBQztJQUNOOztJQUVBO0lBQ0EsSUFBSSxJQUFJeUIsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJQSxJQUFJLENBQUNwQyxHQUFHLENBQUNzQixNQUFNLENBQUNZLFlBQVksQ0FBQ0csT0FBTyxDQUFDLEVBQUU7TUFDeEQ7TUFDQXJDLEdBQUcsQ0FBQ3NCLE1BQU0sQ0FBQ1ksWUFBWSxHQUFHO1FBQ3RCQyxPQUFPLEVBQUUsU0FBUztRQUNsQjNCLE1BQU0sRUFBRSxRQUFRO1FBQ2hCOEIsU0FBUyxFQUFFLElBQUlGLElBQUksQ0FBQyxDQUFDO1FBQ3JCQyxPQUFPLEVBQUUsSUFBSUQsSUFBSSxDQUFDQSxJQUFJLENBQUNHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQztRQUFFO1FBQzNEQyxRQUFRLEVBQUU7VUFDTkMsV0FBVyxFQUFFLENBQUM7VUFDZEMsU0FBUyxFQUFFLENBQUM7VUFDWkMsVUFBVSxFQUFFLENBQUM7VUFDYkMsZUFBZSxFQUFFLE9BQU87VUFDeEJDLGNBQWMsRUFBRSxDQUFDLFVBQVUsQ0FBQztVQUM1QkMsZ0JBQWdCLEVBQUUsS0FBSztVQUN2QkMsYUFBYSxFQUFFLEtBQUs7VUFDcEJDLGtCQUFrQixFQUFFLEtBQUs7VUFDekJDLE1BQU0sRUFBRTtRQUNaO01BQ0osQ0FBQztNQUNELE1BQU1qRCxHQUFHLENBQUNzQixNQUFNLENBQUNHLElBQUksQ0FBQyxDQUFDO01BRXZCLE9BQU94QixHQUFHLENBQUNPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO1FBQ3hCQyxPQUFPLEVBQUUsS0FBSztRQUNkQyxPQUFPLEVBQUU7TUFDYixDQUFDLENBQUM7SUFDTjtJQUVBVCxJQUFJLENBQUMsQ0FBQztFQUNWLENBQUMsQ0FBQyxPQUFPeUIsS0FBSyxFQUFFO0lBQ1oxQixHQUFHLENBQUNPLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQ2pCQyxPQUFPLEVBQUUsS0FBSztNQUNkQyxPQUFPLEVBQUU7SUFDYixDQUFDLENBQUM7RUFDTjtBQUNKLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["jwt","require","User","Seller","exports","protect","req","res","next","token","headers","authorization","startsWith","split","status","json","success","message","decoded","verify","process","env","JWT_SECRET","user","findById","id","select","role","seller","findOne","_id","save","err","error","authorize","roles","includes","path","method","isSubscriptionActive","subscription","package","Date","endDate","startDate","now","features","maxListings","maxPhotos","commission","searchPlacement","paymentOptions","customAgreements","boostFeatures","homepageVisibility","badges"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\middlewares\\","sources":["auth.middleware.js"],"sourcesContent":["const jwt = require('jsonwebtoken');\r\nconst User = require('../models/User');\r\nconst Seller = require('../models/Seller');\r\n\r\n// Protect routes\r\nexports.protect = async (req, res, next) => {\r\n    try {\r\n        let token;\r\n\r\n        if (req.headers.authorization && req.headers.authorization.startsWith('Bearer')) {\r\n            token = req.headers.authorization.split(' ')[1];\r\n        }\r\n\r\n        if (!token) {\r\n            return res.status(401).json({\r\n                success: false,\r\n                message: 'Not authorized to access this route'\r\n            });\r\n        }\r\n\r\n        try {\r\n            // Verify token\r\n            const decoded = jwt.verify(token, process.env.JWT_SECRET);\r\n            req.user = await User.findById(decoded.id).select('-password');\r\n\r\n            if (!req.user) {\r\n                return res.status(401).json({\r\n                    success: false,\r\n                    message: 'User not found'\r\n                });\r\n            }\r\n\r\n            // If user is a seller, attach seller info\r\n            if (req.user.role === 'seller') {\r\n                req.seller = await Seller.findOne({ user: req.user._id });\r\n                if (!req.seller) {\r\n                    // If seller profile doesn't exist, revert role to user\r\n                    req.user.role = 'user';\r\n                    await req.user.save();\r\n                }\r\n            }\r\n\r\n            next();\r\n        } catch (err) {\r\n            return res.status(401).json({\r\n                success: false,\r\n                message: 'Not authorized to access this route'\r\n            });\r\n        }\r\n    } catch (error) {\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// Grant access to specific roles\r\nexports.authorize = (...roles) => {\r\n    return async (req, res, next) => {\r\n        // Special case for seller profile creation\r\n        if (roles.includes('user') && req.path === '/profile' && req.method === 'POST') {\r\n            if (req.user.role !== 'user') {\r\n                return res.status(403).json({\r\n                    success: false,\r\n                    message: 'Only users can create seller profiles'\r\n                });\r\n            }\r\n            return next();\r\n        }\r\n\r\n        // Special case for seller role\r\n        if (roles.includes('seller')) {\r\n            // Check if user has seller role\r\n            if (req.user.role !== 'seller') {\r\n                return res.status(403).json({\r\n                    success: false,\r\n                    message: 'Seller role required'\r\n                });\r\n            }\r\n\r\n            // Check if seller profile exists\r\n            const seller = await Seller.findOne({ user: req.user._id });\r\n            if (!seller) {\r\n                // Revert role to user if profile doesn't exist\r\n                req.user.role = 'user';\r\n                await req.user.save();\r\n                return res.status(403).json({\r\n                    success: false,\r\n                    message: 'Seller profile required'\r\n                });\r\n            }\r\n\r\n            req.seller = seller;\r\n            return next();\r\n        }\r\n\r\n        // For other roles\r\n        if (!roles.includes(req.user.role)) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: `User role ${req.user.role} is not authorized to access this route`\r\n            });\r\n        }\r\n\r\n        next();\r\n    };\r\n};\r\n\r\n// Check if seller's subscription is active\r\nexports.isSubscriptionActive = async (req, res, next) => {\r\n    try {\r\n        if (!req.seller) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Seller profile required'\r\n            });\r\n        }\r\n\r\n        // For Starter package, always consider active\r\n        if (req.seller.subscription.package === 'Starter') {\r\n            return next();\r\n        }\r\n\r\n        if (req.seller.subscription.status !== 'active') {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Active subscription required'\r\n            });\r\n        }\r\n\r\n        // Check if subscription has expired\r\n        if (new Date() > new Date(req.seller.subscription.endDate)) {\r\n            // Downgrade to Starter package if subscription expires\r\n            req.seller.subscription = {\r\n                package: 'Starter',\r\n                status: 'active',\r\n                startDate: new Date(),\r\n                endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n                features: {\r\n                    maxListings: 1,\r\n                    maxPhotos: 3,\r\n                    commission: 6,\r\n                    searchPlacement: 'basic',\r\n                    paymentOptions: ['platform'],\r\n                    customAgreements: false,\r\n                    boostFeatures: false,\r\n                    homepageVisibility: false,\r\n                    badges: []\r\n                }\r\n            };\r\n            await req.seller.save();\r\n            \r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Subscription has expired. Downgraded to Starter package.'\r\n            });\r\n        }\r\n\r\n        next();\r\n    } catch (error) {\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734029225958},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\User.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst bcrypt = require('bcryptjs');\nconst userSchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: [true, 'Please add a name']\n  },\n  email: {\n    type: String,\n    required: [true, 'Please add an email'],\n    unique: true,\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please add a valid email']\n  },\n  password: {\n    type: String,\n    required: [true, 'Please add a password'],\n    minlength: 6,\n    select: false\n  },\n  role: {\n    type: String,\n    enum: ['user', 'seller', 'admin'],\n    default: 'user'\n  },\n  phone: {\n    type: String,\n    match: [/^[+]?[\\d\\s-]+$/, 'Please enter a valid phone number']\n  },\n  location: {\n    state: String,\n    city: String,\n    pincode: {\n      type: String,\n      match: [/^[0-9]{6}$/, 'Please enter a valid 6-digit pincode']\n    }\n  },\n  isVerified: {\n    type: Boolean,\n    default: false\n  },\n  favorites: [{\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Horse'\n  }],\n  notifications: [{\n    type: {\n      type: String,\n      enum: ['inquiry_response', 'price_drop', 'new_listing', 'system'],\n      required: true\n    },\n    title: {\n      type: String,\n      required: true\n    },\n    message: {\n      type: String,\n      required: true\n    },\n    relatedEntity: {\n      type: {\n        type: String,\n        enum: ['horse', 'inquiry', 'seller']\n      },\n      id: mongoose.Schema.Types.ObjectId\n    },\n    isRead: {\n      type: Boolean,\n      default: false\n    },\n    readAt: Date,\n    createdAt: {\n      type: Date,\n      default: Date.now\n    }\n  }],\n  alertPreferences: {\n    priceDrops: {\n      type: Boolean,\n      default: true\n    },\n    newListings: {\n      type: Boolean,\n      default: true\n    },\n    inquiryResponses: {\n      type: Boolean,\n      default: true\n    },\n    marketUpdates: {\n      type: Boolean,\n      default: false\n    },\n    updatedAt: {\n      type: Date,\n      default: Date.now\n    }\n  },\n  preferences: {\n    breeds: [String],\n    priceRange: {\n      min: Number,\n      max: Number\n    },\n    purposes: [String],\n    location: {\n      states: [String],\n      maxDistance: Number\n    }\n  },\n  createdAt: {\n    type: Date,\n    default: Date.now\n  },\n  updatedAt: {\n    type: Date,\n    default: Date.now\n  }\n});\n\n// Encrypt password using bcrypt\nuserSchema.pre('save', async function (next) {\n  if (!this.isModified('password')) {\n    next();\n  }\n  const salt = await bcrypt.genSalt(10);\n  this.password = await bcrypt.hash(this.password, salt);\n});\n\n// Match user entered password to hashed password in database\nuserSchema.methods.matchPassword = async function (enteredPassword) {\n  return await bcrypt.compare(enteredPassword, this.password);\n};\n\n// Add notification\nuserSchema.methods.addNotification = async function (notification) {\n  this.notifications.unshift(notification);\n  if (this.notifications.length > 50) {\n    this.notifications = this.notifications.slice(0, 50);\n  }\n  return this.save();\n};\n\n// Get unread notifications count\nuserSchema.methods.getUnreadNotificationsCount = function () {\n  return this.notifications.filter(n => !n.isRead).length;\n};\n\n// Create indexes\nuserSchema.index({\n  email: 1\n});\nuserSchema.index({\n  role: 1\n});\nuserSchema.index({\n  'notifications.isRead': 1\n});\nuserSchema.index({\n  'notifications.createdAt': -1\n});\nmodule.exports = mongoose.model('User', userSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJiY3J5cHQiLCJ1c2VyU2NoZW1hIiwiU2NoZW1hIiwibmFtZSIsInR5cGUiLCJTdHJpbmciLCJyZXF1aXJlZCIsImVtYWlsIiwidW5pcXVlIiwibWF0Y2giLCJwYXNzd29yZCIsIm1pbmxlbmd0aCIsInNlbGVjdCIsInJvbGUiLCJlbnVtIiwiZGVmYXVsdCIsInBob25lIiwibG9jYXRpb24iLCJzdGF0ZSIsImNpdHkiLCJwaW5jb2RlIiwiaXNWZXJpZmllZCIsIkJvb2xlYW4iLCJmYXZvcml0ZXMiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwibm90aWZpY2F0aW9ucyIsInRpdGxlIiwibWVzc2FnZSIsInJlbGF0ZWRFbnRpdHkiLCJpZCIsImlzUmVhZCIsInJlYWRBdCIsIkRhdGUiLCJjcmVhdGVkQXQiLCJub3ciLCJhbGVydFByZWZlcmVuY2VzIiwicHJpY2VEcm9wcyIsIm5ld0xpc3RpbmdzIiwiaW5xdWlyeVJlc3BvbnNlcyIsIm1hcmtldFVwZGF0ZXMiLCJ1cGRhdGVkQXQiLCJwcmVmZXJlbmNlcyIsImJyZWVkcyIsInByaWNlUmFuZ2UiLCJtaW4iLCJOdW1iZXIiLCJtYXgiLCJwdXJwb3NlcyIsInN0YXRlcyIsIm1heERpc3RhbmNlIiwicHJlIiwibmV4dCIsImlzTW9kaWZpZWQiLCJzYWx0IiwiZ2VuU2FsdCIsImhhc2giLCJtZXRob2RzIiwibWF0Y2hQYXNzd29yZCIsImVudGVyZWRQYXNzd29yZCIsImNvbXBhcmUiLCJhZGROb3RpZmljYXRpb24iLCJub3RpZmljYXRpb24iLCJ1bnNoaWZ0IiwibGVuZ3RoIiwic2xpY2UiLCJzYXZlIiwiZ2V0VW5yZWFkTm90aWZpY2F0aW9uc0NvdW50IiwiZmlsdGVyIiwibiIsImluZGV4IiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxtb2RlbHNcXCIsInNvdXJjZXMiOlsiVXNlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcbmNvbnN0IGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdGpzJyk7XHJcblxyXG5jb25zdCB1c2VyU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XHJcbiAgICBuYW1lOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1BsZWFzZSBhZGQgYSBuYW1lJ11cclxuICAgIH0sXHJcbiAgICBlbWFpbDoge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICByZXF1aXJlZDogW3RydWUsICdQbGVhc2UgYWRkIGFuIGVtYWlsJ10sXHJcbiAgICAgICAgdW5pcXVlOiB0cnVlLFxyXG4gICAgICAgIG1hdGNoOiBbXHJcbiAgICAgICAgICAgIC9eXFx3KyhbXFwuLV0/XFx3KykqQFxcdysoW1xcLi1dP1xcdyspKihcXC5cXHd7MiwzfSkrJC8sXHJcbiAgICAgICAgICAgICdQbGVhc2UgYWRkIGEgdmFsaWQgZW1haWwnXHJcbiAgICAgICAgXVxyXG4gICAgfSxcclxuICAgIHBhc3N3b3JkOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIHJlcXVpcmVkOiBbdHJ1ZSwgJ1BsZWFzZSBhZGQgYSBwYXNzd29yZCddLFxyXG4gICAgICAgIG1pbmxlbmd0aDogNixcclxuICAgICAgICBzZWxlY3Q6IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgcm9sZToge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBlbnVtOiBbJ3VzZXInLCAnc2VsbGVyJywgJ2FkbWluJ10sXHJcbiAgICAgICAgZGVmYXVsdDogJ3VzZXInXHJcbiAgICB9LFxyXG4gICAgcGhvbmU6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgbWF0Y2g6IFsvXlsrXT9bXFxkXFxzLV0rJC8sICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBwaG9uZSBudW1iZXInXVxyXG4gICAgfSxcclxuICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgc3RhdGU6IFN0cmluZyxcclxuICAgICAgICBjaXR5OiBTdHJpbmcsXHJcbiAgICAgICAgcGluY29kZToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIG1hdGNoOiBbL15bMC05XXs2fSQvLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgNi1kaWdpdCBwaW5jb2RlJ11cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgaXNWZXJpZmllZDoge1xyXG4gICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgIH0sXHJcbiAgICBmYXZvcml0ZXM6IFt7XHJcbiAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlZjogJ0hvcnNlJ1xyXG4gICAgfV0sXHJcbiAgICBub3RpZmljYXRpb25zOiBbe1xyXG4gICAgICAgIHR5cGU6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICBlbnVtOiBbJ2lucXVpcnlfcmVzcG9uc2UnLCAncHJpY2VfZHJvcCcsICduZXdfbGlzdGluZycsICdzeXN0ZW0nXSxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRpdGxlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1lc3NhZ2U6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVsYXRlZEVudGl0eToge1xyXG4gICAgICAgICAgICB0eXBlOiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBlbnVtOiBbJ2hvcnNlJywgJ2lucXVpcnknLCAnc2VsbGVyJ11cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaWQ6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaXNSZWFkOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWFkQXQ6IERhdGUsXHJcbiAgICAgICAgY3JlYXRlZEF0OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IERhdGUsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IERhdGUubm93XHJcbiAgICAgICAgfVxyXG4gICAgfV0sXHJcbiAgICBhbGVydFByZWZlcmVuY2VzOiB7XHJcbiAgICAgICAgcHJpY2VEcm9wczoge1xyXG4gICAgICAgICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBuZXdMaXN0aW5nczoge1xyXG4gICAgICAgICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbnF1aXJ5UmVzcG9uc2VzOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1hcmtldFVwZGF0ZXM6IHtcclxuICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgICAgICB9LFxyXG4gICAgICAgIHVwZGF0ZWRBdDoge1xyXG4gICAgICAgICAgICB0eXBlOiBEYXRlLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiBEYXRlLm5vd1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBwcmVmZXJlbmNlczoge1xyXG4gICAgICAgIGJyZWVkczogW1N0cmluZ10sXHJcbiAgICAgICAgcHJpY2VSYW5nZToge1xyXG4gICAgICAgICAgICBtaW46IE51bWJlcixcclxuICAgICAgICAgICAgbWF4OiBOdW1iZXJcclxuICAgICAgICB9LFxyXG4gICAgICAgIHB1cnBvc2VzOiBbU3RyaW5nXSxcclxuICAgICAgICBsb2NhdGlvbjoge1xyXG4gICAgICAgICAgICBzdGF0ZXM6IFtTdHJpbmddLFxyXG4gICAgICAgICAgICBtYXhEaXN0YW5jZTogTnVtYmVyXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGNyZWF0ZWRBdDoge1xyXG4gICAgICAgIHR5cGU6IERhdGUsXHJcbiAgICAgICAgZGVmYXVsdDogRGF0ZS5ub3dcclxuICAgIH0sXHJcbiAgICB1cGRhdGVkQXQ6IHtcclxuICAgICAgICB0eXBlOiBEYXRlLFxyXG4gICAgICAgIGRlZmF1bHQ6IERhdGUubm93XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLy8gRW5jcnlwdCBwYXNzd29yZCB1c2luZyBiY3J5cHRcclxudXNlclNjaGVtYS5wcmUoJ3NhdmUnLCBhc3luYyBmdW5jdGlvbihuZXh0KSB7XHJcbiAgICBpZiAoIXRoaXMuaXNNb2RpZmllZCgncGFzc3dvcmQnKSkge1xyXG4gICAgICAgIG5leHQoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzYWx0ID0gYXdhaXQgYmNyeXB0LmdlblNhbHQoMTApO1xyXG4gICAgdGhpcy5wYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHRoaXMucGFzc3dvcmQsIHNhbHQpO1xyXG59KTtcclxuXHJcbi8vIE1hdGNoIHVzZXIgZW50ZXJlZCBwYXNzd29yZCB0byBoYXNoZWQgcGFzc3dvcmQgaW4gZGF0YWJhc2VcclxudXNlclNjaGVtYS5tZXRob2RzLm1hdGNoUGFzc3dvcmQgPSBhc3luYyBmdW5jdGlvbihlbnRlcmVkUGFzc3dvcmQpIHtcclxuICAgIHJldHVybiBhd2FpdCBiY3J5cHQuY29tcGFyZShlbnRlcmVkUGFzc3dvcmQsIHRoaXMucGFzc3dvcmQpO1xyXG59O1xyXG5cclxuLy8gQWRkIG5vdGlmaWNhdGlvblxyXG51c2VyU2NoZW1hLm1ldGhvZHMuYWRkTm90aWZpY2F0aW9uID0gYXN5bmMgZnVuY3Rpb24obm90aWZpY2F0aW9uKSB7XHJcbiAgICB0aGlzLm5vdGlmaWNhdGlvbnMudW5zaGlmdChub3RpZmljYXRpb24pO1xyXG4gICAgaWYgKHRoaXMubm90aWZpY2F0aW9ucy5sZW5ndGggPiA1MCkge1xyXG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9ucyA9IHRoaXMubm90aWZpY2F0aW9ucy5zbGljZSgwLCA1MCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5zYXZlKCk7XHJcbn07XHJcblxyXG4vLyBHZXQgdW5yZWFkIG5vdGlmaWNhdGlvbnMgY291bnRcclxudXNlclNjaGVtYS5tZXRob2RzLmdldFVucmVhZE5vdGlmaWNhdGlvbnNDb3VudCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubm90aWZpY2F0aW9ucy5maWx0ZXIobiA9PiAhbi5pc1JlYWQpLmxlbmd0aDtcclxufTtcclxuXHJcbi8vIENyZWF0ZSBpbmRleGVzXHJcbnVzZXJTY2hlbWEuaW5kZXgoeyBlbWFpbDogMSB9KTtcclxudXNlclNjaGVtYS5pbmRleCh7IHJvbGU6IDEgfSk7XHJcbnVzZXJTY2hlbWEuaW5kZXgoeyAnbm90aWZpY2F0aW9ucy5pc1JlYWQnOiAxIH0pO1xyXG51c2VyU2NoZW1hLmluZGV4KHsgJ25vdGlmaWNhdGlvbnMuY3JlYXRlZEF0JzogLTEgfSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdVc2VyJywgdXNlclNjaGVtYSk7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBQ3BDLE1BQU1DLE1B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","map":{"version":3,"names":["mongoose","require","bcrypt","userSchema","Schema","name","type","String","required","email","unique","match","password","minlength","select","role","enum","default","phone","location","state","city","pincode","isVerified","Boolean","favorites","Types","ObjectId","ref","notifications","title","message","relatedEntity","id","isRead","readAt","Date","createdAt","now","alertPreferences","priceDrops","newListings","inquiryResponses","marketUpdates","updatedAt","preferences","breeds","priceRange","min","Number","max","purposes","states","maxDistance","pre","next","isModified","salt","genSalt","hash","methods","matchPassword","enteredPassword","compare","addNotification","notification","unshift","length","slice","save","getUnreadNotificationsCount","filter","n","index","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["User.js"],"sourcesContent":["const mongoose = require('mongoose');\r\nconst bcrypt = require('bcryptjs');\r\n\r\nconst userSchema = new mongoose.Schema({\r\n    name: {\r\n        type: String,\r\n        required: [true, 'Please add a name']\r\n    },\r\n    email: {\r\n        type: String,\r\n        required: [true, 'Please add an email'],\r\n        unique: true,\r\n        match: [\r\n            /^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/,\r\n            'Please add a valid email'\r\n        ]\r\n    },\r\n    password: {\r\n        type: String,\r\n        required: [true, 'Please add a password'],\r\n        minlength: 6,\r\n        select: false\r\n    },\r\n    role: {\r\n        type: String,\r\n        enum: ['user', 'seller', 'admin'],\r\n        default: 'user'\r\n    },\r\n    phone: {\r\n        type: String,\r\n        match: [/^[+]?[\\d\\s-]+$/, 'Please enter a valid phone number']\r\n    },\r\n    location: {\r\n        state: String,\r\n        city: String,\r\n        pincode: {\r\n            type: String,\r\n            match: [/^[0-9]{6}$/, 'Please enter a valid 6-digit pincode']\r\n        }\r\n    },\r\n    isVerified: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    favorites: [{\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Horse'\r\n    }],\r\n    notifications: [{\r\n        type: {\r\n            type: String,\r\n            enum: ['inquiry_response', 'price_drop', 'new_listing', 'system'],\r\n            required: true\r\n        },\r\n        title: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        message: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        relatedEntity: {\r\n            type: {\r\n                type: String,\r\n                enum: ['horse', 'inquiry', 'seller']\r\n            },\r\n            id: mongoose.Schema.Types.ObjectId\r\n        },\r\n        isRead: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        readAt: Date,\r\n        createdAt: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    }],\r\n    alertPreferences: {\r\n        priceDrops: {\r\n            type: Boolean,\r\n            default: true\r\n        },\r\n        newListings: {\r\n            type: Boolean,\r\n            default: true\r\n        },\r\n        inquiryResponses: {\r\n            type: Boolean,\r\n            default: true\r\n        },\r\n        marketUpdates: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        updatedAt: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    },\r\n    preferences: {\r\n        breeds: [String],\r\n        priceRange: {\r\n            min: Number,\r\n            max: Number\r\n        },\r\n        purposes: [String],\r\n        location: {\r\n            states: [String],\r\n            maxDistance: Number\r\n        }\r\n    },\r\n    createdAt: {\r\n        type: Date,\r\n        default: Date.now\r\n    },\r\n    updatedAt: {\r\n        type: Date,\r\n        default: Date.now\r\n    }\r\n});\r\n\r\n// Encrypt password using bcrypt\r\nuserSchema.pre('save', async function(next) {\r\n    if (!this.isModified('password')) {\r\n        next();\r\n    }\r\n\r\n    const salt = await bcrypt.genSalt(10);\r\n    this.password = await bcrypt.hash(this.password, salt);\r\n});\r\n\r\n// Match user entered password to hashed password in database\r\nuserSchema.methods.matchPassword = async function(enteredPassword) {\r\n    return await bcrypt.compare(enteredPassword, this.password);\r\n};\r\n\r\n// Add notification\r\nuserSchema.methods.addNotification = async function(notification) {\r\n    this.notifications.unshift(notification);\r\n    if (this.notifications.length > 50) {\r\n        this.notifications = this.notifications.slice(0, 50);\r\n    }\r\n    return this.save();\r\n};\r\n\r\n// Get unread notifications count\r\nuserSchema.methods.getUnreadNotificationsCount = function() {\r\n    return this.notifications.filter(n => !n.isRead).length;\r\n};\r\n\r\n// Create indexes\r\nuserSchema.index({ email: 1 });\r\nuserSchema.index({ role: 1 });\r\nuserSchema.index({ 'notifications.isRead': 1 });\r\nuserSchema.index({ 'notifications.createdAt': -1 });\r\n\r\nmodule.exports = mongoose.model('User', userSchema); "],"mappings":"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","ignoreList":[]}},"mtime":1734037885211},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Seller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst sellerSchema = new mongoose.Schema({\n  user: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true,\n    unique: true\n  },\n  businessName: {\n    type: String,\n    required: true,\n    trim: true\n  },\n  description: {\n    type: String,\n    required: true\n  },\n  location: {\n    state: {\n      type: String,\n      required: true\n    },\n    city: {\n      type: String,\n      required: true\n    },\n    pincode: {\n      type: String,\n      required: true\n    }\n  },\n  contactDetails: {\n    phone: {\n      type: String,\n      required: true,\n      match: [/^[0-9]{10}$/, 'Please enter a valid 10-digit phone number']\n    },\n    email: {\n      type: String,\n      required: true,\n      match: [/^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/, 'Please enter a valid email']\n    },\n    whatsapp: {\n      type: String,\n      match: [/^[0-9]{10}$/, 'Please enter a valid 10-digit WhatsApp number']\n    }\n  },\n  businessDocuments: {\n    gst: String,\n    pan: String,\n    otherDocuments: [{\n      name: String,\n      url: String,\n      verified: {\n        type: Boolean,\n        default: false\n      }\n    }]\n  },\n  subscription: {\n    plan: {\n      type: String,\n      enum: ['Royal Stallion', 'Gallop', 'Trot'],\n      default: 'Trot'\n    },\n    status: {\n      type: String,\n      enum: ['active', 'expired', 'cancelled'],\n      default: 'active'\n    },\n    startDate: {\n      type: Date,\n      default: Date.now\n    },\n    expiresAt: {\n      type: Date,\n      default: () => new Date(Date.now() + 365 * 24 * 60 * 60 * 1000) // 1 year for starter plan\n    }\n  },\n  verificationStatus: {\n    type: String,\n    enum: ['pending', 'verified', 'rejected'],\n    default: 'pending'\n  },\n  rating: {\n    average: {\n      type: Number,\n      default: 0,\n      min: 0,\n      max: 5\n    },\n    count: {\n      type: Number,\n      default: 0\n    }\n  },\n  verification: {\n    level: {\n      type: String,\n      enum: ['basic', 'professional', null],\n      default: null\n    },\n    status: {\n      type: String,\n      enum: ['unverified', 'pending', 'verified', 'rejected'],\n      default: 'unverified'\n    },\n    submittedAt: Date,\n    verifiedAt: Date,\n    expiresAt: Date,\n    documents: [{\n      type: {\n        type: String,\n        enum: ['identity', 'address', 'business_license', 'tax_registration', 'bank_statement']\n      },\n      url: String,\n      public_id: String,\n      verified: {\n        type: Boolean,\n        default: false\n      },\n      verifiedAt: Date,\n      verifiedBy: {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: 'User'\n      }\n    }],\n    notes: String,\n    rejectionReason: String\n  },\n  badges: [{\n    type: {\n      type: String,\n      enum: ['Top Seller', 'Premium Stable', 'Verified Seller']\n    },\n    awardedAt: {\n      type: Date,\n      default: Date.now\n    },\n    expiresAt: Date,\n    criteria: {\n      type: Map,\n      of: mongoose.Schema.Types.Mixed\n    }\n  }],\n  statistics: {\n    totalListings: {\n      type: Number,\n      default: 0\n    },\n    activeListings: {\n      type: Number,\n      default: 0\n    },\n    activeSales: {\n      type: Number,\n      default: 0\n    },\n    totalSales: {\n      type: Number,\n      default: 0\n    },\n    totalRevenue: {\n      type: Number,\n      default: 0\n    },\n    rating: {\n      type: Number,\n      default: 0,\n      min: 0,\n      max: 5\n    },\n    reviewCount: {\n      type: Number,\n      default: 0\n    },\n    responseRate: {\n      type: Number,\n      default: 0\n    },\n    responseTime: {\n      type: Number,\n      // in hours\n      default: 0\n    }\n  },\n  reviews: [{\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Review'\n  }]\n}, {\n  timestamps: true\n});\n\n// Pre-save hook to update statistics\nsellerSchema.pre('save', async function (next) {\n  if (this.isModified('reviews')) {\n    // Update rating\n    if (this.reviews && this.reviews.length > 0) {\n      const totalRating = this.reviews.reduce((acc, review) => acc + review.rating, 0);\n      this.statistics.rating = totalRating / this.reviews.length;\n      this.statistics.reviewCount = this.reviews.length;\n    }\n  }\n\n  // Check badge expiry\n  if (this.badges) {\n    this.badges = this.badges.filter(badge => !badge.expiresAt || badge.expiresAt > new Date());\n  }\n\n  // Check verification expiry\n  if (this.verification && this.verification.expiresAt && this.verification.expiresAt < new Date()) {\n    this.verification.status = 'unverified';\n    this.verification.level = null;\n  }\n  next();\n});\n\n// Method to check badge eligibility\nsellerSchema.methods.checkBadgeEligibility = async function () {\n  const eligibleBadges = [];\n\n  // Top Seller criteria\n  if (this.statistics.totalSales >= 5 && this.statistics.rating >= 4.5 && this.statistics.totalListings >= 10) {\n    eligibleBadges.push('Top Seller');\n  }\n\n  // Premium Stable criteria\n  if (this.subscription?.plan === 'Royal Stallion' && this.verification?.level === 'professional' && this.statistics.rating >= 4.0 && this.statistics.totalListings >= 5) {\n    eligibleBadges.push('Premium Stable');\n  }\n\n  // Verified Seller criteria\n  if (this.verification?.level === 'basic') {\n    eligibleBadges.push('Verified Seller');\n  }\n  return eligibleBadges;\n};\n\n// Method to award badge\nsellerSchema.methods.awardBadge = async function (badgeType) {\n  if (!this.badges) {\n    this.badges = [];\n  }\n\n  // Remove existing badge of same type\n  this.badges = this.badges.filter(b => b.type !== badgeType);\n\n  // Add new badge\n  const expiryDate = new Date();\n  expiryDate.setMonth(expiryDate.getMonth() + 3); // Badges expire after 3 months\n\n  this.badges.push({\n    type: badgeType,\n    awardedAt: new Date(),\n    expiresAt: expiryDate,\n    criteria: this.statistics\n  });\n  await this.save();\n};\n\n// Method to check if subscription is active\nsellerSchema.methods.hasActiveSubscription = function () {\n  return this.subscription.status === 'active' && new Date() < this.subscription.expiresAt;\n};\n\n// Method to get listing limit based on subscription\nsellerSchema.methods.getListingLimit = function () {\n  switch (this.subscription.plan) {\n    case 'Trot':\n      return 2;\n    case 'Gallop':\n      return 10;\n    case 'Royal Stallion':\n      return Infinity;\n    default:\n      return 0;\n  }\n};\n\n// Method to check if can add more listings\nsellerSchema.methods.canAddListing = function () {\n  if (!this.hasActiveSubscription()) return false;\n  return this.statistics.activeListings < this.getListingLimit();\n};\n\n// Method to generate auth token (if needed for tests)\nsellerSchema.methods.generateAuthToken = function () {\n  const jwt = require('jsonwebtoken');\n  return jwt.sign({\n    _id: this._id,\n    role: 'seller',\n    businessName: this.businessName\n  }, process.env.JWT_SECRET, {\n    expiresIn: '24h'\n  });\n};\nmodule.exports = mongoose.model('Seller', sellerSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJzZWxsZXJTY2hlbWEiLCJTY2hlbWEiLCJ1c2VyIiwidHlwZSIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJyZXF1aXJlZCIsInVuaXF1ZSIsImJ1c2luZXNzTmFtZSIsIlN0cmluZyIsInRyaW0iLCJkZXNjcmlwdGlvbiIsImxvY2F0aW9uIiwic3RhdGUiLCJjaXR5IiwicGluY29kZSIsImNvbnRhY3REZXRhaWxzIiwicGhvbmUiLCJtYXRjaCIsImVtYWlsIiwid2hhdHNhcHAiLCJidXNpbmVzc0RvY3VtZW50cyIsImdzdCIsInBhbiIsIm90aGVyRG9jdW1lbnRzIiwibmFtZSIsInVybCIsInZlcmlmaWVkIiwiQm9vbGVhbiIsImRlZmF1bHQiLCJzdWJzY3JpcHRpb24iLCJwbGFuIiwiZW51bSIsInN0YXR1cyIsInN0YXJ0RGF0ZSIsIkRhdGUiLCJub3ciLCJleHBpcmVzQXQiLCJ2ZXJpZmljYXRpb25TdGF0dXMiLCJyYXRpbmciLCJhdmVyYWdlIiwiTnVtYmVyIiwibWluIiwibWF4IiwiY291bnQiLCJ2ZXJpZmljYXRpb24iLCJsZXZlbCIsInN1Ym1pdHRlZEF0IiwidmVyaWZpZWRBdCIsImRvY3VtZW50cyIsInB1YmxpY19pZCIsInZlcmlmaWVkQnkiLCJub3RlcyIsInJlamVjdGlvblJlYXNvbiIsImJhZGdlcyIsImF3YXJkZWRBdCIsImNyaXRlcmlhIiwiTWFwIiwib2YiLCJNaXhlZCIsInN0YXRpc3RpY3MiLCJ0b3RhbExpc3RpbmdzIiwiYWN0aXZlTGlzdGluZ3MiLCJhY3RpdmVTYWxlcyIsInRvdGFsU2FsZXMiLCJ0b3RhbFJldmVudWUiLCJyZXZpZXdDb3VudCIsInJlc3BvbnNlUmF0ZSIsInJlc3BvbnNlVGltZSIsInJldmlld3MiLCJ0aW1lc3RhbXBzIiwicHJlIiwibmV4dCIsImlzTW9kaWZpZWQiLCJsZW5ndGgiLCJ0b3RhbFJhdGluZyIsInJlZHVjZSIsImFjYyIsInJldmlldyIsImZpbHRlciIsImJhZGdlIiwibWV0aG9kcyIsImNoZWNrQmFkZ2VFbGlnaWJpbGl0eSIsImVsaWdpYmxlQmFkZ2VzIiwicHVzaCIsImF3YXJkQmFkZ2UiLCJiYWRnZVR5cGUiLCJiIiwiZXhwaXJ5RGF0ZSIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJzYXZlIiwiaGFzQWN0aXZlU3Vic2NyaXB0aW9uIiwiZ2V0TGlzdGluZ0xpbWl0IiwiSW5maW5pdHkiLCJjYW5BZGRMaXN0aW5nIiwiZ2VuZXJhdGVBdXRoVG9rZW4iLCJqd3QiLCJzaWduIiwiX2lkIiwicm9sZSIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwiZXhwaXJlc0luIiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxtb2RlbHNcXCIsInNvdXJjZXMiOlsiU2VsbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcclxuXHJcbmNvbnN0IHNlbGxlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gICAgdXNlcjoge1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICB1bmlxdWU6IHRydWVcclxuICAgIH0sXHJcbiAgICBidXNpbmVzc05hbWU6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgdHJpbTogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGRlc2NyaXB0aW9uOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgbG9jYXRpb246IHtcclxuICAgICAgICBzdGF0ZToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjaXR5OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHBpbmNvZGU6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjb250YWN0RGV0YWlsczoge1xyXG4gICAgICAgIHBob25lOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgICAgIG1hdGNoOiBbL15bMC05XXsxMH0kLywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIDEwLWRpZ2l0IHBob25lIG51bWJlciddXHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbWFpbDoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBtYXRjaDogWy9eW1xcdy1cXC5dK0AoW1xcdy1dK1xcLikrW1xcdy1dezIsNH0kLywgJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsJ11cclxuICAgICAgICB9LFxyXG4gICAgICAgIHdoYXRzYXBwOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgbWF0Y2g6IFsvXlswLTldezEwfSQvLCAnUGxlYXNlIGVudGVyIGEgdmFsaWQgMTAtZGlnaXQgV2hhdHNBcHAgbnVtYmVyJ11cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgYnVzaW5lc3NEb2N1bWVudHM6IHtcclxuICAgICAgICBnc3Q6IFN0cmluZyxcclxuICAgICAgICBwYW46IFN0cmluZyxcclxuICAgICAgICBvdGhlckRvY3VtZW50czogW3tcclxuICAgICAgICAgICAgbmFtZTogU3RyaW5nLFxyXG4gICAgICAgICAgICB1cmw6IFN0cmluZyxcclxuICAgICAgICAgICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBmYWxzZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfV1cclxuICAgIH0sXHJcbiAgICBzdWJzY3JpcHRpb246IHtcclxuICAgICAgICBwbGFuOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgZW51bTogWydSb3lhbCBTdGFsbGlvbicsICdHYWxsb3AnLCAnVHJvdCddLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiAnVHJvdCdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHN0YXR1czoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGVudW06IFsnYWN0aXZlJywgJ2V4cGlyZWQnLCAnY2FuY2VsbGVkJ10sXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6ICdhY3RpdmUnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdGFydERhdGU6IHtcclxuICAgICAgICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgICAgICAgZGVmYXVsdDogRGF0ZS5ub3dcclxuICAgICAgICB9LFxyXG4gICAgICAgIGV4cGlyZXNBdDoge1xyXG4gICAgICAgICAgICB0eXBlOiBEYXRlLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiAoKSA9PiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCkgLy8gMSB5ZWFyIGZvciBzdGFydGVyIHBsYW5cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgdmVyaWZpY2F0aW9uU3RhdHVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGVudW06IFsncGVuZGluZycsICd2ZXJpZmllZCcsICdyZWplY3RlZCddLFxyXG4gICAgICAgIGRlZmF1bHQ6ICdwZW5kaW5nJ1xyXG4gICAgfSxcclxuICAgIHJhdGluZzoge1xyXG4gICAgICAgIGF2ZXJhZ2U6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiAwLFxyXG4gICAgICAgICAgICBtaW46IDAsXHJcbiAgICAgICAgICAgIG1heDogNVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY291bnQ6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiAwXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHZlcmlmaWNhdGlvbjoge1xyXG4gICAgICAgIGxldmVsOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgZW51bTogWydiYXNpYycsICdwcm9mZXNzaW9uYWwnLCBudWxsXSxcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc3RhdHVzOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgZW51bTogWyd1bnZlcmlmaWVkJywgJ3BlbmRpbmcnLCAndmVyaWZpZWQnLCAncmVqZWN0ZWQnXSxcclxuICAgICAgICAgICAgZGVmYXVsdDogJ3VudmVyaWZpZWQnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdWJtaXR0ZWRBdDogRGF0ZSxcclxuICAgICAgICB2ZXJpZmllZEF0OiBEYXRlLFxyXG4gICAgICAgIGV4cGlyZXNBdDogRGF0ZSxcclxuICAgICAgICBkb2N1bWVudHM6IFt7XHJcbiAgICAgICAgICAgIHR5cGU6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgICAgIGVudW06IFsnaWRlbnRpdHknLCAnYWRkcmVzcycsICdidXNpbmVzc19saWNlbnNlJywgJ3RheF9yZWdpc3RyYXRpb24nLCAnYmFua19zdGF0ZW1lbnQnXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB1cmw6IFN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljX2lkOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHZlcmlmaWVkOiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdmVyaWZpZWRBdDogRGF0ZSxcclxuICAgICAgICAgICAgdmVyaWZpZWRCeToge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgICAgICAgICAgcmVmOiAnVXNlcidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1dLFxyXG4gICAgICAgIG5vdGVzOiBTdHJpbmcsXHJcbiAgICAgICAgcmVqZWN0aW9uUmVhc29uOiBTdHJpbmdcclxuICAgIH0sXHJcbiAgICBiYWRnZXM6IFt7XHJcbiAgICAgICAgdHlwZToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGVudW06IFsnVG9wIFNlbGxlcicsICdQcmVtaXVtIFN0YWJsZScsICdWZXJpZmllZCBTZWxsZXInXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYXdhcmRlZEF0OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IERhdGUsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IERhdGUubm93XHJcbiAgICAgICAgfSxcclxuICAgICAgICBleHBpcmVzQXQ6IERhdGUsXHJcbiAgICAgICAgY3JpdGVyaWE6IHtcclxuICAgICAgICAgICAgdHlwZTogTWFwLFxyXG4gICAgICAgICAgICBvZjogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk1peGVkXHJcbiAgICAgICAgfVxyXG4gICAgfV0sXHJcbiAgICBzdGF0aXN0aWNzOiB7XHJcbiAgICAgICAgdG90YWxMaXN0aW5nczoge1xyXG4gICAgICAgICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFjdGl2ZUxpc3RpbmdzOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgZGVmYXVsdDogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWN0aXZlU2FsZXM6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiAwXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0b3RhbFNhbGVzOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgZGVmYXVsdDogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG90YWxSZXZlbnVlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgZGVmYXVsdDogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmF0aW5nOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgZGVmYXVsdDogMCxcclxuICAgICAgICAgICAgbWluOiAwLFxyXG4gICAgICAgICAgICBtYXg6IDVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJldmlld0NvdW50OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgZGVmYXVsdDogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzcG9uc2VSYXRlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgZGVmYXVsdDogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVzcG9uc2VUaW1lOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlciwgLy8gaW4gaG91cnNcclxuICAgICAgICAgICAgZGVmYXVsdDogMFxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICByZXZpZXdzOiBbe1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdSZXZpZXcnXHJcbiAgICB9XVxyXG59LCB7XHJcbiAgICB0aW1lc3RhbXBzOiB0cnVlXHJcbn0pO1xyXG5cclxuLy8gUHJlLXNhdmUgaG9vayB0byB1cGRhdGUgc3RhdGlzdGljc1xyXG5zZWxsZXJTY2hlbWEucHJlKCdzYXZlJywgYXN5bmMgZnVuY3Rpb24obmV4dCkge1xyXG4gICAgaWYgKHRoaXMuaXNNb2RpZmllZCgncmV2aWV3cycpKSB7XHJcbiAgICAgICAgLy8gVXBkYXRlIHJhdGluZ1xyXG4gICAgICAgIGlmICh0aGlzLnJldmlld3MgJiYgdGhpcy5yZXZpZXdzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgdG90YWxSYXRpbmcgPSB0aGlzLnJldmlld3MucmVkdWNlKChhY2MsIHJldmlldykgPT4gYWNjICsgcmV2aWV3LnJhdGluZywgMCk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljcy5yYXRpbmcgPSB0b3RhbFJhdGluZyAvIHRoaXMucmV2aWV3cy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGlzdGljcy5yZXZpZXdDb3VudCA9IHRoaXMucmV2aWV3cy5sZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGJhZGdlIGV4cGlyeVxyXG4gICAgaWYgKHRoaXMuYmFkZ2VzKSB7XHJcbiAgICAgICAgdGhpcy5iYWRnZXMgPSB0aGlzLmJhZGdlcy5maWx0ZXIoYmFkZ2UgPT4gXHJcbiAgICAgICAgICAgICFiYWRnZS5leHBpcmVzQXQgfHwgYmFkZ2UuZXhwaXJlc0F0ID4gbmV3IERhdGUoKVxyXG4gICAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgdmVyaWZpY2F0aW9uIGV4cGlyeVxyXG4gICAgaWYgKHRoaXMudmVyaWZpY2F0aW9uICYmIHRoaXMudmVyaWZpY2F0aW9uLmV4cGlyZXNBdCAmJiB0aGlzLnZlcmlmaWNhdGlvbi5leHBpcmVzQXQgPCBuZXcgRGF0ZSgpKSB7XHJcbiAgICAgICAgdGhpcy52ZXJpZmljYXRpb24uc3RhdHVzID0gJ3VudmVyaWZpZWQnO1xyXG4gICAgICAgIHRoaXMudmVyaWZpY2F0aW9uLmxldmVsID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBuZXh0KCk7XHJcbn0pO1xyXG5cclxuLy8gTWV0aG9kIHRvIGNoZWNrIGJhZGdlIGVsaWdpYmlsaXR5XHJcbnNlbGxlclNjaGVtYS5tZXRob2RzLmNoZWNrQmFkZ2VFbGlnaWJpbGl0eSA9IGFzeW5jIGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3QgZWxpZ2libGVCYWRnZXMgPSBbXTtcclxuXHJcbiAgICAvLyBUb3AgU2VsbGVyIGNyaXRlcmlhXHJcbiAgICBpZiAoXHJcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzLnRvdGFsU2FsZXMgPj0gNSAmJlxyXG4gICAgICAgIHRoaXMuc3RhdGlzdGljcy5yYXRpbmcgPj0gNC41ICYmXHJcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzLnRvdGFsTGlzdGluZ3MgPj0gMTBcclxuICAgICkge1xyXG4gICAgICAgIGVsaWdpYmxlQmFkZ2VzLnB1c2goJ1RvcCBTZWxsZXInKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBQcmVtaXVtIFN0YWJsZSBjcml0ZXJpYVxyXG4gICAgaWYgKFxyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9uPy5wbGFuID09PSAnUm95YWwgU3RhbGxpb24nICYmXHJcbiAgICAgICAgdGhpcy52ZXJpZmljYXRpb24/LmxldmVsID09PSAncHJvZmVzc2lvbmFsJyAmJlxyXG4gICAgICAgIHRoaXMuc3RhdGlzdGljcy5yYXRpbmcgPj0gNC4wICYmXHJcbiAgICAgICAgdGhpcy5zdGF0aXN0aWNzLnRvdGFsTGlzdGluZ3MgPj0gNVxyXG4gICAgKSB7XHJcbiAgICAgICAgZWxpZ2libGVCYWRnZXMucHVzaCgnUHJlbWl1bSBTdGFibGUnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWZXJpZmllZCBTZWxsZXIgY3JpdGVyaWFcclxuICAgIGlmICh0aGlzLnZlcmlmaWNhdGlvbj8ubGV2ZWwgPT09ICdiYXNpYycpIHtcclxuICAgICAgICBlbGlnaWJsZUJhZGdlcy5wdXNoKCdWZXJpZmllZCBTZWxsZXInKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZWxpZ2libGVCYWRnZXM7XHJcbn07XHJcblxyXG4vLyBNZXRob2QgdG8gYXdhcmQgYmFkZ2Vcclxuc2VsbGVyU2NoZW1hLm1ldGhvZHMuYXdhcmRCYWRnZSA9IGFzeW5jIGZ1bmN0aW9uKGJhZGdlVHlwZSkge1xyXG4gICAgaWYgKCF0aGlzLmJhZGdlcykge1xyXG4gICAgICAgIHRoaXMuYmFkZ2VzID0gW107XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUmVtb3ZlIGV4aXN0aW5nIGJhZGdlIG9mIHNhbWUgdHlwZVxyXG4gICAgdGhpcy5iYWRnZXMgPSB0aGlzLmJhZGdlcy5maWx0ZXIoYiA9PiBiLnR5cGUgIT09IGJhZGdlVHlwZSk7XHJcblxyXG4gICAgLy8gQWRkIG5ldyBiYWRnZVxyXG4gICAgY29uc3QgZXhwaXJ5RGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICBleHBpcnlEYXRlLnNldE1vbnRoKGV4cGlyeURhdGUuZ2V0TW9udGgoKSArIDMpOyAvLyBCYWRnZXMgZXhwaXJlIGFmdGVyIDMgbW9udGhzXHJcblxyXG4gICAgdGhpcy5iYWRnZXMucHVzaCh7XHJcbiAgICAgICAgdHlwZTogYmFkZ2VUeXBlLFxyXG4gICAgICAgIGF3YXJkZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICBleHBpcmVzQXQ6IGV4cGlyeURhdGUsXHJcbiAgICAgICAgY3JpdGVyaWE6IHRoaXMuc3RhdGlzdGljc1xyXG4gICAgfSk7XHJcblxyXG4gICAgYXdhaXQgdGhpcy5zYXZlKCk7XHJcbn07XHJcblxyXG4vLyBNZXRob2QgdG8gY2hlY2sgaWYgc3Vic2NyaXB0aW9uIGlzIGFjdGl2ZVxyXG5zZWxsZXJTY2hlbWEubWV0aG9kcy5oYXNBY3RpdmVTdWJzY3JpcHRpb24gPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLnN1YnNjcmlwdGlvbi5zdGF0dXMgPT09ICdhY3RpdmUnICYmIFxyXG4gICAgICAgICAgIG5ldyBEYXRlKCkgPCB0aGlzLnN1YnNjcmlwdGlvbi5leHBpcmVzQXQ7XHJcbn07XHJcblxyXG4vLyBNZXRob2QgdG8gZ2V0IGxpc3RpbmcgbGltaXQgYmFzZWQgb24gc3Vic2NyaXB0aW9uXHJcbnNlbGxlclNjaGVtYS5tZXRob2RzLmdldExpc3RpbmdMaW1pdCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgc3dpdGNoICh0aGlzLnN1YnNjcmlwdGlvbi5wbGFuKSB7XHJcbiAgICAgICAgY2FzZSAnVHJvdCc6XHJcbiAgICAgICAgICAgIHJldHVybiAyO1xyXG4gICAgICAgIGNhc2UgJ0dhbGxvcCc6XHJcbiAgICAgICAgICAgIHJldHVybiAxMDtcclxuICAgICAgICBjYXNlICdSb3lhbCBTdGFsbGlvbic6XHJcbiAgICAgICAgICAgIHJldHVybiBJbmZpbml0eTtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIE1ldGhvZCB0byBjaGVjayBpZiBjYW4gYWRkIG1vcmUgbGlzdGluZ3Ncclxuc2VsbGVyU2NoZW1hLm1ldGhvZHMuY2FuQWRkTGlzdGluZyA9IGZ1bmN0aW9uKCkge1xyXG4gICAgaWYgKCF0aGlzLmhhc0FjdGl2ZVN1YnNjcmlwdGlvbigpKSByZXR1cm4gZmFsc2U7XHJcbiAgICByZXR1cm4gdGhpcy5zdGF0aXN0aWNzLmFjdGl2ZUxpc3RpbmdzIDwgdGhpcy5nZXRMaXN0aW5nTGltaXQoKTtcclxufTtcclxuXHJcbi8vIE1ldGhvZCB0byBnZW5lcmF0ZSBhdXRoIHRva2VuIChpZiBuZWVkZWQgZm9yIHRlc3RzKVxyXG5zZWxsZXJTY2hlbWEubWV0aG9kcy5nZW5lcmF0ZUF1dGhUb2tlbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XHJcbiAgICByZXR1cm4gand0LnNpZ24oXHJcbiAgICAgICAgeyBcclxuICAgICAgICAgICAgX2lkOiB0aGlzLl9pZCxcclxuICAgICAgICAgICAgcm9sZTogJ3NlbGxlcicsXHJcbiAgICAgICAgICAgIGJ1c2luZXNzTmFtZTogdGhpcy5idXNpbmVzc05hbWVcclxuICAgICAgICB9LCBcclxuICAgICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVULFxyXG4gICAgICAgIHsgZXhwaXJlc0luOiAnMjRoJyB9XHJcbiAgICApO1xyXG59O1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBtb25nb29zZS5tb2RlbCgnU2VsbGVyJywgc2VsbGVyU2NoZW1hKTsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFFcEMsTUFBTUMsWUFBWSxHQUFHLElBQUlGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDO0VBQ3JDQyxJQUFJLEVBQUU7SUFDRkMsSUFBSSxFQUFFTCxRQUFRLENBQUNHLE1BQU0sQ0FBQ0csS0FBSyxDQUFDQyxRQUFRO0lBQ3BDQyxHQUFHLEVBQUUsTUFBTTtJQUNYQyxRQUFRLEVBQUUsSUFBSTtJQUNkQyxNQUFNLEVBQUU7RUFDWixDQUFDO0VBQ0RDLFlBQVksRUFBRTtJQUNWTixJQUFJLEVBQUVPLE1BQU07SUFDWkgsUUFBUSxFQUFFLElBQUk7SUFDZEksSUFBSSxFQUFFO0VBQ1YsQ0FBQztFQUNEQyxXQUFXLEVBQUU7SUFDVFQsSUFBSSxFQUFFTyxNQUFNO0lBQ1pILFFBQVEsRUFBRTtFQUNkLENBQUM7RUFDRE0sUUFBUSxFQUFFO0lBQ05DLEtBQUssRUFBRTtNQUNIWCxJQUFJLEVBQUVPLE1BQU07TUFDWkgsUUFBUSxFQUFFO0lBQ2QsQ0FBQztJQUNE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","map":{"version":3,"names":["mongoose","require","sellerSchema","Schema","user","type","Types","ObjectId","ref","required","unique","businessName","String","trim","description","location","state","city","pincode","contactDetails","phone","match","email","whatsapp","businessDocuments","gst","pan","otherDocuments","name","url","verified","Boolean","default","subscription","plan","enum","status","startDate","Date","now","expiresAt","verificationStatus","rating","average","Number","min","max","count","verification","level","submittedAt","verifiedAt","documents","public_id","verifiedBy","notes","rejectionReason","badges","awardedAt","criteria","Map","of","Mixed","statistics","totalListings","activeListings","activeSales","totalSales","totalRevenue","reviewCount","responseRate","responseTime","reviews","timestamps","pre","next","isModified","length","totalRating","reduce","acc","review","filter","badge","methods","checkBadgeEligibility","eligibleBadges","push","awardBadge","badgeType","b","expiryDate","setMonth","getMonth","save","hasActiveSubscription","getListingLimit","Infinity","canAddListing","generateAuthToken","jwt","sign","_id","role","process","env","JWT_SECRET","expiresIn","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Seller.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst sellerSchema = new mongoose.Schema({\r\n    user: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true,\r\n        unique: true\r\n    },\r\n    businessName: {\r\n        type: String,\r\n        required: true,\r\n        trim: true\r\n    },\r\n    description: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    location: {\r\n        state: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        city: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        pincode: {\r\n            type: String,\r\n            required: true\r\n        }\r\n    },\r\n    contactDetails: {\r\n        phone: {\r\n            type: String,\r\n            required: true,\r\n            match: [/^[0-9]{10}$/, 'Please enter a valid 10-digit phone number']\r\n        },\r\n        email: {\r\n            type: String,\r\n            required: true,\r\n            match: [/^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/, 'Please enter a valid email']\r\n        },\r\n        whatsapp: {\r\n            type: String,\r\n            match: [/^[0-9]{10}$/, 'Please enter a valid 10-digit WhatsApp number']\r\n        }\r\n    },\r\n    businessDocuments: {\r\n        gst: String,\r\n        pan: String,\r\n        otherDocuments: [{\r\n            name: String,\r\n            url: String,\r\n            verified: {\r\n                type: Boolean,\r\n                default: false\r\n            }\r\n        }]\r\n    },\r\n    subscription: {\r\n        plan: {\r\n            type: String,\r\n            enum: ['Royal Stallion', 'Gallop', 'Trot'],\r\n            default: 'Trot'\r\n        },\r\n        status: {\r\n            type: String,\r\n            enum: ['active', 'expired', 'cancelled'],\r\n            default: 'active'\r\n        },\r\n        startDate: {\r\n            type: Date,\r\n            default: Date.now\r\n        },\r\n        expiresAt: {\r\n            type: Date,\r\n            default: () => new Date(Date.now() + 365 * 24 * 60 * 60 * 1000) // 1 year for starter plan\r\n        }\r\n    },\r\n    verificationStatus: {\r\n        type: String,\r\n        enum: ['pending', 'verified', 'rejected'],\r\n        default: 'pending'\r\n    },\r\n    rating: {\r\n        average: {\r\n            type: Number,\r\n            default: 0,\r\n            min: 0,\r\n            max: 5\r\n        },\r\n        count: {\r\n            type: Number,\r\n            default: 0\r\n        }\r\n    },\r\n    verification: {\r\n        level: {\r\n            type: String,\r\n            enum: ['basic', 'professional', null],\r\n            default: null\r\n        },\r\n        status: {\r\n            type: String,\r\n            enum: ['unverified', 'pending', 'verified', 'rejected'],\r\n            default: 'unverified'\r\n        },\r\n        submittedAt: Date,\r\n        verifiedAt: Date,\r\n        expiresAt: Date,\r\n        documents: [{\r\n            type: {\r\n                type: String,\r\n                enum: ['identity', 'address', 'business_license', 'tax_registration', 'bank_statement']\r\n            },\r\n            url: String,\r\n            public_id: String,\r\n            verified: {\r\n                type: Boolean,\r\n                default: false\r\n            },\r\n            verifiedAt: Date,\r\n            verifiedBy: {\r\n                type: mongoose.Schema.Types.ObjectId,\r\n                ref: 'User'\r\n            }\r\n        }],\r\n        notes: String,\r\n        rejectionReason: String\r\n    },\r\n    badges: [{\r\n        type: {\r\n            type: String,\r\n            enum: ['Top Seller', 'Premium Stable', 'Verified Seller']\r\n        },\r\n        awardedAt: {\r\n            type: Date,\r\n            default: Date.now\r\n        },\r\n        expiresAt: Date,\r\n        criteria: {\r\n            type: Map,\r\n            of: mongoose.Schema.Types.Mixed\r\n        }\r\n    }],\r\n    statistics: {\r\n        totalListings: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        activeListings: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        activeSales: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        totalSales: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        totalRevenue: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        rating: {\r\n            type: Number,\r\n            default: 0,\r\n            min: 0,\r\n            max: 5\r\n        },\r\n        reviewCount: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        responseRate: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        responseTime: {\r\n            type: Number, // in hours\r\n            default: 0\r\n        }\r\n    },\r\n    reviews: [{\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Review'\r\n    }]\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Pre-save hook to update statistics\r\nsellerSchema.pre('save', async function(next) {\r\n    if (this.isModified('reviews')) {\r\n        // Update rating\r\n        if (this.reviews && this.reviews.length > 0) {\r\n            const totalRating = this.reviews.reduce((acc, review) => acc + review.rating, 0);\r\n            this.statistics.rating = totalRating / this.reviews.length;\r\n            this.statistics.reviewCount = this.reviews.length;\r\n        }\r\n    }\r\n\r\n    // Check badge expiry\r\n    if (this.badges) {\r\n        this.badges = this.badges.filter(badge => \r\n            !badge.expiresAt || badge.expiresAt > new Date()\r\n        );\r\n    }\r\n\r\n    // Check verification expiry\r\n    if (this.verification && this.verification.expiresAt && this.verification.expiresAt < new Date()) {\r\n        this.verification.status = 'unverified';\r\n        this.verification.level = null;\r\n    }\r\n\r\n    next();\r\n});\r\n\r\n// Method to check badge eligibility\r\nsellerSchema.methods.checkBadgeEligibility = async function() {\r\n    const eligibleBadges = [];\r\n\r\n    // Top Seller criteria\r\n    if (\r\n        this.statistics.totalSales >= 5 &&\r\n        this.statistics.rating >= 4.5 &&\r\n        this.statistics.totalListings >= 10\r\n    ) {\r\n        eligibleBadges.push('Top Seller');\r\n    }\r\n\r\n    // Premium Stable criteria\r\n    if (\r\n        this.subscription?.plan === 'Royal Stallion' &&\r\n        this.verification?.level === 'professional' &&\r\n        this.statistics.rating >= 4.0 &&\r\n        this.statistics.totalListings >= 5\r\n    ) {\r\n        eligibleBadges.push('Premium Stable');\r\n    }\r\n\r\n    // Verified Seller criteria\r\n    if (this.verification?.level === 'basic') {\r\n        eligibleBadges.push('Verified Seller');\r\n    }\r\n\r\n    return eligibleBadges;\r\n};\r\n\r\n// Method to award badge\r\nsellerSchema.methods.awardBadge = async function(badgeType) {\r\n    if (!this.badges) {\r\n        this.badges = [];\r\n    }\r\n\r\n    // Remove existing badge of same type\r\n    this.badges = this.badges.filter(b => b.type !== badgeType);\r\n\r\n    // Add new badge\r\n    const expiryDate = new Date();\r\n    expiryDate.setMonth(expiryDate.getMonth() + 3); // Badges expire after 3 months\r\n\r\n    this.badges.push({\r\n        type: badgeType,\r\n        awardedAt: new Date(),\r\n        expiresAt: expiryDate,\r\n        criteria: this.statistics\r\n    });\r\n\r\n    await this.save();\r\n};\r\n\r\n// Method to check if subscription is active\r\nsellerSchema.methods.hasActiveSubscription = function() {\r\n    return this.subscription.status === 'active' && \r\n           new Date() < this.subscription.expiresAt;\r\n};\r\n\r\n// Method to get listing limit based on subscription\r\nsellerSchema.methods.getListingLimit = function() {\r\n    switch (this.subscription.plan) {\r\n        case 'Trot':\r\n            return 2;\r\n        case 'Gallop':\r\n            return 10;\r\n        case 'Royal Stallion':\r\n            return Infinity;\r\n        default:\r\n            return 0;\r\n    }\r\n};\r\n\r\n// Method to check if can add more listings\r\nsellerSchema.methods.canAddListing = function() {\r\n    if (!this.hasActiveSubscription()) return false;\r\n    return this.statistics.activeListings < this.getListingLimit();\r\n};\r\n\r\n// Method to generate auth token (if needed for tests)\r\nsellerSchema.methods.generateAuthToken = function() {\r\n    const jwt = require('jsonwebtoken');\r\n    return jwt.sign(\r\n        { \r\n            _id: this._id,\r\n            role: 'seller',\r\n            businessName: this.businessName\r\n        }, \r\n        process.env.JWT_SECRET,\r\n        { expiresIn: '24h' }\r\n    );\r\n};\r\n\r\nmodule.exports = mongoose.model('Seller', sellerSchema); "],"mappings":"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","ignoreList":[]}},"mtime":1734042453187},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\auth.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const User = require('../models/User');\nconst Seller = require('../models/Seller');\nconst {\n  validationResult\n} = require('express-validator');\nconst jwt = require('jsonwebtoken');\n\n// Helper function to get user with seller info\nconst getUserWithSellerInfo = async userId => {\n  const user = await User.findById(userId);\n  if (!user) return null;\n  if (user.role === 'seller') {\n    const seller = await Seller.findOne({\n      user: user._id\n    });\n    if (seller) {\n      return {\n        ...user.toObject(),\n        seller\n      };\n    }\n  }\n  return user.toObject();\n};\n\n// Helper function to create token\nconst createToken = userId => {\n  return jwt.sign({\n    id: userId\n  }, process.env.JWT_SECRET, {\n    expiresIn: '30d'\n  });\n};\n\n// @desc    Health check\n// @route   GET /api/auth/health\n// @access  Public\nexports.healthCheck = async (req, res) => {\n  try {\n    // Check database connection\n    await User.findOne();\n    res.json({\n      success: true,\n      message: 'Server is healthy',\n      timestamp: new Date()\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: 'Server is not healthy',\n      error: error.message\n    });\n  }\n};\n\n// @desc    Register user\n// @route   POST /api/auth/register\n// @access  Public\nexports.register = async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        errors: errors.array()\n      });\n    }\n    const {\n      name,\n      email,\n      password,\n      role\n    } = req.body;\n\n    // Check if user exists\n    let user = await User.findOne({\n      email\n    });\n    if (user) {\n      return res.status(400).json({\n        success: false,\n        message: 'User already exists'\n      });\n    }\n\n    // Create user\n    user = await User.create({\n      name,\n      email,\n      password,\n      role: role || 'user'\n    });\n\n    // Get user with seller info if applicable\n    const userWithInfo = await getUserWithSellerInfo(user._id);\n\n    // Create token\n    const token = createToken(user._id);\n    res.status(201).json({\n      success: true,\n      token,\n      user: userWithInfo\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Login user\n// @route   POST /api/auth/login\n// @access  Public\nexports.login = async (req, res) => {\n  try {\n    const errors = validationResult(req);\n    if (!errors.isEmpty()) {\n      return res.status(400).json({\n        errors: errors.array()\n      });\n    }\n    const {\n      email,\n      password\n    } = req.body;\n\n    // Check if user exists\n    const user = await User.findOne({\n      email\n    }).select('+password');\n    if (!user) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n\n    // Check if password matches\n    const isMatch = await user.matchPassword(password);\n    if (!isMatch) {\n      return res.status(401).json({\n        success: false,\n        message: 'Invalid credentials'\n      });\n    }\n\n    // Get user with seller info if applicable\n    const userWithInfo = await getUserWithSellerInfo(user._id);\n\n    // Create token\n    const token = createToken(user._id);\n    res.json({\n      success: true,\n      token,\n      user: userWithInfo\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get current logged in user\n// @route   GET /api/auth/me\n// @access  Private\nexports.getMe = async (req, res) => {\n  try {\n    const userWithInfo = await getUserWithSellerInfo(req.user._id);\n    if (!userWithInfo) {\n      return res.status(404).json({\n        success: false,\n        message: 'User not found'\n      });\n    }\n    res.json({\n      success: true,\n      user: userWithInfo\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVc2VyIiwicmVxdWlyZSIsIlNlbGxlciIsInZhbGlkYXRpb25SZXN1bHQiLCJqd3QiLCJnZXRVc2VyV2l0aFNlbGxlckluZm8iLCJ1c2VySWQiLCJ1c2VyIiwiZmluZEJ5SWQiLCJyb2xlIiwic2VsbGVyIiwiZmluZE9uZSIsIl9pZCIsInRvT2JqZWN0IiwiY3JlYXRlVG9rZW4iLCJzaWduIiwiaWQiLCJwcm9jZXNzIiwiZW52IiwiSldUX1NFQ1JFVCIsImV4cGlyZXNJbiIsImV4cG9ydHMiLCJoZWFsdGhDaGVjayIsInJlcSIsInJlcyIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsInRpbWVzdGFtcCIsIkRhdGUiLCJlcnJvciIsInN0YXR1cyIsInJlZ2lzdGVyIiwiZXJyb3JzIiwiaXNFbXB0eSIsImFycmF5IiwibmFtZSIsImVtYWlsIiwicGFzc3dvcmQiLCJib2R5IiwiY3JlYXRlIiwidXNlcldpdGhJbmZvIiwidG9rZW4iLCJjb25zb2xlIiwibG9naW4iLCJzZWxlY3QiLCJpc01hdGNoIiwibWF0Y2hQYXNzd29yZCIsImdldE1lIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxjb250cm9sbGVyc1xcIiwic291cmNlcyI6WyJhdXRoLmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7XHJcbmNvbnN0IFNlbGxlciA9IHJlcXVpcmUoJy4uL21vZGVscy9TZWxsZXInKTtcclxuY29uc3QgeyB2YWxpZGF0aW9uUmVzdWx0IH0gPSByZXF1aXJlKCdleHByZXNzLXZhbGlkYXRvcicpO1xyXG5jb25zdCBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdXNlciB3aXRoIHNlbGxlciBpbmZvXHJcbmNvbnN0IGdldFVzZXJXaXRoU2VsbGVySW5mbyA9IGFzeW5jICh1c2VySWQpID0+IHtcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHVzZXJJZCk7XHJcbiAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsO1xyXG5cclxuICAgIGlmICh1c2VyLnJvbGUgPT09ICdzZWxsZXInKSB7XHJcbiAgICAgICAgY29uc3Qgc2VsbGVyID0gYXdhaXQgU2VsbGVyLmZpbmRPbmUoeyB1c2VyOiB1c2VyLl9pZCB9KTtcclxuICAgICAgICBpZiAoc2VsbGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAuLi51c2VyLnRvT2JqZWN0KCksXHJcbiAgICAgICAgICAgICAgICBzZWxsZXJcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdXNlci50b09iamVjdCgpO1xyXG59O1xyXG5cclxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0b2tlblxyXG5jb25zdCBjcmVhdGVUb2tlbiA9ICh1c2VySWQpID0+IHtcclxuICAgIHJldHVybiBqd3Quc2lnbihcclxuICAgICAgICB7IGlkOiB1c2VySWQgfSxcclxuICAgICAgICBwcm9jZXNzLmVudi5KV1RfU0VDUkVULFxyXG4gICAgICAgIHsgZXhwaXJlc0luOiAnMzBkJyB9XHJcbiAgICApO1xyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgSGVhbHRoIGNoZWNrXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2F1dGgvaGVhbHRoXHJcbi8vIEBhY2Nlc3MgIFB1YmxpY1xyXG5leHBvcnRzLmhlYWx0aENoZWNrID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIENoZWNrIGRhdGFiYXNlIGNvbm5lY3Rpb25cclxuICAgICAgICBhd2FpdCBVc2VyLmZpbmRPbmUoKTtcclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgaXMgaGVhbHRoeScsXHJcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGlzIG5vdCBoZWFsdGh5JyxcclxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIFJlZ2lzdGVyIHVzZXJcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL2F1dGgvcmVnaXN0ZXJcclxuLy8gQGFjY2VzcyAgUHVibGljXHJcbmV4cG9ydHMucmVnaXN0ZXIgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gICAgICAgIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcnM6IGVycm9ycy5hcnJheSgpIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgeyBuYW1lLCBlbWFpbCwgcGFzc3dvcmQsIHJvbGUgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB1c2VyIGV4aXN0c1xyXG4gICAgICAgIGxldCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgZW1haWwgfSk7XHJcbiAgICAgICAgaWYgKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1VzZXIgYWxyZWFkeSBleGlzdHMnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIHVzZXJcclxuICAgICAgICB1c2VyID0gYXdhaXQgVXNlci5jcmVhdGUoe1xyXG4gICAgICAgICAgICBuYW1lLFxyXG4gICAgICAgICAgICBlbWFpbCxcclxuICAgICAgICAgICAgcGFzc3dvcmQsXHJcbiAgICAgICAgICAgIHJvbGU6IHJvbGUgfHwgJ3VzZXInXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEdldCB1c2VyIHdpdGggc2VsbGVyIGluZm8gaWYgYXBwbGljYWJsZVxyXG4gICAgICAgIGNvbnN0IHVzZXJXaXRoSW5mbyA9IGF3YWl0IGdldFVzZXJXaXRoU2VsbGVySW5mbyh1c2VyLl9pZCk7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSB0b2tlblxyXG4gICAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlVG9rZW4odXNlci5faWQpO1xyXG5cclxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRva2VuLFxyXG4gICAgICAgICAgICB1c2VyOiB1c2VyV2l0aEluZm9cclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIExvZ2luIHVzZXJcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL2F1dGgvbG9naW5cclxuLy8gQGFjY2VzcyAgUHVibGljXHJcbmV4cG9ydHMubG9naW4gPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JzID0gdmFsaWRhdGlvblJlc3VsdChyZXEpO1xyXG4gICAgICAgIGlmICghZXJyb3JzLmlzRW1wdHkoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcnM6IGVycm9ycy5hcnJheSgpIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB1c2VyIGV4aXN0c1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyBlbWFpbCB9KS5zZWxlY3QoJytwYXNzd29yZCcpO1xyXG4gICAgICAgIGlmICghdXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBjcmVkZW50aWFscydcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiBwYXNzd29yZCBtYXRjaGVzXHJcbiAgICAgICAgY29uc3QgaXNNYXRjaCA9IGF3YWl0IHVzZXIubWF0Y2hQYXNzd29yZChwYXNzd29yZCk7XHJcbiAgICAgICAgaWYgKCFpc01hdGNoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGNyZWRlbnRpYWxzJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEdldCB1c2VyIHdpdGggc2VsbGVyIGluZm8gaWYgYXBwbGljYWJsZVxyXG4gICAgICAgIGNvbnN0IHVzZXJXaXRoSW5mbyA9IGF3YWl0IGdldFVzZXJXaXRoU2VsbGVySW5mbyh1c2VyLl9pZCk7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSB0b2tlblxyXG4gICAgICAgIGNvbnN0IHRva2VuID0gY3JlYXRlVG9rZW4odXNlci5faWQpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRva2VuLFxyXG4gICAgICAgICAgICB1c2VyOiB1c2VyV2l0aEluZm9cclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBjdXJyZW50IGxvZ2dlZCBpbiB1c2VyXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2F1dGgvbWVcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLmdldE1lID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXJXaXRoSW5mbyA9IGF3YWl0IGdldFVzZXJXaXRoU2VsbGVySW5mbyhyZXEudXNlci5faWQpO1xyXG4gICAgICAgIGlmICghdXNlcldpdGhJbmZvKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHVzZXI6IHVzZXJXaXRoSW5mb1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59OyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBQzFDLE1BQU07RUFBRUU7QUFBaUIsQ0FBQyxHQUFHRixPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDekQsTUFBTUcsR0FBRyxHQUFHSCxPQUFPLENBQUMsY0FBYyxDQUFDOztBQUVuQztBQUNBLE1BQU1JLHFCQUFxQixHQUFHLE1BQU9DLE1BQU0sSUFBSztFQUM1QyxNQUFNQyxJQUFJLEdBQUcsTUFBTVAsSUFBSSxDQUFDUSxRQUFRLENBQUNGLE1BQU0sQ0FBQztFQUN4QyxJQUFJLENBQUNDLElBQUksRUFBRSxPQUFPLElBQUk7RUFFdEIsSUFBSUEsSUFBSSxDQUFDRSxJQUFJLEtBQUssUUFBUSxFQUFFO0lBQ3hCLE1BQU1DLE1BQU0sR0FBRyxNQUFNUixNQUFNLENBQUNTLE9BQU8sQ0FBQztNQUFFSixJQUFJLEVBQUVBLElBQUksQ0FBQ0s7SUFBSSxDQUFDLENBQUM7SUFDdkQsSUFBSUYsTUFBTSxFQUFFO01BQ1IsT0FBTztRQUNILEdBQUdILElBQUksQ0FBQ00sUUFBUSxDQUFDLENBQUM7UUFDbEJIO01BQ0osQ0FBQztJQUNMO0VBQ0o7RUFDQSxPQUFPSCxJQUFJLENBQUNNLFFBQVEs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","map":{"version":3,"names":["User","require","Seller","validationResult","jwt","getUserWithSellerInfo","userId","user","findById","role","seller","findOne","_id","toObject","createToken","sign","id","process","env","JWT_SECRET","expiresIn","exports","healthCheck","req","res","json","success","message","timestamp","Date","error","status","register","errors","isEmpty","array","name","email","password","body","create","userWithInfo","token","console","login","select","isMatch","matchPassword","getMe"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["auth.controller.js"],"sourcesContent":["const User = require('../models/User');\r\nconst Seller = require('../models/Seller');\r\nconst { validationResult } = require('express-validator');\r\nconst jwt = require('jsonwebtoken');\r\n\r\n// Helper function to get user with seller info\r\nconst getUserWithSellerInfo = async (userId) => {\r\n    const user = await User.findById(userId);\r\n    if (!user) return null;\r\n\r\n    if (user.role === 'seller') {\r\n        const seller = await Seller.findOne({ user: user._id });\r\n        if (seller) {\r\n            return {\r\n                ...user.toObject(),\r\n                seller\r\n            };\r\n        }\r\n    }\r\n    return user.toObject();\r\n};\r\n\r\n// Helper function to create token\r\nconst createToken = (userId) => {\r\n    return jwt.sign(\r\n        { id: userId },\r\n        process.env.JWT_SECRET,\r\n        { expiresIn: '30d' }\r\n    );\r\n};\r\n\r\n// @desc    Health check\r\n// @route   GET /api/auth/health\r\n// @access  Public\r\nexports.healthCheck = async (req, res) => {\r\n    try {\r\n        // Check database connection\r\n        await User.findOne();\r\n        res.json({\r\n            success: true,\r\n            message: 'Server is healthy',\r\n            timestamp: new Date()\r\n        });\r\n    } catch (error) {\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server is not healthy',\r\n            error: error.message\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Register user\r\n// @route   POST /api/auth/register\r\n// @access  Public\r\nexports.register = async (req, res) => {\r\n    try {\r\n        const errors = validationResult(req);\r\n        if (!errors.isEmpty()) {\r\n            return res.status(400).json({ errors: errors.array() });\r\n        }\r\n\r\n        const { name, email, password, role } = req.body;\r\n\r\n        // Check if user exists\r\n        let user = await User.findOne({ email });\r\n        if (user) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: 'User already exists'\r\n            });\r\n        }\r\n\r\n        // Create user\r\n        user = await User.create({\r\n            name,\r\n            email,\r\n            password,\r\n            role: role || 'user'\r\n        });\r\n\r\n        // Get user with seller info if applicable\r\n        const userWithInfo = await getUserWithSellerInfo(user._id);\r\n\r\n        // Create token\r\n        const token = createToken(user._id);\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            token,\r\n            user: userWithInfo\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Login user\r\n// @route   POST /api/auth/login\r\n// @access  Public\r\nexports.login = async (req, res) => {\r\n    try {\r\n        const errors = validationResult(req);\r\n        if (!errors.isEmpty()) {\r\n            return res.status(400).json({ errors: errors.array() });\r\n        }\r\n\r\n        const { email, password } = req.body;\r\n\r\n        // Check if user exists\r\n        const user = await User.findOne({ email }).select('+password');\r\n        if (!user) {\r\n            return res.status(401).json({\r\n                success: false,\r\n                message: 'Invalid credentials'\r\n            });\r\n        }\r\n\r\n        // Check if password matches\r\n        const isMatch = await user.matchPassword(password);\r\n        if (!isMatch) {\r\n            return res.status(401).json({\r\n                success: false,\r\n                message: 'Invalid credentials'\r\n            });\r\n        }\r\n\r\n        // Get user with seller info if applicable\r\n        const userWithInfo = await getUserWithSellerInfo(user._id);\r\n\r\n        // Create token\r\n        const token = createToken(user._id);\r\n\r\n        res.json({\r\n            success: true,\r\n            token,\r\n            user: userWithInfo\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get current logged in user\r\n// @route   GET /api/auth/me\r\n// @access  Private\r\nexports.getMe = async (req, res) => {\r\n    try {\r\n        const userWithInfo = await getUserWithSellerInfo(req.user._id);\r\n        if (!userWithInfo) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'User not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            user: userWithInfo\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734029468637},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\user.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  updateProfile,\n  getFavorites,\n  getNotifications,\n  markNotificationsRead,\n  setAlertPreferences,\n  getAlertPreferences\n} = require('../controllers/user.controller');\n\n// Validation middleware\nconst updateProfileValidation = [body('name').optional().trim().notEmpty().withMessage('Name is required'), body('phone').optional().matches(/^[+]?[\\d\\s-]+$/).withMessage('Please enter a valid phone number'), body('location').optional().isObject().withMessage('Location must be an object'), body('location.state').optional().notEmpty().withMessage('State is required'), body('location.city').optional().notEmpty().withMessage('City is required'), body('location.pincode').optional().matches(/^[0-9]{6}$/).withMessage('Please enter a valid 6-digit pincode'), body('preferences').optional().isObject().withMessage('Preferences must be an object')];\nconst alertPreferencesValidation = [body('priceDrops').isBoolean().withMessage('Price drops must be boolean'), body('newListings').isBoolean().withMessage('New listings must be boolean'), body('inquiryResponses').isBoolean().withMessage('Inquiry responses must be boolean'), body('marketUpdates').isBoolean().withMessage('Market updates must be boolean')];\n\n// Profile routes\nrouter.put('/profile', protect, updateProfileValidation, updateProfile);\n\n// Favorites routes\nrouter.get('/favorites', protect, getFavorites);\n\n// Notifications routes\nrouter.get('/notifications', protect, getNotifications);\nrouter.put('/notifications/read-all', protect, markNotificationsRead);\n\n// Alert preferences routes\nrouter.get('/alerts', protect, getAlertPreferences);\nrouter.put('/alerts', protect, alertPreferencesValidation, setAlertPreferences);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJib2R5IiwidXBkYXRlUHJvZmlsZSIsImdldEZhdm9yaXRlcyIsImdldE5vdGlmaWNhdGlvbnMiLCJtYXJrTm90aWZpY2F0aW9uc1JlYWQiLCJzZXRBbGVydFByZWZlcmVuY2VzIiwiZ2V0QWxlcnRQcmVmZXJlbmNlcyIsInVwZGF0ZVByb2ZpbGVWYWxpZGF0aW9uIiwib3B0aW9uYWwiLCJ0cmltIiwibm90RW1wdHkiLCJ3aXRoTWVzc2FnZSIsIm1hdGNoZXMiLCJpc09iamVjdCIsImFsZXJ0UHJlZmVyZW5jZXNWYWxpZGF0aW9uIiwiaXNCb29sZWFuIiwicHV0IiwiZ2V0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xccm91dGVzXFwiLCJzb3VyY2VzIjpbInVzZXIucm91dGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHsgcHJvdGVjdCB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZXMvYXV0aC5taWRkbGV3YXJlJyk7XHJcbmNvbnN0IHsgYm9keSB9ID0gcmVxdWlyZSgnZXhwcmVzcy12YWxpZGF0b3InKTtcclxuY29uc3Qge1xyXG4gICAgdXBkYXRlUHJvZmlsZSxcclxuICAgIGdldEZhdm9yaXRlcyxcclxuICAgIGdldE5vdGlmaWNhdGlvbnMsXHJcbiAgICBtYXJrTm90aWZpY2F0aW9uc1JlYWQsXHJcbiAgICBzZXRBbGVydFByZWZlcmVuY2VzLFxyXG4gICAgZ2V0QWxlcnRQcmVmZXJlbmNlc1xyXG59ID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvdXNlci5jb250cm9sbGVyJyk7XHJcblxyXG4vLyBWYWxpZGF0aW9uIG1pZGRsZXdhcmVcclxuY29uc3QgdXBkYXRlUHJvZmlsZVZhbGlkYXRpb24gPSBbXHJcbiAgICBib2R5KCduYW1lJykub3B0aW9uYWwoKS50cmltKCkubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnTmFtZSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgncGhvbmUnKS5vcHRpb25hbCgpLm1hdGNoZXMoL15bK10/W1xcZFxccy1dKyQvKS53aXRoTWVzc2FnZSgnUGxlYXNlIGVudGVyIGEgdmFsaWQgcGhvbmUgbnVtYmVyJyksXHJcbiAgICBib2R5KCdsb2NhdGlvbicpLm9wdGlvbmFsKCkuaXNPYmplY3QoKS53aXRoTWVzc2FnZSgnTG9jYXRpb24gbXVzdCBiZSBhbiBvYmplY3QnKSxcclxuICAgIGJvZHkoJ2xvY2F0aW9uLnN0YXRlJykub3B0aW9uYWwoKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdTdGF0ZSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnbG9jYXRpb24uY2l0eScpLm9wdGlvbmFsKCkubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnQ2l0eSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnbG9jYXRpb24ucGluY29kZScpLm9wdGlvbmFsKCkubWF0Y2hlcygvXlswLTldezZ9JC8pLndpdGhNZXNzYWdlKCdQbGVhc2UgZW50ZXIgYSB2YWxpZCA2LWRpZ2l0IHBpbmNvZGUnKSxcclxuICAgIGJvZHkoJ3ByZWZlcmVuY2VzJykub3B0aW9uYWwoKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdQcmVmZXJlbmNlcyBtdXN0IGJlIGFuIG9iamVjdCcpXHJcbl07XHJcblxyXG5jb25zdCBhbGVydFByZWZlcmVuY2VzVmFsaWRhdGlvbiA9IFtcclxuICAgIGJvZHkoJ3ByaWNlRHJvcHMnKS5pc0Jvb2xlYW4oKS53aXRoTWVzc2FnZSgnUHJpY2UgZHJvcHMgbXVzdCBiZSBib29sZWFuJyksXHJcbiAgICBib2R5KCduZXdMaXN0aW5ncycpLmlzQm9vbGVhbigpLndpdGhNZXNzYWdlKCdOZXcgbGlzdGluZ3MgbXVzdCBiZSBib29sZWFuJyksXHJcbiAgICBib2R5KCdpbnF1aXJ5UmVzcG9uc2VzJykuaXNCb29sZWFuKCkud2l0aE1lc3NhZ2UoJ0lucXVpcnkgcmVzcG9uc2VzIG11c3QgYmUgYm9vbGVhbicpLFxyXG4gICAgYm9keSgnbWFya2V0VXBkYXRlcycpLmlzQm9vbGVhbigpLndpdGhNZXNzYWdlKCdNYXJrZXQgdXBkYXRlcyBtdXN0IGJlIGJvb2xlYW4nKVxyXG5dO1xyXG5cclxuLy8gUHJvZmlsZSByb3V0ZXNcclxucm91dGVyLnB1dCgnL3Byb2ZpbGUnLCBwcm90ZWN0LCB1cGRhdGVQcm9maWxlVmFsaWRhdGlvbiwgdXBkYXRlUHJvZmlsZSk7XHJcblxyXG4vLyBGYXZvcml0ZXMgcm91dGVzXHJcbnJvdXRlci5nZXQoJy9mYXZvcml0ZXMnLCBwcm90ZWN0LCBnZXRGYXZvcml0ZXMpO1xyXG5cclxuLy8gTm90aWZpY2F0aW9ucyByb3V0ZXNcclxucm91dGVyLmdldCgnL25vdGlmaWNhdGlvbnMnLCBwcm90ZWN0LCBnZXROb3RpZmljYXRpb25zKTtcclxucm91dGVyLnB1dCgnL25vdGlmaWNhdGlvbnMvcmVhZC1hbGwnLCBwcm90ZWN0LCBtYXJrTm90aWZpY2F0aW9uc1JlYWQpO1xyXG5cclxuLy8gQWxlcnQgcHJlZmVyZW5jZXMgcm91dGVzXHJcbnJvdXRlci5nZXQoJy9hbGVydHMnLCBwcm90ZWN0LCBnZXRBbGVydFByZWZlcmVuY2VzKTtcclxucm91dGVyLnB1dCgnL2FsZXJ0cycsIHByb3RlY3QsIGFsZXJ0UHJlZmVyZW5jZXNWYWxpZGF0aW9uLCBzZXRBbGVydFByZWZlcmVuY2VzKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTTtFQUFFQztB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","map":{"version":3,"names":["express","require","router","Router","protect","body","updateProfile","getFavorites","getNotifications","markNotificationsRead","setAlertPreferences","getAlertPreferences","updateProfileValidation","optional","trim","notEmpty","withMessage","matches","isObject","alertPreferencesValidation","isBoolean","put","get","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["user.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    updateProfile,\r\n    getFavorites,\r\n    getNotifications,\r\n    markNotificationsRead,\r\n    setAlertPreferences,\r\n    getAlertPreferences\r\n} = require('../controllers/user.controller');\r\n\r\n// Validation middleware\r\nconst updateProfileValidation = [\r\n    body('name').optional().trim().notEmpty().withMessage('Name is required'),\r\n    body('phone').optional().matches(/^[+]?[\\d\\s-]+$/).withMessage('Please enter a valid phone number'),\r\n    body('location').optional().isObject().withMessage('Location must be an object'),\r\n    body('location.state').optional().notEmpty().withMessage('State is required'),\r\n    body('location.city').optional().notEmpty().withMessage('City is required'),\r\n    body('location.pincode').optional().matches(/^[0-9]{6}$/).withMessage('Please enter a valid 6-digit pincode'),\r\n    body('preferences').optional().isObject().withMessage('Preferences must be an object')\r\n];\r\n\r\nconst alertPreferencesValidation = [\r\n    body('priceDrops').isBoolean().withMessage('Price drops must be boolean'),\r\n    body('newListings').isBoolean().withMessage('New listings must be boolean'),\r\n    body('inquiryResponses').isBoolean().withMessage('Inquiry responses must be boolean'),\r\n    body('marketUpdates').isBoolean().withMessage('Market updates must be boolean')\r\n];\r\n\r\n// Profile routes\r\nrouter.put('/profile', protect, updateProfileValidation, updateProfile);\r\n\r\n// Favorites routes\r\nrouter.get('/favorites', protect, getFavorites);\r\n\r\n// Notifications routes\r\nrouter.get('/notifications', protect, getNotifications);\r\nrouter.put('/notifications/read-all', protect, markNotificationsRead);\r\n\r\n// Alert preferences routes\r\nrouter.get('/alerts', protect, getAlertPreferences);\r\nrouter.put('/alerts', protect, alertPreferencesValidation, setAlertPreferences);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC;AAAQ,CAAC,GAAGH,OAAO,CAAC,gCAAgC,CAAC;AAC7D,MAAM;EAAEI;AAAK,CAAC,GAAGJ,OAAO,CAAC,mBAAmB,CAAC;AAC7C,MAAM;EACFK,aAAa;EACbC,YAAY;EACZC,gBAAgB;EAChBC,qBAAqB;EACrBC,mBAAmB;EACnBC;AACJ,CAAC,GAAGV,OAAO,CAAC,gCAAgC,CAAC;;AAE7C;AACA,MAAMW,uBAAuB,GAAG,CAC5BP,IAAI,CAAC,MAAM,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,IAAI,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,kBAAkB,CAAC,EACzEX,IAAI,CAAC,OAAO,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACI,OAAO,CAAC,gBAAgB,CAAC,CAACD,WAAW,CAAC,mCAAmC,CAAC,EACnGX,IAAI,CAAC,UAAU,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACK,QAAQ,CAAC,CAAC,CAACF,WAAW,CAAC,4BAA4B,CAAC,EAChFX,IAAI,CAAC,gBAAgB,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACE,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,mBAAmB,CAAC,EAC7EX,IAAI,CAAC,eAAe,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACE,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,kBAAkB,CAAC,EAC3EX,IAAI,CAAC,kBAAkB,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACI,OAAO,CAAC,YAAY,CAAC,CAACD,WAAW,CAAC,sCAAsC,CAAC,EAC7GX,IAAI,CAAC,aAAa,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACK,QAAQ,CAAC,CAAC,CAACF,WAAW,CAAC,+BAA+B,CAAC,CACzF;AAED,MAAMG,0BAA0B,GAAG,CAC/Bd,IAAI,CAAC,YAAY,CAAC,CAACe,SAAS,CAAC,CAAC,CAACJ,WAAW,CAAC,6BAA6B,CAAC,EACzEX,IAAI,CAAC,aAAa,CAAC,CAACe,SAAS,CAAC,CAAC,CAACJ,WAAW,CAAC,8BAA8B,CAAC,EAC3EX,IAAI,CAAC,kBAAkB,CAAC,CAACe,SAAS,CAAC,CAAC,CAACJ,WAAW,CAAC,mCAAmC,CAAC,EACrFX,IAAI,CAAC,eAAe,CAAC,CAACe,SAAS,CAAC,CAAC,CAACJ,WAAW,CAAC,gCAAgC,CAAC,CAClF;;AAED;AACAd,MAAM,CAACmB,GAAG,CAAC,UAAU,EAAEjB,OAAO,EAAEQ,uBAAuB,EAAEN,aAAa,CAAC;;AAEvE;AACAJ,MAAM,CAACoB,GAAG,CAAC,YAAY,EAAElB,OAAO,EAAEG,YAAY,CAAC;;AAE/C;AACAL,MAAM,CAACoB,GAAG,CAAC,gBAAgB,EAAElB,OAAO,EAAEI,gBAAgB,CAAC;AACvDN,MAAM,CAACmB,GAAG,CAAC,yBAAyB,EAAEjB,OAAO,EAAEK,qBAAqB,CAAC;;AAErE;AACAP,MAAM,CAACoB,GAAG,CAAC,SAAS,EAAElB,OAAO,EAAEO,mBAAmB,CAAC;AACnDT,MAAM,CAACmB,GAAG,CAAC,SAAS,EAAEjB,OAAO,EAAEe,0BAA0B,EAAET,mBAAmB,CAAC;AAE/Ea,MAAM,CAACC,OAAO,GAAGtB,MAAM","ignoreList":[]}},"mtime":1734037661644},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\user.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const User = require('../models/User');\nconst Horse = require('../models/Horse');\nconst ActivityLog = require('../models/ActivityLog');\n\n// @desc    Update user profile\n// @route   PUT /api/users/profile\n// @access  Private\nexports.updateProfile = async (req, res) => {\n  try {\n    const user = await User.findByIdAndUpdate(req.user._id, {\n      ...req.body,\n      updatedAt: Date.now()\n    }, {\n      new: true,\n      runValidators: true\n    }).select('-password');\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'profile_update',\n      entityType: 'user',\n      entityId: req.user._id,\n      description: 'Profile updated',\n      status: 'success'\n    });\n    res.json({\n      success: true,\n      user\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get user's favorite horses\n// @route   GET /api/users/favorites\n// @access  Private\nexports.getFavorites = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n    const favorites = await Horse.find({\n      _id: {\n        $in: user.favorites\n      },\n      listingStatus: 'active'\n    }).populate('seller', 'businessName location');\n    res.json({\n      success: true,\n      favorites\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get user's notifications\n// @route   GET /api/users/notifications\n// @access  Private\nexports.getNotifications = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id).select('notifications').sort('-notifications.createdAt');\n    res.json({\n      success: true,\n      notifications: user.notifications || []\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Mark all notifications as read\n// @route   PUT /api/users/notifications/read-all\n// @access  Private\nexports.markNotificationsRead = async (req, res) => {\n  try {\n    await User.findByIdAndUpdate(req.user._id, {\n      $set: {\n        'notifications.$[].isRead': true,\n        'notifications.$[].readAt': Date.now()\n      }\n    });\n    res.json({\n      success: true,\n      message: 'All notifications marked as read'\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get alert preferences\n// @route   GET /api/users/alerts\n// @access  Private\nexports.getAlertPreferences = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id).select('alertPreferences');\n    res.json({\n      success: true,\n      alertPreferences: user.alertPreferences || {\n        priceDrops: true,\n        newListings: true,\n        inquiryResponses: true,\n        marketUpdates: false\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Set alert preferences\n// @route   PUT /api/users/alerts\n// @access  Private\nexports.setAlertPreferences = async (req, res) => {\n  try {\n    const user = await User.findByIdAndUpdate(req.user._id, {\n      alertPreferences: {\n        ...req.body,\n        updatedAt: Date.now()\n      }\n    }, {\n      new: true\n    }).select('alertPreferences');\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'alert_preferences_update',\n      entityType: 'user',\n      entityId: req.user._id,\n      description: 'Alert preferences updated',\n      status: 'success'\n    });\n    res.json({\n      success: true,\n      alertPreferences: user.alertPreferences\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVc2VyIiwicmVxdWlyZSIsIkhvcnNlIiwiQWN0aXZpdHlMb2ciLCJleHBvcnRzIiwidXBkYXRlUHJvZmlsZSIsInJlcSIsInJlcyIsInVzZXIiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIl9pZCIsImJvZHkiLCJ1cGRhdGVkQXQiLCJEYXRlIiwibm93IiwibmV3IiwicnVuVmFsaWRhdG9ycyIsInNlbGVjdCIsImNyZWF0ZSIsImFjdGlvbiIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsImRlc2NyaXB0aW9uIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsImNvbnNvbGUiLCJtZXNzYWdlIiwiZ2V0RmF2b3JpdGVzIiwiZmluZEJ5SWQiLCJmYXZvcml0ZXMiLCJmaW5kIiwiJGluIiwibGlzdGluZ1N0YXR1cyIsInBvcHVsYXRlIiwiZ2V0Tm90aWZpY2F0aW9ucyIsInNvcnQiLCJub3RpZmljYXRpb25zIiwibWFya05vdGlmaWNhdGlvbnNSZWFkIiwiJHNldCIsImdldEFsZXJ0UHJlZmVyZW5jZXMiLCJhbGVydFByZWZlcmVuY2VzIiwicHJpY2VEcm9wcyIsIm5ld0xpc3RpbmdzIiwiaW5xdWlyeVJlc3BvbnNlcyIsIm1hcmtldFVwZGF0ZXMiLCJzZXRBbGVydFByZWZlcmVuY2VzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxjb250cm9sbGVyc1xcIiwic291cmNlcyI6WyJ1c2VyLmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7XHJcbmNvbnN0IEhvcnNlID0gcmVxdWlyZSgnLi4vbW9kZWxzL0hvcnNlJyk7XHJcbmNvbnN0IEFjdGl2aXR5TG9nID0gcmVxdWlyZSgnLi4vbW9kZWxzL0FjdGl2aXR5TG9nJyk7XHJcblxyXG4vLyBAZGVzYyAgICBVcGRhdGUgdXNlciBwcm9maWxlXHJcbi8vIEByb3V0ZSAgIFBVVCAvYXBpL3VzZXJzL3Byb2ZpbGVcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLnVwZGF0ZVByb2ZpbGUgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUoXHJcbiAgICAgICAgICAgIHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLi4ucmVxLmJvZHksXHJcbiAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IERhdGUubm93KClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBuZXc6IHRydWUsIHJ1blZhbGlkYXRvcnM6IHRydWUgfVxyXG4gICAgICAgICkuc2VsZWN0KCctcGFzc3dvcmQnKTtcclxuXHJcbiAgICAgICAgLy8gTG9nIGFjdGl2aXR5XHJcbiAgICAgICAgYXdhaXQgQWN0aXZpdHlMb2cuY3JlYXRlKHtcclxuICAgICAgICAgICAgdXNlcjogcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICBhY3Rpb246ICdwcm9maWxlX3VwZGF0ZScsXHJcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICd1c2VyJyxcclxuICAgICAgICAgICAgZW50aXR5SWQ6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQcm9maWxlIHVwZGF0ZWQnLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHVzZXJcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCB1c2VyJ3MgZmF2b3JpdGUgaG9yc2VzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3VzZXJzL2Zhdm9yaXRlc1xyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuZ2V0RmF2b3JpdGVzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHJlcS51c2VyLl9pZCk7XHJcbiAgICAgICAgY29uc3QgZmF2b3JpdGVzID0gYXdhaXQgSG9yc2UuZmluZCh7XHJcbiAgICAgICAgICAgIF9pZDogeyAkaW46IHVzZXIuZmF2b3JpdGVzIH0sXHJcbiAgICAgICAgICAgIGxpc3RpbmdTdGF0dXM6ICdhY3RpdmUnXHJcbiAgICAgICAgfSkucG9wdWxhdGUoJ3NlbGxlcicsICdidXNpbmVzc05hbWUgbG9jYXRpb24nKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBmYXZvcml0ZXNcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCB1c2VyJ3Mgbm90aWZpY2F0aW9uc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS91c2Vycy9ub3RpZmljYXRpb25zXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5nZXROb3RpZmljYXRpb25zID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkKHJlcS51c2VyLl9pZClcclxuICAgICAgICAgICAgLnNlbGVjdCgnbm90aWZpY2F0aW9ucycpXHJcbiAgICAgICAgICAgIC5zb3J0KCctbm90aWZpY2F0aW9ucy5jcmVhdGVkQXQnKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBub3RpZmljYXRpb25zOiB1c2VyLm5vdGlmaWNhdGlvbnMgfHwgW11cclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIE1hcmsgYWxsIG5vdGlmaWNhdGlvbnMgYXMgcmVhZFxyXG4vLyBAcm91dGUgICBQVVQgL2FwaS91c2Vycy9ub3RpZmljYXRpb25zL3JlYWQtYWxsXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5tYXJrTm90aWZpY2F0aW9uc1JlYWQgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgYXdhaXQgVXNlci5maW5kQnlJZEFuZFVwZGF0ZShcclxuICAgICAgICAgICAgcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkc2V0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ25vdGlmaWNhdGlvbnMuJFtdLmlzUmVhZCc6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgJ25vdGlmaWNhdGlvbnMuJFtdLnJlYWRBdCc6IERhdGUubm93KClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0FsbCBub3RpZmljYXRpb25zIG1hcmtlZCBhcyByZWFkJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IGFsZXJ0IHByZWZlcmVuY2VzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3VzZXJzL2FsZXJ0c1xyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuZ2V0QWxlcnRQcmVmZXJlbmNlcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpXHJcbiAgICAgICAgICAgIC5zZWxlY3QoJ2FsZXJ0UHJlZmVyZW5jZXMnKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBhbGVydFByZWZlcmVuY2VzOiB1c2VyLmFsZXJ0UHJlZmVyZW5jZXMgfHwge1xyXG4gICAgICAgICAgICAgICAgcHJpY2VEcm9wczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG5ld0xpc3RpbmdzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgaW5xdWlyeVJlc3BvbnNlczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIG1hcmtldFVwZGF0ZXM6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIFNldCBhbGVydCBwcmVmZXJlbmNlc1xyXG4vLyBAcm91dGUgICBQVVQgL2FwaS91c2Vycy9hbGVydHNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLnNldEFsZXJ0UHJlZmVyZW5jZXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWRBbmRVcGRhdGUoXHJcbiAgICAgICAgICAgIHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgYWxlcnRQcmVmZXJlbmNlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIC4uLnJlcS5ib2R5LFxyXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogRGF0ZS5ub3coKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7IG5ldzogdHJ1ZSB9XHJcbiAgICAgICAgKS5zZWxlY3QoJ2FsZXJ0UHJlZmVyZW5jZXMnKTtcclxuXHJcbiAgICAgICAgLy8gTG9nIGFjdGl2aXR5XHJcbiAgICAgICAgYXdhaXQgQWN0aXZpdHlMb2cuY3JlYXRlKHtcclxuICAgICAgICAgICAgdXNlcjogcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICBhY3Rpb246ICdhbGVydF9wcmVmZXJlbmNlc191cGRhdGUnLFxyXG4gICAgICAgICAgICBlbnRpdHlUeXBlOiAndXNlcicsXHJcbiAgICAgICAgICAgIGVudGl0eUlkOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQWxlcnQgcHJlZmVyZW5jZXMgdXBkYXRlZCcsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgYWxlcnRQcmVmZXJlbmNlczogdXNlci5hbGVydFByZWZlcmVuY2VzXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDdEMsTUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUUsV0FBVyxHQUFHRixPQUFPLENBQUMsdUJBQXVCLENBQUM7O0FBRXBEO0FBQ0E7QUFDQTtBQUNBRyxPQUFPLENBQUNDLGFBQWEsR0FBRyxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUN4QyxJQUFJO0lBQ0EsTUFBTUMsSUFBSSxHQUFHLE1BQU1SLElBQUksQ0FBQ1MsaUJBQWlCLENBQ3JDSCxHQUFHLENBQUNFLElBQUksQ0FBQ0UsR0FBRyxFQUNaO01BQ0ksR0FBR0osR0FBRyxD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QyxDQUFDO0VBQ04sQ0FBQyxDQUFDLE9BQU9wQixLQUFLLEVBQUU7SUFDWkMsT0FBTyxDQUFDRCxLQUFLLENBQUNBLEtBQUssQ0FBQztJQUNwQm5CLEdBQUcsQ0FBQ2dCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDO01BQ2pCQyxPQUFPLEVBQUUsS0FBSztNQUNkRyxPQUFPLEVBQUU7SUFDYixDQUFDLENBQUM7RUFDTjtBQUNKLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0F4QixPQUFPLENBQUMyQyxtQkFBbUIsR0FBRyxPQUFPekMsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDOUMsSUFBSTtJQUNBLE1BQU1DLElBQUksR0FBRyxNQUFNUixJQUFJLENBQUNTLGlCQUFpQixDQUNyQ0gsR0FBRyxDQUFDRSxJQUFJLENBQUNFLEdBQUcsRUFDWjtNQUNJZ0MsZ0JBQWdCLEVBQUU7UUFDZCxHQUFHcEMsR0FBRyxDQUFDSyxJQUFJO1FBQ1hDLFNBQVMsRUFBRUMsSUFBSSxDQUFDQyxHQUFHLENBQUM7TUFDeEI7SUFDSixDQUFDLEVBQ0Q7TUFBRUMsR0FBRyxFQUFFO0lBQUssQ0FDaEIsQ0FBQyxDQUFDRSxNQUFNLENBQUMsa0JBQWtCLENBQUM7O0lBRTVCO0lBQ0EsTUFBTWQsV0FBVyxDQUFDZSxNQUFNLENBQUM7TUFDckJWLElBQUksRUFBRUYsR0FBRyxDQUFDRSxJQUFJLENBQUNFLEdBQUc7TUFDbEJTLE1BQU0sRUFBRSwwQkFBMEI7TUFDbENDLFVBQVUsRUFBRSxNQUFNO01BQ2xCQyxRQUFRLEVBQUVmLEdBQUcsQ0FBQ0UsSUFBSSxDQUFDRSxHQUFHO01BQ3RCWSxXQUFXLEVBQUUsMkJBQTJCO01BQ3hDQyxNQUFNLEVBQUU7SUFDWixDQUFDLENBQUM7SUFFRmhCLEdBQUcsQ0FBQ2lCLElBQUksQ0FBQztNQUNMQyxPQUFPLEVBQUUsSUFBSTtNQUNiaUIsZ0JBQWdCLEVBQUVsQyxJQUFJLENBQUNrQztJQUMzQixDQUFDLENBQUM7RUFDTixDQUFDLENBQUMsT0FBT2hCLEtBQUssRUFBRTtJQUNaQyxPQUFPLENBQUNELEtBQUssQ0FBQ0EsS0FBSyxDQUFDO0lBQ3BCbkIsR0FBRyxDQUFDZ0IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7TUFDakJDLE9BQU8sRUFBRSxLQUFLO01BQ2RHLE9BQU8sRUFBRTtJQUNiLENBQUMsQ0FBQztFQUNOO0FBQ0osQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["User","require","Horse","ActivityLog","exports","updateProfile","req","res","user","findByIdAndUpdate","_id","body","updatedAt","Date","now","new","runValidators","select","create","action","entityType","entityId","description","status","json","success","error","console","message","getFavorites","findById","favorites","find","$in","listingStatus","populate","getNotifications","sort","notifications","markNotificationsRead","$set","getAlertPreferences","alertPreferences","priceDrops","newListings","inquiryResponses","marketUpdates","setAlertPreferences"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["user.controller.js"],"sourcesContent":["const User = require('../models/User');\r\nconst Horse = require('../models/Horse');\r\nconst ActivityLog = require('../models/ActivityLog');\r\n\r\n// @desc    Update user profile\r\n// @route   PUT /api/users/profile\r\n// @access  Private\r\nexports.updateProfile = async (req, res) => {\r\n    try {\r\n        const user = await User.findByIdAndUpdate(\r\n            req.user._id,\r\n            {\r\n                ...req.body,\r\n                updatedAt: Date.now()\r\n            },\r\n            { new: true, runValidators: true }\r\n        ).select('-password');\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'profile_update',\r\n            entityType: 'user',\r\n            entityId: req.user._id,\r\n            description: 'Profile updated',\r\n            status: 'success'\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            user\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get user's favorite horses\r\n// @route   GET /api/users/favorites\r\n// @access  Private\r\nexports.getFavorites = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id);\r\n        const favorites = await Horse.find({\r\n            _id: { $in: user.favorites },\r\n            listingStatus: 'active'\r\n        }).populate('seller', 'businessName location');\r\n\r\n        res.json({\r\n            success: true,\r\n            favorites\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get user's notifications\r\n// @route   GET /api/users/notifications\r\n// @access  Private\r\nexports.getNotifications = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id)\r\n            .select('notifications')\r\n            .sort('-notifications.createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            notifications: user.notifications || []\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Mark all notifications as read\r\n// @route   PUT /api/users/notifications/read-all\r\n// @access  Private\r\nexports.markNotificationsRead = async (req, res) => {\r\n    try {\r\n        await User.findByIdAndUpdate(\r\n            req.user._id,\r\n            {\r\n                $set: {\r\n                    'notifications.$[].isRead': true,\r\n                    'notifications.$[].readAt': Date.now()\r\n                }\r\n            }\r\n        );\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'All notifications marked as read'\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get alert preferences\r\n// @route   GET /api/users/alerts\r\n// @access  Private\r\nexports.getAlertPreferences = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id)\r\n            .select('alertPreferences');\r\n\r\n        res.json({\r\n            success: true,\r\n            alertPreferences: user.alertPreferences || {\r\n                priceDrops: true,\r\n                newListings: true,\r\n                inquiryResponses: true,\r\n                marketUpdates: false\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Set alert preferences\r\n// @route   PUT /api/users/alerts\r\n// @access  Private\r\nexports.setAlertPreferences = async (req, res) => {\r\n    try {\r\n        const user = await User.findByIdAndUpdate(\r\n            req.user._id,\r\n            {\r\n                alertPreferences: {\r\n                    ...req.body,\r\n                    updatedAt: Date.now()\r\n                }\r\n            },\r\n            { new: true }\r\n        ).select('alertPreferences');\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'alert_preferences_update',\r\n            entityType: 'user',\r\n            entityId: req.user._id,\r\n            description: 'Alert preferences updated',\r\n            status: 'success'\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            alertPreferences: user.alertPreferences\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734037859192},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Horse.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst horseSchema = new mongoose.Schema({\n  seller: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Seller',\n    required: true\n  },\n  name: {\n    type: String,\n    required: true,\n    trim: true\n  },\n  breed: {\n    type: String,\n    required: true\n  },\n  age: {\n    years: {\n      type: Number,\n      required: true,\n      min: 0\n    },\n    months: {\n      type: Number,\n      required: true,\n      min: 0,\n      max: 11\n    }\n  },\n  gender: {\n    type: String,\n    required: true,\n    enum: ['Stallion', 'Mare', 'Gelding']\n  },\n  color: {\n    type: String,\n    required: true\n  },\n  price: {\n    type: Number,\n    required: true,\n    min: 0\n  },\n  description: {\n    type: String,\n    required: true\n  },\n  location: {\n    state: {\n      type: String,\n      required: true\n    },\n    city: {\n      type: String,\n      required: true\n    },\n    pincode: {\n      type: String,\n      required: true\n    }\n  },\n  images: [{\n    url: {\n      type: String,\n      required: true\n    },\n    public_id: {\n      type: String,\n      required: true\n    },\n    thumbnail_url: String,\n    width: Number,\n    height: Number,\n    format: String\n  }],\n  specifications: {\n    training: {\n      type: String,\n      required: true,\n      enum: ['Basic', 'Intermediate', 'Advanced']\n    },\n    discipline: [{\n      type: String,\n      required: true\n    }],\n    temperament: {\n      type: String,\n      required: true\n    },\n    healthStatus: {\n      type: String,\n      required: true\n    },\n    vaccination: {\n      type: Boolean,\n      default: false\n    },\n    papers: {\n      type: Boolean,\n      default: false\n    }\n  },\n  listingStatus: {\n    type: String,\n    enum: ['draft', 'active', 'sold', 'inactive'],\n    default: 'draft'\n  },\n  statistics: {\n    views: {\n      type: Number,\n      default: 0\n    },\n    inquiries: {\n      type: Number,\n      default: 0\n    },\n    lastViewed: {\n      type: Date,\n      default: Date.now\n    }\n  },\n  boost: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    startDate: Date,\n    endDate: Date\n  },\n  verificationStatus: {\n    type: String,\n    enum: ['pending', 'verified', 'rejected', 'unverified'],\n    default: 'unverified'\n  },\n  verificationDetails: {\n    submittedAt: Date,\n    submittedBy: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    verifiedAt: Date,\n    verifiedBy: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    documents: [{\n      type: {\n        type: String,\n        enum: ['registration', 'medical', 'ownership', 'other']\n      },\n      url: String,\n      public_id: String,\n      verified: {\n        type: Boolean,\n        default: false\n      }\n    }],\n    notes: String,\n    rejectionReason: String\n  },\n  expiryDate: {\n    type: Date,\n    required: true,\n    default: () => {\n      const date = new Date();\n      date.setDate(date.getDate() + 30); // Default 30 days\n      return date;\n    }\n  },\n  featured: {\n    active: {\n      type: Boolean,\n      default: false\n    },\n    startDate: Date,\n    endDate: Date,\n    position: Number\n  }\n}, {\n  timestamps: true\n});\n\n// Update statistics when horse is viewed\nhorseSchema.methods.incrementViews = async function () {\n  this.statistics.views += 1;\n  this.statistics.lastViewed = Date.now();\n  await this.save();\n};\n\n// Update statistics when inquiry is created\nhorseSchema.methods.incrementInquiries = async function () {\n  this.statistics.inquiries += 1;\n  await this.save();\n};\n\n// Check if listing is expired\nhorseSchema.methods.isExpired = function () {\n  return this.expiryDate && this.expiryDate < new Date();\n};\n\n// Check if listing is boosted\nhorseSchema.methods.isBoosted = function () {\n  return this.boost && this.boost.active && this.boost.endDate && this.boost.endDate > new Date();\n};\n\n// Check if listing is featured\nhorseSchema.methods.isFeatured = function () {\n  return this.featured && this.featured.active && this.featured.endDate && this.featured.endDate > new Date();\n};\n\n// Pre-save hook to check expiry and status\nhorseSchema.pre('save', function (next) {\n  // Update listing status if expired\n  if (this.isExpired() && this.listingStatus === 'active') {\n    this.listingStatus = 'expired';\n  }\n\n  // Deactivate boost if expired\n  if (this.boost && this.boost.active && this.boost.endDate < new Date()) {\n    this.boost.active = false;\n  }\n\n  // Deactivate featured status if expired\n  if (this.featured && this.featured.active && this.featured.endDate < new Date()) {\n    this.featured.active = false;\n    this.featured.position = undefined;\n  }\n  next();\n});\nmodule.exports = mongoose.model('Horse', horseSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJob3JzZVNjaGVtYSIsIlNjaGVtYSIsInNlbGxlciIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwicmVxdWlyZWQiLCJuYW1lIiwiU3RyaW5nIiwidHJpbSIsImJyZWVkIiwiYWdlIiwieWVhcnMiLCJOdW1iZXIiLCJtaW4iLCJtb250aHMiLCJtYXgiLCJnZW5kZXIiLCJlbnVtIiwiY29sb3IiLCJwcmljZSIsImRlc2NyaXB0aW9uIiwibG9jYXRpb24iLCJzdGF0ZSIsImNpdHkiLCJwaW5jb2RlIiwiaW1hZ2VzIiwidXJsIiwicHVibGljX2lkIiwidGh1bWJuYWlsX3VybCIsIndpZHRoIiwiaGVpZ2h0IiwiZm9ybWF0Iiwic3BlY2lmaWNhdGlvbnMiLCJ0cmFpbmluZyIsImRpc2NpcGxpbmUiLCJ0ZW1wZXJhbWVudCIsImhlYWx0aFN0YXR1cyIsInZhY2NpbmF0aW9uIiwiQm9vbGVhbiIsImRlZmF1bHQiLCJwYXBlcnMiLCJsaXN0aW5nU3RhdHVzIiwic3RhdGlzdGljcyIsInZpZXdzIiwiaW5xdWlyaWVzIiwibGFzdFZpZXdlZCIsIkRhdGUiLCJub3ciLCJib29zdCIsImFjdGl2ZSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJ2ZXJpZmljYXRpb25TdGF0dXMiLCJ2ZXJpZmljYXRpb25EZXRhaWxzIiwic3VibWl0dGVkQXQiLCJzdWJtaXR0ZWRCeSIsInZlcmlmaWVkQXQiLCJ2ZXJpZmllZEJ5IiwiZG9jdW1lbnRzIiwidmVyaWZpZWQiLCJub3RlcyIsInJlamVjdGlvblJlYXNvbiIsImV4cGlyeURhdGUiLCJkYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJmZWF0dXJlZCIsInBvc2l0aW9uIiwidGltZXN0YW1wcyIsIm1ldGhvZHMiLCJpbmNyZW1lbnRWaWV3cyIsInNhdmUiLCJpbmNyZW1lbnRJbnF1aXJpZXMiLCJpc0V4cGlyZWQiLCJpc0Jvb3N0ZWQiLCJpc0ZlYXR1cmVkIiwicHJlIiwibmV4dCIsInVuZGVmaW5lZCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcbW9kZWxzXFwiLCJzb3VyY2VzIjpbIkhvcnNlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcclxuXHJcbmNvbnN0IGhvcnNlU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XHJcbiAgICBzZWxsZXI6IHtcclxuICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgcmVmOiAnU2VsbGVyJyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIG5hbWU6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgdHJpbTogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGJyZWVkOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgYWdlOiB7XHJcbiAgICAgICAgeWVhcnM6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgbWluOiAwXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtb250aHM6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgbWluOiAwLFxyXG4gICAgICAgICAgICBtYXg6IDExXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGdlbmRlcjoge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICBlbnVtOiBbJ1N0YWxsaW9uJywgJ01hcmUnLCAnR2VsZGluZyddXHJcbiAgICB9LFxyXG4gICAgY29sb3I6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBwcmljZToge1xyXG4gICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICBtaW46IDBcclxuICAgIH0sXHJcbiAgICBkZXNjcmlwdGlvbjoge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgc3RhdGU6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY2l0eToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwaW5jb2RlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgaW1hZ2VzOiBbe1xyXG4gICAgICAgIHVybDoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwdWJsaWNfaWQ6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGh1bWJuYWlsX3VybDogU3RyaW5nLFxyXG4gICAgICAgIHdpZHRoOiBOdW1iZXIsXHJcbiAgICAgICAgaGVpZ2h0OiBOdW1iZXIsXHJcbiAgICAgICAgZm9ybWF0OiBTdHJpbmdcclxuICAgIH1dLFxyXG4gICAgc3BlY2lmaWNhdGlvbnM6IHtcclxuICAgICAgICB0cmFpbmluZzoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBlbnVtOiBbJ0Jhc2ljJywgJ0ludGVybWVkaWF0ZScsICdBZHZhbmNlZCddXHJcbiAgICAgICAgfSxcclxuICAgICAgICBkaXNjaXBsaW5lOiBbe1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgICAgfV0sXHJcbiAgICAgICAgdGVtcGVyYW1lbnQ6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaGVhbHRoU3RhdHVzOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZhY2NpbmF0aW9uOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYXBlcnM6IHtcclxuICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgbGlzdGluZ1N0YXR1czoge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBlbnVtOiBbJ2RyYWZ0JywgJ2FjdGl2ZScsICdzb2xkJywgJ2luYWN0aXZlJ10sXHJcbiAgICAgICAgZGVmYXVsdDogJ2RyYWZ0J1xyXG4gICAgfSxcclxuICAgIHN0YXRpc3RpY3M6IHtcclxuICAgICAgICB2aWV3czoge1xyXG4gICAgICAgICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIGlucXVpcmllczoge1xyXG4gICAgICAgICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxhc3RWaWV3ZWQ6IHtcclxuICAgICAgICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgICAgICAgZGVmYXVsdDogRGF0ZS5ub3dcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgYm9vc3Q6IHtcclxuICAgICAgICBhY3RpdmU6IHtcclxuICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgICAgICB9LFxyXG4gICAgICAgIHN0YXJ0RGF0ZTogRGF0ZSxcclxuICAgICAgICBlbmREYXRlOiBEYXRlXHJcbiAgICB9LFxyXG4gICAgdmVyaWZpY2F0aW9uU3RhdHVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGVudW06IFsncGVuZGluZycsICd2ZXJpZmllZCcsICdyZWplY3RlZCcsICd1bnZlcmlmaWVkJ10sXHJcbiAgICAgICAgZGVmYXVsdDogJ3VudmVyaWZpZWQnXHJcbiAgICB9LFxyXG4gICAgdmVyaWZpY2F0aW9uRGV0YWlsczoge1xyXG4gICAgICAgIHN1Ym1pdHRlZEF0OiBEYXRlLFxyXG4gICAgICAgIHN1Ym1pdHRlZEJ5OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICAgICAgcmVmOiAnVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHZlcmlmaWVkQXQ6IERhdGUsXHJcbiAgICAgICAgdmVyaWZpZWRCeToge1xyXG4gICAgICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgICAgIHJlZjogJ1VzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBkb2N1bWVudHM6IFt7XHJcbiAgICAgICAgICAgIHR5cGU6IHtcclxuICAgICAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgICAgIGVudW06IFsncmVnaXN0cmF0aW9uJywgJ21lZGljYWwnLCAnb3duZXJzaGlwJywgJ290aGVyJ11cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdXJsOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHB1YmxpY19pZDogU3RyaW5nLFxyXG4gICAgICAgICAgICB2ZXJpZmllZDoge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XSxcclxuICAgICAgICBub3RlczogU3RyaW5nLFxyXG4gICAgICAgIHJlamVjdGlvblJlYXNvbjogU3RyaW5nXHJcbiAgICB9LFxyXG4gICAgZXhwaXJ5RGF0ZToge1xyXG4gICAgICAgIHR5cGU6IERhdGUsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgZGVmYXVsdDogKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgZGF0ZS5zZXREYXRlKGRhdGUuZ2V0RGF0ZSgpICsgMzApOyAvLyBEZWZhdWx0IDMwIGRheXNcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGZlYXR1cmVkOiB7XHJcbiAgICAgICAgYWN0aXZlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdGFydERhdGU6IERhdGUsXHJcbiAgICAgICAgZW5kRGF0ZTogRGF0ZSxcclxuICAgICAgICBwb3NpdGlvbjogTnVtYmVyXHJcbiAgICB9XHJcbn0sIHtcclxuICAgIHRpbWVzdGFtcHM6IHRydWVcclxufSk7XHJcblxyXG4vLyBVcGRhdGUgc3RhdGlzdGljcyB3aGVuIGhvcnNlIGlzIHZpZXdlZFxyXG5ob3JzZVNjaGVtYS5tZXRob2RzLmluY3JlbWVudFZpZXdzID0gYXN5bmMgZnVuY3Rpb24oKSB7XHJcbiAgICB0aGlzLnN0YXRpc3RpY3Mudmlld3MgKz0gMTtcclxuICAgIHRoaXMuc3RhdGlzdGljcy5sYXN0Vmlld2VkID0gRGF0ZS5ub3coKTtcclxuICAgIGF3YWl0IHRoaXMuc2F2ZSgpO1xyXG59O1xyXG5cclxuLy8gVXBkYXRlIHN0YXRpc3RpY3Mgd2hlbiBpbnF1aXJ5IGlzIGNyZWF0ZWRcclxuaG9yc2VTY2hlbWEubWV0aG9kcy5pbmNyZW1lbnRJbnF1aXJpZXMgPSBhc3luYyBmdW5jdGlvbigpIHtcclxuICAgIHRoaXMuc3RhdGlzdGljcy5pbnF1aXJpZXMgKz0gMTtcclxuICAgIGF3YWl0IHRoaXMuc2F2ZSgpO1xyXG59O1xyXG5cclxuLy8gQ2hlY2sgaWYgbGlzdGluZyBpcyBleHBpcmVkXHJcbmhvcnNlU2NoZW1hLm1ldGhvZHMuaXNFeHBpcmVkID0gZnVuY3Rpb24oKSB7XHJcbiAgICByZXR1cm4gdGhpcy5leHBpcnlEYXRlICYmIHRoaXMuZXhwaXJ5RGF0ZSA8IG5ldyBEYXRlKCk7XHJcbn07XHJcblxyXG4vLyBDaGVjayBpZiBsaXN0aW5nIGlzIGJvb3N0ZWRcclxuaG9yc2VTY2hlbWEubWV0aG9kcy5pc0Jvb3N0ZWQgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLmJvb3N0ICYmIFxyXG4gICAgICAgICAgIHRoaXMuYm9vc3QuYWN0aXZlICYmIFxyXG4gICAgICAgICAgIHRoaXMuYm9vc3QuZW5kRGF0ZSAmJiBcclxuICAgICAgICAgICB0aGlzLmJvb3N0LmVuZERhdGUgPiBuZXcgRGF0ZSgpO1xyXG59O1xyXG5cclxuLy8gQ2hlY2sgaWYgbGlzdGluZyBpcyBmZWF0dXJlZFxyXG5ob3JzZVNjaGVtYS5tZXRob2RzLmlzRmVhdHVyZWQgPSBmdW5jdGlvbigpIHtcclxuICAgIHJldHVybiB0aGlzLmZlYXR1cmVkICYmIFxyXG4gICAgICAgICAgIHRoaXMuZmVhdHVyZWQuYWN0aXZlICYmIFxyXG4gICAgICAgICAgIHRoaXMuZmVhdHVyZWQuZW5kRGF0ZSAmJiBcclxuICAgICAgICAgICB0aGlzLmZlYXR1cmVkLmVuZERhdGUgPiBuZXcgRGF0ZSgpO1xyXG59O1xyXG5cclxuLy8gUHJlLXNhdmUgaG9vayB0byBjaGVjayBleHBpcnkgYW5kIHN0YXR1c1xyXG5ob3JzZVNjaGVtYS5wcmUoJ3NhdmUnLCBmdW5jdGlvbihuZXh0KSB7XHJcbiAgICAvLyBVcGRhdGUgbGlzdGluZyBzdGF0dXMgaWYgZXhwaXJlZFxyXG4gICAgaWYgKHRoaXMuaXNFeHBpcmVkKCkgJiYgdGhpcy5saXN0aW5nU3RhdHVzID09PSAnYWN0aXZlJykge1xyXG4gICAgICAgIHRoaXMubGlzdGluZ1N0YXR1cyA9ICdleHBpcmVkJztcclxuICAgIH1cclxuXHJcbiAgICAvLyBEZWFjdGl2YXRlIGJvb3N0IGlmIGV4cGlyZWRcclxuICAgIGlmICh0aGlzLmJvb3N0ICYmIHRoaXMuYm9vc3QuYWN0aXZlICYmIHRoaXMuYm9vc3QuZW5kRGF0ZSA8IG5ldyBEYXRlKCkpIHtcclxuICAgICAgICB0aGlzLmJvb3N0LmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERlYWN0aXZhdGUgZmVhdHVyZWQgc3RhdHVzIGlmIGV4cGlyZWRcclxuICAgIGlmICh0aGlzLmZlYXR1cmVkICYmIHRoaXMuZmVhdHVyZWQuYWN0aXZlICYmIHRoaXMuZmVhdHVyZWQuZW5kRGF0ZSA8IG5ldyBEYXRlKCkpIHtcclxuICAgICAgICB0aGlzLmZlYXR1cmVkLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZmVhdHVyZWQucG9zaXRpb24gPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgbmV4dCgpO1xyXG59KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ0hvcnNlJywgaG9yc2VTY2hlbWEpOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUVwQyxNQUFNQyxXQUFXLEdBQUcsSUFBSUYsUUFBUSxDQUFDRyxNQUFNLENBQUM7RUFDcENDLE1BQU0sRUFBRTtJQUNKQyxJQUFJLEVBQUVMLFFBQVEsQ0FBQ0csTUFBTSxDQUFDRyxLQUFLLENBQUNDLFFBQVE7SUFDcENDLEdBQUcsRUFBRSxRQUFRO0lBQ2JDLFFBQVEsRUFBRTtFQUNkLENBQUM7RUFDREMsSUFBSSxFQUFFO0lBQ0ZMLElBQUksRUFBRU0sTUFBTTtJQUNaRixRQUFRLEVBQUUsSUFBSTtJQUNkRyxJQUFJLEVBQUU7RUFDVixDQUFDO0VBQ0RDLEtBQUssRUFBRTtJQUNIUixJQUFJLEVBQUVNLE1BQU07SUFDWkYsUUFBUSxFQUFFO0VBQ2QsQ0FBQztFQUNESyxHQUFHLEVBQUU7SUFDREMsS0FBSyxFQUFFO01BQ0hWLElBQUksRUFBRVcsTUFBTTtNQUNaUCxRQUFRLEVBQUUsSUFBSTtNQUNkUSxHQUFHLEVBQUU7SUFDVCxDQUFDO0lBQ0RDLE1BQU0sRUFBRTtNQUNKYixJQUFJLEVBQUVXLE1BQU07TUFDWlAsUUFBUSxFQUFFLElBQUk7TUFDZFEsR0FBRyxFQUFFLENBQUM7TUFDTkUsR0FBRyxFQUFFO0lBQ1Q7RUFDSixDQUFDO0VBQ0RDLE1BQU0sRUFBRTtJQUNKZixJQUFJLEVBQUVNLE1BQU07SUFDWkYsUUFBUSxFQUFFLElBQUk7SUFDZFksSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxTQUFTO0VBQ3hDLENBQUM7RUFDREMsS0FBSyxFQUFFO0lBQ0hqQixJQUFJLEVBQUVNLE1BQU07SUFDWkYsUUFBUSxFQUFFO0VBQ2QsQ0FBQztFQUNEYyxLQUFLLEVBQUU7SUFDSGxC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","map":{"version":3,"names":["mongoose","require","horseSchema","Schema","seller","type","Types","ObjectId","ref","required","name","String","trim","breed","age","years","Number","min","months","max","gender","enum","color","price","description","location","state","city","pincode","images","url","public_id","thumbnail_url","width","height","format","specifications","training","discipline","temperament","healthStatus","vaccination","Boolean","default","papers","listingStatus","statistics","views","inquiries","lastViewed","Date","now","boost","active","startDate","endDate","verificationStatus","verificationDetails","submittedAt","submittedBy","verifiedAt","verifiedBy","documents","verified","notes","rejectionReason","expiryDate","date","setDate","getDate","featured","position","timestamps","methods","incrementViews","save","incrementInquiries","isExpired","isBoosted","isFeatured","pre","next","undefined","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Horse.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst horseSchema = new mongoose.Schema({\r\n    seller: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Seller',\r\n        required: true\r\n    },\r\n    name: {\r\n        type: String,\r\n        required: true,\r\n        trim: true\r\n    },\r\n    breed: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    age: {\r\n        years: {\r\n            type: Number,\r\n            required: true,\r\n            min: 0\r\n        },\r\n        months: {\r\n            type: Number,\r\n            required: true,\r\n            min: 0,\r\n            max: 11\r\n        }\r\n    },\r\n    gender: {\r\n        type: String,\r\n        required: true,\r\n        enum: ['Stallion', 'Mare', 'Gelding']\r\n    },\r\n    color: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    price: {\r\n        type: Number,\r\n        required: true,\r\n        min: 0\r\n    },\r\n    description: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    location: {\r\n        state: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        city: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        pincode: {\r\n            type: String,\r\n            required: true\r\n        }\r\n    },\r\n    images: [{\r\n        url: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        public_id: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        thumbnail_url: String,\r\n        width: Number,\r\n        height: Number,\r\n        format: String\r\n    }],\r\n    specifications: {\r\n        training: {\r\n            type: String,\r\n            required: true,\r\n            enum: ['Basic', 'Intermediate', 'Advanced']\r\n        },\r\n        discipline: [{\r\n            type: String,\r\n            required: true\r\n        }],\r\n        temperament: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        healthStatus: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        vaccination: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        papers: {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    },\r\n    listingStatus: {\r\n        type: String,\r\n        enum: ['draft', 'active', 'sold', 'inactive'],\r\n        default: 'draft'\r\n    },\r\n    statistics: {\r\n        views: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        inquiries: {\r\n            type: Number,\r\n            default: 0\r\n        },\r\n        lastViewed: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    },\r\n    boost: {\r\n        active: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        startDate: Date,\r\n        endDate: Date\r\n    },\r\n    verificationStatus: {\r\n        type: String,\r\n        enum: ['pending', 'verified', 'rejected', 'unverified'],\r\n        default: 'unverified'\r\n    },\r\n    verificationDetails: {\r\n        submittedAt: Date,\r\n        submittedBy: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        verifiedAt: Date,\r\n        verifiedBy: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        documents: [{\r\n            type: {\r\n                type: String,\r\n                enum: ['registration', 'medical', 'ownership', 'other']\r\n            },\r\n            url: String,\r\n            public_id: String,\r\n            verified: {\r\n                type: Boolean,\r\n                default: false\r\n            }\r\n        }],\r\n        notes: String,\r\n        rejectionReason: String\r\n    },\r\n    expiryDate: {\r\n        type: Date,\r\n        required: true,\r\n        default: () => {\r\n            const date = new Date();\r\n            date.setDate(date.getDate() + 30); // Default 30 days\r\n            return date;\r\n        }\r\n    },\r\n    featured: {\r\n        active: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        startDate: Date,\r\n        endDate: Date,\r\n        position: Number\r\n    }\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Update statistics when horse is viewed\r\nhorseSchema.methods.incrementViews = async function() {\r\n    this.statistics.views += 1;\r\n    this.statistics.lastViewed = Date.now();\r\n    await this.save();\r\n};\r\n\r\n// Update statistics when inquiry is created\r\nhorseSchema.methods.incrementInquiries = async function() {\r\n    this.statistics.inquiries += 1;\r\n    await this.save();\r\n};\r\n\r\n// Check if listing is expired\r\nhorseSchema.methods.isExpired = function() {\r\n    return this.expiryDate && this.expiryDate < new Date();\r\n};\r\n\r\n// Check if listing is boosted\r\nhorseSchema.methods.isBoosted = function() {\r\n    return this.boost && \r\n           this.boost.active && \r\n           this.boost.endDate && \r\n           this.boost.endDate > new Date();\r\n};\r\n\r\n// Check if listing is featured\r\nhorseSchema.methods.isFeatured = function() {\r\n    return this.featured && \r\n           this.featured.active && \r\n           this.featured.endDate && \r\n           this.featured.endDate > new Date();\r\n};\r\n\r\n// Pre-save hook to check expiry and status\r\nhorseSchema.pre('save', function(next) {\r\n    // Update listing status if expired\r\n    if (this.isExpired() && this.listingStatus === 'active') {\r\n        this.listingStatus = 'expired';\r\n    }\r\n\r\n    // Deactivate boost if expired\r\n    if (this.boost && this.boost.active && this.boost.endDate < new Date()) {\r\n        this.boost.active = false;\r\n    }\r\n\r\n    // Deactivate featured status if expired\r\n    if (this.featured && this.featured.active && this.featured.endDate < new Date()) {\r\n        this.featured.active = false;\r\n        this.featured.position = undefined;\r\n    }\r\n\r\n    next();\r\n});\r\n\r\nmodule.exports = mongoose.model('Horse', horseSchema); "],"mappings":"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","ignoreList":[]}},"mtime":1734039496124},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\ActivityLog.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst activityLogSchema = new mongoose.Schema({\n  user: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User'\n  },\n  action: {\n    type: String,\n    required: true,\n    enum: [\n    // User actions\n    'user_login', 'user_logout', 'user_register', 'password_change', 'profile_update', 'preferences_update', 'alert_preferences_update', 'support_ticket_create',\n    // Seller actions\n    'seller_register', 'subscription_purchase', 'listing_create', 'listing_update', 'listing_delete', 'document_upload',\n    // Admin actions\n    'user_block', 'user_unblock', 'listing_verify', 'listing_reject', 'promotion_create', 'category_create', 'category_update', 'category_delete',\n    // System actions\n    'subscription_expire', 'payment_process', 'email_send', 'notification_send', 'backup_create', 'system_update']\n  },\n  entityType: {\n    type: String,\n    enum: ['user', 'seller', 'listing', 'subscription', 'payment', 'category', 'promotion', 'ticket', 'system'],\n    required: true\n  },\n  entityId: mongoose.Schema.Types.ObjectId,\n  description: {\n    type: String,\n    required: true\n  },\n  metadata: {\n    ip: String,\n    userAgent: String,\n    browser: String,\n    os: String,\n    device: String,\n    location: {\n      country: String,\n      city: String,\n      coordinates: {\n        latitude: Number,\n        longitude: Number\n      }\n    }\n  },\n  status: {\n    type: String,\n    enum: ['success', 'failure', 'warning'],\n    required: true\n  },\n  details: {\n    before: mongoose.Schema.Types.Mixed,\n    after: mongoose.Schema.Types.Mixed,\n    reason: String,\n    error: String\n  },\n  severity: {\n    type: String,\n    enum: ['info', 'low', 'medium', 'high', 'critical'],\n    default: 'info'\n  },\n  tags: [String]\n}, {\n  timestamps: true\n});\n\n// Create indexes\nactivityLogSchema.index({\n  user: 1\n});\nactivityLogSchema.index({\n  action: 1\n});\nactivityLogSchema.index({\n  entityType: 1,\n  entityId: 1\n});\nactivityLogSchema.index({\n  createdAt: 1\n});\nactivityLogSchema.index({\n  status: 1\n});\nactivityLogSchema.index({\n  severity: 1\n});\n\n// Add TTL index for automatic deletion after 90 days\nactivityLogSchema.index({\n  createdAt: 1\n}, {\n  expireAfterSeconds: 90 * 24 * 60 * 60\n});\nmodule.exports = mongoose.model('ActivityLog', activityLogSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJhY3Rpdml0eUxvZ1NjaGVtYSIsIlNjaGVtYSIsInVzZXIiLCJ0eXBlIiwiVHlwZXMiLCJPYmplY3RJZCIsInJlZiIsImFjdGlvbiIsIlN0cmluZyIsInJlcXVpcmVkIiwiZW51bSIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsImRlc2NyaXB0aW9uIiwibWV0YWRhdGEiLCJpcCIsInVzZXJBZ2VudCIsImJyb3dzZXIiLCJvcyIsImRldmljZSIsImxvY2F0aW9uIiwiY291bnRyeSIsImNpdHkiLCJjb29yZGluYXRlcyIsImxhdGl0dWRlIiwiTnVtYmVyIiwibG9uZ2l0dWRlIiwic3RhdHVzIiwiZGV0YWlscyIsImJlZm9yZSIsIk1peGVkIiwiYWZ0ZXIiLCJyZWFzb24iLCJlcnJvciIsInNldmVyaXR5IiwiZGVmYXVsdCIsInRhZ3MiLCJ0aW1lc3RhbXBzIiwiaW5kZXgiLCJjcmVhdGVkQXQiLCJleHBpcmVBZnRlclNlY29uZHMiLCJtb2R1bGUiLCJleHBvcnRzIiwibW9kZWwiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJBY3Rpdml0eUxvZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG5jb25zdCBhY3Rpdml0eUxvZ1NjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gICAgdXNlcjoge1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdVc2VyJ1xyXG4gICAgfSxcclxuICAgIGFjdGlvbjoge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICBlbnVtOiBbXHJcbiAgICAgICAgICAgIC8vIFVzZXIgYWN0aW9uc1xyXG4gICAgICAgICAgICAndXNlcl9sb2dpbicsXHJcbiAgICAgICAgICAgICd1c2VyX2xvZ291dCcsXHJcbiAgICAgICAgICAgICd1c2VyX3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgJ3Bhc3N3b3JkX2NoYW5nZScsXHJcbiAgICAgICAgICAgICdwcm9maWxlX3VwZGF0ZScsXHJcbiAgICAgICAgICAgICdwcmVmZXJlbmNlc191cGRhdGUnLFxyXG4gICAgICAgICAgICAnYWxlcnRfcHJlZmVyZW5jZXNfdXBkYXRlJyxcclxuICAgICAgICAgICAgJ3N1cHBvcnRfdGlja2V0X2NyZWF0ZScsXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTZWxsZXIgYWN0aW9uc1xyXG4gICAgICAgICAgICAnc2VsbGVyX3JlZ2lzdGVyJyxcclxuICAgICAgICAgICAgJ3N1YnNjcmlwdGlvbl9wdXJjaGFzZScsXHJcbiAgICAgICAgICAgICdsaXN0aW5nX2NyZWF0ZScsXHJcbiAgICAgICAgICAgICdsaXN0aW5nX3VwZGF0ZScsXHJcbiAgICAgICAgICAgICdsaXN0aW5nX2RlbGV0ZScsXHJcbiAgICAgICAgICAgICdkb2N1bWVudF91cGxvYWQnLFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gQWRtaW4gYWN0aW9uc1xyXG4gICAgICAgICAgICAndXNlcl9ibG9jaycsXHJcbiAgICAgICAgICAgICd1c2VyX3VuYmxvY2snLFxyXG4gICAgICAgICAgICAnbGlzdGluZ192ZXJpZnknLFxyXG4gICAgICAgICAgICAnbGlzdGluZ19yZWplY3QnLFxyXG4gICAgICAgICAgICAncHJvbW90aW9uX2NyZWF0ZScsXHJcbiAgICAgICAgICAgICdjYXRlZ29yeV9jcmVhdGUnLFxyXG4gICAgICAgICAgICAnY2F0ZWdvcnlfdXBkYXRlJyxcclxuICAgICAgICAgICAgJ2NhdGVnb3J5X2RlbGV0ZScsXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTeXN0ZW0gYWN0aW9uc1xyXG4gICAgICAgICAgICAnc3Vic2NyaXB0aW9uX2V4cGlyZScsXHJcbiAgICAgICAgICAgICdwYXltZW50X3Byb2Nlc3MnLFxyXG4gICAgICAgICAgICAnZW1haWxfc2VuZCcsXHJcbiAgICAgICAgICAgICdub3RpZmljYXRpb25fc2VuZCcsXHJcbiAgICAgICAgICAgICdiYWNrdXBfY3JlYXRlJyxcclxuICAgICAgICAgICAgJ3N5c3RlbV91cGRhdGUnXHJcbiAgICAgICAgXVxyXG4gICAgfSxcclxuICAgIGVudGl0eVR5cGU6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZW51bTogW1xyXG4gICAgICAgICAgICAndXNlcicsXHJcbiAgICAgICAgICAgICdzZWxsZXInLFxyXG4gICAgICAgICAgICAnbGlzdGluZycsXHJcbiAgICAgICAgICAgICdzdWJzY3JpcHRpb24nLFxyXG4gICAgICAgICAgICAncGF5bWVudCcsXHJcbiAgICAgICAgICAgICdjYXRlZ29yeScsXHJcbiAgICAgICAgICAgICdwcm9tb3Rpb24nLFxyXG4gICAgICAgICAgICAndGlja2V0JyxcclxuICAgICAgICAgICAgJ3N5c3RlbSdcclxuICAgICAgICBdLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgZW50aXR5SWQ6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgIGRlc2NyaXB0aW9uOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgbWV0YWRhdGE6IHtcclxuICAgICAgICBpcDogU3RyaW5nLFxyXG4gICAgICAgIHVzZXJBZ2VudDogU3RyaW5nLFxyXG4gICAgICAgIGJyb3dzZXI6IFN0cmluZyxcclxuICAgICAgICBvczogU3RyaW5nLFxyXG4gICAgICAgIGRldmljZTogU3RyaW5nLFxyXG4gICAgICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgICAgIGNvdW50cnk6IFN0cmluZyxcclxuICAgICAgICAgICAgY2l0eTogU3RyaW5nLFxyXG4gICAgICAgICAgICBjb29yZGluYXRlczoge1xyXG4gICAgICAgICAgICAgICAgbGF0aXR1ZGU6IE51bWJlcixcclxuICAgICAgICAgICAgICAgIGxvbmdpdHVkZTogTnVtYmVyXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgc3RhdHVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGVudW06IFsnc3VjY2VzcycsICdmYWlsdXJlJywgJ3dhcm5pbmcnXSxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGRldGFpbHM6IHtcclxuICAgICAgICBiZWZvcmU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5NaXhlZCxcclxuICAgICAgICBhZnRlcjogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk1peGVkLFxyXG4gICAgICAgIHJlYXNvbjogU3RyaW5nLFxyXG4gICAgICAgIGVycm9yOiBTdHJpbmdcclxuICAgIH0sXHJcbiAgICBzZXZlcml0eToge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBlbnVtOiBbJ2luZm8nLCAnbG93JywgJ21lZGl1bScsICdoaWdoJywgJ2NyaXRpY2FsJ10sXHJcbiAgICAgICAgZGVmYXVsdDogJ2luZm8nXHJcbiAgICB9LFxyXG4gICAgdGFnczogW1N0cmluZ11cclxufSwge1xyXG4gICAgdGltZXN0YW1wczogdHJ1ZVxyXG59KTtcclxuXHJcbi8vIENyZWF0ZSBpbmRleGVzXHJcbmFjdGl2aXR5TG9nU2NoZW1hLmluZGV4KHsgdXNlcjogMSB9KTtcclxuYWN0aXZpdHlMb2dTY2hlbWEuaW5kZXgoeyBhY3Rpb246IDEgfSk7XHJcbmFjdGl2aXR5TG9nU2NoZW1hLmluZGV4KHsgZW50aXR5VHlwZTogMSwgZW50aXR5SWQ6IDEgfSk7XHJcbmFjdGl2aXR5TG9nU2NoZW1hLmluZGV4KHsgY3JlYXRlZEF0OiAxIH0pO1xyXG5hY3Rpdml0eUxvZ1NjaGVtYS5pbmRleCh7IHN0YXR1czogMSB9KTtcclxuYWN0aXZpdHlMb2dTY2hlbWEuaW5kZXgoeyBzZXZlcml0eTogMSB9KTtcclxuXHJcbi8vIEFkZCBUVEwgaW5kZXggZm9yIGF1dG9tYXRpYyBkZWxldGlvbiBhZnRlciA5MCBkYXlzXHJcbmFjdGl2aXR5TG9nU2NoZW1hLmluZGV4KHsgY3JlYXRlZEF0OiAxIH0sIHsgZXhwaXJlQWZ0ZXJTZWNvbmRzOiA5MCAqIDI0ICogNjAgKiA2MCB9KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ0FjdGl2aXR5TG9nJywgYWN0aXZpdHlMb2dTY2hlbWEpOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUVwQyxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUMxQ0MsSUFBSSxFQUFFO0lBQ0ZDLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNHLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFO0VBQ1QsQ0FBQztFQUNEQyxNQUFNLEVBQUU7SUFDSkosSUFBSSxFQUFFSyxNQUFNO0lBQ1pDLFFBQVEsRUFBRSxJQUFJO0lBQ2RDLElBQUksRUFBRTtJQUNGO0lBQ0EsWUFBWSxFQUNaLGFBQWEsRUFDYixlQUFlLEVBQ2YsaUJBQWlCLEVBQ2pCLGdCQUFnQixFQUNoQixvQkFBb0IsRUFDcEIsMEJBQTBCLEVBQzFCLHVCQUF1QjtJQUV2QjtJQUNBLGlCQUFpQixFQUNqQix1QkFBdUIsRUFDdkIsZ0JBQWdCLEVBQ2hCLGdCQUFnQixFQUNoQixnQkFBZ0IsRUFDaEIsaUJBQWlCO0lBRWpCO0lBQ0EsWUFBWSxFQUNaLGNBQWMsRUFDZCxnQkFBZ0IsRUFDaEIsZ0JBQWdCLEVBQ2hCLGtCQUFrQixFQUNsQixpQkFBaUIsRUFDakIsaUJBQWlCLEVBQ2pCLGlCQUFp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","map":{"version":3,"names":["mongoose","require","activityLogSchema","Schema","user","type","Types","ObjectId","ref","action","String","required","enum","entityType","entityId","description","metadata","ip","userAgent","browser","os","device","location","country","city","coordinates","latitude","Number","longitude","status","details","before","Mixed","after","reason","error","severity","default","tags","timestamps","index","createdAt","expireAfterSeconds","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["ActivityLog.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst activityLogSchema = new mongoose.Schema({\r\n    user: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User'\r\n    },\r\n    action: {\r\n        type: String,\r\n        required: true,\r\n        enum: [\r\n            // User actions\r\n            'user_login',\r\n            'user_logout',\r\n            'user_register',\r\n            'password_change',\r\n            'profile_update',\r\n            'preferences_update',\r\n            'alert_preferences_update',\r\n            'support_ticket_create',\r\n            \r\n            // Seller actions\r\n            'seller_register',\r\n            'subscription_purchase',\r\n            'listing_create',\r\n            'listing_update',\r\n            'listing_delete',\r\n            'document_upload',\r\n            \r\n            // Admin actions\r\n            'user_block',\r\n            'user_unblock',\r\n            'listing_verify',\r\n            'listing_reject',\r\n            'promotion_create',\r\n            'category_create',\r\n            'category_update',\r\n            'category_delete',\r\n            \r\n            // System actions\r\n            'subscription_expire',\r\n            'payment_process',\r\n            'email_send',\r\n            'notification_send',\r\n            'backup_create',\r\n            'system_update'\r\n        ]\r\n    },\r\n    entityType: {\r\n        type: String,\r\n        enum: [\r\n            'user',\r\n            'seller',\r\n            'listing',\r\n            'subscription',\r\n            'payment',\r\n            'category',\r\n            'promotion',\r\n            'ticket',\r\n            'system'\r\n        ],\r\n        required: true\r\n    },\r\n    entityId: mongoose.Schema.Types.ObjectId,\r\n    description: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    metadata: {\r\n        ip: String,\r\n        userAgent: String,\r\n        browser: String,\r\n        os: String,\r\n        device: String,\r\n        location: {\r\n            country: String,\r\n            city: String,\r\n            coordinates: {\r\n                latitude: Number,\r\n                longitude: Number\r\n            }\r\n        }\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['success', 'failure', 'warning'],\r\n        required: true\r\n    },\r\n    details: {\r\n        before: mongoose.Schema.Types.Mixed,\r\n        after: mongoose.Schema.Types.Mixed,\r\n        reason: String,\r\n        error: String\r\n    },\r\n    severity: {\r\n        type: String,\r\n        enum: ['info', 'low', 'medium', 'high', 'critical'],\r\n        default: 'info'\r\n    },\r\n    tags: [String]\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Create indexes\r\nactivityLogSchema.index({ user: 1 });\r\nactivityLogSchema.index({ action: 1 });\r\nactivityLogSchema.index({ entityType: 1, entityId: 1 });\r\nactivityLogSchema.index({ createdAt: 1 });\r\nactivityLogSchema.index({ status: 1 });\r\nactivityLogSchema.index({ severity: 1 });\r\n\r\n// Add TTL index for automatic deletion after 90 days\r\nactivityLogSchema.index({ createdAt: 1 }, { expireAfterSeconds: 90 * 24 * 60 * 60 });\r\n\r\nmodule.exports = mongoose.model('ActivityLog', activityLogSchema); "],"mappings":"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","ignoreList":[]}},"mtime":1734037955655},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\seller.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middlewares/auth.middleware');\nconst Seller = require('../models/Seller');\nconst User = require('../models/User');\nconst Transaction = require('../models/Transaction');\nconst ActivityLog = require('../models/ActivityLog');\nconst {\n  validateSubscription\n} = require('../src/utils/validation');\nconst {\n  getMe,\n  createProfile,\n  updateProfile,\n  updateBankDetails,\n  getPaymentHistory,\n  getAnalytics,\n  getListings,\n  getInquiries,\n  getReviews,\n  addReview,\n  updateSubscription,\n  cancelSubscription,\n  getSubscriptionDetails\n} = require('../controllers/seller.controller');\n\n// Get subscription plans\nrouter.get('/plans', async (req, res) => {\n  try {\n    const plans = [{\n      id: 'starter',\n      name: 'Starter',\n      price: 0,\n      features: ['Up to 2 horse listings', 'Basic analytics', 'Email support'],\n      duration: 'forever'\n    }, {\n      id: 'gallop',\n      name: 'Gallop',\n      price: 4999,\n      features: ['Up to 10 horse listings', 'Advanced analytics', 'Priority email support', 'Featured listings', 'Social media promotion'],\n      duration: '30 days'\n    }, {\n      id: 'royal_stallion',\n      name: 'Royal Stallion',\n      price: 9999,\n      features: ['Unlimited horse listings', 'Premium analytics', '24/7 priority support', 'Featured listings', 'Social media promotion', 'Custom branding', 'Verified seller badge'],\n      duration: '30 days'\n    }];\n    res.json({\n      success: true,\n      plans\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// Subscribe to a plan\nrouter.post('/subscribe', protect, authorize('seller'), async (req, res) => {\n  try {\n    const {\n      package: packageName,\n      duration\n    } = req.body;\n\n    // Validate package\n    const validPackages = ['Royal Stallion', 'Gallop', 'Trot'];\n    if (!validPackages.includes(packageName)) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid package selected'\n      });\n    }\n\n    // Create subscription transaction\n    const transaction = await Transaction.create({\n      seller: req.user._id,\n      type: 'subscription',\n      amount: packageName === 'Royal Stallion' ? 9999 : packageName === 'Gallop' ? 4999 : 999,\n      status: 'pending',\n      subscriptionDetails: {\n        package: packageName,\n        duration: duration || 30,\n        // Default to 30 days\n        startDate: new Date(),\n        endDate: new Date(Date.now() + (duration || 30) * 24 * 60 * 60 * 1000)\n      }\n    });\n\n    // Update seller subscription\n    const seller = await Seller.findOneAndUpdate({\n      user: req.user._id\n    }, {\n      subscription: {\n        package: packageName,\n        startDate: new Date(),\n        endDate: new Date(Date.now() + (duration || 30) * 24 * 60 * 60 * 1000),\n        status: 'active',\n        transaction: transaction._id\n      }\n    }, {\n      new: true\n    });\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'subscription_purchase',\n      entityType: 'subscription',\n      entityId: transaction._id,\n      description: `Subscribed to ${packageName} package`,\n      status: 'success'\n    });\n    res.json({\n      success: true,\n      subscription: seller.subscription,\n      transaction\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// Create seller profile\nrouter.post('/profile', protect, async (req, res) => {\n  try {\n    const seller = await req.user.model('Seller').create({\n      user: req.user._id,\n      ...req.body\n    });\n\n    // Update user role to seller\n    req.user.role = 'seller';\n    await req.user.save();\n    res.status(201).json({\n      success: true,\n      seller\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// Get seller profile\nrouter.get('/me', protect, authorize('seller'), getMe);\n\n// Update seller profile\nrouter.put('/profile', protect, authorize('seller'), updateProfile);\n\n// Bank details\nrouter.put('/bank-details', protect, authorize('seller'), updateBankDetails);\n\n// Payment history\nrouter.get('/payments', protect, authorize('seller'), getPaymentHistory);\n\n// Analytics\nrouter.get('/analytics', protect, authorize('seller'), getAnalytics);\n\n// Listings\nrouter.get('/listings', protect, authorize('seller'), getListings);\n\n// Inquiries\nrouter.get('/inquiries', protect, authorize('seller'), getInquiries);\n\n// Reviews\nrouter.get('/reviews', protect, authorize('seller'), getReviews);\nrouter.post('/reviews', protect, addReview);\n\n// Subscription management\nrouter.put('/subscription', protect, authorize('seller'), updateSubscription);\nrouter.delete('/subscription', protect, authorize('seller'), cancelSubscription);\nrouter.get('/subscription', protect, authorize('seller'), getSubscriptionDetails);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJTZWxsZXIiLCJVc2VyIiwiVHJhbnNhY3Rpb24iLCJBY3Rpdml0eUxvZyIsInZhbGlkYXRlU3Vic2NyaXB0aW9uIiwiZ2V0TWUiLCJjcmVhdGVQcm9maWxlIiwidXBkYXRlUHJvZmlsZSIsInVwZGF0ZUJhbmtEZXRhaWxzIiwiZ2V0UGF5bWVudEhpc3RvcnkiLCJnZXRBbmFseXRpY3MiLCJnZXRMaXN0aW5ncyIsImdldElucXVpcmllcyIsImdldFJldmlld3MiLCJhZGRSZXZpZXciLCJ1cGRhdGVTdWJzY3JpcHRpb24iLCJjYW5jZWxTdWJzY3JpcHRpb24iLCJnZXRTdWJzY3JpcHRpb25EZXRhaWxzIiwiZ2V0IiwicmVxIiwicmVzIiwicGxhbnMiLCJpZCIsIm5hbWUiLCJwcmljZSIsImZlYXR1cmVzIiwiZHVyYXRpb24iLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiY29uc29sZSIsInN0YXR1cyIsIm1lc3NhZ2UiLCJwb3N0IiwicGFja2FnZSIsInBhY2thZ2VOYW1lIiwiYm9keSIsInZhbGlkUGFja2FnZXMiLCJpbmNsdWRlcyIsInRyYW5zYWN0aW9uIiwiY3JlYXRlIiwic2VsbGVyIiwidXNlciIsIl9pZCIsInR5cGUiLCJhbW91bnQiLCJzdWJzY3JpcHRpb25EZXRhaWxzIiwic3RhcnREYXRlIiwiRGF0ZSIsImVuZERhdGUiLCJub3ciLCJmaW5kT25lQW5kVXBkYXRlIiwic3Vic2NyaXB0aW9uIiwibmV3IiwiYWN0aW9uIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwiZGVzY3JpcHRpb24iLCJtb2RlbCIsInJvbGUiLCJzYXZlIiwicHV0IiwiZGVsZXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xccm91dGVzXFwiLCJzb3VyY2VzIjpbInNlbGxlci5yb3V0ZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuY29uc3QgeyBwcm90ZWN0LCBhdXRob3JpemUgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmVzL2F1dGgubWlkZGxld2FyZScpO1xyXG5jb25zdCBTZWxsZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvU2VsbGVyJyk7XHJcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xyXG5jb25zdCBUcmFuc2FjdGlvbiA9IHJlcXVpcmUoJy4uL21vZGVscy9UcmFuc2FjdGlvbicpO1xyXG5jb25zdCBBY3Rpdml0eUxvZyA9IHJlcXVpcmUoJy4uL21vZGVscy9BY3Rpdml0eUxvZycpO1xyXG5jb25zdCB7IHZhbGlkYXRlU3Vic2NyaXB0aW9uIH0gPSByZXF1aXJlKCcuLi9zcmMvdXRpbHMvdmFsaWRhdGlvbicpO1xyXG5cclxuY29uc3Qge1xyXG4gICAgZ2V0TWUsXHJcbiAgICBjcmVhdGVQcm9maWxlLFxyXG4gICAgdXBkYXRlUHJvZmlsZSxcclxuICAgIHVwZGF0ZUJhbmtEZXRhaWxzLFxyXG4gICAgZ2V0UGF5bWVudEhpc3RvcnksXHJcbiAgICBnZXRBbmFseXRpY3MsXHJcbiAgICBnZXRMaXN0aW5ncyxcclxuICAgIGdldElucXVpcmllcyxcclxuICAgIGdldFJldmlld3MsXHJcbiAgICBhZGRSZXZpZXcsXHJcbiAgICB1cGRhdGVTdWJzY3JpcHRpb24sXHJcbiAgICBjYW5jZWxTdWJzY3JpcHRpb24sXHJcbiAgICBnZXRTdWJzY3JpcHRpb25EZXRhaWxzXHJcbn0gPSByZXF1aXJlKCcuLi9jb250cm9sbGVycy9zZWxsZXIuY29udHJvbGxlcicpO1xyXG5cclxuLy8gR2V0IHN1YnNjcmlwdGlvbiBwbGFuc1xyXG5yb3V0ZXIuZ2V0KCcvcGxhbnMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcGxhbnMgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAnc3RhcnRlcicsXHJcbiAgICAgICAgICAgICAgICBuYW1lOiAnU3RhcnRlcicsXHJcbiAgICAgICAgICAgICAgICBwcmljZTogMCxcclxuICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgJ1VwIHRvIDIgaG9yc2UgbGlzdGluZ3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICdCYXNpYyBhbmFseXRpY3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICdFbWFpbCBzdXBwb3J0J1xyXG4gICAgICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAnZm9yZXZlcidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6ICdnYWxsb3AnLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ0dhbGxvcCcsXHJcbiAgICAgICAgICAgICAgICBwcmljZTogNDk5OSxcclxuICAgICAgICAgICAgICAgIGZlYXR1cmVzOiBbXHJcbiAgICAgICAgICAgICAgICAgICAgJ1VwIHRvIDEwIGhvcnNlIGxpc3RpbmdzJyxcclxuICAgICAgICAgICAgICAgICAgICAnQWR2YW5jZWQgYW5hbHl0aWNzJyxcclxuICAgICAgICAgICAgICAgICAgICAnUHJpb3JpdHkgZW1haWwgc3VwcG9ydCcsXHJcbiAgICAgICAgICAgICAgICAgICAgJ0ZlYXR1cmVkIGxpc3RpbmdzJyxcclxuICAgICAgICAgICAgICAgICAgICAnU29jaWFsIG1lZGlhIHByb21vdGlvbidcclxuICAgICAgICAgICAgICAgIF0sXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogJzMwIGRheXMnXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAncm95YWxfc3RhbGxpb24nLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogJ1JveWFsIFN0YWxsaW9uJyxcclxuICAgICAgICAgICAgICAgIHByaWNlOiA5OTk5LFxyXG4gICAgICAgICAgICAgICAgZmVhdHVyZXM6IFtcclxuICAgICAgICAgICAgICAgICAgICAnVW5saW1pdGVkIGhvcnNlIGxpc3RpbmdzJyxcclxuICAgICAgICAgICAgICAgICAgICAnUHJlbWl1bSBhbmFseXRpY3MnLFxyXG4gICAgICAgICAgICAgICAgICAgICcyNC83IHByaW9yaXR5IHN1cHBvcnQnLFxyXG4gICAgICAgICAgICAgICAgICAgICdGZWF0dXJlZCBsaXN0aW5ncycsXHJcbiAgICAgICAgICAgICAgICAgICAgJ1NvY2lhbCBtZWRpYSBwcm9tb3Rpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICdDdXN0b20gYnJhbmRpbmcnLFxyXG4gICAgICAgICAgICAgICAgICAgICdWZXJpZmllZCBzZWxsZXIgYmFkZ2UnXHJcbiAgICAgICAgICAgICAgICBdLFxyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246ICczMCBkYXlzJ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBwbGFuc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8vIFN1YnNjcmliZSB0byBhIHBsYW5cclxucm91dGVyLnBvc3QoJy9zdWJzY3JpYmUnLCBwcm90ZWN0LCBhdXRob3JpemUoJ3NlbGxlcicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBwYWNrYWdlOiBwYWNrYWdlTmFtZSwgZHVyYXRpb24gfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICAvLyBWYWxpZGF0ZSBwYWNrYWdlXHJcbiAgICAgICAgY29uc3QgdmFsaWRQYWNrYWdlcyA9IFsnUm95YWwgU3RhbGxpb24nLCAnR2FsbG9wJywgJ1Ryb3QnXTtcclxuICAgICAgICBpZiAoIXZhbGlkUGFja2FnZXMuaW5jbHVkZXMocGFja2FnZU5hbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHBhY2thZ2Ugc2VsZWN0ZWQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIHN1YnNjcmlwdGlvbiB0cmFuc2FjdGlvblxyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gYXdhaXQgVHJhbnNhY3Rpb24uY3JlYXRlKHtcclxuICAgICAgICAgICAgc2VsbGVyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIHR5cGU6ICdzdWJzY3JpcHRpb24nLFxyXG4gICAgICAgICAgICBhbW91bnQ6IHBhY2thZ2VOYW1lID09PSAnUm95YWwgU3RhbGxpb24nID8gOTk5OSA6IFxyXG4gICAgICAgICAgICAgICAgICAgIHBhY2thZ2VOYW1lID09PSAnR2FsbG9wJyA/IDQ5OTkgOiA5OTksXHJcbiAgICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxyXG4gICAgICAgICAgICBzdWJzY3JpcHRpb25EZXRhaWxzOiB7XHJcbiAgICAgICAgICAgICAgICBwYWNrYWdlOiBwYWNrYWdlTmFtZSxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbiB8fCAzMCwgLy8gRGVmYXVsdCB0byAzMCBkYXlzXHJcbiAgICAgICAgICAgICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgICAgICBlbmREYXRlOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgKGR1cmF0aW9uIHx8IDMwKSAqIDI0ICogNjAgKiA2MCAqIDEwMDApXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHNlbGxlciBzdWJzY3JpcHRpb25cclxuICAgICAgICBjb25zdCBzZWxsZXIgPSBhd2FpdCBTZWxsZXIuZmluZE9uZUFuZFVwZGF0ZShcclxuICAgICAgICAgICAgeyB1c2VyOiByZXEudXNlci5faWQgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFja2FnZTogcGFja2FnZU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGVuZERhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgKyAoZHVyYXRpb24gfHwgMzApICogMjQgKiA2MCAqIDYwICogMTAwMCksXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbjogdHJhbnNhY3Rpb24uX2lkXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHsgbmV3OiB0cnVlIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyBMb2cgYWN0aXZpdHlcclxuICAgICAgICBhd2FpdCBBY3Rpdml0eUxvZy5jcmVhdGUoe1xyXG4gICAgICAgICAgICB1c2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIGFjdGlvbjogJ3N1YnNjcmlwdGlvbl9wdXJjaGFzZScsXHJcbiAgICAgICAgICAgIGVudGl0eVR5cGU6ICdzdWJzY3JpcHRpb24nLFxyXG4gICAgICAgICAgICBlbnRpdHlJZDogdHJhbnNhY3Rpb24uX2lkLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYFN1YnNjcmliZWQgdG8gJHtwYWNrYWdlTmFtZX0gcGFja2FnZWAsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uOiBzZWxsZXIuc3Vic2NyaXB0aW9uLFxyXG4gICAgICAgICAgICB0cmFuc2FjdGlvblxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8vIENyZWF0ZSBzZWxsZXIgcHJvZmlsZVxyXG5yb3V0ZXIucG9zdCgnL3Byb2ZpbGUnLCBwcm90ZWN0LCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qgc2VsbGVyID0gYXdhaXQgcmVxLnVzZXIubW9kZWwoJ1NlbGxlcicpLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHVzZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgLi4ucmVxLmJvZHlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHVzZXIgcm9sZSB0byBzZWxsZXJcclxuICAgICAgICByZXEudXNlci5yb2xlID0gJ3NlbGxlcic7XHJcbiAgICAgICAgYXdhaXQgcmVxLnVzZXIuc2F2ZSgpO1xyXG5cclxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHNlbGxlclxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8vIEdldCBzZWxsZXIgcHJvZmlsZVxyXG5yb3V0ZXIuZ2V0KCcvbWUnLCBwcm90ZWN0LCBhdXRob3JpemUoJ3NlbGxlcicpLCBnZXRNZSk7XHJcblxyXG4vLyBVcGRhdGUgc2VsbGVyIHByb2ZpbGVcclxucm91dGVyLnB1dCgnL3Byb2ZpbGUnLCBwcm90ZWN0LCBhdXRob3JpemUoJ3NlbGxlcicpLCB1cGRhdGVQcm9maWxlKTtcclxuXHJcbi8vIEJhbmsgZGV0YWlsc1xyXG5yb3V0ZXIucHV0KCcvYmFuay1kZXRhaWxzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgdXBkYXRlQmFua0RldGFpbHMpO1xyXG5cclxuLy8gUGF5bWVudCBoaXN0b3J5XHJcbnJvdXRlci5nZXQoJy9wYXltZW50cycsIHByb3RlY3QsIGF1dGhvcml6ZSgnc2VsbGVyJyksIGdldFBheW1lbnRIaXN0b3J5KTtcclxuXHJcbi8vIEFuYWx5dGljc1xyXG5yb3V0ZXIuZ2V0KCcvYW5hbHl0aWNzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgZ2V0QW5hbHl0aWNzKTtcclxuXHJcbi8vIExpc3RpbmdzXHJcbnJvdXRlci5nZXQoJy9saXN0aW5ncycsIHByb3RlY3QsIGF1dGhvcml6ZSgnc2VsbGVyJyksIGdldExpc3RpbmdzKTtcclxuXHJcbi8vIElucXVpcmllc1xyXG5yb3V0ZXIuZ2V0KCcvaW5xdWlyaWVzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgZ2V0SW5xdWlyaWVzKTtcclxuXHJcbi8vIFJldmlld3Ncclxucm91dGVyLmdldCgnL3Jldmlld3MnLCBwcm90ZWN0LCBhdXRob3JpemUoJ3NlbGxlcicpLCBnZXRSZXZpZXdzKTtcclxucm91dGVyLnBvc3QoJy9yZXZpZXdzJywgcHJvdGVjdCwgYWRkUmV2aWV3KTtcclxuXHJcbi8vIFN1YnNjcmlwdGlvbiBtYW5hZ2VtZW50XHJcbnJvdXRlci5wdXQoJy9zdWJzY3JpcHRpb24nLCBwcm90ZWN0LCBhdXRob3JpemUoJ3NlbGxlcicpLCB1cGRhdGVTdWJzY3JpcHRpb24pO1xyXG5yb3V0ZXIuZGVsZXRlKCcvc3Vic2NyaXB0aW9uJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgY2FuY2VsU3Vic2NyaXB0aW9uKTtcclxucm91dGVyLmdldCgnL3N1YnNjcmlwdGlvbicsIHByb3RlY3QsIGF1dGhvcml6ZSgnc2VsbGVyJyksIGdldFN1YnNjcmlwdGlvbkRldGFpbHMpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU07RUFBRUMsT0FBTztFQUFFQztBQUFVLENBQUMsR0FBR0osT0FBTyxDQUFDLGdDQUFnQyxDQUFDO0FBQ3hFLE1BQU1LLE1BQU0sR0FBR0wsT0FBTyxDQUFDLGtCQUFrQixDQUFDO0FBQzFDLE1BQU1NLElBQUksR0FBR04sT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU1PLFdBQVcsR0FBR1AsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQ3BELE1BQU1RLFdBQVcsR0FBR1IsT0FBTyxDQUFDLHVCQUF1QixDQUFDO0FBQ3BELE1B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","map":{"version":3,"names":["express","require","router","Router","protect","authorize","Seller","User","Transaction","ActivityLog","validateSubscription","getMe","createProfile","updateProfile","updateBankDetails","getPaymentHistory","getAnalytics","getListings","getInquiries","getReviews","addReview","updateSubscription","cancelSubscription","getSubscriptionDetails","get","req","res","plans","id","name","price","features","duration","json","success","error","console","status","message","post","package","packageName","body","validPackages","includes","transaction","create","seller","user","_id","type","amount","subscriptionDetails","startDate","Date","endDate","now","findOneAndUpdate","subscription","new","action","entityType","entityId","description","model","role","save","put","delete","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["seller.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect, authorize } = require('../middlewares/auth.middleware');\r\nconst Seller = require('../models/Seller');\r\nconst User = require('../models/User');\r\nconst Transaction = require('../models/Transaction');\r\nconst ActivityLog = require('../models/ActivityLog');\r\nconst { validateSubscription } = require('../src/utils/validation');\r\n\r\nconst {\r\n    getMe,\r\n    createProfile,\r\n    updateProfile,\r\n    updateBankDetails,\r\n    getPaymentHistory,\r\n    getAnalytics,\r\n    getListings,\r\n    getInquiries,\r\n    getReviews,\r\n    addReview,\r\n    updateSubscription,\r\n    cancelSubscription,\r\n    getSubscriptionDetails\r\n} = require('../controllers/seller.controller');\r\n\r\n// Get subscription plans\r\nrouter.get('/plans', async (req, res) => {\r\n    try {\r\n        const plans = [\r\n            {\r\n                id: 'starter',\r\n                name: 'Starter',\r\n                price: 0,\r\n                features: [\r\n                    'Up to 2 horse listings',\r\n                    'Basic analytics',\r\n                    'Email support'\r\n                ],\r\n                duration: 'forever'\r\n            },\r\n            {\r\n                id: 'gallop',\r\n                name: 'Gallop',\r\n                price: 4999,\r\n                features: [\r\n                    'Up to 10 horse listings',\r\n                    'Advanced analytics',\r\n                    'Priority email support',\r\n                    'Featured listings',\r\n                    'Social media promotion'\r\n                ],\r\n                duration: '30 days'\r\n            },\r\n            {\r\n                id: 'royal_stallion',\r\n                name: 'Royal Stallion',\r\n                price: 9999,\r\n                features: [\r\n                    'Unlimited horse listings',\r\n                    'Premium analytics',\r\n                    '24/7 priority support',\r\n                    'Featured listings',\r\n                    'Social media promotion',\r\n                    'Custom branding',\r\n                    'Verified seller badge'\r\n                ],\r\n                duration: '30 days'\r\n            }\r\n        ];\r\n\r\n        res.json({\r\n            success: true,\r\n            plans\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// Subscribe to a plan\r\nrouter.post('/subscribe', protect, authorize('seller'), async (req, res) => {\r\n    try {\r\n        const { package: packageName, duration } = req.body;\r\n\r\n        // Validate package\r\n        const validPackages = ['Royal Stallion', 'Gallop', 'Trot'];\r\n        if (!validPackages.includes(packageName)) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: 'Invalid package selected'\r\n            });\r\n        }\r\n\r\n        // Create subscription transaction\r\n        const transaction = await Transaction.create({\r\n            seller: req.user._id,\r\n            type: 'subscription',\r\n            amount: packageName === 'Royal Stallion' ? 9999 : \r\n                    packageName === 'Gallop' ? 4999 : 999,\r\n            status: 'pending',\r\n            subscriptionDetails: {\r\n                package: packageName,\r\n                duration: duration || 30, // Default to 30 days\r\n                startDate: new Date(),\r\n                endDate: new Date(Date.now() + (duration || 30) * 24 * 60 * 60 * 1000)\r\n            }\r\n        });\r\n\r\n        // Update seller subscription\r\n        const seller = await Seller.findOneAndUpdate(\r\n            { user: req.user._id },\r\n            {\r\n                subscription: {\r\n                    package: packageName,\r\n                    startDate: new Date(),\r\n                    endDate: new Date(Date.now() + (duration || 30) * 24 * 60 * 60 * 1000),\r\n                    status: 'active',\r\n                    transaction: transaction._id\r\n                }\r\n            },\r\n            { new: true }\r\n        );\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'subscription_purchase',\r\n            entityType: 'subscription',\r\n            entityId: transaction._id,\r\n            description: `Subscribed to ${packageName} package`,\r\n            status: 'success'\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            subscription: seller.subscription,\r\n            transaction\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// Create seller profile\r\nrouter.post('/profile', protect, async (req, res) => {\r\n    try {\r\n        const seller = await req.user.model('Seller').create({\r\n            user: req.user._id,\r\n            ...req.body\r\n        });\r\n\r\n        // Update user role to seller\r\n        req.user.role = 'seller';\r\n        await req.user.save();\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            seller\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// Get seller profile\r\nrouter.get('/me', protect, authorize('seller'), getMe);\r\n\r\n// Update seller profile\r\nrouter.put('/profile', protect, authorize('seller'), updateProfile);\r\n\r\n// Bank details\r\nrouter.put('/bank-details', protect, authorize('seller'), updateBankDetails);\r\n\r\n// Payment history\r\nrouter.get('/payments', protect, authorize('seller'), getPaymentHistory);\r\n\r\n// Analytics\r\nrouter.get('/analytics', protect, authorize('seller'), getAnalytics);\r\n\r\n// Listings\r\nrouter.get('/listings', protect, authorize('seller'), getListings);\r\n\r\n// Inquiries\r\nrouter.get('/inquiries', protect, authorize('seller'), getInquiries);\r\n\r\n// Reviews\r\nrouter.get('/reviews', protect, authorize('seller'), getReviews);\r\nrouter.post('/reviews', protect, addReview);\r\n\r\n// Subscription management\r\nrouter.put('/subscription', protect, authorize('seller'), updateSubscription);\r\nrouter.delete('/subscription', protect, authorize('seller'), cancelSubscription);\r\nrouter.get('/subscription', protect, authorize('seller'), getSubscriptionDetails);\r\n\r\nmodule.exports = router;"],"mappings":"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","ignoreList":[]}},"mtime":1734042649832},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Transaction.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst transactionSchema = new mongoose.Schema({\n  seller: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Seller',\n    required: true\n  },\n  type: {\n    type: String,\n    enum: ['subscription', 'feature_purchase', 'refund'],\n    required: true\n  },\n  amount: {\n    type: Number,\n    required: true\n  },\n  currency: {\n    type: String,\n    default: 'INR'\n  },\n  status: {\n    type: String,\n    enum: ['pending', 'completed', 'failed', 'refunded'],\n    default: 'pending'\n  },\n  subscriptionDetails: {\n    package: {\n      type: String,\n      enum: ['Royal Stallion', 'Gallop', 'Trot']\n    },\n    duration: Number,\n    // in months\n    startDate: Date,\n    endDate: Date\n  },\n  featureDetails: {\n    type: {\n      type: String,\n      enum: ['spotlight', 'featured_listing', 'virtual_tour']\n    },\n    duration: Number,\n    // in days\n    horseId: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Horse'\n    }\n  },\n  paymentMethod: {\n    type: String,\n    required: function () {\n      return process.env.NODE_ENV !== 'test';\n    },\n    default: function () {\n      return process.env.NODE_ENV === 'test' ? 'test_payment' : undefined;\n    }\n  },\n  razorpayPaymentId: String,\n  razorpayOrderId: String,\n  razorpaySignature: String,\n  razorpayRefundId: String,\n  invoice: {\n    number: String,\n    url: String\n  },\n  refundReason: String\n}, {\n  timestamps: true\n});\nmodule.exports = mongoose.model('Transaction', transactionSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJ0cmFuc2FjdGlvblNjaGVtYSIsIlNjaGVtYSIsInNlbGxlciIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwicmVxdWlyZWQiLCJTdHJpbmciLCJlbnVtIiwiYW1vdW50IiwiTnVtYmVyIiwiY3VycmVuY3kiLCJkZWZhdWx0Iiwic3RhdHVzIiwic3Vic2NyaXB0aW9uRGV0YWlscyIsInBhY2thZ2UiLCJkdXJhdGlvbiIsInN0YXJ0RGF0ZSIsIkRhdGUiLCJlbmREYXRlIiwiZmVhdHVyZURldGFpbHMiLCJob3JzZUlkIiwicGF5bWVudE1ldGhvZCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsInVuZGVmaW5lZCIsInJhem9ycGF5UGF5bWVudElkIiwicmF6b3JwYXlPcmRlcklkIiwicmF6b3JwYXlTaWduYXR1cmUiLCJyYXpvcnBheVJlZnVuZElkIiwiaW52b2ljZSIsIm51bWJlciIsInVybCIsInJlZnVuZFJlYXNvbiIsInRpbWVzdGFtcHMiLCJtb2R1bGUiLCJleHBvcnRzIiwibW9kZWwiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJUcmFuc2FjdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG5jb25zdCB0cmFuc2FjdGlvblNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gICAgc2VsbGVyOiB7XHJcbiAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlZjogJ1NlbGxlcicsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICB0eXBlOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGVudW06IFsnc3Vic2NyaXB0aW9uJywgJ2ZlYXR1cmVfcHVyY2hhc2UnLCAncmVmdW5kJ10sXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBhbW91bnQ6IHtcclxuICAgICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBjdXJyZW5jeToge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBkZWZhdWx0OiAnSU5SJ1xyXG4gICAgfSxcclxuICAgIHN0YXR1czoge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBlbnVtOiBbJ3BlbmRpbmcnLCAnY29tcGxldGVkJywgJ2ZhaWxlZCcsICdyZWZ1bmRlZCddLFxyXG4gICAgICAgIGRlZmF1bHQ6ICdwZW5kaW5nJ1xyXG4gICAgfSxcclxuICAgIHN1YnNjcmlwdGlvbkRldGFpbHM6IHtcclxuICAgICAgICBwYWNrYWdlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgZW51bTogWydSb3lhbCBTdGFsbGlvbicsICdHYWxsb3AnLCAnVHJvdCddXHJcbiAgICAgICAgfSxcclxuICAgICAgICBkdXJhdGlvbjogTnVtYmVyLCAvLyBpbiBtb250aHNcclxuICAgICAgICBzdGFydERhdGU6IERhdGUsXHJcbiAgICAgICAgZW5kRGF0ZTogRGF0ZVxyXG4gICAgfSxcclxuICAgIGZlYXR1cmVEZXRhaWxzOiB7XHJcbiAgICAgICAgdHlwZToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGVudW06IFsnc3BvdGxpZ2h0JywgJ2ZlYXR1cmVkX2xpc3RpbmcnLCAndmlydHVhbF90b3VyJ11cclxuICAgICAgICB9LFxyXG4gICAgICAgIGR1cmF0aW9uOiBOdW1iZXIsIC8vIGluIGRheXNcclxuICAgICAgICBob3JzZUlkOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICAgICAgcmVmOiAnSG9yc2UnXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHBheW1lbnRNZXRob2Q6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgcmVxdWlyZWQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0JztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyA/ICd0ZXN0X3BheW1lbnQnIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICByYXpvcnBheVBheW1lbnRJZDogU3RyaW5nLFxyXG4gICAgcmF6b3JwYXlPcmRlcklkOiBTdHJpbmcsXHJcbiAgICByYXpvcnBheVNpZ25hdHVyZTogU3RyaW5nLFxyXG4gICAgcmF6b3JwYXlSZWZ1bmRJZDogU3RyaW5nLFxyXG4gICAgaW52b2ljZToge1xyXG4gICAgICAgIG51bWJlcjogU3RyaW5nLFxyXG4gICAgICAgIHVybDogU3RyaW5nXHJcbiAgICB9LFxyXG4gICAgcmVmdW5kUmVhc29uOiBTdHJpbmdcclxufSwge1xyXG4gICAgdGltZXN0YW1wczogdHJ1ZVxyXG59KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ1RyYW5zYWN0aW9uJywgdHJhbnNhY3Rpb25TY2hlbWEpOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUVwQyxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUMxQ0MsTUFBTSxFQUFFO0lBQ0pDLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNHLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFLFFBQVE7SUFDYkMsUUFBUSxFQUFFO0VBQ2QsQ0FBQztFQUNESixJQUFJLEVBQUU7SUFDRkEsSUFBSSxFQUFFSyxNQUFNO0lBQ1pDLElBQUksRUFBRSxDQUFDLGNBQWMsRUFBRSxrQkFBa0IsRUFBRSxRQUFRLENBQUM7SUFDcERGLFFBQVEsRUFBRTtFQUNkLENBQUM7RUFDREcsTUFBTSxFQUFFO0lBQ0pQLElBQUksRUFBRVEsTUFBTTtJQUNaSixRQUFRLEVBQUU7RUFDZCxDQUFDO0VBQ0RLLFFBQVEsRUFBRTtJQUNOVCxJQUFJLEVBQUVLLE1BQU07SUFDWkssT0FBTyxFQUFFO0VBQ2IsQ0FBQztFQUNEQyxNQUFNLEVBQUU7SUFDSlgsSUFBSSxFQUFFSyxNQUFNO0lBQ1pDLElBQUksRUFBRSxDQUFDLFNBQVMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLFVBQVUsQ0FBQztJQUNwREksT0FBTyxFQUFFO0VBQ2IsQ0FBQztFQUNERSxtQkFBbUIsRUFBRTtJQUNqQkMsT0FBTyxFQUFFO01BQ0xiLElBQUksRUFBRUssTUFBTTtNQUNaQyxJQUFJLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxRQUFRLEVBQUUsTUFBTTtJQUM3QyxDQUFDO0lBQ0RRLFFBQVEsRUFBRU4sTUFBTTtJQUFFO0lBQ2xCTyxTQUFTLEVBQUVDLElBQUk7SUFDZkMsT0FBTyxFQUFFRDtFQUNiLENBQUM7RUFDREUsY0FBYyxFQUFFO0lBQ1psQixJQUFJLEVBQUU7TUFDRkEsSUFBSSxFQUFFSyxNQUFNO01BQ1pDLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxrQkFBa0IsRUFBRSxjQUFjO0lBQzFELENBQUM7SUFDRFEsUUFBUSxFQUFFTixNQUFNO0lBQUU7SUFDbEJXLE9BQU8sRUFBRTtNQUNMbkIsSUFBSSxFQUFFTCxRQUFRLENBQUNHLE1BQU0sQ0FBQ0csS0FBSyxDQUFDQyxRQUFRO01BQ3BDQyxHQUFHLEVBQUU7SUFDVDtFQUNKLENBQUM7RUFDRGlCLGFBQWEsRUFBRTtJQUNYcEIsSUFBSSxFQUFFSyxNQUFNO0lBQ1pELFFBQVEsRUFBRSxTQUFBQSxDQUFBLEVBQVc7TUFDakIsT0FBT2lCLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLEtBQUssTUFBTTtJQUMxQyxDQUFDO0lBQ0RiLE9BQU8sRUFBRSxTQUFBQSxDQUFBLEVBQVc7TUFDaEIsT0FBT1csT0FBTyxDQUFDQyxHQUFHLENBQUNDLFFBQVEsS0FBSyxNQUFNLEdBQUcsY0FBYyxHQUFHQyxTQUFTO0lBQ3ZFO0VBQ0osQ0FBQztFQUNEQyxpQkFBaUIsRUFBRXBCLE1BQU07RUFDekJxQixlQUFlLEVBQUVyQixNQUFNO0VBQ3ZCc0IsaUJBQWlCLEVBQUV0QixNQUFNO0VBQ3pCdUIsZ0JBQWdCLEVBQUV2QixNQUFNO0VBQ3hCd0IsT0FBTyxFQUFFO0lBQ0xDLE1BQU0sRUFBRXpCLE1BQU07SUFDZDBCLEdBQUcsRUFBRTFCO0VBQ1QsQ0FBQztFQUNEMkIsWUFBWSxFQUFFM0I7QUFDbEIsQ0FBQyxFQUFFO0VBQ0M0QixVQUFVLEVBQUU7QUFDaEIsQ0FBQyxDQUFDO0FBRUZDLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHeEMsUUFBUSxDQUFDeUMsS0FBSyxDQUFDLGFBQWEsRUFBRXZDLGlCQUFpQixDQUFDIiwiaWdub3JlTGlzdCI6W119","map":{"version":3,"names":["mongoose","require","transactionSchema","Schema","seller","type","Types","ObjectId","ref","required","String","enum","amount","Number","currency","default","status","subscriptionDetails","package","duration","startDate","Date","endDate","featureDetails","horseId","paymentMethod","process","env","NODE_ENV","undefined","razorpayPaymentId","razorpayOrderId","razorpaySignature","razorpayRefundId","invoice","number","url","refundReason","timestamps","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Transaction.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst transactionSchema = new mongoose.Schema({\r\n    seller: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Seller',\r\n        required: true\r\n    },\r\n    type: {\r\n        type: String,\r\n        enum: ['subscription', 'feature_purchase', 'refund'],\r\n        required: true\r\n    },\r\n    amount: {\r\n        type: Number,\r\n        required: true\r\n    },\r\n    currency: {\r\n        type: String,\r\n        default: 'INR'\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['pending', 'completed', 'failed', 'refunded'],\r\n        default: 'pending'\r\n    },\r\n    subscriptionDetails: {\r\n        package: {\r\n            type: String,\r\n            enum: ['Royal Stallion', 'Gallop', 'Trot']\r\n        },\r\n        duration: Number, // in months\r\n        startDate: Date,\r\n        endDate: Date\r\n    },\r\n    featureDetails: {\r\n        type: {\r\n            type: String,\r\n            enum: ['spotlight', 'featured_listing', 'virtual_tour']\r\n        },\r\n        duration: Number, // in days\r\n        horseId: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'Horse'\r\n        }\r\n    },\r\n    paymentMethod: {\r\n        type: String,\r\n        required: function() {\r\n            return process.env.NODE_ENV !== 'test';\r\n        },\r\n        default: function() {\r\n            return process.env.NODE_ENV === 'test' ? 'test_payment' : undefined;\r\n        }\r\n    },\r\n    razorpayPaymentId: String,\r\n    razorpayOrderId: String,\r\n    razorpaySignature: String,\r\n    razorpayRefundId: String,\r\n    invoice: {\r\n        number: String,\r\n        url: String\r\n    },\r\n    refundReason: String\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\nmodule.exports = mongoose.model('Transaction', transactionSchema); "],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,iBAAiB,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EAC1CC,MAAM,EAAE;IACJC,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,QAAQ;IACbC,QAAQ,EAAE;EACd,CAAC;EACDJ,IAAI,EAAE;IACFA,IAAI,EAAEK,MAAM;IACZC,IAAI,EAAE,CAAC,cAAc,EAAE,kBAAkB,EAAE,QAAQ,CAAC;IACpDF,QAAQ,EAAE;EACd,CAAC;EACDG,MAAM,EAAE;IACJP,IAAI,EAAEQ,MAAM;IACZJ,QAAQ,EAAE;EACd,CAAC;EACDK,QAAQ,EAAE;IACNT,IAAI,EAAEK,MAAM;IACZK,OAAO,EAAE;EACb,CAAC;EACDC,MAAM,EAAE;IACJX,IAAI,EAAEK,MAAM;IACZC,IAAI,EAAE,CAAC,SAAS,EAAE,WAAW,EAAE,QAAQ,EAAE,UAAU,CAAC;IACpDI,OAAO,EAAE;EACb,CAAC;EACDE,mBAAmB,EAAE;IACjBC,OAAO,EAAE;MACLb,IAAI,EAAEK,MAAM;MACZC,IAAI,EAAE,CAAC,gBAAgB,EAAE,QAAQ,EAAE,MAAM;IAC7C,CAAC;IACDQ,QAAQ,EAAEN,MAAM;IAAE;IAClBO,SAAS,EAAEC,IAAI;IACfC,OAAO,EAAED;EACb,CAAC;EACDE,cAAc,EAAE;IACZlB,IAAI,EAAE;MACFA,IAAI,EAAEK,MAAM;MACZC,IAAI,EAAE,CAAC,WAAW,EAAE,kBAAkB,EAAE,cAAc;IAC1D,CAAC;IACDQ,QAAQ,EAAEN,MAAM;IAAE;IAClBW,OAAO,EAAE;MACLnB,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;MACpCC,GAAG,EAAE;IACT;EACJ,CAAC;EACDiB,aAAa,EAAE;IACXpB,IAAI,EAAEK,MAAM;IACZD,QAAQ,EAAE,SAAAA,CAAA,EAAW;MACjB,OAAOiB,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,MAAM;IAC1C,CAAC;IACDb,OAAO,EAAE,SAAAA,CAAA,EAAW;MAChB,OAAOW,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,MAAM,GAAG,cAAc,GAAGC,SAAS;IACvE;EACJ,CAAC;EACDC,iBAAiB,EAAEpB,MAAM;EACzBqB,eAAe,EAAErB,MAAM;EACvBsB,iBAAiB,EAAEtB,MAAM;EACzBuB,gBAAgB,EAAEvB,MAAM;EACxBwB,OAAO,EAAE;IACLC,MAAM,EAAEzB,MAAM;IACd0B,GAAG,EAAE1B;EACT,CAAC;EACD2B,YAAY,EAAE3B;AAClB,CAAC,EAAE;EACC4B,UAAU,EAAE;AAChB,CAAC,CAAC;AAEFC,MAAM,CAACC,OAAO,GAAGxC,QAAQ,CAACyC,KAAK,CAAC,aAAa,EAAEvC,iBAAiB,CAAC","ignoreList":[]}},"mtime":1734043033968},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\src\\\\utils\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\src\\\\utils\\\\validation.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const validateSubscription = subscription => {\n  // Validate subscription package\n  const validPackages = ['Royal Stallion', 'Gallop', 'Trot'];\n  if (!validPackages.includes(subscription.package)) {\n    throw new Error('Invalid subscription package');\n  }\n\n  // Validate subscription status\n  const validStatuses = ['active', 'expired', 'cancelled'];\n  if (!validStatuses.includes(subscription.status)) {\n    throw new Error('Invalid subscription status');\n  }\n\n  // Validate dates\n  if (!(subscription.startDate instanceof Date)) {\n    throw new Error('Invalid start date');\n  }\n  if (!(subscription.endDate instanceof Date)) {\n    throw new Error('Invalid end date');\n  }\n  if (subscription.endDate < subscription.startDate) {\n    throw new Error('End date cannot be before start date');\n  }\n  return true;\n};\nmodule.exports = {\n  validateSubscription\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ2YWxpZGF0ZVN1YnNjcmlwdGlvbiIsInN1YnNjcmlwdGlvbiIsInZhbGlkUGFja2FnZXMiLCJpbmNsdWRlcyIsInBhY2thZ2UiLCJFcnJvciIsInZhbGlkU3RhdHVzZXMiLCJzdGF0dXMiLCJzdGFydERhdGUiLCJEYXRlIiwiZW5kRGF0ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXHNyY1xcdXRpbHNcXCIsInNvdXJjZXMiOlsidmFsaWRhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB2YWxpZGF0ZVN1YnNjcmlwdGlvbiA9IChzdWJzY3JpcHRpb24pID0+IHtcclxuICAgIC8vIFZhbGlkYXRlIHN1YnNjcmlwdGlvbiBwYWNrYWdlXHJcbiAgICBjb25zdCB2YWxpZFBhY2thZ2VzID0gWydSb3lhbCBTdGFsbGlvbicsICdHYWxsb3AnLCAnVHJvdCddO1xyXG4gICAgaWYgKCF2YWxpZFBhY2thZ2VzLmluY2x1ZGVzKHN1YnNjcmlwdGlvbi5wYWNrYWdlKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBzdWJzY3JpcHRpb24gcGFja2FnZScpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFZhbGlkYXRlIHN1YnNjcmlwdGlvbiBzdGF0dXNcclxuICAgIGNvbnN0IHZhbGlkU3RhdHVzZXMgPSBbJ2FjdGl2ZScsICdleHBpcmVkJywgJ2NhbmNlbGxlZCddO1xyXG4gICAgaWYgKCF2YWxpZFN0YXR1c2VzLmluY2x1ZGVzKHN1YnNjcmlwdGlvbi5zdGF0dXMpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHN1YnNjcmlwdGlvbiBzdGF0dXMnKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBWYWxpZGF0ZSBkYXRlc1xyXG4gICAgaWYgKCEoc3Vic2NyaXB0aW9uLnN0YXJ0RGF0ZSBpbnN0YW5jZW9mIERhdGUpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHN0YXJ0IGRhdGUnKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIShzdWJzY3JpcHRpb24uZW5kRGF0ZSBpbnN0YW5jZW9mIERhdGUpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVuZCBkYXRlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHN1YnNjcmlwdGlvbi5lbmREYXRlIDwgc3Vic2NyaXB0aW9uLnN0YXJ0RGF0ZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRW5kIGRhdGUgY2Fubm90IGJlIGJlZm9yZSBzdGFydCBkYXRlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRydWU7XHJcbn07XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHtcclxuICAgIHZhbGlkYXRlU3Vic2NyaXB0aW9uXHJcbn07ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsb0JBQW9CLEdBQUlDLFlBQVksSUFBSztFQUMzQztFQUNBLE1BQU1DLGFBQWEsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUM7RUFDMUQsSUFBSSxDQUFDQSxhQUFhLENBQUNDLFFBQVEsQ0FBQ0YsWUFBWSxDQUFDRyxPQUFPLENBQUMsRUFBRTtJQUMvQyxNQUFNLElBQUlDLEtBQUssQ0FBQyw4QkFBOEIsQ0FBQztFQUNuRDs7RUFFQTtFQUNBLE1BQU1DLGFBQWEsR0FBRyxDQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUUsV0FBVyxDQUFDO0VBQ3hELElBQUksQ0FBQ0EsYUFBYSxDQUFDSCxRQUFRLENBQUNGLFlBQVksQ0FBQ00sTUFBTSxDQUFDLEVBQUU7SUFDOUMsTUFBTSxJQUFJRixLQUFLLENBQUMsNkJBQTZCLENBQUM7RUFDbEQ7O0VBRUE7RUFDQSxJQUFJLEVBQUVKLFlBQVksQ0FBQ08sU0FBUyxZQUFZQyxJQUFJLENBQUMsRUFBRTtJQUMzQyxNQUFNLElBQUlKLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQztFQUN6QztFQUVBLElBQUksRUFBRUosWUFBWSxDQUFDUyxPQUFPLFlBQVlELElBQUksQ0FBQyxFQUFFO0lBQ3pDLE1BQU0sSUFBSUosS0FBSyxDQUFDLGtCQUFrQixDQUFDO0VBQ3ZDO0VBRUEsSUFBSUosWUFBWSxDQUFDUyxPQUFPLEdBQUdULFlBQVksQ0FBQ08sU0FBUyxFQUFFO0lBQy9DLE1BQU0sSUFBSUgsS0FBSyxDQUFDLHNDQUFzQyxDQUFDO0VBQzNEO0VBRUEsT0FBTyxJQUFJO0FBQ2YsQ0FBQztBQUVETSxNQUFNLENBQUNDLE9BQU8sR0FBRztFQUNiWjtBQUNKLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["validateSubscription","subscription","validPackages","includes","package","Error","validStatuses","status","startDate","Date","endDate","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\src\\utils\\","sources":["validation.js"],"sourcesContent":["const validateSubscription = (subscription) => {\r\n    // Validate subscription package\r\n    const validPackages = ['Royal Stallion', 'Gallop', 'Trot'];\r\n    if (!validPackages.includes(subscription.package)) {\r\n        throw new Error('Invalid subscription package');\r\n    }\r\n\r\n    // Validate subscription status\r\n    const validStatuses = ['active', 'expired', 'cancelled'];\r\n    if (!validStatuses.includes(subscription.status)) {\r\n        throw new Error('Invalid subscription status');\r\n    }\r\n\r\n    // Validate dates\r\n    if (!(subscription.startDate instanceof Date)) {\r\n        throw new Error('Invalid start date');\r\n    }\r\n\r\n    if (!(subscription.endDate instanceof Date)) {\r\n        throw new Error('Invalid end date');\r\n    }\r\n\r\n    if (subscription.endDate < subscription.startDate) {\r\n        throw new Error('End date cannot be before start date');\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\nmodule.exports = {\r\n    validateSubscription\r\n}; "],"mappings":"AAAA,MAAMA,oBAAoB,GAAIC,YAAY,IAAK;EAC3C;EACA,MAAMC,aAAa,GAAG,CAAC,gBAAgB,EAAE,QAAQ,EAAE,MAAM,CAAC;EAC1D,IAAI,CAACA,aAAa,CAACC,QAAQ,CAACF,YAAY,CAACG,OAAO,CAAC,EAAE;IAC/C,MAAM,IAAIC,KAAK,CAAC,8BAA8B,CAAC;EACnD;;EAEA;EACA,MAAMC,aAAa,GAAG,CAAC,QAAQ,EAAE,SAAS,EAAE,WAAW,CAAC;EACxD,IAAI,CAACA,aAAa,CAACH,QAAQ,CAACF,YAAY,CAACM,MAAM,CAAC,EAAE;IAC9C,MAAM,IAAIF,KAAK,CAAC,6BAA6B,CAAC;EAClD;;EAEA;EACA,IAAI,EAAEJ,YAAY,CAACO,SAAS,YAAYC,IAAI,CAAC,EAAE;IAC3C,MAAM,IAAIJ,KAAK,CAAC,oBAAoB,CAAC;EACzC;EAEA,IAAI,EAAEJ,YAAY,CAACS,OAAO,YAAYD,IAAI,CAAC,EAAE;IACzC,MAAM,IAAIJ,KAAK,CAAC,kBAAkB,CAAC;EACvC;EAEA,IAAIJ,YAAY,CAACS,OAAO,GAAGT,YAAY,CAACO,SAAS,EAAE;IAC/C,MAAM,IAAIH,KAAK,CAAC,sCAAsC,CAAC;EAC3D;EAEA,OAAO,IAAI;AACf,CAAC;AAEDM,MAAM,CAACC,OAAO,GAAG;EACbZ;AACJ,CAAC","ignoreList":[]}},"mtime":1734042636513},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\seller.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const User = require('../models/User');\nconst Seller = require('../models/Seller');\nconst Horse = require('../models/Horse');\nconst Inquiry = require('../models/Inquiry');\nconst Transaction = require('../models/Transaction');\n\n// @desc    Create seller profile\n// @route   POST /api/sellers/profile\n// @access  Private (User)\nexports.createProfile = async (req, res) => {\n  try {\n    // Check if seller profile already exists\n    let seller = await Seller.findOne({\n      user: req.user._id\n    });\n    if (seller) {\n      return res.status(400).json({\n        success: false,\n        message: 'Seller profile already exists'\n      });\n    }\n\n    // Create seller profile with Starter package\n    seller = await Seller.create({\n      user: req.user._id,\n      businessName: req.body.businessName,\n      description: req.body.description,\n      subscription: {\n        package: 'Starter',\n        status: 'active',\n        startDate: new Date(),\n        endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000),\n        // 1 year\n        features: {\n          maxListings: 1,\n          maxPhotos: 3,\n          commission: 6,\n          searchPlacement: 'basic',\n          paymentOptions: ['platform'],\n          customAgreements: false,\n          boostFeatures: false,\n          homepageVisibility: false,\n          badges: [],\n          spotlightRemaining: 0,\n          boostRemaining: 0\n        }\n      }\n    });\n\n    // Update user role to seller\n    req.user.role = 'seller';\n    await req.user.save();\n    res.status(201).json({\n      success: true,\n      seller\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get current seller profile\n// @route   GET /api/sellers/me\n// @access  Private (Seller)\nexports.getMe = async (req, res) => {\n  try {\n    const seller = await Seller.findOne({\n      user: req.user._id\n    });\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller profile not found'\n      });\n    }\n    res.json({\n      success: true,\n      seller\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Update seller profile\n// @route   PUT /api/sellers/profile\n// @access  Private (Seller)\nexports.updateProfile = async (req, res) => {\n  try {\n    const seller = await Seller.findOneAndUpdate({\n      user: req.user._id\n    }, {\n      businessName: req.body.businessName,\n      description: req.body.description,\n      contactInfo: req.body.contactInfo,\n      socialMedia: req.body.socialMedia\n    }, {\n      new: true,\n      runValidators: true\n    });\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller profile not found'\n      });\n    }\n    res.json({\n      success: true,\n      seller\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Update bank details\n// @route   PUT /api/sellers/bank-details\n// @access  Private (Seller)\nexports.updateBankDetails = async (req, res) => {\n  try {\n    const seller = await Seller.findOneAndUpdate({\n      user: req.user._id\n    }, {\n      bankDetails: req.body\n    }, {\n      new: true,\n      runValidators: true\n    });\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller profile not found'\n      });\n    }\n    res.json({\n      success: true,\n      seller\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get payment history\n// @route   GET /api/sellers/payments\n// @access  Private (Seller)\nexports.getPaymentHistory = async (req, res) => {\n  try {\n    const transactions = await Transaction.find({\n      seller: req.seller._id\n    }).sort('-createdAt');\n    res.json({\n      success: true,\n      transactions\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller analytics\n// @route   GET /api/sellers/analytics\n// @access  Private (Seller)\nexports.getAnalytics = async (req, res) => {\n  try {\n    // Get basic analytics\n    const analytics = {\n      totalListings: await Horse.countDocuments({\n        seller: req.seller._id\n      }),\n      activeListings: await Horse.countDocuments({\n        seller: req.seller._id,\n        status: 'active'\n      }),\n      totalInquiries: await Inquiry.countDocuments({\n        seller: req.seller._id\n      }),\n      totalTransactions: await Transaction.countDocuments({\n        seller: req.seller._id\n      }),\n      revenue: await Transaction.aggregate([{\n        $match: {\n          seller: req.seller._id,\n          status: 'completed'\n        }\n      }, {\n        $group: {\n          _id: null,\n          total: {\n            $sum: '$amount'\n          }\n        }\n      }])\n    };\n    res.json({\n      success: true,\n      analytics\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller listings\n// @route   GET /api/sellers/listings\n// @access  Private (Seller)\nexports.getListings = async (req, res) => {\n  try {\n    const listings = await Horse.find({\n      seller: req.seller._id\n    }).sort('-createdAt');\n    res.json({\n      success: true,\n      listings\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller inquiries\n// @route   GET /api/sellers/inquiries\n// @access  Private (Seller)\nexports.getInquiries = async (req, res) => {\n  try {\n    const inquiries = await Inquiry.find({\n      seller: req.seller._id\n    }).populate('user', 'name email').populate('horse', 'name').sort('-createdAt');\n    res.json({\n      success: true,\n      inquiries\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller reviews\n// @route   GET /api/sellers/reviews\n// @access  Private (Seller)\nexports.getReviews = async (req, res) => {\n  try {\n    const seller = await Seller.findById(req.seller._id).populate('reviews.user', 'name');\n    res.json({\n      success: true,\n      reviews: seller.reviews\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Add review for seller\n// @route   POST /api/sellers/reviews\n// @access  Private\nexports.addReview = async (req, res) => {\n  try {\n    const {\n      rating,\n      comment\n    } = req.body;\n    const seller = await Seller.findById(req.params.id);\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller not found'\n      });\n    }\n    const review = {\n      user: req.user._id,\n      rating,\n      comment,\n      date: Date.now()\n    };\n    seller.reviews.push(review);\n\n    // Update average rating\n    const totalRating = seller.reviews.reduce((sum, item) => sum + item.rating, 0);\n    seller.rating = totalRating / seller.reviews.length;\n    await seller.save();\n    res.json({\n      success: true,\n      review\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Update subscription\n// @route   PUT /api/sellers/subscription\n// @access  Private (Seller)\nexports.updateSubscription = async (req, res) => {\n  try {\n    const {\n      subscriptionPackage\n    } = req.body;\n    let features;\n    switch (subscriptionPackage) {\n      case 'Royal Stallion':\n        features = {\n          listingLimit: 50,\n          photosPerListing: 30,\n          videosPerListing: 5,\n          featuredListings: true,\n          virtualTours: true,\n          analytics: true,\n          support: '24/7'\n        };\n        break;\n      case 'Gallop':\n        features = {\n          listingLimit: 25,\n          photosPerListing: 20,\n          videosPerListing: 3,\n          featuredListings: true,\n          virtualTours: false,\n          analytics: true,\n          support: 'business hours'\n        };\n        break;\n      case 'Trot':\n        features = {\n          listingLimit: 10,\n          photosPerListing: 10,\n          videosPerListing: 1,\n          featuredListings: false,\n          virtualTours: false,\n          analytics: false,\n          support: 'email'\n        };\n        break;\n      default:\n        return res.status(400).json({\n          success: false,\n          message: 'Invalid subscription package'\n        });\n    }\n    const seller = await Seller.findById(req.seller._id);\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller not found'\n      });\n    }\n    seller.subscription = {\n      package: subscriptionPackage,\n      features,\n      startDate: new Date(),\n      endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000),\n      // 30 days\n      status: 'active'\n    };\n    await seller.save();\n    res.json({\n      success: true,\n      subscription: seller.subscription\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Cancel subscription\n// @route   DELETE /api/sellers/subscription\n// @access  Private (Seller)\nexports.cancelSubscription = async (req, res) => {\n  try {\n    const seller = await Seller.findOneAndUpdate({\n      user: req.user._id\n    }, {\n      subscription: {\n        package: 'Starter',\n        status: 'active',\n        startDate: new Date(),\n        endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000),\n        // 1 year\n        features: {\n          maxListings: 1,\n          maxPhotos: 3,\n          commission: 6,\n          searchPlacement: 'basic',\n          paymentOptions: ['platform'],\n          customAgreements: false,\n          boostFeatures: false,\n          homepageVisibility: false,\n          badges: [],\n          spotlightRemaining: 0,\n          boostRemaining: 0\n        }\n      }\n    }, {\n      new: true\n    });\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller profile not found'\n      });\n    }\n    res.json({\n      success: true,\n      seller\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get subscription details\n// @route   GET /api/sellers/subscription\n// @access  Private (Seller)\nexports.getSubscriptionDetails = async (req, res) => {\n  try {\n    const seller = await Seller.findOne({\n      user: req.user._id\n    }).select('subscription');\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller profile not found'\n      });\n    }\n    res.json({\n      success: true,\n      subscription: seller.subscription\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVc2VyIiwicmVxdWlyZSIsIlNlbGxlciIsIkhvcnNlIiwiSW5xdWlyeSIsIlRyYW5zYWN0aW9uIiwiZXhwb3J0cyIsImNyZWF0ZVByb2ZpbGUiLCJyZXEiLCJyZXMiLCJzZWxsZXIiLCJmaW5kT25lIiwidXNlciIsIl9pZCIsInN0YXR1cyIsImpzb24iLCJzdWNjZXNzIiwibWVzc2FnZSIsImNyZWF0ZSIsImJ1c2luZXNzTmFtZSIsImJvZHkiLCJkZXNjcmlwdGlvbiIsInN1YnNjcmlwdGlvbiIsInBhY2thZ2UiLCJzdGFydERhdGUiLCJEYXRlIiwiZW5kRGF0ZSIsIm5vdyIsImZlYXR1cmVzIiwibWF4TGlzdGluZ3MiLCJtYXhQaG90b3MiLCJjb21taXNzaW9uIiwic2VhcmNoUGxhY2VtZW50IiwicGF5bWVudE9wdGlvbnMiLCJjdXN0b21BZ3JlZW1lbnRzIiwiYm9vc3RGZWF0dXJlcyIsImhvbWVwYWdlVmlzaWJpbGl0eSIsImJhZGdlcyIsInNwb3RsaWdodFJlbWFpbmluZyIsImJvb3N0UmVtYWluaW5nIiwicm9sZSIsInNhdmUiLCJlcnJvciIsImNvbnNvbGUiLCJnZXRNZSIsInVwZGF0ZVByb2ZpbGUiLCJmaW5kT25lQW5kVXBkYXRlIiwiY29udGFjdEluZm8iLCJzb2NpYWxNZWRpYSIsIm5ldyIsInJ1blZhbGlkYXRvcnMiLCJ1cGRhdGVCYW5rRGV0YWlscyIsImJhbmtEZXRhaWxzIiwiZ2V0UGF5bWVudEhpc3RvcnkiLCJ0cmFuc2FjdGlvbnMiLCJmaW5kIiwic29ydCIsImdldEFuYWx5dGljcyIsImFuYWx5dGljcyIsInRvdGFsTGlzdGluZ3MiLCJjb3VudERvY3VtZW50cyIsImFjdGl2ZUxpc3RpbmdzIiwidG90YWxJbnF1aXJpZXMiLCJ0b3RhbFRyYW5zYWN0aW9ucyIsInJldmVudWUiLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCIkZ3JvdXAiLCJ0b3RhbCIsIiRzdW0iLCJnZXRMaXN0aW5ncyIsImxpc3RpbmdzIiwiZ2V0SW5xdWlyaWVzIiwiaW5xdWlyaWVzIiwicG9wdWxhdGUiLCJnZXRSZXZpZXdzIiwiZmluZEJ5SWQiLCJyZXZpZXdzIiwiYWRkUmV2aWV3IiwicmF0aW5nIiwiY29tbWVudCIsInBhcmFtcyIsImlkIiwicmV2aWV3IiwiZGF0ZSIsInB1c2giLCJ0b3RhbFJhdGluZyIsInJlZHVjZSIsInN1bSIsIml0ZW0iLCJsZW5ndGgiLCJ1cGRhdGVTdWJzY3JpcHRpb24iLCJzdWJzY3JpcHRpb25QYWNrYWdlIiwibGlzdGluZ0xpbWl0IiwicGhvdG9zUGVyTGlzdGluZyIsInZpZGVvc1Blckxpc3RpbmciLCJmZWF0dXJlZExpc3RpbmdzIiwidmlydHVhbFRvdXJzIiwic3VwcG9ydCIsImNhbmNlbFN1YnNjcmlwdGlvbiIsImdldFN1YnNjcmlwdGlvbkRldGFpbHMiLCJzZWxlY3QiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXGNvbnRyb2xsZXJzXFwiLCJzb3VyY2VzIjpbInNlbGxlci5jb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xyXG5jb25zdCBTZWxsZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvU2VsbGVyJyk7XHJcbmNvbnN0IEhvcnNlID0gcmVxdWlyZSgnLi4vbW9kZWxzL0hvcnNlJyk7XHJcbmNvbnN0IElucXVpcnkgPSByZXF1aXJlKCcuLi9tb2RlbHMvSW5xdWlyeScpO1xyXG5jb25zdCBUcmFuc2FjdGlvbiA9IHJlcXVpcmUoJy4uL21vZGVscy9UcmFuc2FjdGlvbicpO1xyXG5cclxuLy8gQGRlc2MgICAgQ3JlYXRlIHNlbGxlciBwcm9maWxlXHJcbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9zZWxsZXJzL3Byb2ZpbGVcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoVXNlcilcclxuZXhwb3J0cy5jcmVhdGVQcm9maWxlID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIENoZWNrIGlmIHNlbGxlciBwcm9maWxlIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgICAgbGV0IHNlbGxlciA9IGF3YWl0IFNlbGxlci5maW5kT25lKHsgdXNlcjogcmVxLnVzZXIuX2lkIH0pO1xyXG4gICAgICAgIGlmIChzZWxsZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1NlbGxlciBwcm9maWxlIGFscmVhZHkgZXhpc3RzJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBzZWxsZXIgcHJvZmlsZSB3aXRoIFN0YXJ0ZXIgcGFja2FnZVxyXG4gICAgICAgIHNlbGxlciA9IGF3YWl0IFNlbGxlci5jcmVhdGUoe1xyXG4gICAgICAgICAgICB1c2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIGJ1c2luZXNzTmFtZTogcmVxLmJvZHkuYnVzaW5lc3NOYW1lLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogcmVxLmJvZHkuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgcGFja2FnZTogJ1N0YXJ0ZXInLFxyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcclxuICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgICAgIGVuZERhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzNjUgKiAyNCAqIDYwICogNjAgKiAxMDAwKSwgLy8gMSB5ZWFyXHJcbiAgICAgICAgICAgICAgICBmZWF0dXJlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIG1heExpc3RpbmdzOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIG1heFBob3RvczogMyxcclxuICAgICAgICAgICAgICAgICAgICBjb21taXNzaW9uOiA2LFxyXG4gICAgICAgICAgICAgICAgICAgIHNlYXJjaFBsYWNlbWVudDogJ2Jhc2ljJyxcclxuICAgICAgICAgICAgICAgICAgICBwYXltZW50T3B0aW9uczogWydwbGF0Zm9ybSddLFxyXG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbUFncmVlbWVudHM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGJvb3N0RmVhdHVyZXM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGhvbWVwYWdlVmlzaWJpbGl0eTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgYmFkZ2VzOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICBzcG90bGlnaHRSZW1haW5pbmc6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgYm9vc3RSZW1haW5pbmc6IDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBVcGRhdGUgdXNlciByb2xlIHRvIHNlbGxlclxyXG4gICAgICAgIHJlcS51c2VyLnJvbGUgPSAnc2VsbGVyJztcclxuICAgICAgICBhd2FpdCByZXEudXNlci5zYXZlKCk7XHJcblxyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgc2VsbGVyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgY3VycmVudCBzZWxsZXIgcHJvZmlsZVxyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zZWxsZXJzL21lXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlcilcclxuZXhwb3J0cy5nZXRNZSA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzZWxsZXIgPSBhd2FpdCBTZWxsZXIuZmluZE9uZSh7IHVzZXI6IHJlcS51c2VyLl9pZCB9KTtcclxuICAgICAgICBpZiAoIXNlbGxlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU2VsbGVyIHByb2ZpbGUgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgc2VsbGVyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBVcGRhdGUgc2VsbGVyIHByb2ZpbGVcclxuLy8gQHJvdXRlICAgUFVUIC9hcGkvc2VsbGVycy9wcm9maWxlXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlcilcclxuZXhwb3J0cy51cGRhdGVQcm9maWxlID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHNlbGxlciA9IGF3YWl0IFNlbGxlci5maW5kT25lQW5kVXBkYXRlKFxyXG4gICAgICAgICAgICB7IHVzZXI6IHJlcS51c2VyLl9pZCB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBidXNpbmVzc05hbWU6IHJlcS5ib2R5LmJ1c2luZXNzTmFtZSxcclxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiByZXEuYm9keS5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICAgIGNvbnRhY3RJbmZvOiByZXEuYm9keS5jb250YWN0SW5mbyxcclxuICAgICAgICAgICAgICAgIHNvY2lhbE1lZGlhOiByZXEuYm9keS5zb2NpYWxNZWRpYVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgaWYgKCFzZWxsZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1NlbGxlciBwcm9maWxlIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHNlbGxlclxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgVXBkYXRlIGJhbmsgZGV0YWlsc1xyXG4vLyBAcm91dGUgICBQVVQgL2FwaS9zZWxsZXJzL2JhbmstZGV0YWlsc1xyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIpXHJcbmV4cG9ydHMudXBkYXRlQmFua0RldGFpbHMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qgc2VsbGVyID0gYXdhaXQgU2VsbGVyLmZpbmRPbmVBbmRVcGRhdGUoXHJcbiAgICAgICAgICAgIHsgdXNlcjogcmVxLnVzZXIuX2lkIH0sXHJcbiAgICAgICAgICAgIHsgYmFua0RldGFpbHM6IHJlcS5ib2R5IH0sXHJcbiAgICAgICAgICAgIHsgbmV3OiB0cnVlLCBydW5WYWxpZGF0b3JzOiB0cnVlIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICBpZiAoIXNlbGxlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU2VsbGVyIHByb2ZpbGUgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgc2VsbGVyXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgcGF5bWVudCBoaXN0b3J5XHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3NlbGxlcnMvcGF5bWVudHNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoU2VsbGVyKVxyXG5leHBvcnRzLmdldFBheW1lbnRIaXN0b3J5ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9ucyA9IGF3YWl0IFRyYW5zYWN0aW9uLmZpbmQoeyBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkIH0pXHJcbiAgICAgICAgICAgIC5zb3J0KCctY3JlYXRlZEF0Jyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25zXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgc2VsbGVyIGFuYWx5dGljc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zZWxsZXJzL2FuYWx5dGljc1xyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIpXHJcbmV4cG9ydHMuZ2V0QW5hbHl0aWNzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIEdldCBiYXNpYyBhbmFseXRpY3NcclxuICAgICAgICBjb25zdCBhbmFseXRpY3MgPSB7XHJcbiAgICAgICAgICAgIHRvdGFsTGlzdGluZ3M6IGF3YWl0IEhvcnNlLmNvdW50RG9jdW1lbnRzKHsgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCB9KSxcclxuICAgICAgICAgICAgYWN0aXZlTGlzdGluZ3M6IGF3YWl0IEhvcnNlLmNvdW50RG9jdW1lbnRzKHsgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCwgc3RhdHVzOiAnYWN0aXZlJyB9KSxcclxuICAgICAgICAgICAgdG90YWxJbnF1aXJpZXM6IGF3YWl0IElucXVpcnkuY291bnREb2N1bWVudHMoeyBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkIH0pLFxyXG4gICAgICAgICAgICB0b3RhbFRyYW5zYWN0aW9uczogYXdhaXQgVHJhbnNhY3Rpb24uY291bnREb2N1bWVudHMoeyBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkIH0pLFxyXG4gICAgICAgICAgICByZXZlbnVlOiBhd2FpdCBUcmFuc2FjdGlvbi5hZ2dyZWdhdGUoW1xyXG4gICAgICAgICAgICAgICAgeyAkbWF0Y2g6IHsgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCwgc3RhdHVzOiAnY29tcGxldGVkJyB9IH0sXHJcbiAgICAgICAgICAgICAgICB7ICRncm91cDogeyBfaWQ6IG51bGwsIHRvdGFsOiB7ICRzdW06ICckYW1vdW50JyB9IH0gfVxyXG4gICAgICAgICAgICBdKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgYW5hbHl0aWNzXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgc2VsbGVyIGxpc3RpbmdzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3NlbGxlcnMvbGlzdGluZ3NcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoU2VsbGVyKVxyXG5leHBvcnRzLmdldExpc3RpbmdzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGxpc3RpbmdzID0gYXdhaXQgSG9yc2UuZmluZCh7IHNlbGxlcjogcmVxLnNlbGxlci5faWQgfSlcclxuICAgICAgICAgICAgLnNvcnQoJy1jcmVhdGVkQXQnKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBsaXN0aW5nc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHNlbGxlciBpbnF1aXJpZXNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvc2VsbGVycy9pbnF1aXJpZXNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoU2VsbGVyKVxyXG5leHBvcnRzLmdldElucXVpcmllcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBpbnF1aXJpZXMgPSBhd2FpdCBJbnF1aXJ5LmZpbmQoeyBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkIH0pXHJcbiAgICAgICAgICAgIC5wb3B1bGF0ZSgndXNlcicsICduYW1lIGVtYWlsJylcclxuICAgICAgICAgICAgLnBvcHVsYXRlKCdob3JzZScsICduYW1lJylcclxuICAgICAgICAgICAgLnNvcnQoJy1jcmVhdGVkQXQnKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBpbnF1aXJpZXNcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBzZWxsZXIgcmV2aWV3c1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zZWxsZXJzL3Jldmlld3NcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoU2VsbGVyKVxyXG5leHBvcnRzLmdldFJldmlld3MgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qgc2VsbGVyID0gYXdhaXQgU2VsbGVyLmZpbmRCeUlkKHJlcS5zZWxsZXIuX2lkKVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3Jldmlld3MudXNlcicsICduYW1lJyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgcmV2aWV3czogc2VsbGVyLnJldmlld3NcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEFkZCByZXZpZXcgZm9yIHNlbGxlclxyXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvc2VsbGVycy9yZXZpZXdzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5hZGRSZXZpZXcgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyByYXRpbmcsIGNvbW1lbnQgfSA9IHJlcS5ib2R5O1xyXG4gICAgICAgIGNvbnN0IHNlbGxlciA9IGF3YWl0IFNlbGxlci5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuXHJcbiAgICAgICAgaWYgKCFzZWxsZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1NlbGxlciBub3QgZm91bmQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgcmV2aWV3ID0ge1xyXG4gICAgICAgICAgICB1c2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIHJhdGluZyxcclxuICAgICAgICAgICAgY29tbWVudCxcclxuICAgICAgICAgICAgZGF0ZTogRGF0ZS5ub3coKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHNlbGxlci5yZXZpZXdzLnB1c2gocmV2aWV3KTtcclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIGF2ZXJhZ2UgcmF0aW5nXHJcbiAgICAgICAgY29uc3QgdG90YWxSYXRpbmcgPSBzZWxsZXIucmV2aWV3cy5yZWR1Y2UoKHN1bSwgaXRlbSkgPT4gc3VtICsgaXRlbS5yYXRpbmcsIDApO1xyXG4gICAgICAgIHNlbGxlci5yYXRpbmcgPSB0b3RhbFJhdGluZyAvIHNlbGxlci5yZXZpZXdzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgYXdhaXQgc2VsbGVyLnNhdmUoKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICByZXZpZXdcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIFVwZGF0ZSBzdWJzY3JpcHRpb25cclxuLy8gQHJvdXRlICAgUFVUIC9hcGkvc2VsbGVycy9zdWJzY3JpcHRpb25cclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoU2VsbGVyKVxyXG5leHBvcnRzLnVwZGF0ZVN1YnNjcmlwdGlvbiA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IHN1YnNjcmlwdGlvblBhY2thZ2UgfSA9IHJlcS5ib2R5O1xyXG4gICAgICAgIGxldCBmZWF0dXJlcztcclxuXHJcbiAgICAgICAgc3dpdGNoIChzdWJzY3JpcHRpb25QYWNrYWdlKSB7XHJcbiAgICAgICAgICAgIGNhc2UgJ1JveWFsIFN0YWxsaW9uJzpcclxuICAgICAgICAgICAgICAgIGZlYXR1cmVzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpc3RpbmdMaW1pdDogNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgcGhvdG9zUGVyTGlzdGluZzogMzAsXHJcbiAgICAgICAgICAgICAgICAgICAgdmlkZW9zUGVyTGlzdGluZzogNSxcclxuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlZExpc3RpbmdzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpcnR1YWxUb3VyczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBhbmFseXRpY3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydDogJzI0LzcnXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ0dhbGxvcCc6XHJcbiAgICAgICAgICAgICAgICBmZWF0dXJlcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICBsaXN0aW5nTGltaXQ6IDI1LFxyXG4gICAgICAgICAgICAgICAgICAgIHBob3Rvc1Blckxpc3Rpbmc6IDIwLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpZGVvc1Blckxpc3Rpbmc6IDMsXHJcbiAgICAgICAgICAgICAgICAgICAgZmVhdHVyZWRMaXN0aW5nczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICB2aXJ0dWFsVG91cnM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIGFuYWx5dGljczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBzdXBwb3J0OiAnYnVzaW5lc3MgaG91cnMnXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ1Ryb3QnOlxyXG4gICAgICAgICAgICAgICAgZmVhdHVyZXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdGluZ0xpbWl0OiAxMCxcclxuICAgICAgICAgICAgICAgICAgICBwaG90b3NQZXJMaXN0aW5nOiAxMCxcclxuICAgICAgICAgICAgICAgICAgICB2aWRlb3NQZXJMaXN0aW5nOiAxLFxyXG4gICAgICAgICAgICAgICAgICAgIGZlYXR1cmVkTGlzdGluZ3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIHZpcnR1YWxUb3VyczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgYW5hbHl0aWNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICBzdXBwb3J0OiAnZW1haWwnXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHN1YnNjcmlwdGlvbiBwYWNrYWdlJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzZWxsZXIgPSBhd2FpdCBTZWxsZXIuZmluZEJ5SWQocmVxLnNlbGxlci5faWQpO1xyXG4gICAgICAgIGlmICghc2VsbGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdTZWxsZXIgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNlbGxlci5zdWJzY3JpcHRpb24gPSB7XHJcbiAgICAgICAgICAgIHBhY2thZ2U6IHN1YnNjcmlwdGlvblBhY2thZ2UsXHJcbiAgICAgICAgICAgIGZlYXR1cmVzLFxyXG4gICAgICAgICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgIGVuZERhdGU6IG5ldyBEYXRlKERhdGUubm93KCkgKyAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAzMCBkYXlzXHJcbiAgICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZSdcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhd2FpdCBzZWxsZXIuc2F2ZSgpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogc2VsbGVyLnN1YnNjcmlwdGlvblxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgQ2FuY2VsIHN1YnNjcmlwdGlvblxyXG4vLyBAcm91dGUgICBERUxFVEUgL2FwaS9zZWxsZXJzL3N1YnNjcmlwdGlvblxyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIpXHJcbmV4cG9ydHMuY2FuY2VsU3Vic2NyaXB0aW9uID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHNlbGxlciA9IGF3YWl0IFNlbGxlci5maW5kT25lQW5kVXBkYXRlKFxyXG4gICAgICAgICAgICB7IHVzZXI6IHJlcS51c2VyLl9pZCB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBwYWNrYWdlOiAnU3RhcnRlcicsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcclxuICAgICAgICAgICAgICAgICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgZW5kRGF0ZTogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2NSAqIDI0ICogNjAgKiA2MCAqIDEwMDApLCAvLyAxIHllYXJcclxuICAgICAgICAgICAgICAgICAgICBmZWF0dXJlczoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhMaXN0aW5nczogMSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF4UGhvdG9zOiAzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21taXNzaW9uOiA2LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hQbGFjZW1lbnQ6ICdiYXNpYycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBheW1lbnRPcHRpb25zOiBbJ3BsYXRmb3JtJ10sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1c3RvbUFncmVlbWVudHM6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib29zdEZlYXR1cmVzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaG9tZXBhZ2VWaXNpYmlsaXR5OiBmYWxzZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFkZ2VzOiBbXSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3BvdGxpZ2h0UmVtYWluaW5nOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBib29zdFJlbWFpbmluZzogMFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBuZXc6IHRydWUgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICghc2VsbGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdTZWxsZXIgcHJvZmlsZSBub3QgZm91bmQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBzZWxsZXJcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBzdWJzY3JpcHRpb24gZGV0YWlsc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zZWxsZXJzL3N1YnNjcmlwdGlvblxyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIpXHJcbmV4cG9ydHMuZ2V0U3Vic2NyaXB0aW9uRGV0YWlscyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBzZWxsZXIgPSBhd2FpdCBTZWxsZXIuZmluZE9uZSh7IHVzZXI6IHJlcS51c2VyLl9pZCB9KVxyXG4gICAgICAgICAgICAuc2VsZWN0KCdzdWJzY3JpcHRpb24nKTtcclxuXHJcbiAgICAgICAgaWYgKCFzZWxsZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1NlbGxlciBwcm9maWxlIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbjogc2VsbGVyLnN1YnNjcmlwdGlvblxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59OyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RD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","map":{"version":3,"names":["User","require","Seller","Horse","Inquiry","Transaction","exports","createProfile","req","res","seller","findOne","user","_id","status","json","success","message","create","businessName","body","description","subscription","package","startDate","Date","endDate","now","features","maxListings","maxPhotos","commission","searchPlacement","paymentOptions","customAgreements","boostFeatures","homepageVisibility","badges","spotlightRemaining","boostRemaining","role","save","error","console","getMe","updateProfile","findOneAndUpdate","contactInfo","socialMedia","new","runValidators","updateBankDetails","bankDetails","getPaymentHistory","transactions","find","sort","getAnalytics","analytics","totalListings","countDocuments","activeListings","totalInquiries","totalTransactions","revenue","aggregate","$match","$group","total","$sum","getListings","listings","getInquiries","inquiries","populate","getReviews","findById","reviews","addReview","rating","comment","params","id","review","date","push","totalRating","reduce","sum","item","length","updateSubscription","subscriptionPackage","listingLimit","photosPerListing","videosPerListing","featuredListings","virtualTours","support","cancelSubscription","getSubscriptionDetails","select"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["seller.controller.js"],"sourcesContent":["const User = require('../models/User');\r\nconst Seller = require('../models/Seller');\r\nconst Horse = require('../models/Horse');\r\nconst Inquiry = require('../models/Inquiry');\r\nconst Transaction = require('../models/Transaction');\r\n\r\n// @desc    Create seller profile\r\n// @route   POST /api/sellers/profile\r\n// @access  Private (User)\r\nexports.createProfile = async (req, res) => {\r\n    try {\r\n        // Check if seller profile already exists\r\n        let seller = await Seller.findOne({ user: req.user._id });\r\n        if (seller) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: 'Seller profile already exists'\r\n            });\r\n        }\r\n\r\n        // Create seller profile with Starter package\r\n        seller = await Seller.create({\r\n            user: req.user._id,\r\n            businessName: req.body.businessName,\r\n            description: req.body.description,\r\n            subscription: {\r\n                package: 'Starter',\r\n                status: 'active',\r\n                startDate: new Date(),\r\n                endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n                features: {\r\n                    maxListings: 1,\r\n                    maxPhotos: 3,\r\n                    commission: 6,\r\n                    searchPlacement: 'basic',\r\n                    paymentOptions: ['platform'],\r\n                    customAgreements: false,\r\n                    boostFeatures: false,\r\n                    homepageVisibility: false,\r\n                    badges: [],\r\n                    spotlightRemaining: 0,\r\n                    boostRemaining: 0\r\n                }\r\n            }\r\n        });\r\n\r\n        // Update user role to seller\r\n        req.user.role = 'seller';\r\n        await req.user.save();\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            seller\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get current seller profile\r\n// @route   GET /api/sellers/me\r\n// @access  Private (Seller)\r\nexports.getMe = async (req, res) => {\r\n    try {\r\n        const seller = await Seller.findOne({ user: req.user._id });\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller profile not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            seller\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update seller profile\r\n// @route   PUT /api/sellers/profile\r\n// @access  Private (Seller)\r\nexports.updateProfile = async (req, res) => {\r\n    try {\r\n        const seller = await Seller.findOneAndUpdate(\r\n            { user: req.user._id },\r\n            {\r\n                businessName: req.body.businessName,\r\n                description: req.body.description,\r\n                contactInfo: req.body.contactInfo,\r\n                socialMedia: req.body.socialMedia\r\n            },\r\n            { new: true, runValidators: true }\r\n        );\r\n\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller profile not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            seller\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update bank details\r\n// @route   PUT /api/sellers/bank-details\r\n// @access  Private (Seller)\r\nexports.updateBankDetails = async (req, res) => {\r\n    try {\r\n        const seller = await Seller.findOneAndUpdate(\r\n            { user: req.user._id },\r\n            { bankDetails: req.body },\r\n            { new: true, runValidators: true }\r\n        );\r\n\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller profile not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            seller\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get payment history\r\n// @route   GET /api/sellers/payments\r\n// @access  Private (Seller)\r\nexports.getPaymentHistory = async (req, res) => {\r\n    try {\r\n        const transactions = await Transaction.find({ seller: req.seller._id })\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            transactions\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller analytics\r\n// @route   GET /api/sellers/analytics\r\n// @access  Private (Seller)\r\nexports.getAnalytics = async (req, res) => {\r\n    try {\r\n        // Get basic analytics\r\n        const analytics = {\r\n            totalListings: await Horse.countDocuments({ seller: req.seller._id }),\r\n            activeListings: await Horse.countDocuments({ seller: req.seller._id, status: 'active' }),\r\n            totalInquiries: await Inquiry.countDocuments({ seller: req.seller._id }),\r\n            totalTransactions: await Transaction.countDocuments({ seller: req.seller._id }),\r\n            revenue: await Transaction.aggregate([\r\n                { $match: { seller: req.seller._id, status: 'completed' } },\r\n                { $group: { _id: null, total: { $sum: '$amount' } } }\r\n            ])\r\n        };\r\n\r\n        res.json({\r\n            success: true,\r\n            analytics\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller listings\r\n// @route   GET /api/sellers/listings\r\n// @access  Private (Seller)\r\nexports.getListings = async (req, res) => {\r\n    try {\r\n        const listings = await Horse.find({ seller: req.seller._id })\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            listings\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller inquiries\r\n// @route   GET /api/sellers/inquiries\r\n// @access  Private (Seller)\r\nexports.getInquiries = async (req, res) => {\r\n    try {\r\n        const inquiries = await Inquiry.find({ seller: req.seller._id })\r\n            .populate('user', 'name email')\r\n            .populate('horse', 'name')\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            inquiries\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller reviews\r\n// @route   GET /api/sellers/reviews\r\n// @access  Private (Seller)\r\nexports.getReviews = async (req, res) => {\r\n    try {\r\n        const seller = await Seller.findById(req.seller._id)\r\n            .populate('reviews.user', 'name');\r\n\r\n        res.json({\r\n            success: true,\r\n            reviews: seller.reviews\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Add review for seller\r\n// @route   POST /api/sellers/reviews\r\n// @access  Private\r\nexports.addReview = async (req, res) => {\r\n    try {\r\n        const { rating, comment } = req.body;\r\n        const seller = await Seller.findById(req.params.id);\r\n\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller not found'\r\n            });\r\n        }\r\n\r\n        const review = {\r\n            user: req.user._id,\r\n            rating,\r\n            comment,\r\n            date: Date.now()\r\n        };\r\n\r\n        seller.reviews.push(review);\r\n\r\n        // Update average rating\r\n        const totalRating = seller.reviews.reduce((sum, item) => sum + item.rating, 0);\r\n        seller.rating = totalRating / seller.reviews.length;\r\n\r\n        await seller.save();\r\n\r\n        res.json({\r\n            success: true,\r\n            review\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update subscription\r\n// @route   PUT /api/sellers/subscription\r\n// @access  Private (Seller)\r\nexports.updateSubscription = async (req, res) => {\r\n    try {\r\n        const { subscriptionPackage } = req.body;\r\n        let features;\r\n\r\n        switch (subscriptionPackage) {\r\n            case 'Royal Stallion':\r\n                features = {\r\n                    listingLimit: 50,\r\n                    photosPerListing: 30,\r\n                    videosPerListing: 5,\r\n                    featuredListings: true,\r\n                    virtualTours: true,\r\n                    analytics: true,\r\n                    support: '24/7'\r\n                };\r\n                break;\r\n            case 'Gallop':\r\n                features = {\r\n                    listingLimit: 25,\r\n                    photosPerListing: 20,\r\n                    videosPerListing: 3,\r\n                    featuredListings: true,\r\n                    virtualTours: false,\r\n                    analytics: true,\r\n                    support: 'business hours'\r\n                };\r\n                break;\r\n            case 'Trot':\r\n                features = {\r\n                    listingLimit: 10,\r\n                    photosPerListing: 10,\r\n                    videosPerListing: 1,\r\n                    featuredListings: false,\r\n                    virtualTours: false,\r\n                    analytics: false,\r\n                    support: 'email'\r\n                };\r\n                break;\r\n            default:\r\n                return res.status(400).json({\r\n                    success: false,\r\n                    message: 'Invalid subscription package'\r\n                });\r\n        }\r\n\r\n        const seller = await Seller.findById(req.seller._id);\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller not found'\r\n            });\r\n        }\r\n\r\n        seller.subscription = {\r\n            package: subscriptionPackage,\r\n            features,\r\n            startDate: new Date(),\r\n            endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\r\n            status: 'active'\r\n        };\r\n\r\n        await seller.save();\r\n\r\n        res.json({\r\n            success: true,\r\n            subscription: seller.subscription\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Cancel subscription\r\n// @route   DELETE /api/sellers/subscription\r\n// @access  Private (Seller)\r\nexports.cancelSubscription = async (req, res) => {\r\n    try {\r\n        const seller = await Seller.findOneAndUpdate(\r\n            { user: req.user._id },\r\n            {\r\n                subscription: {\r\n                    package: 'Starter',\r\n                    status: 'active',\r\n                    startDate: new Date(),\r\n                    endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000), // 1 year\r\n                    features: {\r\n                        maxListings: 1,\r\n                        maxPhotos: 3,\r\n                        commission: 6,\r\n                        searchPlacement: 'basic',\r\n                        paymentOptions: ['platform'],\r\n                        customAgreements: false,\r\n                        boostFeatures: false,\r\n                        homepageVisibility: false,\r\n                        badges: [],\r\n                        spotlightRemaining: 0,\r\n                        boostRemaining: 0\r\n                    }\r\n                }\r\n            },\r\n            { new: true }\r\n        );\r\n\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller profile not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            seller\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get subscription details\r\n// @route   GET /api/sellers/subscription\r\n// @access  Private (Seller)\r\nexports.getSubscriptionDetails = async (req, res) => {\r\n    try {\r\n        const seller = await Seller.findOne({ user: req.user._id })\r\n            .select('subscription');\r\n\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller profile not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            subscription: seller.subscription\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734101651957},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Inquiry.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst inquirySchema = new mongoose.Schema({\n  user: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  seller: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Seller',\n    required: true\n  },\n  horse: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Horse',\n    required: true\n  },\n  message: {\n    type: String,\n    required: true\n  },\n  status: {\n    type: String,\n    enum: ['pending', 'responded', 'closed'],\n    default: 'pending'\n  },\n  response: {\n    message: String,\n    date: Date\n  },\n  contactPreference: {\n    type: String,\n    enum: ['email', 'phone', 'whatsapp'],\n    required: true\n  },\n  attachments: [{\n    url: String,\n    public_id: String,\n    filename: String,\n    fileType: String\n  }],\n  metadata: {\n    userAgent: String,\n    ip: String,\n    location: {\n      country: String,\n      city: String\n    }\n  },\n  isRead: {\n    type: Boolean,\n    default: false\n  },\n  lastActivity: {\n    type: Date,\n    default: Date.now\n  }\n}, {\n  timestamps: true\n});\n\n// Create indexes\ninquirySchema.index({\n  user: 1,\n  seller: 1\n});\ninquirySchema.index({\n  horse: 1\n});\ninquirySchema.index({\n  status: 1\n});\ninquirySchema.index({\n  createdAt: 1\n});\nmodule.exports = mongoose.model('Inquiry', inquirySchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJpbnF1aXJ5U2NoZW1hIiwiU2NoZW1hIiwidXNlciIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwicmVxdWlyZWQiLCJzZWxsZXIiLCJob3JzZSIsIm1lc3NhZ2UiLCJTdHJpbmciLCJzdGF0dXMiLCJlbnVtIiwiZGVmYXVsdCIsInJlc3BvbnNlIiwiZGF0ZSIsIkRhdGUiLCJjb250YWN0UHJlZmVyZW5jZSIsImF0dGFjaG1lbnRzIiwidXJsIiwicHVibGljX2lkIiwiZmlsZW5hbWUiLCJmaWxlVHlwZSIsIm1ldGFkYXRhIiwidXNlckFnZW50IiwiaXAiLCJsb2NhdGlvbiIsImNvdW50cnkiLCJjaXR5IiwiaXNSZWFkIiwiQm9vbGVhbiIsImxhc3RBY3Rpdml0eSIsIm5vdyIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcbW9kZWxzXFwiLCJzb3VyY2VzIjpbIklucXVpcnkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5cclxuY29uc3QgaW5xdWlyeVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gICAgdXNlcjoge1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIHNlbGxlcjoge1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdTZWxsZXInLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgaG9yc2U6IHtcclxuICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgcmVmOiAnSG9yc2UnLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgbWVzc2FnZToge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIHN0YXR1czoge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBlbnVtOiBbJ3BlbmRpbmcnLCAncmVzcG9uZGVkJywgJ2Nsb3NlZCddLFxyXG4gICAgICAgIGRlZmF1bHQ6ICdwZW5kaW5nJ1xyXG4gICAgfSxcclxuICAgIHJlc3BvbnNlOiB7XHJcbiAgICAgICAgbWVzc2FnZTogU3RyaW5nLFxyXG4gICAgICAgIGRhdGU6IERhdGVcclxuICAgIH0sXHJcbiAgICBjb250YWN0UHJlZmVyZW5jZToge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBlbnVtOiBbJ2VtYWlsJywgJ3Bob25lJywgJ3doYXRzYXBwJ10sXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBhdHRhY2htZW50czogW3tcclxuICAgICAgICB1cmw6IFN0cmluZyxcclxuICAgICAgICBwdWJsaWNfaWQ6IFN0cmluZyxcclxuICAgICAgICBmaWxlbmFtZTogU3RyaW5nLFxyXG4gICAgICAgIGZpbGVUeXBlOiBTdHJpbmdcclxuICAgIH1dLFxyXG4gICAgbWV0YWRhdGE6IHtcclxuICAgICAgICB1c2VyQWdlbnQ6IFN0cmluZyxcclxuICAgICAgICBpcDogU3RyaW5nLFxyXG4gICAgICAgIGxvY2F0aW9uOiB7XHJcbiAgICAgICAgICAgIGNvdW50cnk6IFN0cmluZyxcclxuICAgICAgICAgICAgY2l0eTogU3RyaW5nXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGlzUmVhZDoge1xyXG4gICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgIH0sXHJcbiAgICBsYXN0QWN0aXZpdHk6IHtcclxuICAgICAgICB0eXBlOiBEYXRlLFxyXG4gICAgICAgIGRlZmF1bHQ6IERhdGUubm93XHJcbiAgICB9XHJcbn0sIHtcclxuICAgIHRpbWVzdGFtcHM6IHRydWVcclxufSk7XHJcblxyXG4vLyBDcmVhdGUgaW5kZXhlc1xyXG5pbnF1aXJ5U2NoZW1hLmluZGV4KHsgdXNlcjogMSwgc2VsbGVyOiAxIH0pO1xyXG5pbnF1aXJ5U2NoZW1hLmluZGV4KHsgaG9yc2U6IDEgfSk7XHJcbmlucXVpcnlTY2hlbWEuaW5kZXgoeyBzdGF0dXM6IDEgfSk7XHJcbmlucXVpcnlTY2hlbWEuaW5kZXgoeyBjcmVhdGVkQXQ6IDEgfSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdJbnF1aXJ5JywgaW5xdWlyeVNjaGVtYSk7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLGFBQWEsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUN0Q0MsSUFBSSxFQUFFO0lBQ0ZDLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNHLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFLE1BQU07SUFDWEMsUUFBUSxFQUFFO0VBQ2QsQ0FBQztFQUNEQyxNQUFNLEVBQUU7SUFDSkwsSUFBSSxFQUFFTCxRQUFRLENBQUNHLE1BQU0sQ0FBQ0csS0FBSyxDQUFDQyxRQUFRO0lBQ3BDQyxHQUFHLEVBQUUsUUFBUTtJQUNiQyxRQUFRLEVBQUU7RUFDZCxDQUFDO0VBQ0RFLEtBQUssRUFBRTtJQUNITixJQUFJLEVBQUVMLFFBQVEsQ0FBQ0csTUFBTSxDQUFDRyxLQUFLLENBQUNDLFFBQVE7SUFDcENDLEdBQUcsRUFBRSxPQUFPO0lBQ1pDLFFBQVEsRUFBRTtFQUNkLENBQUM7RUFDREcsT0FBTyxFQUFFO0lBQ0xQLElBQUksRUFBRVEsTUFBTTtJQUNaSixRQUFRLEVBQUU7RUFDZCxDQUFDO0VBQ0RLLE1BQU0sRUFBRTtJQUNKVCxJQUFJLEVBQUVRLE1BQU07SUFDWkUsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUM7SUFDeENDLE9BQU8sRUFBRTtFQUNiLENBQUM7RUFDREMsUUFBUSxFQUFFO0lBQ05MLE9BQU8sRUFBRUMsTUFBTTtJQUNmSyxJQUFJLEVBQUVDO0VBQ1YsQ0FBQztFQUNEQyxpQkFBaUIsRUFBRTtJQUNmZixJQUFJLEVBQUVRLE1BQU07SUFDWkUsSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxVQUFVLENBQUM7SUFDcENOLFFBQVEsRUFBRTtFQUNkLENBQUM7RUFDRFksV0FBVyxFQUFFLENBQUM7SUFDVkMsR0FBRyxFQUFFVCxNQUFNO0lBQ1hVLFNBQVMsRUFBRVYsTUFBTTtJQUNqQlcsUUFBUSxFQUFFWCxNQUFNO0lBQ2hCWSxRQUFRLEVBQUVaO0VBQ2QsQ0FBQyxDQUFDO0VBQ0ZhLFFBQVEsRUFBRTtJQUNOQyxTQUFTLEVBQUVkLE1BQU07SUFDakJlLEVBQUUsRUFBRWYsTUFBTTtJQUNWZ0IsUUFBUSxFQUFFO01BQ05DLE9BQU8sRUFBRWpCLE1BQU07TUFDZmtCLElBQUksRUFBRWxCO0lBQ1Y7RUFDSixDQUFDO0VBQ0RtQixNQUFNLEVBQUU7SUFDSjNCLElBQUksRUFBRTRCLE9BQU87SUFDYmpCLE9BQU8sRUFBRTtFQUNiLENBQUM7RUFDRGtCLFlBQVksRUFBRTtJQUNWN0IsSUFBSSxFQUFFYyxJQUFJO0lBQ1ZILE9BQU8sRUFBRUcsSUFBSSxDQUFDZ0I7RUFDbEI7QUFDSixDQUFDLEVBQUU7RUFDQ0MsVUFBVSxFQUFFO0FBQ2hCLENBQUMsQ0FBQzs7QUFFRjtBQUNBbEMsYUFBYSxDQUFDbUMsS0FBSyxDQUFDO0VBQUVqQyxJQUFJLEVBQUUsQ0FBQztFQUFFTSxNQUFNLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFDM0NSLGFBQWEsQ0FBQ21DLEtBQUssQ0FBQztFQUFFMUIsS0FBSyxFQUFFO0FBQUUsQ0FBQyxDQUFDO0FBQ2pDVCxhQUFhLENBQUNtQyxLQUFLLENBQUM7RUFBRXZCLE1BQU0sRUFBRTtBQUFFLENBQUMsQ0FBQztBQUNsQ1osYUFBYSxDQUFDbUMsS0FBSyxDQUFDO0VBQUVDLFNBQVMsRUFBRTtBQUFFLENBQUMsQ0FBQztBQUVyQ0MsTUFBTSxDQUFDQyxPQUFPLEdBQUd4QyxRQUFRLENBQUN5QyxLQUFLLENBQUMsU0FBUyxFQUFFdkMsYUFBYSxDQUFDIiwiaWdub3JlTGlzdCI6W119","map":{"version":3,"names":["mongoose","require","inquirySchema","Schema","user","type","Types","ObjectId","ref","required","seller","horse","message","String","status","enum","default","response","date","Date","contactPreference","attachments","url","public_id","filename","fileType","metadata","userAgent","ip","location","country","city","isRead","Boolean","lastActivity","now","timestamps","index","createdAt","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Inquiry.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst inquirySchema = new mongoose.Schema({\r\n    user: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true\r\n    },\r\n    seller: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Seller',\r\n        required: true\r\n    },\r\n    horse: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Horse',\r\n        required: true\r\n    },\r\n    message: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['pending', 'responded', 'closed'],\r\n        default: 'pending'\r\n    },\r\n    response: {\r\n        message: String,\r\n        date: Date\r\n    },\r\n    contactPreference: {\r\n        type: String,\r\n        enum: ['email', 'phone', 'whatsapp'],\r\n        required: true\r\n    },\r\n    attachments: [{\r\n        url: String,\r\n        public_id: String,\r\n        filename: String,\r\n        fileType: String\r\n    }],\r\n    metadata: {\r\n        userAgent: String,\r\n        ip: String,\r\n        location: {\r\n            country: String,\r\n            city: String\r\n        }\r\n    },\r\n    isRead: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    lastActivity: {\r\n        type: Date,\r\n        default: Date.now\r\n    }\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Create indexes\r\ninquirySchema.index({ user: 1, seller: 1 });\r\ninquirySchema.index({ horse: 1 });\r\ninquirySchema.index({ status: 1 });\r\ninquirySchema.index({ createdAt: 1 });\r\n\r\nmodule.exports = mongoose.model('Inquiry', inquirySchema); "],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,aAAa,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EACtCC,IAAI,EAAE;IACFC,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,MAAM;IACXC,QAAQ,EAAE;EACd,CAAC;EACDC,MAAM,EAAE;IACJL,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,QAAQ;IACbC,QAAQ,EAAE;EACd,CAAC;EACDE,KAAK,EAAE;IACHN,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,OAAO;IACZC,QAAQ,EAAE;EACd,CAAC;EACDG,OAAO,EAAE;IACLP,IAAI,EAAEQ,MAAM;IACZJ,QAAQ,EAAE;EACd,CAAC;EACDK,MAAM,EAAE;IACJT,IAAI,EAAEQ,MAAM;IACZE,IAAI,EAAE,CAAC,SAAS,EAAE,WAAW,EAAE,QAAQ,CAAC;IACxCC,OAAO,EAAE;EACb,CAAC;EACDC,QAAQ,EAAE;IACNL,OAAO,EAAEC,MAAM;IACfK,IAAI,EAAEC;EACV,CAAC;EACDC,iBAAiB,EAAE;IACff,IAAI,EAAEQ,MAAM;IACZE,IAAI,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,UAAU,CAAC;IACpCN,QAAQ,EAAE;EACd,CAAC;EACDY,WAAW,EAAE,CAAC;IACVC,GAAG,EAAET,MAAM;IACXU,SAAS,EAAEV,MAAM;IACjBW,QAAQ,EAAEX,MAAM;IAChBY,QAAQ,EAAEZ;EACd,CAAC,CAAC;EACFa,QAAQ,EAAE;IACNC,SAAS,EAAEd,MAAM;IACjBe,EAAE,EAAEf,MAAM;IACVgB,QAAQ,EAAE;MACNC,OAAO,EAAEjB,MAAM;MACfkB,IAAI,EAAElB;IACV;EACJ,CAAC;EACDmB,MAAM,EAAE;IACJ3B,IAAI,EAAE4B,OAAO;IACbjB,OAAO,EAAE;EACb,CAAC;EACDkB,YAAY,EAAE;IACV7B,IAAI,EAAEc,IAAI;IACVH,OAAO,EAAEG,IAAI,CAACgB;EAClB;AACJ,CAAC,EAAE;EACCC,UAAU,EAAE;AAChB,CAAC,CAAC;;AAEF;AACAlC,aAAa,CAACmC,KAAK,CAAC;EAAEjC,IAAI,EAAE,CAAC;EAAEM,MAAM,EAAE;AAAE,CAAC,CAAC;AAC3CR,aAAa,CAACmC,KAAK,CAAC;EAAE1B,KAAK,EAAE;AAAE,CAAC,CAAC;AACjCT,aAAa,CAACmC,KAAK,CAAC;EAAEvB,MAAM,EAAE;AAAE,CAAC,CAAC;AAClCZ,aAAa,CAACmC,KAAK,CAAC;EAAEC,SAAS,EAAE;AAAE,CAAC,CAAC;AAErCC,MAAM,CAACC,OAAO,GAAGxC,QAAQ,CAACyC,KAAK,CAAC,SAAS,EAAEvC,aAAa,CAAC","ignoreList":[]}},"mtime":1734030128211},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\horse.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  createHorseListing,\n  getHorses,\n  getHorseById,\n  updateHorseListing,\n  deleteHorseListing,\n  getFeaturedHorses,\n  getCategories,\n  getPriceRanges,\n  searchHorses,\n  addToFavorites,\n  removeFromFavorites\n} = require('../controllers/horse.controller');\n\n// Validation middleware\nconst createHorseValidation = [body('name').trim().notEmpty().withMessage('Name is required'), body('breed').notEmpty().withMessage('Breed is required'), body('age').isObject().withMessage('Age must be an object'), body('age.years').isInt({\n  min: 0\n}).withMessage('Years must be a positive number'), body('age.months').isInt({\n  min: 0,\n  max: 11\n}).withMessage('Months must be between 0 and 11'), body('gender').isIn(['Stallion', 'Mare', 'Gelding']).withMessage('Invalid gender'), body('color').notEmpty().withMessage('Color is required'), body('price').isNumeric().withMessage('Price must be a number'), body('description').notEmpty().withMessage('Description is required'), body('location').isObject().withMessage('Location must be an object'), body('location.state').notEmpty().withMessage('State is required'), body('location.city').notEmpty().withMessage('City is required'), body('location.pincode').matches(/^[0-9]{6}$/).withMessage('Please enter a valid 6-digit pincode'), body('specifications').isObject().withMessage('Specifications must be an object'), body('specifications.training').isIn(['Basic', 'Intermediate', 'Advanced']).withMessage('Invalid training level'), body('specifications.discipline').isArray().withMessage('Discipline must be an array'), body('specifications.temperament').notEmpty().withMessage('Temperament is required'), body('specifications.healthStatus').notEmpty().withMessage('Health status is required'), body('listingStatus').optional().isIn(['draft', 'active', 'sold', 'inactive']).withMessage('Invalid listing status')];\nconst updateHorseValidation = [body('name').optional().trim().notEmpty().withMessage('Name is required'), body('breed').optional().notEmpty().withMessage('Breed is required'), body('age').optional().isObject().withMessage('Age must be an object'), body('age.years').optional().isInt({\n  min: 0\n}).withMessage('Years must be a positive number'), body('age.months').optional().isInt({\n  min: 0,\n  max: 11\n}).withMessage('Months must be between 0 and 11'), body('gender').optional().isIn(['Stallion', 'Mare', 'Gelding']).withMessage('Invalid gender'), body('color').optional().notEmpty().withMessage('Color is required'), body('price').optional().isNumeric().withMessage('Price must be a number'), body('description').optional().notEmpty().withMessage('Description is required'), body('location').optional().isObject().withMessage('Location must be an object'), body('location.state').optional().notEmpty().withMessage('State is required'), body('location.city').optional().notEmpty().withMessage('City is required'), body('location.pincode').optional().matches(/^[0-9]{6}$/).withMessage('Please enter a valid 6-digit pincode'), body('specifications').optional().isObject().withMessage('Specifications must be an object'), body('specifications.training').optional().isIn(['Basic', 'Intermediate', 'Advanced']).withMessage('Invalid training level'), body('specifications.discipline').optional().isArray().withMessage('Discipline must be an array'), body('specifications.temperament').optional().notEmpty().withMessage('Temperament is required'), body('specifications.healthStatus').optional().notEmpty().withMessage('Health status is required'), body('listingStatus').optional().isIn(['draft', 'active', 'sold', 'inactive']).withMessage('Invalid listing status')];\n\n// Public routes for buyers\nrouter.get('/featured', getFeaturedHorses);\nrouter.get('/categories', getCategories);\nrouter.get('/price-ranges', getPriceRanges);\nrouter.get('/search', searchHorses);\n\n// Get all horses\nrouter.get('/', getHorses);\n\n// Get single horse\nrouter.get('/:id', getHorseById);\n\n// Create horse listing (Seller only)\nrouter.post('/', protect, authorize('seller'), createHorseValidation, createHorseListing);\n\n// Update horse listing (Seller only)\nrouter.put('/:id', protect, authorize('seller'), updateHorseValidation, updateHorseListing);\n\n// Delete horse listing (Seller only)\nrouter.delete('/:id', protect, authorize('seller'), deleteHorseListing);\n\n// Favorites management (Authenticated users)\nrouter.post('/:id/favorite', protect, addToFavorites);\nrouter.delete('/:id/favorite', protect, removeFromFavorites);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJib2R5IiwiY3JlYXRlSG9yc2VMaXN0aW5nIiwiZ2V0SG9yc2VzIiwiZ2V0SG9yc2VCeUlkIiwidXBkYXRlSG9yc2VMaXN0aW5nIiwiZGVsZXRlSG9yc2VMaXN0aW5nIiwiZ2V0RmVhdHVyZWRIb3JzZXMiLCJnZXRDYXRlZ29yaWVzIiwiZ2V0UHJpY2VSYW5nZXMiLCJzZWFyY2hIb3JzZXMiLCJhZGRUb0Zhdm9yaXRlcyIsInJlbW92ZUZyb21GYXZvcml0ZXMiLCJjcmVhdGVIb3JzZVZhbGlkYXRpb24iLCJ0cmltIiwibm90RW1wdHkiLCJ3aXRoTWVzc2FnZSIsImlzT2JqZWN0IiwiaXNJbnQiLCJtaW4iLCJtYXgiLCJpc0luIiwiaXNOdW1lcmljIiwibWF0Y2hlcyIsImlzQXJyYXkiLCJvcHRpb25hbCIsInVwZGF0ZUhvcnNlVmFsaWRhdGlvbiIsImdldCIsInBvc3QiLCJwdXQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsiaG9yc2Uucm91dGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHsgcHJvdGVjdCwgYXV0aG9yaXplIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlcy9hdXRoLm1pZGRsZXdhcmUnKTtcclxuY29uc3QgeyBib2R5IH0gPSByZXF1aXJlKCdleHByZXNzLXZhbGlkYXRvcicpO1xyXG5jb25zdCB7XHJcbiAgICBjcmVhdGVIb3JzZUxpc3RpbmcsXHJcbiAgICBnZXRIb3JzZXMsXHJcbiAgICBnZXRIb3JzZUJ5SWQsXHJcbiAgICB1cGRhdGVIb3JzZUxpc3RpbmcsXHJcbiAgICBkZWxldGVIb3JzZUxpc3RpbmcsXHJcbiAgICBnZXRGZWF0dXJlZEhvcnNlcyxcclxuICAgIGdldENhdGVnb3JpZXMsXHJcbiAgICBnZXRQcmljZVJhbmdlcyxcclxuICAgIHNlYXJjaEhvcnNlcyxcclxuICAgIGFkZFRvRmF2b3JpdGVzLFxyXG4gICAgcmVtb3ZlRnJvbUZhdm9yaXRlc1xyXG59ID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvaG9yc2UuY29udHJvbGxlcicpO1xyXG5cclxuLy8gVmFsaWRhdGlvbiBtaWRkbGV3YXJlXHJcbmNvbnN0IGNyZWF0ZUhvcnNlVmFsaWRhdGlvbiA9IFtcclxuICAgIGJvZHkoJ25hbWUnKS50cmltKCkubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnTmFtZSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnYnJlZWQnKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdCcmVlZCBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnYWdlJykuaXNPYmplY3QoKS53aXRoTWVzc2FnZSgnQWdlIG11c3QgYmUgYW4gb2JqZWN0JyksXHJcbiAgICBib2R5KCdhZ2UueWVhcnMnKS5pc0ludCh7IG1pbjogMCB9KS53aXRoTWVzc2FnZSgnWWVhcnMgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpLFxyXG4gICAgYm9keSgnYWdlLm1vbnRocycpLmlzSW50KHsgbWluOiAwLCBtYXg6IDExIH0pLndpdGhNZXNzYWdlKCdNb250aHMgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDExJyksXHJcbiAgICBib2R5KCdnZW5kZXInKS5pc0luKFsnU3RhbGxpb24nLCAnTWFyZScsICdHZWxkaW5nJ10pLndpdGhNZXNzYWdlKCdJbnZhbGlkIGdlbmRlcicpLFxyXG4gICAgYm9keSgnY29sb3InKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdDb2xvciBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgncHJpY2UnKS5pc051bWVyaWMoKS53aXRoTWVzc2FnZSgnUHJpY2UgbXVzdCBiZSBhIG51bWJlcicpLFxyXG4gICAgYm9keSgnZGVzY3JpcHRpb24nKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdEZXNjcmlwdGlvbiBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnbG9jYXRpb24nKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdMb2NhdGlvbiBtdXN0IGJlIGFuIG9iamVjdCcpLFxyXG4gICAgYm9keSgnbG9jYXRpb24uc3RhdGUnKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdTdGF0ZSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnbG9jYXRpb24uY2l0eScpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ0NpdHkgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2xvY2F0aW9uLnBpbmNvZGUnKS5tYXRjaGVzKC9eWzAtOV17Nn0kLykud2l0aE1lc3NhZ2UoJ1BsZWFzZSBlbnRlciBhIHZhbGlkIDYtZGlnaXQgcGluY29kZScpLFxyXG4gICAgYm9keSgnc3BlY2lmaWNhdGlvbnMnKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdTcGVjaWZpY2F0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCcpLFxyXG4gICAgYm9keSgnc3BlY2lmaWNhdGlvbnMudHJhaW5pbmcnKS5pc0luKFsnQmFzaWMnLCAnSW50ZXJtZWRpYXRlJywgJ0FkdmFuY2VkJ10pLndpdGhNZXNzYWdlKCdJbnZhbGlkIHRyYWluaW5nIGxldmVsJyksXHJcbiAgICBib2R5KCdzcGVjaWZpY2F0aW9ucy5kaXNjaXBsaW5lJykuaXNBcnJheSgpLndpdGhNZXNzYWdlKCdEaXNjaXBsaW5lIG11c3QgYmUgYW4gYXJyYXknKSxcclxuICAgIGJvZHkoJ3NwZWNpZmljYXRpb25zLnRlbXBlcmFtZW50Jykubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnVGVtcGVyYW1lbnQgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ3NwZWNpZmljYXRpb25zLmhlYWx0aFN0YXR1cycpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ0hlYWx0aCBzdGF0dXMgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2xpc3RpbmdTdGF0dXMnKS5vcHRpb25hbCgpLmlzSW4oWydkcmFmdCcsICdhY3RpdmUnLCAnc29sZCcsICdpbmFjdGl2ZSddKS53aXRoTWVzc2FnZSgnSW52YWxpZCBsaXN0aW5nIHN0YXR1cycpXHJcbl07XHJcblxyXG5jb25zdCB1cGRhdGVIb3JzZVZhbGlkYXRpb24gPSBbXHJcbiAgICBib2R5KCduYW1lJykub3B0aW9uYWwoKS50cmltKCkubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnTmFtZSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnYnJlZWQnKS5vcHRpb25hbCgpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ0JyZWVkIGlzIHJlcXVpcmVkJyksXHJcbiAgICBib2R5KCdhZ2UnKS5vcHRpb25hbCgpLmlzT2JqZWN0KCkud2l0aE1lc3NhZ2UoJ0FnZSBtdXN0IGJlIGFuIG9iamVjdCcpLFxyXG4gICAgYm9keSgnYWdlLnllYXJzJykub3B0aW9uYWwoKS5pc0ludCh7IG1pbjogMCB9KS53aXRoTWVzc2FnZSgnWWVhcnMgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicpLFxyXG4gICAgYm9keSgnYWdlLm1vbnRocycpLm9wdGlvbmFsKCkuaXNJbnQoeyBtaW46IDAsIG1heDogMTEgfSkud2l0aE1lc3NhZ2UoJ01vbnRocyBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMTEnKSxcclxuICAgIGJvZHkoJ2dlbmRlcicpLm9wdGlvbmFsKCkuaXNJbihbJ1N0YWxsaW9uJywgJ01hcmUnLCAnR2VsZGluZyddKS53aXRoTWVzc2FnZSgnSW52YWxpZCBnZW5kZXInKSxcclxuICAgIGJvZHkoJ2NvbG9yJykub3B0aW9uYWwoKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdDb2xvciBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgncHJpY2UnKS5vcHRpb25hbCgpLmlzTnVtZXJpYygpLndpdGhNZXNzYWdlKCdQcmljZSBtdXN0IGJlIGEgbnVtYmVyJyksXHJcbiAgICBib2R5KCdkZXNjcmlwdGlvbicpLm9wdGlvbmFsKCkubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnRGVzY3JpcHRpb24gaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2xvY2F0aW9uJykub3B0aW9uYWwoKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdMb2NhdGlvbiBtdXN0IGJlIGFuIG9iamVjdCcpLFxyXG4gICAgYm9keSgnbG9jYXRpb24uc3RhdGUnKS5vcHRpb25hbCgpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ1N0YXRlIGlzIHJlcXVpcmVkJyksXHJcbiAgICBib2R5KCdsb2NhdGlvbi5jaXR5Jykub3B0aW9uYWwoKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdDaXR5IGlzIHJlcXVpcmVkJyksXHJcbiAgICBib2R5KCdsb2NhdGlvbi5waW5jb2RlJykub3B0aW9uYWwoKS5tYXRjaGVzKC9eWzAtOV17Nn0kLykud2l0aE1lc3NhZ2UoJ1BsZWFzZSBlbnRlciBhIHZhbGlkIDYtZGlnaXQgcGluY29kZScpLFxyXG4gICAgYm9keSgnc3BlY2lmaWNhdGlvbnMnKS5vcHRpb25hbCgpLmlzT2JqZWN0KCkud2l0aE1lc3NhZ2UoJ1NwZWNpZmljYXRpb25zIG11c3QgYmUgYW4gb2JqZWN0JyksXHJcbiAgICBib2R5KCdzcGVjaWZpY2F0aW9ucy50cmFpbmluZycpLm9wdGlvbmFsKCkuaXNJbihbJ0Jhc2ljJywgJ0ludGVybWVkaWF0ZScsICdBZHZhbmNlZCddKS53aXRoTWVzc2FnZSgnSW52YWxpZCB0cmFpbmluZyBsZXZlbCcpLFxyXG4gICAgYm9keSgnc3BlY2lmaWNhdGlvbnMuZGlzY2lwbGluZScpLm9wdGlvbmFsKCkuaXNBcnJheSgpLndpdGhNZXNzYWdlKCdEaXNjaXBsaW5lIG11c3QgYmUgYW4gYXJyYXknKSxcclxuICAgIGJvZHkoJ3NwZWNpZmljYXRpb25zLnRlbXBlcmFtZW50Jykub3B0aW9uYWwoKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdUZW1wZXJhbWVudCBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnc3BlY2lmaWNhdGlvbnMuaGVhbHRoU3RhdHVzJykub3B0aW9uYWwoKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdIZWFsdGggc3RhdHVzIGlzIHJlcXVpcmVkJyksXHJcbiAgICBib2R5KCdsaXN0aW5nU3RhdHVzJykub3B0aW9uYWwoKS5pc0luKFsnZHJhZnQnLCAnYWN0aXZlJywgJ3NvbGQnLCAnaW5hY3RpdmUnXSkud2l0aE1lc3NhZ2UoJ0ludmFsaWQgbGlzdGluZyBzdGF0dXMnKVxyXG5dO1xyXG5cclxuLy8gUHVibGljIHJvdXRlcyBmb3IgYnV5ZXJzXHJcbnJvdXRlci5nZXQoJy9mZWF0dXJlZCcsIGdldEZlYXR1cmVkSG9yc2VzKTtcclxucm91dGVyLmdldCgnL2NhdGVnb3JpZXMnLCBnZXRDYXRlZ29yaWVzKTtcclxucm91dGVyLmdldCgnL3ByaWNlLXJhbmdlcycsIGdldFByaWNlUmFuZ2VzKTtcclxucm91dGVyLmdldCgnL3NlYXJjaCcsIHNlYXJjaEhvcnNlcyk7XHJcblxyXG4vLyBHZXQgYWxsIGhvcnNlc1xyXG5yb3V0ZXIuZ2V0KCcvJywgZ2V0SG9yc2VzKTtcclxuXHJcbi8vIEdldCBzaW5nbGUgaG9yc2Vcclxucm91dGVyLmdldCgnLzppZCcsIGdldEhvcnNlQnlJZCk7XHJcblxyXG4vLyBDcmVhdGUgaG9yc2UgbGlzdGluZyAoU2VsbGVyIG9ubHkpXHJcbnJvdXRlci5wb3N0KCcvJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgY3JlYXRlSG9yc2VWYWxpZGF0aW9uLCBjcmVhdGVIb3JzZUxpc3RpbmcpO1xyXG5cclxuLy8gVXBkYXRlIGhvcnNlIGxpc3RpbmcgKFNlbGxlciBvbmx5KVxyXG5yb3V0ZXIucHV0KCcvOmlkJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgdXBkYXRlSG9yc2VWYWxpZGF0aW9uLCB1cGRhdGVIb3JzZUxpc3RpbmcpO1xyXG5cclxuLy8gRGVsZXRlIGhvcnNlIGxpc3RpbmcgKFNlbGxlciBvbmx5KVxyXG5yb3V0ZXIuZGVsZXRlKCcvOmlkJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgZGVsZXRlSG9yc2VMaXN0aW5nKTtcclxuXHJcbi8vIEZhdm9yaXRlcyBtYW5hZ2VtZW50IChBdXRoZW50aWNhdGVkIHVzZXJzKVxyXG5yb3V0ZXIucG9zdCgnLzppZC9mYXZvcml0ZScsIHByb3RlY3QsIGFkZFRvRmF2b3JpdGVzKTtcclxucm91dGVyLmRlbGV0ZSgnLzppZC9mYXZvcml0ZScsIHByb3RlY3QsIHJlbW92ZUZyb21GYXZvcml0ZXMpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNO0VBQUVDLE9BQU87RUFBRUM7QUFBVSxDQUFDLEdBQUdKLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQztBQUN4RSxNQUFNO0VBQUVLO0FBQUssQ0FBQyxHQUFHTCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDN0MsTUFBTTtFQUNGTSxrQkFBa0I7RUFDbEJDLFNBQVM7RUFDVEMsWUFBWTtFQUNaQyxrQkFBa0I7RUFDbEJDLGtCQUFrQjtFQUNsQkMsaUJBQWlCO0VBQ2pCQyxhQUFhO0VBQ2JDLGNBQWM7RUFDZEMsWUFBWTtFQUNaQyxjQUFjO0VBQ2RDO0FBQ0osQ0FBQyxHQUFHaEIsT0FBTyxDQUFDLGlDQUFpQyxDQUFDOztBQUU5QztBQUNBLE1BQU1pQixxQkFBcUIsR0FBRyxDQUMxQlosSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDYSxJQUFJLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUMsa0JBQWtCLENBQUMsRUFDOURmLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQ2MsUUFBUSxDQUFDLENB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","map":{"version":3,"names":["express","require","router","Router","protect","authorize","body","createHorseListing","getHorses","getHorseById","updateHorseListing","deleteHorseListing","getFeaturedHorses","getCategories","getPriceRanges","searchHorses","addToFavorites","removeFromFavorites","createHorseValidation","trim","notEmpty","withMessage","isObject","isInt","min","max","isIn","isNumeric","matches","isArray","optional","updateHorseValidation","get","post","put","delete","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["horse.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect, authorize } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    createHorseListing,\r\n    getHorses,\r\n    getHorseById,\r\n    updateHorseListing,\r\n    deleteHorseListing,\r\n    getFeaturedHorses,\r\n    getCategories,\r\n    getPriceRanges,\r\n    searchHorses,\r\n    addToFavorites,\r\n    removeFromFavorites\r\n} = require('../controllers/horse.controller');\r\n\r\n// Validation middleware\r\nconst createHorseValidation = [\r\n    body('name').trim().notEmpty().withMessage('Name is required'),\r\n    body('breed').notEmpty().withMessage('Breed is required'),\r\n    body('age').isObject().withMessage('Age must be an object'),\r\n    body('age.years').isInt({ min: 0 }).withMessage('Years must be a positive number'),\r\n    body('age.months').isInt({ min: 0, max: 11 }).withMessage('Months must be between 0 and 11'),\r\n    body('gender').isIn(['Stallion', 'Mare', 'Gelding']).withMessage('Invalid gender'),\r\n    body('color').notEmpty().withMessage('Color is required'),\r\n    body('price').isNumeric().withMessage('Price must be a number'),\r\n    body('description').notEmpty().withMessage('Description is required'),\r\n    body('location').isObject().withMessage('Location must be an object'),\r\n    body('location.state').notEmpty().withMessage('State is required'),\r\n    body('location.city').notEmpty().withMessage('City is required'),\r\n    body('location.pincode').matches(/^[0-9]{6}$/).withMessage('Please enter a valid 6-digit pincode'),\r\n    body('specifications').isObject().withMessage('Specifications must be an object'),\r\n    body('specifications.training').isIn(['Basic', 'Intermediate', 'Advanced']).withMessage('Invalid training level'),\r\n    body('specifications.discipline').isArray().withMessage('Discipline must be an array'),\r\n    body('specifications.temperament').notEmpty().withMessage('Temperament is required'),\r\n    body('specifications.healthStatus').notEmpty().withMessage('Health status is required'),\r\n    body('listingStatus').optional().isIn(['draft', 'active', 'sold', 'inactive']).withMessage('Invalid listing status')\r\n];\r\n\r\nconst updateHorseValidation = [\r\n    body('name').optional().trim().notEmpty().withMessage('Name is required'),\r\n    body('breed').optional().notEmpty().withMessage('Breed is required'),\r\n    body('age').optional().isObject().withMessage('Age must be an object'),\r\n    body('age.years').optional().isInt({ min: 0 }).withMessage('Years must be a positive number'),\r\n    body('age.months').optional().isInt({ min: 0, max: 11 }).withMessage('Months must be between 0 and 11'),\r\n    body('gender').optional().isIn(['Stallion', 'Mare', 'Gelding']).withMessage('Invalid gender'),\r\n    body('color').optional().notEmpty().withMessage('Color is required'),\r\n    body('price').optional().isNumeric().withMessage('Price must be a number'),\r\n    body('description').optional().notEmpty().withMessage('Description is required'),\r\n    body('location').optional().isObject().withMessage('Location must be an object'),\r\n    body('location.state').optional().notEmpty().withMessage('State is required'),\r\n    body('location.city').optional().notEmpty().withMessage('City is required'),\r\n    body('location.pincode').optional().matches(/^[0-9]{6}$/).withMessage('Please enter a valid 6-digit pincode'),\r\n    body('specifications').optional().isObject().withMessage('Specifications must be an object'),\r\n    body('specifications.training').optional().isIn(['Basic', 'Intermediate', 'Advanced']).withMessage('Invalid training level'),\r\n    body('specifications.discipline').optional().isArray().withMessage('Discipline must be an array'),\r\n    body('specifications.temperament').optional().notEmpty().withMessage('Temperament is required'),\r\n    body('specifications.healthStatus').optional().notEmpty().withMessage('Health status is required'),\r\n    body('listingStatus').optional().isIn(['draft', 'active', 'sold', 'inactive']).withMessage('Invalid listing status')\r\n];\r\n\r\n// Public routes for buyers\r\nrouter.get('/featured', getFeaturedHorses);\r\nrouter.get('/categories', getCategories);\r\nrouter.get('/price-ranges', getPriceRanges);\r\nrouter.get('/search', searchHorses);\r\n\r\n// Get all horses\r\nrouter.get('/', getHorses);\r\n\r\n// Get single horse\r\nrouter.get('/:id', getHorseById);\r\n\r\n// Create horse listing (Seller only)\r\nrouter.post('/', protect, authorize('seller'), createHorseValidation, createHorseListing);\r\n\r\n// Update horse listing (Seller only)\r\nrouter.put('/:id', protect, authorize('seller'), updateHorseValidation, updateHorseListing);\r\n\r\n// Delete horse listing (Seller only)\r\nrouter.delete('/:id', protect, authorize('seller'), deleteHorseListing);\r\n\r\n// Favorites management (Authenticated users)\r\nrouter.post('/:id/favorite', protect, addToFavorites);\r\nrouter.delete('/:id/favorite', protect, removeFromFavorites);\r\n\r\nmodule.exports = router; "],"mappings":"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","ignoreList":[]}},"mtime":1734037599338},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\horse.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Horse = require('../models/Horse');\nconst Category = require('../models/Category');\nconst User = require('../models/User');\nconst cloudinary = require('cloudinary').v2;\nconst Seller = require('../models/Seller');\n\n// @desc    Get featured horses\n// @route   GET /api/horses/featured\n// @access  Public\nexports.getFeaturedHorses = async (req, res) => {\n  try {\n    const horses = await Horse.find({\n      listingStatus: 'active'\n    }).sort('-statistics.views').limit(6).populate('seller', 'businessName location');\n    res.json({\n      success: true,\n      horses\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get horse categories\n// @route   GET /api/horses/categories\n// @access  Public\nexports.getCategories = async (req, res) => {\n  try {\n    const categories = await Category.find({\n      type: 'horse_breed',\n      status: 'active'\n    }).sort('name');\n    res.json({\n      success: true,\n      categories\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get price ranges\n// @route   GET /api/horses/price-ranges\n// @access  Public\nexports.getPriceRanges = async (req, res) => {\n  try {\n    const ranges = [{\n      min: 0,\n      max: 100000,\n      label: 'Under ₹1 Lakh'\n    }, {\n      min: 100000,\n      max: 300000,\n      label: '₹1-3 Lakhs'\n    }, {\n      min: 300000,\n      max: 500000,\n      label: '₹3-5 Lakhs'\n    }, {\n      min: 500000,\n      max: 1000000,\n      label: '₹5-10 Lakhs'\n    }, {\n      min: 1000000,\n      max: 2000000,\n      label: '₹10-20 Lakhs'\n    }, {\n      min: 2000000,\n      max: null,\n      label: 'Above ₹20 Lakhs'\n    }];\n    res.json({\n      success: true,\n      ranges\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Search horses\n// @route   GET /api/horses/search\n// @access  Public\nexports.searchHorses = async (req, res) => {\n  try {\n    const {\n      breed,\n      gender,\n      minPrice,\n      maxPrice,\n      location,\n      training,\n      discipline,\n      minAge,\n      maxAge,\n      sort = '-createdAt'\n    } = req.query;\n    const query = {\n      listingStatus: 'active'\n    };\n\n    // Apply filters\n    if (breed) query.breed = breed;\n    if (gender) query.gender = gender;\n    if (location) query['location.state'] = location;\n    if (training) query['specifications.training'] = training;\n    if (discipline) query['specifications.discipline'] = discipline;\n\n    // Price range\n    if (minPrice || maxPrice) {\n      query.price = {};\n      if (minPrice) query.price.$gte = minPrice;\n      if (maxPrice) query.price.$lte = maxPrice;\n    }\n\n    // Age range\n    if (minAge || maxAge) {\n      query['age.years'] = {};\n      if (minAge) query['age.years'].$gte = minAge;\n      if (maxAge) query['age.years'].$lte = maxAge;\n    }\n    const horses = await Horse.find(query).sort(sort).populate('seller', 'businessName location');\n    res.json({\n      success: true,\n      horses\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Add horse to favorites\n// @route   POST /api/horses/:id/favorite\n// @access  Private\nexports.addToFavorites = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n    if (!user.favorites) user.favorites = [];\n    if (!user.favorites.includes(req.params.id)) {\n      user.favorites.push(req.params.id);\n      await user.save();\n    }\n    res.json({\n      success: true,\n      message: 'Added to favorites'\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Remove horse from favorites\n// @route   DELETE /api/horses/:id/favorite\n// @access  Private\nexports.removeFromFavorites = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n    if (!user.favorites) user.favorites = [];\n    user.favorites = user.favorites.filter(id => id.toString() !== req.params.id);\n    await user.save();\n    res.json({\n      success: true,\n      message: 'Removed from favorites'\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get all horses\n// @route   GET /api/horses\n// @access  Public\nexports.getHorses = async (req, res) => {\n  try {\n    const horses = await Horse.find().populate('seller', 'businessName location');\n    res.json({\n      success: true,\n      horses\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get single horse\n// @route   GET /api/horses/:id\n// @access  Public\nexports.getHorseById = async (req, res) => {\n  try {\n    const horse = await Horse.findById(req.params.id).populate('seller', 'businessName location');\n    if (!horse) {\n      return res.status(404).json({\n        success: false,\n        message: 'Horse not found'\n      });\n    }\n\n    // Increment views\n    await horse.incrementViews();\n    res.json({\n      success: true,\n      horse\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Create horse listing\n// @route   POST /api/horses\n// @access  Private (Seller only)\nexports.createHorseListing = async (req, res) => {\n  try {\n    // Get seller profile\n    const seller = await Seller.findOne({\n      user: req.user._id\n    });\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller profile not found'\n      });\n    }\n    const horse = await Horse.create({\n      seller: seller._id,\n      ...req.body\n    });\n    res.status(201).json({\n      success: true,\n      horse\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Update horse listing\n// @route   PUT /api/horses/:id\n// @access  Private (Seller only)\nexports.updateHorseListing = async (req, res) => {\n  try {\n    let horse = await Horse.findById(req.params.id);\n    if (!horse) {\n      return res.status(404).json({\n        success: false,\n        message: 'Horse not found'\n      });\n    }\n\n    // Make sure user owns the listing\n    if (horse.seller.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this listing'\n      });\n    }\n    horse = await Horse.findByIdAndUpdate(req.params.id, req.body, {\n      new: true,\n      runValidators: true\n    });\n    res.json({\n      success: true,\n      horse\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Delete horse listing\n// @route   DELETE /api/horses/:id\n// @access  Private (Seller only)\nexports.deleteHorseListing = async (req, res) => {\n  try {\n    const horse = await Horse.findById(req.params.id);\n    if (!horse) {\n      return res.status(404).json({\n        success: false,\n        message: 'Horse not found'\n      });\n    }\n\n    // Make sure user owns the listing\n    if (horse.seller.toString() !== req.user._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to delete this listing'\n      });\n    }\n\n    // Delete images from cloudinary\n    for (const image of horse.images) {\n      if (image.public_id) {\n        await cloudinary.uploader.destroy(image.public_id);\n      }\n    }\n    await horse.remove();\n    res.json({\n      success: true,\n      message: 'Horse listing deleted'\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIb3JzZSIsInJlcXVpcmUiLCJDYXRlZ29yeSIsIlVzZXIiLCJjbG91ZGluYXJ5IiwidjIiLCJTZWxsZXIiLCJleHBvcnRzIiwiZ2V0RmVhdHVyZWRIb3JzZXMiLCJyZXEiLCJyZXMiLCJob3JzZXMiLCJmaW5kIiwibGlzdGluZ1N0YXR1cyIsInNvcnQiLCJsaW1pdCIsInBvcHVsYXRlIiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsImNvbnNvbGUiLCJzdGF0dXMiLCJtZXNzYWdlIiwiZ2V0Q2F0ZWdvcmllcyIsImNhdGVnb3JpZXMiLCJ0eXBlIiwiZ2V0UHJpY2VSYW5nZXMiLCJyYW5nZXMiLCJtaW4iLCJtYXgiLCJsYWJlbCIsInNlYXJjaEhvcnNlcyIsImJyZWVkIiwiZ2VuZGVyIiwibWluUHJpY2UiLCJtYXhQcmljZSIsImxvY2F0aW9uIiwidHJhaW5pbmciLCJkaXNjaXBsaW5lIiwibWluQWdlIiwibWF4QWdlIiwicXVlcnkiLCJwcmljZSIsIiRndGUiLCIkbHRlIiwiYWRkVG9GYXZvcml0ZXMiLCJ1c2VyIiwiZmluZEJ5SWQiLCJfaWQiLCJmYXZvcml0ZXMiLCJpbmNsdWRlcyIsInBhcmFtcyIsImlkIiwicHVzaCIsInNhdmUiLCJyZW1vdmVGcm9tRmF2b3JpdGVzIiwiZmlsdGVyIiwidG9TdHJpbmciLCJnZXRIb3JzZXMiLCJnZXRIb3JzZUJ5SWQiLCJob3JzZSIsImluY3JlbWVudFZpZXdzIiwiY3JlYXRlSG9yc2VMaXN0aW5nIiwic2VsbGVyIiwiZmluZE9uZSIsImNyZWF0ZSIsImJvZHkiLCJ1cGRhdGVIb3JzZUxpc3RpbmciLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIm5ldyIsInJ1blZhbGlkYXRvcnMiLCJkZWxldGVIb3JzZUxpc3RpbmciLCJpbWFnZSIsImltYWdlcyIsInB1YmxpY19pZCIsInVwbG9hZGVyIiwiZGVzdHJveSIsInJlbW92ZSJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcY29udHJvbGxlcnNcXCIsInNvdXJjZXMiOlsiaG9yc2UuY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBIb3JzZSA9IHJlcXVpcmUoJy4uL21vZGVscy9Ib3JzZScpO1xyXG5jb25zdCBDYXRlZ29yeSA9IHJlcXVpcmUoJy4uL21vZGVscy9DYXRlZ29yeScpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuY29uc3QgY2xvdWRpbmFyeSA9IHJlcXVpcmUoJ2Nsb3VkaW5hcnknKS52MjtcclxuY29uc3QgU2VsbGVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1NlbGxlcicpO1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IGZlYXR1cmVkIGhvcnNlc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9ob3JzZXMvZmVhdHVyZWRcclxuLy8gQGFjY2VzcyAgUHVibGljXHJcbmV4cG9ydHMuZ2V0RmVhdHVyZWRIb3JzZXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgaG9yc2VzID0gYXdhaXQgSG9yc2UuZmluZCh7IGxpc3RpbmdTdGF0dXM6ICdhY3RpdmUnIH0pXHJcbiAgICAgICAgICAgIC5zb3J0KCctc3RhdGlzdGljcy52aWV3cycpXHJcbiAgICAgICAgICAgIC5saW1pdCg2KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3NlbGxlcicsICdidXNpbmVzc05hbWUgbG9jYXRpb24nKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBob3JzZXNcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBob3JzZSBjYXRlZ29yaWVzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2hvcnNlcy9jYXRlZ29yaWVzXHJcbi8vIEBhY2Nlc3MgIFB1YmxpY1xyXG5leHBvcnRzLmdldENhdGVnb3JpZXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgY2F0ZWdvcmllcyA9IGF3YWl0IENhdGVnb3J5LmZpbmQoeyBcclxuICAgICAgICAgICAgdHlwZTogJ2hvcnNlX2JyZWVkJyxcclxuICAgICAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyBcclxuICAgICAgICB9KS5zb3J0KCduYW1lJyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgY2F0ZWdvcmllc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHByaWNlIHJhbmdlc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9ob3JzZXMvcHJpY2UtcmFuZ2VzXHJcbi8vIEBhY2Nlc3MgIFB1YmxpY1xyXG5leHBvcnRzLmdldFByaWNlUmFuZ2VzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHJhbmdlcyA9IFtcclxuICAgICAgICAgICAgeyBtaW46IDAsIG1heDogMTAwMDAwLCBsYWJlbDogJ1VuZGVyIOKCuTEgTGFraCcgfSxcclxuICAgICAgICAgICAgeyBtaW46IDEwMDAwMCwgbWF4OiAzMDAwMDAsIGxhYmVsOiAn4oK5MS0zIExha2hzJyB9LFxyXG4gICAgICAgICAgICB7IG1pbjogMzAwMDAwLCBtYXg6IDUwMDAwMCwgbGFiZWw6ICfigrkzLTUgTGFraHMnIH0sXHJcbiAgICAgICAgICAgIHsgbWluOiA1MDAwMDAsIG1heDogMTAwMDAwMCwgbGFiZWw6ICfigrk1LTEwIExha2hzJyB9LFxyXG4gICAgICAgICAgICB7IG1pbjogMTAwMDAwMCwgbWF4OiAyMDAwMDAwLCBsYWJlbDogJ+KCuTEwLTIwIExha2hzJyB9LFxyXG4gICAgICAgICAgICB7IG1pbjogMjAwMDAwMCwgbWF4OiBudWxsLCBsYWJlbDogJ0Fib3ZlIOKCuTIwIExha2hzJyB9XHJcbiAgICAgICAgXTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICByYW5nZXNcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIFNlYXJjaCBob3JzZXNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvaG9yc2VzL3NlYXJjaFxyXG4vLyBAYWNjZXNzICBQdWJsaWNcclxuZXhwb3J0cy5zZWFyY2hIb3JzZXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3Qge1xyXG4gICAgICAgICAgICBicmVlZCxcclxuICAgICAgICAgICAgZ2VuZGVyLFxyXG4gICAgICAgICAgICBtaW5QcmljZSxcclxuICAgICAgICAgICAgbWF4UHJpY2UsXHJcbiAgICAgICAgICAgIGxvY2F0aW9uLFxyXG4gICAgICAgICAgICB0cmFpbmluZyxcclxuICAgICAgICAgICAgZGlzY2lwbGluZSxcclxuICAgICAgICAgICAgbWluQWdlLFxyXG4gICAgICAgICAgICBtYXhBZ2UsXHJcbiAgICAgICAgICAgIHNvcnQgPSAnLWNyZWF0ZWRBdCdcclxuICAgICAgICB9ID0gcmVxLnF1ZXJ5O1xyXG5cclxuICAgICAgICBjb25zdCBxdWVyeSA9IHsgbGlzdGluZ1N0YXR1czogJ2FjdGl2ZScgfTtcclxuXHJcbiAgICAgICAgLy8gQXBwbHkgZmlsdGVyc1xyXG4gICAgICAgIGlmIChicmVlZCkgcXVlcnkuYnJlZWQgPSBicmVlZDtcclxuICAgICAgICBpZiAoZ2VuZGVyKSBxdWVyeS5nZW5kZXIgPSBnZW5kZXI7XHJcbiAgICAgICAgaWYgKGxvY2F0aW9uKSBxdWVyeVsnbG9jYXRpb24uc3RhdGUnXSA9IGxvY2F0aW9uO1xyXG4gICAgICAgIGlmICh0cmFpbmluZykgcXVlcnlbJ3NwZWNpZmljYXRpb25zLnRyYWluaW5nJ10gPSB0cmFpbmluZztcclxuICAgICAgICBpZiAoZGlzY2lwbGluZSkgcXVlcnlbJ3NwZWNpZmljYXRpb25zLmRpc2NpcGxpbmUnXSA9IGRpc2NpcGxpbmU7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJpY2UgcmFuZ2VcclxuICAgICAgICBpZiAobWluUHJpY2UgfHwgbWF4UHJpY2UpIHtcclxuICAgICAgICAgICAgcXVlcnkucHJpY2UgPSB7fTtcclxuICAgICAgICAgICAgaWYgKG1pblByaWNlKSBxdWVyeS5wcmljZS4kZ3RlID0gbWluUHJpY2U7XHJcbiAgICAgICAgICAgIGlmIChtYXhQcmljZSkgcXVlcnkucHJpY2UuJGx0ZSA9IG1heFByaWNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQWdlIHJhbmdlXHJcbiAgICAgICAgaWYgKG1pbkFnZSB8fCBtYXhBZ2UpIHtcclxuICAgICAgICAgICAgcXVlcnlbJ2FnZS55ZWFycyddID0ge307XHJcbiAgICAgICAgICAgIGlmIChtaW5BZ2UpIHF1ZXJ5WydhZ2UueWVhcnMnXS4kZ3RlID0gbWluQWdlO1xyXG4gICAgICAgICAgICBpZiAobWF4QWdlKSBxdWVyeVsnYWdlLnllYXJzJ10uJGx0ZSA9IG1heEFnZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGhvcnNlcyA9IGF3YWl0IEhvcnNlLmZpbmQocXVlcnkpXHJcbiAgICAgICAgICAgIC5zb3J0KHNvcnQpXHJcbiAgICAgICAgICAgIC5wb3B1bGF0ZSgnc2VsbGVyJywgJ2J1c2luZXNzTmFtZSBsb2NhdGlvbicpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIGhvcnNlc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgQWRkIGhvcnNlIHRvIGZhdm9yaXRlc1xyXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvaG9yc2VzLzppZC9mYXZvcml0ZVxyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuYWRkVG9GYXZvcml0ZXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQocmVxLnVzZXIuX2lkKTtcclxuICAgICAgICBpZiAoIXVzZXIuZmF2b3JpdGVzKSB1c2VyLmZhdm9yaXRlcyA9IFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmICghdXNlci5mYXZvcml0ZXMuaW5jbHVkZXMocmVxLnBhcmFtcy5pZCkpIHtcclxuICAgICAgICAgICAgdXNlci5mYXZvcml0ZXMucHVzaChyZXEucGFyYW1zLmlkKTtcclxuICAgICAgICAgICAgYXdhaXQgdXNlci5zYXZlKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBZGRlZCB0byBmYXZvcml0ZXMnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBSZW1vdmUgaG9yc2UgZnJvbSBmYXZvcml0ZXNcclxuLy8gQHJvdXRlICAgREVMRVRFIC9hcGkvaG9yc2VzLzppZC9mYXZvcml0ZVxyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMucmVtb3ZlRnJvbUZhdm9yaXRlcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpO1xyXG4gICAgICAgIGlmICghdXNlci5mYXZvcml0ZXMpIHVzZXIuZmF2b3JpdGVzID0gW107XHJcbiAgICAgICAgXHJcbiAgICAgICAgdXNlci5mYXZvcml0ZXMgPSB1c2VyLmZhdm9yaXRlcy5maWx0ZXIoXHJcbiAgICAgICAgICAgIGlkID0+IGlkLnRvU3RyaW5nKCkgIT09IHJlcS5wYXJhbXMuaWRcclxuICAgICAgICApO1xyXG4gICAgICAgIGF3YWl0IHVzZXIuc2F2ZSgpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdSZW1vdmVkIGZyb20gZmF2b3JpdGVzJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IGFsbCBob3JzZXNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvaG9yc2VzXHJcbi8vIEBhY2Nlc3MgIFB1YmxpY1xyXG5leHBvcnRzLmdldEhvcnNlcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBob3JzZXMgPSBhd2FpdCBIb3JzZS5maW5kKClcclxuICAgICAgICAgICAgLnBvcHVsYXRlKCdzZWxsZXInLCAnYnVzaW5lc3NOYW1lIGxvY2F0aW9uJyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgaG9yc2VzXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgc2luZ2xlIGhvcnNlXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2hvcnNlcy86aWRcclxuLy8gQGFjY2VzcyAgUHVibGljXHJcbmV4cG9ydHMuZ2V0SG9yc2VCeUlkID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGhvcnNlID0gYXdhaXQgSG9yc2UuZmluZEJ5SWQocmVxLnBhcmFtcy5pZClcclxuICAgICAgICAgICAgLnBvcHVsYXRlKCdzZWxsZXInLCAnYnVzaW5lc3NOYW1lIGxvY2F0aW9uJyk7XHJcblxyXG4gICAgICAgIGlmICghaG9yc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0hvcnNlIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBJbmNyZW1lbnQgdmlld3NcclxuICAgICAgICBhd2FpdCBob3JzZS5pbmNyZW1lbnRWaWV3cygpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIGhvcnNlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBDcmVhdGUgaG9yc2UgbGlzdGluZ1xyXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvaG9yc2VzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlciBvbmx5KVxyXG5leHBvcnRzLmNyZWF0ZUhvcnNlTGlzdGluZyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBHZXQgc2VsbGVyIHByb2ZpbGVcclxuICAgICAgICBjb25zdCBzZWxsZXIgPSBhd2FpdCBTZWxsZXIuZmluZE9uZSh7IHVzZXI6IHJlcS51c2VyLl9pZCB9KTtcclxuICAgICAgICBpZiAoIXNlbGxlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU2VsbGVyIHByb2ZpbGUgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGhvcnNlID0gYXdhaXQgSG9yc2UuY3JlYXRlKHtcclxuICAgICAgICAgICAgc2VsbGVyOiBzZWxsZXIuX2lkLFxyXG4gICAgICAgICAgICAuLi5yZXEuYm9keVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIGhvcnNlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBVcGRhdGUgaG9yc2UgbGlzdGluZ1xyXG4vLyBAcm91dGUgICBQVVQgL2FwaS9ob3JzZXMvOmlkXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlciBvbmx5KVxyXG5leHBvcnRzLnVwZGF0ZUhvcnNlTGlzdGluZyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBsZXQgaG9yc2UgPSBhd2FpdCBIb3JzZS5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuXHJcbiAgICAgICAgaWYgKCFob3JzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnSG9yc2Ugbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB1c2VyIG93bnMgdGhlIGxpc3RpbmdcclxuICAgICAgICBpZiAoaG9yc2Uuc2VsbGVyLnRvU3RyaW5nKCkgIT09IHJlcS51c2VyLl9pZC50b1N0cmluZygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byB1cGRhdGUgdGhpcyBsaXN0aW5nJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGhvcnNlID0gYXdhaXQgSG9yc2UuZmluZEJ5SWRBbmRVcGRhdGUoXHJcbiAgICAgICAgICAgIHJlcS5wYXJhbXMuaWQsXHJcbiAgICAgICAgICAgIHJlcS5ib2R5LFxyXG4gICAgICAgICAgICB7IG5ldzogdHJ1ZSwgcnVuVmFsaWRhdG9yczogdHJ1ZSB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBob3JzZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgRGVsZXRlIGhvcnNlIGxpc3RpbmdcclxuLy8gQHJvdXRlICAgREVMRVRFIC9hcGkvaG9yc2VzLzppZFxyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIgb25seSlcclxuZXhwb3J0cy5kZWxldGVIb3JzZUxpc3RpbmcgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgaG9yc2UgPSBhd2FpdCBIb3JzZS5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuXHJcbiAgICAgICAgaWYgKCFob3JzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnSG9yc2Ugbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIE1ha2Ugc3VyZSB1c2VyIG93bnMgdGhlIGxpc3RpbmdcclxuICAgICAgICBpZiAoaG9yc2Uuc2VsbGVyLnRvU3RyaW5nKCkgIT09IHJlcS51c2VyLl9pZC50b1N0cmluZygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byBkZWxldGUgdGhpcyBsaXN0aW5nJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIERlbGV0ZSBpbWFnZXMgZnJvbSBjbG91ZGluYXJ5XHJcbiAgICAgICAgZm9yIChjb25zdCBpbWFnZSBvZiBob3JzZS5pbWFnZXMpIHtcclxuICAgICAgICAgICAgaWYgKGltYWdlLnB1YmxpY19pZCkge1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgY2xvdWRpbmFyeS51cGxvYWRlci5kZXN0cm95KGltYWdlLnB1YmxpY19pZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGF3YWl0IGhvcnNlLnJlbW92ZSgpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdIb3JzZSBsaXN0aW5nIGRlbGV0ZWQnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcbiAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLEtBQUssR0FBR0MsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0FBQ3hDLE1BQU1DLFFBQVEsR0FBR0QsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBQzlDLE1BQU1FLElBQUksR0FBR0YsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU1HLFVBQVUsR0FBR0gsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDSSxFQUFFO0FBQzNDLE1BQU1DLE1BQU0sR0FBR0wsT0FBTyxDQUFDLGtCQUFrQixDQUFDOztBQUUxQztBQUNBO0FBQ0E7QUFDQU0sT0FBTyxDQUFDQyxpQkFBaUIsR0FBRyxP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","map":{"version":3,"names":["Horse","require","Category","User","cloudinary","v2","Seller","exports","getFeaturedHorses","req","res","horses","find","listingStatus","sort","limit","populate","json","success","error","console","status","message","getCategories","categories","type","getPriceRanges","ranges","min","max","label","searchHorses","breed","gender","minPrice","maxPrice","location","training","discipline","minAge","maxAge","query","price","$gte","$lte","addToFavorites","user","findById","_id","favorites","includes","params","id","push","save","removeFromFavorites","filter","toString","getHorses","getHorseById","horse","incrementViews","createHorseListing","seller","findOne","create","body","updateHorseListing","findByIdAndUpdate","new","runValidators","deleteHorseListing","image","images","public_id","uploader","destroy","remove"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["horse.controller.js"],"sourcesContent":["const Horse = require('../models/Horse');\r\nconst Category = require('../models/Category');\r\nconst User = require('../models/User');\r\nconst cloudinary = require('cloudinary').v2;\r\nconst Seller = require('../models/Seller');\r\n\r\n// @desc    Get featured horses\r\n// @route   GET /api/horses/featured\r\n// @access  Public\r\nexports.getFeaturedHorses = async (req, res) => {\r\n    try {\r\n        const horses = await Horse.find({ listingStatus: 'active' })\r\n            .sort('-statistics.views')\r\n            .limit(6)\r\n            .populate('seller', 'businessName location');\r\n\r\n        res.json({\r\n            success: true,\r\n            horses\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get horse categories\r\n// @route   GET /api/horses/categories\r\n// @access  Public\r\nexports.getCategories = async (req, res) => {\r\n    try {\r\n        const categories = await Category.find({ \r\n            type: 'horse_breed',\r\n            status: 'active' \r\n        }).sort('name');\r\n\r\n        res.json({\r\n            success: true,\r\n            categories\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get price ranges\r\n// @route   GET /api/horses/price-ranges\r\n// @access  Public\r\nexports.getPriceRanges = async (req, res) => {\r\n    try {\r\n        const ranges = [\r\n            { min: 0, max: 100000, label: 'Under ₹1 Lakh' },\r\n            { min: 100000, max: 300000, label: '₹1-3 Lakhs' },\r\n            { min: 300000, max: 500000, label: '₹3-5 Lakhs' },\r\n            { min: 500000, max: 1000000, label: '₹5-10 Lakhs' },\r\n            { min: 1000000, max: 2000000, label: '₹10-20 Lakhs' },\r\n            { min: 2000000, max: null, label: 'Above ₹20 Lakhs' }\r\n        ];\r\n\r\n        res.json({\r\n            success: true,\r\n            ranges\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Search horses\r\n// @route   GET /api/horses/search\r\n// @access  Public\r\nexports.searchHorses = async (req, res) => {\r\n    try {\r\n        const {\r\n            breed,\r\n            gender,\r\n            minPrice,\r\n            maxPrice,\r\n            location,\r\n            training,\r\n            discipline,\r\n            minAge,\r\n            maxAge,\r\n            sort = '-createdAt'\r\n        } = req.query;\r\n\r\n        const query = { listingStatus: 'active' };\r\n\r\n        // Apply filters\r\n        if (breed) query.breed = breed;\r\n        if (gender) query.gender = gender;\r\n        if (location) query['location.state'] = location;\r\n        if (training) query['specifications.training'] = training;\r\n        if (discipline) query['specifications.discipline'] = discipline;\r\n        \r\n        // Price range\r\n        if (minPrice || maxPrice) {\r\n            query.price = {};\r\n            if (minPrice) query.price.$gte = minPrice;\r\n            if (maxPrice) query.price.$lte = maxPrice;\r\n        }\r\n\r\n        // Age range\r\n        if (minAge || maxAge) {\r\n            query['age.years'] = {};\r\n            if (minAge) query['age.years'].$gte = minAge;\r\n            if (maxAge) query['age.years'].$lte = maxAge;\r\n        }\r\n\r\n        const horses = await Horse.find(query)\r\n            .sort(sort)\r\n            .populate('seller', 'businessName location');\r\n\r\n        res.json({\r\n            success: true,\r\n            horses\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Add horse to favorites\r\n// @route   POST /api/horses/:id/favorite\r\n// @access  Private\r\nexports.addToFavorites = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id);\r\n        if (!user.favorites) user.favorites = [];\r\n        \r\n        if (!user.favorites.includes(req.params.id)) {\r\n            user.favorites.push(req.params.id);\r\n            await user.save();\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'Added to favorites'\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Remove horse from favorites\r\n// @route   DELETE /api/horses/:id/favorite\r\n// @access  Private\r\nexports.removeFromFavorites = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id);\r\n        if (!user.favorites) user.favorites = [];\r\n        \r\n        user.favorites = user.favorites.filter(\r\n            id => id.toString() !== req.params.id\r\n        );\r\n        await user.save();\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'Removed from favorites'\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get all horses\r\n// @route   GET /api/horses\r\n// @access  Public\r\nexports.getHorses = async (req, res) => {\r\n    try {\r\n        const horses = await Horse.find()\r\n            .populate('seller', 'businessName location');\r\n\r\n        res.json({\r\n            success: true,\r\n            horses\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get single horse\r\n// @route   GET /api/horses/:id\r\n// @access  Public\r\nexports.getHorseById = async (req, res) => {\r\n    try {\r\n        const horse = await Horse.findById(req.params.id)\r\n            .populate('seller', 'businessName location');\r\n\r\n        if (!horse) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Horse not found'\r\n            });\r\n        }\r\n\r\n        // Increment views\r\n        await horse.incrementViews();\r\n\r\n        res.json({\r\n            success: true,\r\n            horse\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Create horse listing\r\n// @route   POST /api/horses\r\n// @access  Private (Seller only)\r\nexports.createHorseListing = async (req, res) => {\r\n    try {\r\n        // Get seller profile\r\n        const seller = await Seller.findOne({ user: req.user._id });\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller profile not found'\r\n            });\r\n        }\r\n\r\n        const horse = await Horse.create({\r\n            seller: seller._id,\r\n            ...req.body\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            horse\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update horse listing\r\n// @route   PUT /api/horses/:id\r\n// @access  Private (Seller only)\r\nexports.updateHorseListing = async (req, res) => {\r\n    try {\r\n        let horse = await Horse.findById(req.params.id);\r\n\r\n        if (!horse) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Horse not found'\r\n            });\r\n        }\r\n\r\n        // Make sure user owns the listing\r\n        if (horse.seller.toString() !== req.user._id.toString()) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to update this listing'\r\n            });\r\n        }\r\n\r\n        horse = await Horse.findByIdAndUpdate(\r\n            req.params.id,\r\n            req.body,\r\n            { new: true, runValidators: true }\r\n        );\r\n\r\n        res.json({\r\n            success: true,\r\n            horse\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Delete horse listing\r\n// @route   DELETE /api/horses/:id\r\n// @access  Private (Seller only)\r\nexports.deleteHorseListing = async (req, res) => {\r\n    try {\r\n        const horse = await Horse.findById(req.params.id);\r\n\r\n        if (!horse) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Horse not found'\r\n            });\r\n        }\r\n\r\n        // Make sure user owns the listing\r\n        if (horse.seller.toString() !== req.user._id.toString()) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to delete this listing'\r\n            });\r\n        }\r\n\r\n        // Delete images from cloudinary\r\n        for (const image of horse.images) {\r\n            if (image.public_id) {\r\n                await cloudinary.uploader.destroy(image.public_id);\r\n            }\r\n        }\r\n\r\n        await horse.remove();\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'Horse listing deleted'\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n "],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,iBAAiB,CAAC;AACxC,MAAMC,QAAQ,GAAGD,OAAO,CAAC,oBAAoB,CAAC;AAC9C,MAAME,IAAI,GAAGF,OAAO,CAAC,gBAAgB,CAAC;AACtC,MAAMG,UAAU,GAAGH,OAAO,CAAC,YAAY,CAAC,CAACI,EAAE;AAC3C,MAAMC,MAAM,GAAGL,OAAO,CAAC,kBAAkB,CAAC;;AAE1C;AACA;AACA;AACAM,OAAO,CAACC,iBAAiB,GAAG,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAC5C,IAAI;IACA,MAAMC,MAAM,GAAG,MAAMX,KAAK,CAACY,IAAI,CAAC;MAAEC,aAAa,EAAE;IAAS,CAAC,CAAC,CACvDC,IAAI,CAAC,mBAAmB,CAAC,CACzBC,KAAK,CAAC,CAAC,CAAC,CACRC,QAAQ,CAAC,QAAQ,EAAE,uBAAuB,CAAC;IAEhDN,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbP;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOQ,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACgB,aAAa,GAAG,OAAOd,GAAG,EAAEC,GAAG,KAAK;EACxC,IAAI;IACA,MAAMc,UAAU,GAAG,MAAMtB,QAAQ,CAACU,IAAI,CAAC;MACnCa,IAAI,EAAE,aAAa;MACnBJ,MAAM,EAAE;IACZ,CAAC,CAAC,CAACP,IAAI,CAAC,MAAM,CAAC;IAEfJ,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbM;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOL,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACmB,cAAc,GAAG,OAAOjB,GAAG,EAAEC,GAAG,KAAK;EACzC,IAAI;IACA,MAAMiB,MAAM,GAAG,CACX;MAAEC,GAAG,EAAE,CAAC;MAAEC,GAAG,EAAE,MAAM;MAAEC,KAAK,EAAE;IAAgB,CAAC,EAC/C;MAAEF,GAAG,EAAE,MAAM;MAAEC,GAAG,EAAE,MAAM;MAAEC,KAAK,EAAE;IAAa,CAAC,EACjD;MAAEF,GAAG,EAAE,MAAM;MAAEC,GAAG,EAAE,MAAM;MAAEC,KAAK,EAAE;IAAa,CAAC,EACjD;MAAEF,GAAG,EAAE,MAAM;MAAEC,GAAG,EAAE,OAAO;MAAEC,KAAK,EAAE;IAAc,CAAC,EACnD;MAAEF,GAAG,EAAE,OAAO;MAAEC,GAAG,EAAE,OAAO;MAAEC,KAAK,EAAE;IAAe,CAAC,EACrD;MAAEF,GAAG,EAAE,OAAO;MAAEC,GAAG,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAkB,CAAC,CACxD;IAEDpB,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbS;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOR,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACwB,YAAY,GAAG,OAAOtB,GAAG,EAAEC,GAAG,KAAK;EACvC,IAAI;IACA,MAAM;MACFsB,KAAK;MACLC,MAAM;MACNC,QAAQ;MACRC,QAAQ;MACRC,QAAQ;MACRC,QAAQ;MACRC,UAAU;MACVC,MAAM;MACNC,MAAM;MACN1B,IAAI,GAAG;IACX,CAAC,GAAGL,GAAG,CAACgC,KAAK;IAEb,MAAMA,KAAK,GAAG;MAAE5B,aAAa,EAAE;IAAS,CAAC;;IAEzC;IACA,IAAImB,KAAK,EAAES,KAAK,CAACT,KAAK,GAAGA,KAAK;IAC9B,IAAIC,MAAM,EAAEQ,KAAK,CAACR,MAAM,GAAGA,MAAM;IACjC,IAAIG,QAAQ,EAAEK,KAAK,CAAC,gBAAgB,CAAC,GAAGL,QAAQ;IAChD,IAAIC,QAAQ,EAAEI,KAAK,CAAC,yBAAyB,CAAC,GAAGJ,QAAQ;IACzD,IAAIC,UAAU,EAAEG,KAAK,CAAC,2BAA2B,CAAC,GAAGH,UAAU;;IAE/D;IACA,IAAIJ,QAAQ,IAAIC,QAAQ,EAAE;MACtBM,KAAK,CAACC,KAAK,GAAG,CAAC,CAAC;MAChB,IAAIR,QAAQ,EAAEO,KAAK,CAACC,KAAK,CAACC,IAAI,GAAGT,QAAQ;MACzC,IAAIC,QAAQ,EAAEM,KAAK,CAACC,KAAK,CAACE,IAAI,GAAGT,QAAQ;IAC7C;;IAEA;IACA,IAAII,MAAM,IAAIC,MAAM,EAAE;MAClBC,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;MACvB,IAAIF,MAAM,EAAEE,KAAK,CAAC,WAAW,CAAC,CAACE,IAAI,GAAGJ,MAAM;MAC5C,IAAIC,MAAM,EAAEC,KAAK,CAAC,WAAW,CAAC,CAACG,IAAI,GAAGJ,MAAM;IAChD;IAEA,MAAM7B,MAAM,GAAG,MAAMX,KAAK,CAACY,IAAI,CAAC6B,KAAK,CAAC,CACjC3B,IAAI,CAACA,IAAI,CAAC,CACVE,QAAQ,CAAC,QAAQ,EAAE,uBAAuB,CAAC;IAEhDN,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbP;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOQ,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACsC,cAAc,GAAG,OAAOpC,GAAG,EAAEC,GAAG,KAAK;EACzC,IAAI;IACA,MAAMoC,IAAI,GAAG,MAAM3C,IAAI,CAAC4C,QAAQ,CAACtC,GAAG,CAACqC,IAAI,CAACE,GAAG,CAAC;IAC9C,IAAI,CAACF,IAAI,CAACG,SAAS,EAAEH,IAAI,CAACG,SAAS,GAAG,EAAE;IAExC,IAAI,CAACH,IAAI,CAACG,SAAS,CAACC,QAAQ,CAACzC,GAAG,CAAC0C,MAAM,CAACC,EAAE,CAAC,EAAE;MACzCN,IAAI,CAACG,SAAS,CAACI,IAAI,CAAC5C,GAAG,CAAC0C,MAAM,CAACC,EAAE,CAAC;MAClC,MAAMN,IAAI,CAACQ,IAAI,CAAC,CAAC;IACrB;IAEA5C,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbI,OAAO,EAAE;IACb,CAAC,CAAC;EACN,CAAC,CAAC,OAAOH,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACgD,mBAAmB,GAAG,OAAO9C,GAAG,EAAEC,GAAG,KAAK;EAC9C,IAAI;IACA,MAAMoC,IAAI,GAAG,MAAM3C,IAAI,CAAC4C,QAAQ,CAACtC,GAAG,CAACqC,IAAI,CAACE,GAAG,CAAC;IAC9C,IAAI,CAACF,IAAI,CAACG,SAAS,EAAEH,IAAI,CAACG,SAAS,GAAG,EAAE;IAExCH,IAAI,CAACG,SAAS,GAAGH,IAAI,CAACG,SAAS,CAACO,MAAM,CAClCJ,EAAE,IAAIA,EAAE,CAACK,QAAQ,CAAC,CAAC,KAAKhD,GAAG,CAAC0C,MAAM,CAACC,EACvC,CAAC;IACD,MAAMN,IAAI,CAACQ,IAAI,CAAC,CAAC;IAEjB5C,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbI,OAAO,EAAE;IACb,CAAC,CAAC;EACN,CAAC,CAAC,OAAOH,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACmD,SAAS,GAAG,OAAOjD,GAAG,EAAEC,GAAG,KAAK;EACpC,IAAI;IACA,MAAMC,MAAM,GAAG,MAAMX,KAAK,CAACY,IAAI,CAAC,CAAC,CAC5BI,QAAQ,CAAC,QAAQ,EAAE,uBAAuB,CAAC;IAEhDN,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbP;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOQ,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACoD,YAAY,GAAG,OAAOlD,GAAG,EAAEC,GAAG,KAAK;EACvC,IAAI;IACA,MAAMkD,KAAK,GAAG,MAAM5D,KAAK,CAAC+C,QAAQ,CAACtC,GAAG,CAAC0C,MAAM,CAACC,EAAE,CAAC,CAC5CpC,QAAQ,CAAC,QAAQ,EAAE,uBAAuB,CAAC;IAEhD,IAAI,CAAC4C,KAAK,EAAE;MACR,OAAOlD,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdI,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,MAAMsC,KAAK,CAACC,cAAc,CAAC,CAAC;IAE5BnD,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACb0C;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOzC,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACuD,kBAAkB,GAAG,OAAOrD,GAAG,EAAEC,GAAG,KAAK;EAC7C,IAAI;IACA;IACA,MAAMqD,MAAM,GAAG,MAAMzD,MAAM,CAAC0D,OAAO,CAAC;MAAElB,IAAI,EAAErC,GAAG,CAACqC,IAAI,CAACE;IAAI,CAAC,CAAC;IAC3D,IAAI,CAACe,MAAM,EAAE;MACT,OAAOrD,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdI,OAAO,EAAE;MACb,CAAC,CAAC;IACN;IAEA,MAAMsC,KAAK,GAAG,MAAM5D,KAAK,CAACiE,MAAM,CAAC;MAC7BF,MAAM,EAAEA,MAAM,CAACf,GAAG;MAClB,GAAGvC,GAAG,CAACyD;IACX,CAAC,CAAC;IAEFxD,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,IAAI;MACb0C;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOzC,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAAC4D,kBAAkB,GAAG,OAAO1D,GAAG,EAAEC,GAAG,KAAK;EAC7C,IAAI;IACA,IAAIkD,KAAK,GAAG,MAAM5D,KAAK,CAAC+C,QAAQ,CAACtC,GAAG,CAAC0C,MAAM,CAACC,EAAE,CAAC;IAE/C,IAAI,CAACQ,KAAK,EAAE;MACR,OAAOlD,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdI,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,IAAIsC,KAAK,CAACG,MAAM,CAACN,QAAQ,CAAC,CAAC,KAAKhD,GAAG,CAACqC,IAAI,CAACE,GAAG,CAACS,QAAQ,CAAC,CAAC,EAAE;MACrD,OAAO/C,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdI,OAAO,EAAE;MACb,CAAC,CAAC;IACN;IAEAsC,KAAK,GAAG,MAAM5D,KAAK,CAACoE,iBAAiB,CACjC3D,GAAG,CAAC0C,MAAM,CAACC,EAAE,EACb3C,GAAG,CAACyD,IAAI,EACR;MAAEG,GAAG,EAAE,IAAI;MAAEC,aAAa,EAAE;IAAK,CACrC,CAAC;IAED5D,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACb0C;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOzC,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAf,OAAO,CAACgE,kBAAkB,GAAG,OAAO9D,GAAG,EAAEC,GAAG,KAAK;EAC7C,IAAI;IACA,MAAMkD,KAAK,GAAG,MAAM5D,KAAK,CAAC+C,QAAQ,CAACtC,GAAG,CAAC0C,MAAM,CAACC,EAAE,CAAC;IAEjD,IAAI,CAACQ,KAAK,EAAE;MACR,OAAOlD,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdI,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,IAAIsC,KAAK,CAACG,MAAM,CAACN,QAAQ,CAAC,CAAC,KAAKhD,GAAG,CAACqC,IAAI,CAACE,GAAG,CAACS,QAAQ,CAAC,CAAC,EAAE;MACrD,OAAO/C,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdI,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,KAAK,MAAMkD,KAAK,IAAIZ,KAAK,CAACa,MAAM,EAAE;MAC9B,IAAID,KAAK,CAACE,SAAS,EAAE;QACjB,MAAMtE,UAAU,CAACuE,QAAQ,CAACC,OAAO,CAACJ,KAAK,CAACE,SAAS,CAAC;MACtD;IACJ;IAEA,MAAMd,KAAK,CAACiB,MAAM,CAAC,CAAC;IAEpBnE,GAAG,CAACO,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbI,OAAO,EAAE;IACb,CAAC,CAAC;EACN,CAAC,CAAC,OAAOH,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBT,GAAG,CAACW,MAAM,CAAC,GAAG,CAAC,CAACJ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdI,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC","ignoreList":[]}},"mtime":1734044352122},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Category.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst categorySchema = new mongoose.Schema({\n  name: {\n    type: String,\n    required: true,\n    unique: true\n  },\n  type: {\n    type: String,\n    enum: ['horse_breed', 'equipment', 'service'],\n    required: true\n  },\n  description: String,\n  parent: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Category'\n  },\n  attributes: [{\n    name: String,\n    type: String,\n    required: Boolean,\n    options: [String] // For dropdown/multiple choice attributes\n  }],\n  status: {\n    type: String,\n    enum: ['active', 'inactive'],\n    default: 'active'\n  },\n  image: {\n    url: String,\n    public_id: String\n  },\n  metadata: {\n    seoTitle: String,\n    seoDescription: String,\n    keywords: [String]\n  },\n  sortOrder: {\n    type: Number,\n    default: 0\n  }\n}, {\n  timestamps: true\n});\n\n// Create indexes\ncategorySchema.index({\n  name: 1,\n  type: 1\n}, {\n  unique: true\n});\ncategorySchema.index({\n  parent: 1\n});\nmodule.exports = mongoose.model('Category', categorySchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJjYXRlZ29yeVNjaGVtYSIsIlNjaGVtYSIsIm5hbWUiLCJ0eXBlIiwiU3RyaW5nIiwicmVxdWlyZWQiLCJ1bmlxdWUiLCJlbnVtIiwiZGVzY3JpcHRpb24iLCJwYXJlbnQiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwiYXR0cmlidXRlcyIsIkJvb2xlYW4iLCJvcHRpb25zIiwic3RhdHVzIiwiZGVmYXVsdCIsImltYWdlIiwidXJsIiwicHVibGljX2lkIiwibWV0YWRhdGEiLCJzZW9UaXRsZSIsInNlb0Rlc2NyaXB0aW9uIiwia2V5d29yZHMiLCJzb3J0T3JkZXIiLCJOdW1iZXIiLCJ0aW1lc3RhbXBzIiwiaW5kZXgiLCJtb2R1bGUiLCJleHBvcnRzIiwibW9kZWwiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJDYXRlZ29yeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG5jb25zdCBjYXRlZ29yeVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gICAgbmFtZToge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICB1bmlxdWU6IHRydWVcclxuICAgIH0sXHJcbiAgICB0eXBlOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGVudW06IFsnaG9yc2VfYnJlZWQnLCAnZXF1aXBtZW50JywgJ3NlcnZpY2UnXSxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGRlc2NyaXB0aW9uOiBTdHJpbmcsXHJcbiAgICBwYXJlbnQ6IHtcclxuICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgcmVmOiAnQ2F0ZWdvcnknXHJcbiAgICB9LFxyXG4gICAgYXR0cmlidXRlczogW3tcclxuICAgICAgICBuYW1lOiBTdHJpbmcsXHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIHJlcXVpcmVkOiBCb29sZWFuLFxyXG4gICAgICAgIG9wdGlvbnM6IFtTdHJpbmddIC8vIEZvciBkcm9wZG93bi9tdWx0aXBsZSBjaG9pY2UgYXR0cmlidXRlc1xyXG4gICAgfV0sXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZW51bTogWydhY3RpdmUnLCAnaW5hY3RpdmUnXSxcclxuICAgICAgICBkZWZhdWx0OiAnYWN0aXZlJ1xyXG4gICAgfSxcclxuICAgIGltYWdlOiB7XHJcbiAgICAgICAgdXJsOiBTdHJpbmcsXHJcbiAgICAgICAgcHVibGljX2lkOiBTdHJpbmdcclxuICAgIH0sXHJcbiAgICBtZXRhZGF0YToge1xyXG4gICAgICAgIHNlb1RpdGxlOiBTdHJpbmcsXHJcbiAgICAgICAgc2VvRGVzY3JpcHRpb246IFN0cmluZyxcclxuICAgICAgICBrZXl3b3JkczogW1N0cmluZ11cclxuICAgIH0sXHJcbiAgICBzb3J0T3JkZXI6IHtcclxuICAgICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgICAgZGVmYXVsdDogMFxyXG4gICAgfVxyXG59LCB7XHJcbiAgICB0aW1lc3RhbXBzOiB0cnVlXHJcbn0pO1xyXG5cclxuLy8gQ3JlYXRlIGluZGV4ZXNcclxuY2F0ZWdvcnlTY2hlbWEuaW5kZXgoeyBuYW1lOiAxLCB0eXBlOiAxIH0sIHsgdW5pcXVlOiB0cnVlIH0pO1xyXG5jYXRlZ29yeVNjaGVtYS5pbmRleCh7IHBhcmVudDogMSB9KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ0NhdGVnb3J5JywgY2F0ZWdvcnlTY2hlbWEpOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQztBQUVwQyxNQUFNQyxjQUFjLEdBQUcsSUFBSUYsUUFBUSxDQUFDRyxNQUFNLENBQUM7RUFDdkNDLElBQUksRUFBRTtJQUNGQyxJQUFJLEVBQUVDLE1BQU07SUFDWkMsUUFBUSxFQUFFLElBQUk7SUFDZEMsTUFBTSxFQUFFO0VBQ1osQ0FBQztFQUNESCxJQUFJLEVBQUU7SUFDRkEsSUFBSSxFQUFFQyxNQUFNO0lBQ1pHLElBQUksRUFBRSxDQUFDLGFBQWEsRUFBRSxXQUFXLEVBQUUsU0FBUyxDQUFDO0lBQzdDRixRQUFRLEVBQUU7RUFDZCxDQUFDO0VBQ0RHLFdBQVcsRUFBRUosTUFBTTtFQUNuQkssTUFBTSxFQUFFO0lBQ0pOLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNTLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFO0VBQ1QsQ0FBQztFQUNEQyxVQUFVLEVBQUUsQ0FBQztJQUNUWCxJQUFJLEVBQUVFLE1BQU07SUFDWkQsSUFBSSxFQUFFQyxNQUFNO0lBQ1pDLFFBQVEsRUFBRVMsT0FBTztJQUNqQkMsT0FBTyxFQUFFLENBQUNYLE1BQU0sQ0FBQyxDQUFDO0VBQ3RCLENBQUMsQ0FBQztFQUNGWSxNQUFNLEVBQUU7SUFDSmIsSUFBSSxFQUFFQyxNQUFNO0lBQ1pHLElBQUksRUFBRSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUM7SUFDNUJVLE9BQU8sRUFBRTtFQUNiLENBQUM7RUFDREMsS0FBSyxFQUFFO0lBQ0hDLEdBQUcsRUFBRWYsTUFBTTtJQUNYZ0IsU0FBUyxFQUFFaEI7RUFDZixDQUFDO0VBQ0RpQixRQUFRLEVBQUU7SUFDTkMsUUFBUSxFQUFFbEIsTUFBTTtJQUNoQm1CLGNBQWMsRUFBRW5CLE1BQU07SUFDdEJvQixRQUFRLEVBQUUsQ0FBQ3BCLE1BQU07RUFDckIsQ0FBQztFQUNEcUIsU0FBUyxFQUFFO0lBQ1B0QixJQUFJLEVBQUV1QixNQUFNO0lBQ1pULE9BQU8sRUFBRTtFQUNiO0FBQ0osQ0FBQyxFQUFFO0VBQ0NVLFVBQVUsRUFBRTtBQUNoQixDQUFDLENBQUM7O0FBRUY7QUFDQTNCLGNBQWMsQ0FBQzRCLEtBQUssQ0FBQztFQUFFMUIsSUFBSSxFQUFFLENBQUM7RUFBRUMsSUFBSSxFQUFFO0FBQUUsQ0FBQyxFQUFFO0VBQUVHLE1BQU0sRUFBRTtBQUFLLENBQUMsQ0FBQztBQUM1RE4sY0FBYyxDQUFDNEIsS0FBSyxDQUFDO0VBQUVuQixNQUFNLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFFbkNvQixNQUFNLENBQUNDLE9BQU8sR0FBR2hDLFFBQVEsQ0FBQ2lDLEtBQUssQ0FBQyxVQUFVLEVBQUUvQixjQUFjLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["mongoose","require","categorySchema","Schema","name","type","String","required","unique","enum","description","parent","Types","ObjectId","ref","attributes","Boolean","options","status","default","image","url","public_id","metadata","seoTitle","seoDescription","keywords","sortOrder","Number","timestamps","index","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Category.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst categorySchema = new mongoose.Schema({\r\n    name: {\r\n        type: String,\r\n        required: true,\r\n        unique: true\r\n    },\r\n    type: {\r\n        type: String,\r\n        enum: ['horse_breed', 'equipment', 'service'],\r\n        required: true\r\n    },\r\n    description: String,\r\n    parent: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Category'\r\n    },\r\n    attributes: [{\r\n        name: String,\r\n        type: String,\r\n        required: Boolean,\r\n        options: [String] // For dropdown/multiple choice attributes\r\n    }],\r\n    status: {\r\n        type: String,\r\n        enum: ['active', 'inactive'],\r\n        default: 'active'\r\n    },\r\n    image: {\r\n        url: String,\r\n        public_id: String\r\n    },\r\n    metadata: {\r\n        seoTitle: String,\r\n        seoDescription: String,\r\n        keywords: [String]\r\n    },\r\n    sortOrder: {\r\n        type: Number,\r\n        default: 0\r\n    }\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Create indexes\r\ncategorySchema.index({ name: 1, type: 1 }, { unique: true });\r\ncategorySchema.index({ parent: 1 });\r\n\r\nmodule.exports = mongoose.model('Category', categorySchema); "],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,cAAc,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EACvCC,IAAI,EAAE;IACFC,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,IAAI;IACdC,MAAM,EAAE;EACZ,CAAC;EACDH,IAAI,EAAE;IACFA,IAAI,EAAEC,MAAM;IACZG,IAAI,EAAE,CAAC,aAAa,EAAE,WAAW,EAAE,SAAS,CAAC;IAC7CF,QAAQ,EAAE;EACd,CAAC;EACDG,WAAW,EAAEJ,MAAM;EACnBK,MAAM,EAAE;IACJN,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACS,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE;EACT,CAAC;EACDC,UAAU,EAAE,CAAC;IACTX,IAAI,EAAEE,MAAM;IACZD,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAES,OAAO;IACjBC,OAAO,EAAE,CAACX,MAAM,CAAC,CAAC;EACtB,CAAC,CAAC;EACFY,MAAM,EAAE;IACJb,IAAI,EAAEC,MAAM;IACZG,IAAI,EAAE,CAAC,QAAQ,EAAE,UAAU,CAAC;IAC5BU,OAAO,EAAE;EACb,CAAC;EACDC,KAAK,EAAE;IACHC,GAAG,EAAEf,MAAM;IACXgB,SAAS,EAAEhB;EACf,CAAC;EACDiB,QAAQ,EAAE;IACNC,QAAQ,EAAElB,MAAM;IAChBmB,cAAc,EAAEnB,MAAM;IACtBoB,QAAQ,EAAE,CAACpB,MAAM;EACrB,CAAC;EACDqB,SAAS,EAAE;IACPtB,IAAI,EAAEuB,MAAM;IACZT,OAAO,EAAE;EACb;AACJ,CAAC,EAAE;EACCU,UAAU,EAAE;AAChB,CAAC,CAAC;;AAEF;AACA3B,cAAc,CAAC4B,KAAK,CAAC;EAAE1B,IAAI,EAAE,CAAC;EAAEC,IAAI,EAAE;AAAE,CAAC,EAAE;EAAEG,MAAM,EAAE;AAAK,CAAC,CAAC;AAC5DN,cAAc,CAAC4B,KAAK,CAAC;EAAEnB,MAAM,EAAE;AAAE,CAAC,CAAC;AAEnCoB,MAAM,CAACC,OAAO,GAAGhC,QAAQ,CAACiC,KAAK,CAAC,UAAU,EAAE/B,cAAc,CAAC","ignoreList":[]}},"mtime":1734021699175},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\inquiry.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  createInquiry,\n  getInquiryById,\n  updateInquiryStatus,\n  respondToInquiry,\n  getSellerInquiries,\n  getBuyerInquiries\n} = require('../controllers/inquiry.controller');\n\n// Validation middleware\nconst createInquiryValidation = [body('horse').notEmpty().withMessage('Horse ID is required'), body('message').notEmpty().withMessage('Message is required'), body('contactPreference').isIn(['email', 'phone', 'whatsapp']).withMessage('Valid contact preference is required')];\nconst updateStatusValidation = [body('status').isIn(['pending', 'responded', 'closed']).withMessage('Valid status is required')];\nconst respondValidation = [body('message').notEmpty().withMessage('Response message is required')];\n\n// Get all inquiries for a seller\nrouter.get('/seller', protect, authorize('seller'), getSellerInquiries);\n\n// Get all inquiries for a buyer\nrouter.get('/buyer', protect, getBuyerInquiries);\n\n// Get single inquiry\nrouter.get('/:id', protect, getInquiryById);\n\n// Create inquiry\nrouter.post('/', protect, createInquiryValidation, createInquiry);\n\n// Update inquiry status\nrouter.put('/:id/status', protect, authorize('seller'), updateStatusValidation, updateInquiryStatus);\n\n// Respond to inquiry\nrouter.post('/:id/respond', protect, authorize('seller'), respondValidation, respondToInquiry);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJib2R5IiwiY3JlYXRlSW5xdWlyeSIsImdldElucXVpcnlCeUlkIiwidXBkYXRlSW5xdWlyeVN0YXR1cyIsInJlc3BvbmRUb0lucXVpcnkiLCJnZXRTZWxsZXJJbnF1aXJpZXMiLCJnZXRCdXllcklucXVpcmllcyIsImNyZWF0ZUlucXVpcnlWYWxpZGF0aW9uIiwibm90RW1wdHkiLCJ3aXRoTWVzc2FnZSIsImlzSW4iLCJ1cGRhdGVTdGF0dXNWYWxpZGF0aW9uIiwicmVzcG9uZFZhbGlkYXRpb24iLCJnZXQiLCJwb3N0IiwicHV0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xccm91dGVzXFwiLCJzb3VyY2VzIjpbImlucXVpcnkucm91dGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHsgcHJvdGVjdCwgYXV0aG9yaXplIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlcy9hdXRoLm1pZGRsZXdhcmUnKTtcclxuY29uc3QgeyBib2R5IH0gPSByZXF1aXJlKCdleHByZXNzLXZhbGlkYXRvcicpO1xyXG5jb25zdCB7XHJcbiAgICBjcmVhdGVJbnF1aXJ5LFxyXG4gICAgZ2V0SW5xdWlyeUJ5SWQsXHJcbiAgICB1cGRhdGVJbnF1aXJ5U3RhdHVzLFxyXG4gICAgcmVzcG9uZFRvSW5xdWlyeSxcclxuICAgIGdldFNlbGxlcklucXVpcmllcyxcclxuICAgIGdldEJ1eWVySW5xdWlyaWVzXHJcbn0gPSByZXF1aXJlKCcuLi9jb250cm9sbGVycy9pbnF1aXJ5LmNvbnRyb2xsZXInKTtcclxuXHJcbi8vIFZhbGlkYXRpb24gbWlkZGxld2FyZVxyXG5jb25zdCBjcmVhdGVJbnF1aXJ5VmFsaWRhdGlvbiA9IFtcclxuICAgIGJvZHkoJ2hvcnNlJykubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnSG9yc2UgSUQgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ21lc3NhZ2UnKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdNZXNzYWdlIGlzIHJlcXVpcmVkJyksXHJcbiAgICBib2R5KCdjb250YWN0UHJlZmVyZW5jZScpXHJcbiAgICAgICAgLmlzSW4oWydlbWFpbCcsICdwaG9uZScsICd3aGF0c2FwcCddKVxyXG4gICAgICAgIC53aXRoTWVzc2FnZSgnVmFsaWQgY29udGFjdCBwcmVmZXJlbmNlIGlzIHJlcXVpcmVkJylcclxuXTtcclxuXHJcbmNvbnN0IHVwZGF0ZVN0YXR1c1ZhbGlkYXRpb24gPSBbXHJcbiAgICBib2R5KCdzdGF0dXMnKVxyXG4gICAgICAgIC5pc0luKFsncGVuZGluZycsICdyZXNwb25kZWQnLCAnY2xvc2VkJ10pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdWYWxpZCBzdGF0dXMgaXMgcmVxdWlyZWQnKVxyXG5dO1xyXG5cclxuY29uc3QgcmVzcG9uZFZhbGlkYXRpb24gPSBbXHJcbiAgICBib2R5KCdtZXNzYWdlJykubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnUmVzcG9uc2UgbWVzc2FnZSBpcyByZXF1aXJlZCcpXHJcbl07XHJcblxyXG4vLyBHZXQgYWxsIGlucXVpcmllcyBmb3IgYSBzZWxsZXJcclxucm91dGVyLmdldCgnL3NlbGxlcicsIHByb3RlY3QsIGF1dGhvcml6ZSgnc2VsbGVyJyksIGdldFNlbGxlcklucXVpcmllcyk7XHJcblxyXG4vLyBHZXQgYWxsIGlucXVpcmllcyBmb3IgYSBidXllclxyXG5yb3V0ZXIuZ2V0KCcvYnV5ZXInLCBwcm90ZWN0LCBnZXRCdXllcklucXVpcmllcyk7XHJcblxyXG4vLyBHZXQgc2luZ2xlIGlucXVpcnlcclxucm91dGVyLmdldCgnLzppZCcsIHByb3RlY3QsIGdldElucXVpcnlCeUlkKTtcclxuXHJcbi8vIENyZWF0ZSBpbnF1aXJ5XHJcbnJvdXRlci5wb3N0KCcvJywgcHJvdGVjdCwgY3JlYXRlSW5xdWlyeVZhbGlkYXRpb24sIGNyZWF0ZUlucXVpcnkpO1xyXG5cclxuLy8gVXBkYXRlIGlucXVpcnkgc3RhdHVzXHJcbnJvdXRlci5wdXQoJy86aWQvc3RhdHVzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdzZWxsZXInKSwgdXBkYXRlU3RhdHVzVmFsaWRhdGlvbiwgdXBkYXRlSW5xdWlyeVN0YXR1cyk7XHJcblxyXG4vLyBSZXNwb25kIHRvIGlucXVpcnlcclxucm91dGVyLnBvc3QoJy86aWQvcmVzcG9uZCcsIHByb3RlY3QsIGF1dGhvcml6ZSgnc2VsbGVyJyksIHJlc3BvbmRWYWxpZGF0aW9uLCByZXNwb25kVG9JbnF1aXJ5KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTTtFQUFFQyxPQUFPO0VBQUVDO0FBQVUsQ0FBQyxHQUFHSixPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDeEUsTUFBTTtFQUFFSztBQUFLLENBQUMsR0FBR0wsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzdDLE1BQU07RUFDRk0sYUFBYTtFQUNiQyxjQUFjO0VBQ2RDLG1CQUFtQjtFQUNuQkMsZ0JBQWdCO0VBQ2hCQyxrQkFBa0I7RUFDbEJDO0FBQ0osQ0FBQyxHQUFHWCxPQUFPLENBQUMsbUNBQW1DLENBQUM7O0FBRWhEO0FBQ0EsTUFBTVksdUJBQXVCLEdBQUcsQ0FDNUJQLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQ1EsUUFBUSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLHNCQUFzQixDQUFDLEVBQzVEVCxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUNRLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxFQUM3RFQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQ3BCVSxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQ3BDRCxXQUFXLENBQUMsc0NBQXNDLENBQUMsQ0FDM0Q7QUFFRCxNQUFNRSxzQkFBc0IsR0FBRyxDQUMzQlgsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUNUVSxJQUFJLENBQUMsQ0FBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQ3hDRCxXQUFXLENBQUMsMEJBQTBCLENBQUMsQ0FDL0M7QUFFRCxNQUFNRyxpQkFBaUIsR0FBRyxDQUN0QlosSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDUSxRQUFRLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUMsOEJBQThCLENBQUMsQ0FDekU7O0FBRUQ7QUFDQWIsTUFBTSxDQUFDaUIsR0FBRyxDQUFDLFNBQVMsRUFBRWYsT0FBTyxFQUFFQyxTQUFTLENBQUMsUUFBUSxDQUFDLEVBQUVNLGtCQUFrQixDQUFDOztBQUV2RTtBQUNBVCxNQUFNLENBQUNpQixHQUFHLENBQUMsUUFBUSxFQUFFZixPQUFPLEVBQUVRLGlCQUFpQixDQUFDOztBQUVoRDtBQUNBVixNQUFNLENBQUNpQixHQUFHLENBQUMsTUFBTSxFQUFFZixPQUFPLEVBQUVJLGNBQWMsQ0FBQzs7QUFFM0M7QUFDQU4sTUFBTSxDQUFDa0IsSUFBSSxDQUFDLEdBQUcsRUFBRWhCLE9BQU8sRUFBRVMsdUJBQXVCLEVBQUVOLGFBQWEsQ0FBQzs7QUFFakU7QUFDQUwsTUFBTSxDQUFDbUIsR0FBRyxDQUFDLGFBQWEsRUFBRWpCLE9BQU8sRUFBRUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFWSxzQkFBc0IsRUFBRVIsbUJBQW1CLENBQUM7O0FBRXBHO0FBQ0FQLE1BQU0sQ0FBQ2tCLElBQUksQ0FBQyxjQUFjLEVBQUVoQixPQUFPLEVBQUVDLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRWEsaUJBQWlCLEVBQUVSLGdCQUFnQixDQUFDO0FBRTlGWSxNQUFNLENBQUNDLE9BQU8sR0FBR3JCLE1BQU0iLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["express","require","router","Router","protect","authorize","body","createInquiry","getInquiryById","updateInquiryStatus","respondToInquiry","getSellerInquiries","getBuyerInquiries","createInquiryValidation","notEmpty","withMessage","isIn","updateStatusValidation","respondValidation","get","post","put","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["inquiry.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect, authorize } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    createInquiry,\r\n    getInquiryById,\r\n    updateInquiryStatus,\r\n    respondToInquiry,\r\n    getSellerInquiries,\r\n    getBuyerInquiries\r\n} = require('../controllers/inquiry.controller');\r\n\r\n// Validation middleware\r\nconst createInquiryValidation = [\r\n    body('horse').notEmpty().withMessage('Horse ID is required'),\r\n    body('message').notEmpty().withMessage('Message is required'),\r\n    body('contactPreference')\r\n        .isIn(['email', 'phone', 'whatsapp'])\r\n        .withMessage('Valid contact preference is required')\r\n];\r\n\r\nconst updateStatusValidation = [\r\n    body('status')\r\n        .isIn(['pending', 'responded', 'closed'])\r\n        .withMessage('Valid status is required')\r\n];\r\n\r\nconst respondValidation = [\r\n    body('message').notEmpty().withMessage('Response message is required')\r\n];\r\n\r\n// Get all inquiries for a seller\r\nrouter.get('/seller', protect, authorize('seller'), getSellerInquiries);\r\n\r\n// Get all inquiries for a buyer\r\nrouter.get('/buyer', protect, getBuyerInquiries);\r\n\r\n// Get single inquiry\r\nrouter.get('/:id', protect, getInquiryById);\r\n\r\n// Create inquiry\r\nrouter.post('/', protect, createInquiryValidation, createInquiry);\r\n\r\n// Update inquiry status\r\nrouter.put('/:id/status', protect, authorize('seller'), updateStatusValidation, updateInquiryStatus);\r\n\r\n// Respond to inquiry\r\nrouter.post('/:id/respond', protect, authorize('seller'), respondValidation, respondToInquiry);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC,OAAO;EAAEC;AAAU,CAAC,GAAGJ,OAAO,CAAC,gCAAgC,CAAC;AACxE,MAAM;EAAEK;AAAK,CAAC,GAAGL,OAAO,CAAC,mBAAmB,CAAC;AAC7C,MAAM;EACFM,aAAa;EACbC,cAAc;EACdC,mBAAmB;EACnBC,gBAAgB;EAChBC,kBAAkB;EAClBC;AACJ,CAAC,GAAGX,OAAO,CAAC,mCAAmC,CAAC;;AAEhD;AACA,MAAMY,uBAAuB,GAAG,CAC5BP,IAAI,CAAC,OAAO,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,sBAAsB,CAAC,EAC5DT,IAAI,CAAC,SAAS,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,qBAAqB,CAAC,EAC7DT,IAAI,CAAC,mBAAmB,CAAC,CACpBU,IAAI,CAAC,CAAC,OAAO,EAAE,OAAO,EAAE,UAAU,CAAC,CAAC,CACpCD,WAAW,CAAC,sCAAsC,CAAC,CAC3D;AAED,MAAME,sBAAsB,GAAG,CAC3BX,IAAI,CAAC,QAAQ,CAAC,CACTU,IAAI,CAAC,CAAC,SAAS,EAAE,WAAW,EAAE,QAAQ,CAAC,CAAC,CACxCD,WAAW,CAAC,0BAA0B,CAAC,CAC/C;AAED,MAAMG,iBAAiB,GAAG,CACtBZ,IAAI,CAAC,SAAS,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,8BAA8B,CAAC,CACzE;;AAED;AACAb,MAAM,CAACiB,GAAG,CAAC,SAAS,EAAEf,OAAO,EAAEC,SAAS,CAAC,QAAQ,CAAC,EAAEM,kBAAkB,CAAC;;AAEvE;AACAT,MAAM,CAACiB,GAAG,CAAC,QAAQ,EAAEf,OAAO,EAAEQ,iBAAiB,CAAC;;AAEhD;AACAV,MAAM,CAACiB,GAAG,CAAC,MAAM,EAAEf,OAAO,EAAEI,cAAc,CAAC;;AAE3C;AACAN,MAAM,CAACkB,IAAI,CAAC,GAAG,EAAEhB,OAAO,EAAES,uBAAuB,EAAEN,aAAa,CAAC;;AAEjE;AACAL,MAAM,CAACmB,GAAG,CAAC,aAAa,EAAEjB,OAAO,EAAEC,SAAS,CAAC,QAAQ,CAAC,EAAEY,sBAAsB,EAAER,mBAAmB,CAAC;;AAEpG;AACAP,MAAM,CAACkB,IAAI,CAAC,cAAc,EAAEhB,OAAO,EAAEC,SAAS,CAAC,QAAQ,CAAC,EAAEa,iBAAiB,EAAER,gBAAgB,CAAC;AAE9FY,MAAM,CAACC,OAAO,GAAGrB,MAAM","ignoreList":[]}},"mtime":1734030958768},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\inquiry.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Inquiry = require('../models/Inquiry');\nconst Horse = require('../models/Horse');\nconst Seller = require('../models/Seller');\n\n// @desc    Create inquiry\n// @route   POST /api/inquiries\n// @access  Private\nexports.createInquiry = async (req, res) => {\n  try {\n    const {\n      horse: horseId,\n      message,\n      contactPreference\n    } = req.body;\n\n    // Check if horse exists\n    const horse = await Horse.findById(horseId);\n    if (!horse) {\n      return res.status(404).json({\n        success: false,\n        message: 'Horse not found'\n      });\n    }\n\n    // Get seller from horse\n    const seller = await Seller.findById(horse.seller);\n    if (!seller) {\n      return res.status(404).json({\n        success: false,\n        message: 'Seller not found'\n      });\n    }\n\n    // Create inquiry\n    const inquiry = await Inquiry.create({\n      user: req.user._id,\n      seller: seller._id,\n      horse: horseId,\n      message,\n      contactPreference,\n      metadata: {\n        userAgent: req.headers['user-agent'],\n        ip: req.ip\n      }\n    });\n\n    // Increment horse inquiries\n    await horse.incrementInquiries();\n    res.status(201).json({\n      success: true,\n      inquiry\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get all inquiries for a seller\n// @route   GET /api/inquiries/seller\n// @access  Private (Seller)\nexports.getSellerInquiries = async (req, res) => {\n  try {\n    const inquiries = await Inquiry.find({\n      seller: req.seller._id\n    }).populate('user', 'name email').populate('horse', 'name').sort('-createdAt');\n    res.json({\n      success: true,\n      inquiries\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get all inquiries for a buyer\n// @route   GET /api/inquiries/buyer\n// @access  Private\nexports.getBuyerInquiries = async (req, res) => {\n  try {\n    const inquiries = await Inquiry.find({\n      user: req.user._id\n    }).populate('seller', 'businessName').populate('horse', 'name').sort('-createdAt');\n    res.json({\n      success: true,\n      inquiries\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get single inquiry\n// @route   GET /api/inquiries/:id\n// @access  Private\nexports.getInquiryById = async (req, res) => {\n  try {\n    const inquiry = await Inquiry.findById(req.params.id).populate('user', 'name email').populate('seller', 'businessName').populate('horse', 'name');\n    if (!inquiry) {\n      return res.status(404).json({\n        success: false,\n        message: 'Inquiry not found'\n      });\n    }\n\n    // Check if user is authorized to view this inquiry\n    const isSeller = req.seller && inquiry.seller.toString() === req.seller._id.toString();\n    const isBuyer = inquiry.user.toString() === req.user._id.toString();\n    if (!isSeller && !isBuyer) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to view this inquiry'\n      });\n    }\n    res.json({\n      success: true,\n      inquiry\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Update inquiry status\n// @route   PUT /api/inquiries/:id/status\n// @access  Private (Seller)\nexports.updateInquiryStatus = async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    const inquiry = await Inquiry.findById(req.params.id);\n    if (!inquiry) {\n      return res.status(404).json({\n        success: false,\n        message: 'Inquiry not found'\n      });\n    }\n\n    // Check if seller owns this inquiry\n    if (inquiry.seller.toString() !== req.seller._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this inquiry'\n      });\n    }\n    inquiry.status = status;\n    inquiry.lastActivity = Date.now();\n    await inquiry.save();\n    res.json({\n      success: true,\n      inquiry\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Respond to inquiry\n// @route   POST /api/inquiries/:id/respond\n// @access  Private (Seller)\nexports.respondToInquiry = async (req, res) => {\n  try {\n    const {\n      message\n    } = req.body;\n    const inquiry = await Inquiry.findById(req.params.id);\n    if (!inquiry) {\n      return res.status(404).json({\n        success: false,\n        message: 'Inquiry not found'\n      });\n    }\n\n    // Check if seller owns this inquiry\n    if (inquiry.seller.toString() !== req.seller._id.toString()) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to respond to this inquiry'\n      });\n    }\n    inquiry.response = {\n      message,\n      date: Date.now()\n    };\n    inquiry.status = 'responded';\n    inquiry.lastActivity = Date.now();\n    await inquiry.save();\n    res.json({\n      success: true,\n      inquiry\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnF1aXJ5IiwicmVxdWlyZSIsIkhvcnNlIiwiU2VsbGVyIiwiZXhwb3J0cyIsImNyZWF0ZUlucXVpcnkiLCJyZXEiLCJyZXMiLCJob3JzZSIsImhvcnNlSWQiLCJtZXNzYWdlIiwiY29udGFjdFByZWZlcmVuY2UiLCJib2R5IiwiZmluZEJ5SWQiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsInNlbGxlciIsImlucXVpcnkiLCJjcmVhdGUiLCJ1c2VyIiwiX2lkIiwibWV0YWRhdGEiLCJ1c2VyQWdlbnQiLCJoZWFkZXJzIiwiaXAiLCJpbmNyZW1lbnRJbnF1aXJpZXMiLCJlcnJvciIsImNvbnNvbGUiLCJnZXRTZWxsZXJJbnF1aXJpZXMiLCJpbnF1aXJpZXMiLCJmaW5kIiwicG9wdWxhdGUiLCJzb3J0IiwiZ2V0QnV5ZXJJbnF1aXJpZXMiLCJnZXRJbnF1aXJ5QnlJZCIsInBhcmFtcyIsImlkIiwiaXNTZWxsZXIiLCJ0b1N0cmluZyIsImlzQnV5ZXIiLCJ1cGRhdGVJbnF1aXJ5U3RhdHVzIiwibGFzdEFjdGl2aXR5IiwiRGF0ZSIsIm5vdyIsInNhdmUiLCJyZXNwb25kVG9JbnF1aXJ5IiwicmVzcG9uc2UiLCJkYXRlIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxjb250cm9sbGVyc1xcIiwic291cmNlcyI6WyJpbnF1aXJ5LmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgSW5xdWlyeSA9IHJlcXVpcmUoJy4uL21vZGVscy9JbnF1aXJ5Jyk7XHJcbmNvbnN0IEhvcnNlID0gcmVxdWlyZSgnLi4vbW9kZWxzL0hvcnNlJyk7XHJcbmNvbnN0IFNlbGxlciA9IHJlcXVpcmUoJy4uL21vZGVscy9TZWxsZXInKTtcclxuXHJcbi8vIEBkZXNjICAgIENyZWF0ZSBpbnF1aXJ5XHJcbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9pbnF1aXJpZXNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLmNyZWF0ZUlucXVpcnkgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBob3JzZTogaG9yc2VJZCwgbWVzc2FnZSwgY29udGFjdFByZWZlcmVuY2UgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiBob3JzZSBleGlzdHNcclxuICAgICAgICBjb25zdCBob3JzZSA9IGF3YWl0IEhvcnNlLmZpbmRCeUlkKGhvcnNlSWQpO1xyXG4gICAgICAgIGlmICghaG9yc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0hvcnNlIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBHZXQgc2VsbGVyIGZyb20gaG9yc2VcclxuICAgICAgICBjb25zdCBzZWxsZXIgPSBhd2FpdCBTZWxsZXIuZmluZEJ5SWQoaG9yc2Uuc2VsbGVyKTtcclxuICAgICAgICBpZiAoIXNlbGxlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnU2VsbGVyIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDcmVhdGUgaW5xdWlyeVxyXG4gICAgICAgIGNvbnN0IGlucXVpcnkgPSBhd2FpdCBJbnF1aXJ5LmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHVzZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgc2VsbGVyOiBzZWxsZXIuX2lkLFxyXG4gICAgICAgICAgICBob3JzZTogaG9yc2VJZCxcclxuICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAgY29udGFjdFByZWZlcmVuY2UsXHJcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICB1c2VyQWdlbnQ6IHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J10sXHJcbiAgICAgICAgICAgICAgICBpcDogcmVxLmlwXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gSW5jcmVtZW50IGhvcnNlIGlucXVpcmllc1xyXG4gICAgICAgIGF3YWl0IGhvcnNlLmluY3JlbWVudElucXVpcmllcygpO1xyXG5cclxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIGlucXVpcnlcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBhbGwgaW5xdWlyaWVzIGZvciBhIHNlbGxlclxyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9pbnF1aXJpZXMvc2VsbGVyXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlcilcclxuZXhwb3J0cy5nZXRTZWxsZXJJbnF1aXJpZXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgaW5xdWlyaWVzID0gYXdhaXQgSW5xdWlyeS5maW5kKHsgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCB9KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3VzZXInLCAnbmFtZSBlbWFpbCcpXHJcbiAgICAgICAgICAgIC5wb3B1bGF0ZSgnaG9yc2UnLCAnbmFtZScpXHJcbiAgICAgICAgICAgIC5zb3J0KCctY3JlYXRlZEF0Jyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgaW5xdWlyaWVzXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgYWxsIGlucXVpcmllcyBmb3IgYSBidXllclxyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9pbnF1aXJpZXMvYnV5ZXJcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLmdldEJ1eWVySW5xdWlyaWVzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGlucXVpcmllcyA9IGF3YWl0IElucXVpcnkuZmluZCh7IHVzZXI6IHJlcS51c2VyLl9pZCB9KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3NlbGxlcicsICdidXNpbmVzc05hbWUnKVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ2hvcnNlJywgJ25hbWUnKVxyXG4gICAgICAgICAgICAuc29ydCgnLWNyZWF0ZWRBdCcpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIGlucXVpcmllc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHNpbmdsZSBpbnF1aXJ5XHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2lucXVpcmllcy86aWRcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLmdldElucXVpcnlCeUlkID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IGlucXVpcnkgPSBhd2FpdCBJbnF1aXJ5LmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpXHJcbiAgICAgICAgICAgIC5wb3B1bGF0ZSgndXNlcicsICduYW1lIGVtYWlsJylcclxuICAgICAgICAgICAgLnBvcHVsYXRlKCdzZWxsZXInLCAnYnVzaW5lc3NOYW1lJylcclxuICAgICAgICAgICAgLnBvcHVsYXRlKCdob3JzZScsICduYW1lJyk7XHJcblxyXG4gICAgICAgIGlmICghaW5xdWlyeSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnSW5xdWlyeSBub3QgZm91bmQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhdXRob3JpemVkIHRvIHZpZXcgdGhpcyBpbnF1aXJ5XHJcbiAgICAgICAgY29uc3QgaXNTZWxsZXIgPSByZXEuc2VsbGVyICYmIGlucXVpcnkuc2VsbGVyLnRvU3RyaW5nKCkgPT09IHJlcS5zZWxsZXIuX2lkLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgY29uc3QgaXNCdXllciA9IGlucXVpcnkudXNlci50b1N0cmluZygpID09PSByZXEudXNlci5faWQudG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgaWYgKCFpc1NlbGxlciAmJiAhaXNCdXllcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnTm90IGF1dGhvcml6ZWQgdG8gdmlldyB0aGlzIGlucXVpcnknXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBpbnF1aXJ5XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBVcGRhdGUgaW5xdWlyeSBzdGF0dXNcclxuLy8gQHJvdXRlICAgUFVUIC9hcGkvaW5xdWlyaWVzLzppZC9zdGF0dXNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoU2VsbGVyKVxyXG5leHBvcnRzLnVwZGF0ZUlucXVpcnlTdGF0dXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBzdGF0dXMgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICBjb25zdCBpbnF1aXJ5ID0gYXdhaXQgSW5xdWlyeS5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuICAgICAgICBpZiAoIWlucXVpcnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0lucXVpcnkgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIHNlbGxlciBvd25zIHRoaXMgaW5xdWlyeVxyXG4gICAgICAgIGlmIChpbnF1aXJ5LnNlbGxlci50b1N0cmluZygpICE9PSByZXEuc2VsbGVyLl9pZC50b1N0cmluZygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byB1cGRhdGUgdGhpcyBpbnF1aXJ5J1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlucXVpcnkuc3RhdHVzID0gc3RhdHVzO1xyXG4gICAgICAgIGlucXVpcnkubGFzdEFjdGl2aXR5ID0gRGF0ZS5ub3coKTtcclxuICAgICAgICBhd2FpdCBpbnF1aXJ5LnNhdmUoKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBpbnF1aXJ5XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBSZXNwb25kIHRvIGlucXVpcnlcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL2lucXVpcmllcy86aWQvcmVzcG9uZFxyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIpXHJcbmV4cG9ydHMucmVzcG9uZFRvSW5xdWlyeSA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IG1lc3NhZ2UgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICBjb25zdCBpbnF1aXJ5ID0gYXdhaXQgSW5xdWlyeS5maW5kQnlJZChyZXEucGFyYW1zLmlkKTtcclxuICAgICAgICBpZiAoIWlucXVpcnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0lucXVpcnkgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIHNlbGxlciBvd25zIHRoaXMgaW5xdWlyeVxyXG4gICAgICAgIGlmIChpbnF1aXJ5LnNlbGxlci50b1N0cmluZygpICE9PSByZXEuc2VsbGVyLl9pZC50b1N0cmluZygpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byByZXNwb25kIHRvIHRoaXMgaW5xdWlyeSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpbnF1aXJ5LnJlc3BvbnNlID0ge1xyXG4gICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgICAgICBkYXRlOiBEYXRlLm5vdygpXHJcbiAgICAgICAgfTtcclxuICAgICAgICBpbnF1aXJ5LnN0YXR1cyA9ICdyZXNwb25kZWQnO1xyXG4gICAgICAgIGlucXVpcnkubGFzdEFjdGl2aXR5ID0gRGF0ZS5ub3coKTtcclxuICAgICAgICBhd2FpdCBpbnF1aXJ5LnNhdmUoKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBpbnF1aXJ5XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDNUMsTUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsa0JBQWtCLENBQUM7O0FBRTFDO0FBQ0E7QUFDQTtBQUNBRyxPQUFPLENBQUNDLGFBQWEsR0FBRyxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUN4QyxJQUFJO0lBQ0EsTUFBTTtNQUFFQyxLQUFLLEVBQUVDLE9BQU87TUFBRUMsT0FBTztNQUFFQztJQUFrQixDQUFDLEdBQUdMLEdBQUcsQ0FBQ00sSUFBSTs7SUFFL0Q7SUFDQSxNQUFNSixLQUFLLEdBQUcsTUFBTU4sS0FBSyxDQUFDVyxRQUFRLENBQUNKLE9BQU8sQ0FBQztJQUMzQyxJQUFJLENBQUNELEtBQUssRUFBRTtNQUNSLE9BQU9ELEdBQUcsQ0FBQ08sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUM7UUFDeEJDLE9BQU8sRUFBRSxLQUFLO1FBQ2ROLE9BQU8sRUFBRTtNQUNiLENBQUMsQ0FBQztJQUNOOztJQUVBO0lBQ0EsTUFBTU8sTUFBTSxHQUFHLE1B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","map":{"version":3,"names":["Inquiry","require","Horse","Seller","exports","createInquiry","req","res","horse","horseId","message","contactPreference","body","findById","status","json","success","seller","inquiry","create","user","_id","metadata","userAgent","headers","ip","incrementInquiries","error","console","getSellerInquiries","inquiries","find","populate","sort","getBuyerInquiries","getInquiryById","params","id","isSeller","toString","isBuyer","updateInquiryStatus","lastActivity","Date","now","save","respondToInquiry","response","date"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["inquiry.controller.js"],"sourcesContent":["const Inquiry = require('../models/Inquiry');\r\nconst Horse = require('../models/Horse');\r\nconst Seller = require('../models/Seller');\r\n\r\n// @desc    Create inquiry\r\n// @route   POST /api/inquiries\r\n// @access  Private\r\nexports.createInquiry = async (req, res) => {\r\n    try {\r\n        const { horse: horseId, message, contactPreference } = req.body;\r\n\r\n        // Check if horse exists\r\n        const horse = await Horse.findById(horseId);\r\n        if (!horse) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Horse not found'\r\n            });\r\n        }\r\n\r\n        // Get seller from horse\r\n        const seller = await Seller.findById(horse.seller);\r\n        if (!seller) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Seller not found'\r\n            });\r\n        }\r\n\r\n        // Create inquiry\r\n        const inquiry = await Inquiry.create({\r\n            user: req.user._id,\r\n            seller: seller._id,\r\n            horse: horseId,\r\n            message,\r\n            contactPreference,\r\n            metadata: {\r\n                userAgent: req.headers['user-agent'],\r\n                ip: req.ip\r\n            }\r\n        });\r\n\r\n        // Increment horse inquiries\r\n        await horse.incrementInquiries();\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            inquiry\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get all inquiries for a seller\r\n// @route   GET /api/inquiries/seller\r\n// @access  Private (Seller)\r\nexports.getSellerInquiries = async (req, res) => {\r\n    try {\r\n        const inquiries = await Inquiry.find({ seller: req.seller._id })\r\n            .populate('user', 'name email')\r\n            .populate('horse', 'name')\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            inquiries\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get all inquiries for a buyer\r\n// @route   GET /api/inquiries/buyer\r\n// @access  Private\r\nexports.getBuyerInquiries = async (req, res) => {\r\n    try {\r\n        const inquiries = await Inquiry.find({ user: req.user._id })\r\n            .populate('seller', 'businessName')\r\n            .populate('horse', 'name')\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            inquiries\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get single inquiry\r\n// @route   GET /api/inquiries/:id\r\n// @access  Private\r\nexports.getInquiryById = async (req, res) => {\r\n    try {\r\n        const inquiry = await Inquiry.findById(req.params.id)\r\n            .populate('user', 'name email')\r\n            .populate('seller', 'businessName')\r\n            .populate('horse', 'name');\r\n\r\n        if (!inquiry) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Inquiry not found'\r\n            });\r\n        }\r\n\r\n        // Check if user is authorized to view this inquiry\r\n        const isSeller = req.seller && inquiry.seller.toString() === req.seller._id.toString();\r\n        const isBuyer = inquiry.user.toString() === req.user._id.toString();\r\n\r\n        if (!isSeller && !isBuyer) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to view this inquiry'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            inquiry\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update inquiry status\r\n// @route   PUT /api/inquiries/:id/status\r\n// @access  Private (Seller)\r\nexports.updateInquiryStatus = async (req, res) => {\r\n    try {\r\n        const { status } = req.body;\r\n\r\n        const inquiry = await Inquiry.findById(req.params.id);\r\n        if (!inquiry) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Inquiry not found'\r\n            });\r\n        }\r\n\r\n        // Check if seller owns this inquiry\r\n        if (inquiry.seller.toString() !== req.seller._id.toString()) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to update this inquiry'\r\n            });\r\n        }\r\n\r\n        inquiry.status = status;\r\n        inquiry.lastActivity = Date.now();\r\n        await inquiry.save();\r\n\r\n        res.json({\r\n            success: true,\r\n            inquiry\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Respond to inquiry\r\n// @route   POST /api/inquiries/:id/respond\r\n// @access  Private (Seller)\r\nexports.respondToInquiry = async (req, res) => {\r\n    try {\r\n        const { message } = req.body;\r\n\r\n        const inquiry = await Inquiry.findById(req.params.id);\r\n        if (!inquiry) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Inquiry not found'\r\n            });\r\n        }\r\n\r\n        // Check if seller owns this inquiry\r\n        if (inquiry.seller.toString() !== req.seller._id.toString()) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to respond to this inquiry'\r\n            });\r\n        }\r\n\r\n        inquiry.response = {\r\n            message,\r\n            date: Date.now()\r\n        };\r\n        inquiry.status = 'responded';\r\n        inquiry.lastActivity = Date.now();\r\n        await inquiry.save();\r\n\r\n        res.json({\r\n            success: true,\r\n            inquiry\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,mBAAmB,CAAC;AAC5C,MAAMC,KAAK,GAAGD,OAAO,CAAC,iBAAiB,CAAC;AACxC,MAAME,MAAM,GAAGF,OAAO,CAAC,kBAAkB,CAAC;;AAE1C;AACA;AACA;AACAG,OAAO,CAACC,aAAa,GAAG,OAAOC,GAAG,EAAEC,GAAG,KAAK;EACxC,IAAI;IACA,MAAM;MAAEC,KAAK,EAAEC,OAAO;MAAEC,OAAO;MAAEC;IAAkB,CAAC,GAAGL,GAAG,CAACM,IAAI;;IAE/D;IACA,MAAMJ,KAAK,GAAG,MAAMN,KAAK,CAACW,QAAQ,CAACJ,OAAO,CAAC;IAC3C,IAAI,CAACD,KAAK,EAAE;MACR,OAAOD,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,MAAMO,MAAM,GAAG,MAAMd,MAAM,CAACU,QAAQ,CAACL,KAAK,CAACS,MAAM,CAAC;IAClD,IAAI,CAACA,MAAM,EAAE;MACT,OAAOV,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,MAAMQ,OAAO,GAAG,MAAMlB,OAAO,CAACmB,MAAM,CAAC;MACjCC,IAAI,EAAEd,GAAG,CAACc,IAAI,CAACC,GAAG;MAClBJ,MAAM,EAAEA,MAAM,CAACI,GAAG;MAClBb,KAAK,EAAEC,OAAO;MACdC,OAAO;MACPC,iBAAiB;MACjBW,QAAQ,EAAE;QACNC,SAAS,EAAEjB,GAAG,CAACkB,OAAO,CAAC,YAAY,CAAC;QACpCC,EAAE,EAAEnB,GAAG,CAACmB;MACZ;IACJ,CAAC,CAAC;;IAEF;IACA,MAAMjB,KAAK,CAACkB,kBAAkB,CAAC,CAAC;IAEhCnB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBC,OAAO,EAAE,IAAI;MACbE;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOS,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBpB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdN,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAN,OAAO,CAACyB,kBAAkB,GAAG,OAAOvB,GAAG,EAAEC,GAAG,KAAK;EAC7C,IAAI;IACA,MAAMuB,SAAS,GAAG,MAAM9B,OAAO,CAAC+B,IAAI,CAAC;MAAEd,MAAM,EAAEX,GAAG,CAACW,MAAM,CAACI;IAAI,CAAC,CAAC,CAC3DW,QAAQ,CAAC,MAAM,EAAE,YAAY,CAAC,CAC9BA,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAC,CACzBC,IAAI,CAAC,YAAY,CAAC;IAEvB1B,GAAG,CAACQ,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbc;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOH,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBpB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdN,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAN,OAAO,CAAC8B,iBAAiB,GAAG,OAAO5B,GAAG,EAAEC,GAAG,KAAK;EAC5C,IAAI;IACA,MAAMuB,SAAS,GAAG,MAAM9B,OAAO,CAAC+B,IAAI,CAAC;MAAEX,IAAI,EAAEd,GAAG,CAACc,IAAI,CAACC;IAAI,CAAC,CAAC,CACvDW,QAAQ,CAAC,QAAQ,EAAE,cAAc,CAAC,CAClCA,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAC,CACzBC,IAAI,CAAC,YAAY,CAAC;IAEvB1B,GAAG,CAACQ,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbc;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOH,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBpB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdN,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAN,OAAO,CAAC+B,cAAc,GAAG,OAAO7B,GAAG,EAAEC,GAAG,KAAK;EACzC,IAAI;IACA,MAAMW,OAAO,GAAG,MAAMlB,OAAO,CAACa,QAAQ,CAACP,GAAG,CAAC8B,MAAM,CAACC,EAAE,CAAC,CAChDL,QAAQ,CAAC,MAAM,EAAE,YAAY,CAAC,CAC9BA,QAAQ,CAAC,QAAQ,EAAE,cAAc,CAAC,CAClCA,QAAQ,CAAC,OAAO,EAAE,MAAM,CAAC;IAE9B,IAAI,CAACd,OAAO,EAAE;MACV,OAAOX,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,MAAM4B,QAAQ,GAAGhC,GAAG,CAACW,MAAM,IAAIC,OAAO,CAACD,MAAM,CAACsB,QAAQ,CAAC,CAAC,KAAKjC,GAAG,CAACW,MAAM,CAACI,GAAG,CAACkB,QAAQ,CAAC,CAAC;IACtF,MAAMC,OAAO,GAAGtB,OAAO,CAACE,IAAI,CAACmB,QAAQ,CAAC,CAAC,KAAKjC,GAAG,CAACc,IAAI,CAACC,GAAG,CAACkB,QAAQ,CAAC,CAAC;IAEnE,IAAI,CAACD,QAAQ,IAAI,CAACE,OAAO,EAAE;MACvB,OAAOjC,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;IAEAH,GAAG,CAACQ,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbE;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOS,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBpB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdN,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAN,OAAO,CAACqC,mBAAmB,GAAG,OAAOnC,GAAG,EAAEC,GAAG,KAAK;EAC9C,IAAI;IACA,MAAM;MAAEO;IAAO,CAAC,GAAGR,GAAG,CAACM,IAAI;IAE3B,MAAMM,OAAO,GAAG,MAAMlB,OAAO,CAACa,QAAQ,CAACP,GAAG,CAAC8B,MAAM,CAACC,EAAE,CAAC;IACrD,IAAI,CAACnB,OAAO,EAAE;MACV,OAAOX,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,IAAIQ,OAAO,CAACD,MAAM,CAACsB,QAAQ,CAAC,CAAC,KAAKjC,GAAG,CAACW,MAAM,CAACI,GAAG,CAACkB,QAAQ,CAAC,CAAC,EAAE;MACzD,OAAOhC,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;IAEAQ,OAAO,CAACJ,MAAM,GAAGA,MAAM;IACvBI,OAAO,CAACwB,YAAY,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACjC,MAAM1B,OAAO,CAAC2B,IAAI,CAAC,CAAC;IAEpBtC,GAAG,CAACQ,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbE;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOS,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBpB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdN,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC;;AAED;AACA;AACA;AACAN,OAAO,CAAC0C,gBAAgB,GAAG,OAAOxC,GAAG,EAAEC,GAAG,KAAK;EAC3C,IAAI;IACA,MAAM;MAAEG;IAAQ,CAAC,GAAGJ,GAAG,CAACM,IAAI;IAE5B,MAAMM,OAAO,GAAG,MAAMlB,OAAO,CAACa,QAAQ,CAACP,GAAG,CAAC8B,MAAM,CAACC,EAAE,CAAC;IACrD,IAAI,CAACnB,OAAO,EAAE;MACV,OAAOX,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,IAAIQ,OAAO,CAACD,MAAM,CAACsB,QAAQ,CAAC,CAAC,KAAKjC,GAAG,CAACW,MAAM,CAACI,GAAG,CAACkB,QAAQ,CAAC,CAAC,EAAE;MACzD,OAAOhC,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdN,OAAO,EAAE;MACb,CAAC,CAAC;IACN;IAEAQ,OAAO,CAAC6B,QAAQ,GAAG;MACfrC,OAAO;MACPsC,IAAI,EAAEL,IAAI,CAACC,GAAG,CAAC;IACnB,CAAC;IACD1B,OAAO,CAACJ,MAAM,GAAG,WAAW;IAC5BI,OAAO,CAACwB,YAAY,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACjC,MAAM1B,OAAO,CAAC2B,IAAI,CAAC,CAAC;IAEpBtC,GAAG,CAACQ,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbE;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOS,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBpB,GAAG,CAACO,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdN,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC","ignoreList":[]}},"mtime":1734044437493},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\transaction.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  createTransaction,\n  getTransactions,\n  getTransactionById,\n  updateTransactionStatus,\n  getSellerTransactions,\n  getAdminTransactions\n} = require('../controllers/transaction.controller');\n\n// Validation middleware\nconst createTransactionValidation = [body('horse').notEmpty().withMessage('Horse ID is required'), body('amount').isNumeric().withMessage('Amount must be a number'), body('paymentMethod').isIn(['razorpay', 'bank_transfer', 'platform']).withMessage('Valid payment method is required')];\nconst updateStatusValidation = [body('status').isIn(['pending', 'completed', 'failed', 'refunded']).withMessage('Valid status is required')];\n\n// Get all transactions (Admin only)\nrouter.get('/admin', protect, authorize('admin'), getAdminTransactions);\n\n// Get seller's transactions\nrouter.get('/seller', protect, authorize('seller'), getSellerTransactions);\n\n// Get all transactions for current user\nrouter.get('/', protect, getTransactions);\n\n// Get single transaction\nrouter.get('/:id', protect, getTransactionById);\n\n// Create transaction\nrouter.post('/', protect, createTransactionValidation, createTransaction);\n\n// Update transaction status (Admin only)\nrouter.put('/:id/status', protect, authorize('admin'), updateStatusValidation, updateTransactionStatus);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJib2R5IiwiY3JlYXRlVHJhbnNhY3Rpb24iLCJnZXRUcmFuc2FjdGlvbnMiLCJnZXRUcmFuc2FjdGlvbkJ5SWQiLCJ1cGRhdGVUcmFuc2FjdGlvblN0YXR1cyIsImdldFNlbGxlclRyYW5zYWN0aW9ucyIsImdldEFkbWluVHJhbnNhY3Rpb25zIiwiY3JlYXRlVHJhbnNhY3Rpb25WYWxpZGF0aW9uIiwibm90RW1wdHkiLCJ3aXRoTWVzc2FnZSIsImlzTnVtZXJpYyIsImlzSW4iLCJ1cGRhdGVTdGF0dXNWYWxpZGF0aW9uIiwiZ2V0IiwicG9zdCIsInB1dCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJ0cmFuc2FjdGlvbi5yb3V0ZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuY29uc3QgeyBwcm90ZWN0LCBhdXRob3JpemUgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmVzL2F1dGgubWlkZGxld2FyZScpO1xyXG5jb25zdCB7IGJvZHkgfSA9IHJlcXVpcmUoJ2V4cHJlc3MtdmFsaWRhdG9yJyk7XHJcbmNvbnN0IHtcclxuICAgIGNyZWF0ZVRyYW5zYWN0aW9uLFxyXG4gICAgZ2V0VHJhbnNhY3Rpb25zLFxyXG4gICAgZ2V0VHJhbnNhY3Rpb25CeUlkLFxyXG4gICAgdXBkYXRlVHJhbnNhY3Rpb25TdGF0dXMsXHJcbiAgICBnZXRTZWxsZXJUcmFuc2FjdGlvbnMsXHJcbiAgICBnZXRBZG1pblRyYW5zYWN0aW9uc1xyXG59ID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvdHJhbnNhY3Rpb24uY29udHJvbGxlcicpO1xyXG5cclxuLy8gVmFsaWRhdGlvbiBtaWRkbGV3YXJlXHJcbmNvbnN0IGNyZWF0ZVRyYW5zYWN0aW9uVmFsaWRhdGlvbiA9IFtcclxuICAgIGJvZHkoJ2hvcnNlJykubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnSG9yc2UgSUQgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2Ftb3VudCcpLmlzTnVtZXJpYygpLndpdGhNZXNzYWdlKCdBbW91bnQgbXVzdCBiZSBhIG51bWJlcicpLFxyXG4gICAgYm9keSgncGF5bWVudE1ldGhvZCcpXHJcbiAgICAgICAgLmlzSW4oWydyYXpvcnBheScsICdiYW5rX3RyYW5zZmVyJywgJ3BsYXRmb3JtJ10pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdWYWxpZCBwYXltZW50IG1ldGhvZCBpcyByZXF1aXJlZCcpXHJcbl07XHJcblxyXG5jb25zdCB1cGRhdGVTdGF0dXNWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnc3RhdHVzJylcclxuICAgICAgICAuaXNJbihbJ3BlbmRpbmcnLCAnY29tcGxldGVkJywgJ2ZhaWxlZCcsICdyZWZ1bmRlZCddKVxyXG4gICAgICAgIC53aXRoTWVzc2FnZSgnVmFsaWQgc3RhdHVzIGlzIHJlcXVpcmVkJylcclxuXTtcclxuXHJcbi8vIEdldCBhbGwgdHJhbnNhY3Rpb25zIChBZG1pbiBvbmx5KVxyXG5yb3V0ZXIuZ2V0KCcvYWRtaW4nLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGdldEFkbWluVHJhbnNhY3Rpb25zKTtcclxuXHJcbi8vIEdldCBzZWxsZXIncyB0cmFuc2FjdGlvbnNcclxucm91dGVyLmdldCgnL3NlbGxlcicsIHByb3RlY3QsIGF1dGhvcml6ZSgnc2VsbGVyJyksIGdldFNlbGxlclRyYW5zYWN0aW9ucyk7XHJcblxyXG4vLyBHZXQgYWxsIHRyYW5zYWN0aW9ucyBmb3IgY3VycmVudCB1c2VyXHJcbnJvdXRlci5nZXQoJy8nLCBwcm90ZWN0LCBnZXRUcmFuc2FjdGlvbnMpO1xyXG5cclxuLy8gR2V0IHNpbmdsZSB0cmFuc2FjdGlvblxyXG5yb3V0ZXIuZ2V0KCcvOmlkJywgcHJvdGVjdCwgZ2V0VHJhbnNhY3Rpb25CeUlkKTtcclxuXHJcbi8vIENyZWF0ZSB0cmFuc2FjdGlvblxyXG5yb3V0ZXIucG9zdCgnLycsIHByb3RlY3QsIGNyZWF0ZVRyYW5zYWN0aW9uVmFsaWRhdGlvbiwgY3JlYXRlVHJhbnNhY3Rpb24pO1xyXG5cclxuLy8gVXBkYXRlIHRyYW5zYWN0aW9uIHN0YXR1cyAoQWRtaW4gb25seSlcclxucm91dGVyLnB1dCgnLzppZC9zdGF0dXMnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIHVwZGF0ZVN0YXR1c1ZhbGlkYXRpb24sIHVwZGF0ZVRyYW5zYWN0aW9uU3RhdHVzKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTTtFQUFFQyxPQUFPO0VBQUVDO0FBQVUsQ0FBQyxHQUFHSixPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDeEUsTUFBTTtFQUFFSztBQUFLLENBQUMsR0FBR0wsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzdDLE1BQU07RUFDRk0saUJBQWlCO0VBQ2pCQyxlQUFlO0VBQ2ZDLGtCQUFrQjtFQUNsQkMsdUJBQXVCO0VBQ3ZCQyxxQkFBcUI7RUFDckJDO0FBQ0osQ0FBQyxHQUFHWCxPQUFPLENBQUMsdUNBQXVDLENBQUM7O0FBRXBEO0FBQ0EsTUFBTVksMkJBQTJCLEdBQUcsQ0FDaENQLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQ1EsUUFBUSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLHNCQUFzQixDQUFDLEVBQzVEVCxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUNVLFNBQVMsQ0FBQyxDQUFDLENBQUNELFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxFQUNqRVQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUNoQlcsSUFBSSxDQUFDLENBQUMsVUFBVSxFQUFFLGVBQWUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUMvQ0YsV0FBVyxDQUFDLGtDQUFrQyxDQUFDLENBQ3ZEO0FBRUQsTUFBTUcsc0JBQXNCLEdBQUcsQ0FDM0JaLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FDVFcsSUFBSSxDQUFDLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FDcERGLFdBQVcsQ0FBQywwQkFBMEIsQ0FBQyxDQUMvQzs7QUFFRDtBQUNBYixNQUFNLENBQUNpQixHQUFHLENBQUMsUUFBUSxFQUFFZixPQUFPLEVBQUVDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRU8sb0JBQW9CLENBQUM7O0FBRXZFO0FBQ0FWLE1BQU0sQ0FBQ2lCLEdBQUcsQ0FBQyxTQUFTLEVBQUVmLE9BQU8sRUFBRUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFTSxxQkFBcUIsQ0FBQzs7QUFFMUU7QUFDQVQsTUFBTSxDQUFDaUIsR0FBRyxDQUFDLEdBQUcsRUFBRWYsT0FBTyxFQUFFSSxlQUFlLENBQUM7O0FBRXpDO0FBQ0FOLE1BQU0sQ0FBQ2lCLEdBQUcsQ0FBQyxNQUFNLEVBQUVmLE9BQU8sRUFBRUssa0JBQWtCLENBQUM7O0FBRS9DO0FBQ0FQLE1BQU0sQ0FBQ2tCLElBQUksQ0FBQyxHQUFHLEVBQUVoQixPQUFPLEVBQUVTLDJCQUEyQixFQUFFTixpQkFBaUIsQ0FBQzs7QUFFekU7QUFDQUwsTUFBTSxDQUFDbUIsR0FBRyxDQUFDLGFBQWEsRUFBRWpCLE9BQU8sRUFBRUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFYSxzQkFBc0IsRUFBRVIsdUJBQXVCLENBQUM7QUFFdkdZLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHckIsTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["express","require","router","Router","protect","authorize","body","createTransaction","getTransactions","getTransactionById","updateTransactionStatus","getSellerTransactions","getAdminTransactions","createTransactionValidation","notEmpty","withMessage","isNumeric","isIn","updateStatusValidation","get","post","put","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["transaction.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect, authorize } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    createTransaction,\r\n    getTransactions,\r\n    getTransactionById,\r\n    updateTransactionStatus,\r\n    getSellerTransactions,\r\n    getAdminTransactions\r\n} = require('../controllers/transaction.controller');\r\n\r\n// Validation middleware\r\nconst createTransactionValidation = [\r\n    body('horse').notEmpty().withMessage('Horse ID is required'),\r\n    body('amount').isNumeric().withMessage('Amount must be a number'),\r\n    body('paymentMethod')\r\n        .isIn(['razorpay', 'bank_transfer', 'platform'])\r\n        .withMessage('Valid payment method is required')\r\n];\r\n\r\nconst updateStatusValidation = [\r\n    body('status')\r\n        .isIn(['pending', 'completed', 'failed', 'refunded'])\r\n        .withMessage('Valid status is required')\r\n];\r\n\r\n// Get all transactions (Admin only)\r\nrouter.get('/admin', protect, authorize('admin'), getAdminTransactions);\r\n\r\n// Get seller's transactions\r\nrouter.get('/seller', protect, authorize('seller'), getSellerTransactions);\r\n\r\n// Get all transactions for current user\r\nrouter.get('/', protect, getTransactions);\r\n\r\n// Get single transaction\r\nrouter.get('/:id', protect, getTransactionById);\r\n\r\n// Create transaction\r\nrouter.post('/', protect, createTransactionValidation, createTransaction);\r\n\r\n// Update transaction status (Admin only)\r\nrouter.put('/:id/status', protect, authorize('admin'), updateStatusValidation, updateTransactionStatus);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC,OAAO;EAAEC;AAAU,CAAC,GAAGJ,OAAO,CAAC,gCAAgC,CAAC;AACxE,MAAM;EAAEK;AAAK,CAAC,GAAGL,OAAO,CAAC,mBAAmB,CAAC;AAC7C,MAAM;EACFM,iBAAiB;EACjBC,eAAe;EACfC,kBAAkB;EAClBC,uBAAuB;EACvBC,qBAAqB;EACrBC;AACJ,CAAC,GAAGX,OAAO,CAAC,uCAAuC,CAAC;;AAEpD;AACA,MAAMY,2BAA2B,GAAG,CAChCP,IAAI,CAAC,OAAO,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,sBAAsB,CAAC,EAC5DT,IAAI,CAAC,QAAQ,CAAC,CAACU,SAAS,CAAC,CAAC,CAACD,WAAW,CAAC,yBAAyB,CAAC,EACjET,IAAI,CAAC,eAAe,CAAC,CAChBW,IAAI,CAAC,CAAC,UAAU,EAAE,eAAe,EAAE,UAAU,CAAC,CAAC,CAC/CF,WAAW,CAAC,kCAAkC,CAAC,CACvD;AAED,MAAMG,sBAAsB,GAAG,CAC3BZ,IAAI,CAAC,QAAQ,CAAC,CACTW,IAAI,CAAC,CAAC,SAAS,EAAE,WAAW,EAAE,QAAQ,EAAE,UAAU,CAAC,CAAC,CACpDF,WAAW,CAAC,0BAA0B,CAAC,CAC/C;;AAED;AACAb,MAAM,CAACiB,GAAG,CAAC,QAAQ,EAAEf,OAAO,EAAEC,SAAS,CAAC,OAAO,CAAC,EAAEO,oBAAoB,CAAC;;AAEvE;AACAV,MAAM,CAACiB,GAAG,CAAC,SAAS,EAAEf,OAAO,EAAEC,SAAS,CAAC,QAAQ,CAAC,EAAEM,qBAAqB,CAAC;;AAE1E;AACAT,MAAM,CAACiB,GAAG,CAAC,GAAG,EAAEf,OAAO,EAAEI,eAAe,CAAC;;AAEzC;AACAN,MAAM,CAACiB,GAAG,CAAC,MAAM,EAAEf,OAAO,EAAEK,kBAAkB,CAAC;;AAE/C;AACAP,MAAM,CAACkB,IAAI,CAAC,GAAG,EAAEhB,OAAO,EAAES,2BAA2B,EAAEN,iBAAiB,CAAC;;AAEzE;AACAL,MAAM,CAACmB,GAAG,CAAC,aAAa,EAAEjB,OAAO,EAAEC,SAAS,CAAC,OAAO,CAAC,EAAEa,sBAAsB,EAAER,uBAAuB,CAAC;AAEvGY,MAAM,CAACC,OAAO,GAAGrB,MAAM","ignoreList":[]}},"mtime":1734031004406},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\transaction.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Transaction = require('../models/Transaction');\n\n// @desc    Get all transactions\n// @route   GET /api/transactions\n// @access  Private\nexports.getTransactions = async (req, res) => {\n  try {\n    const transactions = await Transaction.find({\n      seller: req.user._id\n    }).sort('-createdAt');\n    res.json({\n      success: true,\n      transactions\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get transaction by ID\n// @route   GET /api/transactions/:id\n// @access  Private\nexports.getTransactionById = async (req, res) => {\n  try {\n    const transaction = await Transaction.findById(req.params.id);\n    if (!transaction) {\n      return res.status(404).json({\n        success: false,\n        message: 'Transaction not found'\n      });\n    }\n\n    // Check if user owns the transaction or is admin\n    if (transaction.seller.toString() !== req.user._id.toString() && req.user.role !== 'admin') {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to view this transaction'\n      });\n    }\n    res.json({\n      success: true,\n      transaction\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller transactions\n// @route   GET /api/transactions/seller\n// @access  Private (Seller only)\nexports.getSellerTransactions = async (req, res) => {\n  try {\n    const transactions = await Transaction.find({\n      seller: req.user._id\n    }).sort('-createdAt');\n    res.json({\n      success: true,\n      transactions\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get admin transactions\n// @route   GET /api/transactions/admin\n// @access  Private (Admin only)\nexports.getAdminTransactions = async (req, res) => {\n  try {\n    const transactions = await Transaction.find().populate('seller', 'businessName').sort('-createdAt');\n    res.json({\n      success: true,\n      transactions\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Create transaction\n// @route   POST /api/transactions\n// @access  Private\nexports.createTransaction = async (req, res) => {\n  try {\n    const transaction = await Transaction.create({\n      seller: req.user._id,\n      ...req.body\n    });\n    res.status(201).json({\n      success: true,\n      transaction\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Update transaction status\n// @route   PUT /api/transactions/:id/status\n// @access  Private (Admin only)\nexports.updateTransactionStatus = async (req, res) => {\n  try {\n    const {\n      status\n    } = req.body;\n    const transaction = await Transaction.findByIdAndUpdate(req.params.id, {\n      status\n    }, {\n      new: true\n    });\n    if (!transaction) {\n      return res.status(404).json({\n        success: false,\n        message: 'Transaction not found'\n      });\n    }\n    res.json({\n      success: true,\n      transaction\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJUcmFuc2FjdGlvbiIsInJlcXVpcmUiLCJleHBvcnRzIiwiZ2V0VHJhbnNhY3Rpb25zIiwicmVxIiwicmVzIiwidHJhbnNhY3Rpb25zIiwiZmluZCIsInNlbGxlciIsInVzZXIiLCJfaWQiLCJzb3J0IiwianNvbiIsInN1Y2Nlc3MiLCJlcnJvciIsImNvbnNvbGUiLCJzdGF0dXMiLCJtZXNzYWdlIiwiZ2V0VHJhbnNhY3Rpb25CeUlkIiwidHJhbnNhY3Rpb24iLCJmaW5kQnlJZCIsInBhcmFtcyIsImlkIiwidG9TdHJpbmciLCJyb2xlIiwiZ2V0U2VsbGVyVHJhbnNhY3Rpb25zIiwiZ2V0QWRtaW5UcmFuc2FjdGlvbnMiLCJwb3B1bGF0ZSIsImNyZWF0ZVRyYW5zYWN0aW9uIiwiY3JlYXRlIiwiYm9keSIsInVwZGF0ZVRyYW5zYWN0aW9uU3RhdHVzIiwiZmluZEJ5SWRBbmRVcGRhdGUiLCJuZXciXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXGNvbnRyb2xsZXJzXFwiLCJzb3VyY2VzIjpbInRyYW5zYWN0aW9uLmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgVHJhbnNhY3Rpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvVHJhbnNhY3Rpb24nKTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBhbGwgdHJhbnNhY3Rpb25zXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3RyYW5zYWN0aW9uc1xyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuZ2V0VHJhbnNhY3Rpb25zID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9ucyA9IGF3YWl0IFRyYW5zYWN0aW9uLmZpbmQoeyBzZWxsZXI6IHJlcS51c2VyLl9pZCB9KVxyXG4gICAgICAgICAgICAuc29ydCgnLWNyZWF0ZWRBdCcpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHRyYW5zYWN0aW9uIGJ5IElEXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3RyYW5zYWN0aW9ucy86aWRcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLmdldFRyYW5zYWN0aW9uQnlJZCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGF3YWl0IFRyYW5zYWN0aW9uLmZpbmRCeUlkKHJlcS5wYXJhbXMuaWQpO1xyXG5cclxuICAgICAgICBpZiAoIXRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUcmFuc2FjdGlvbiBub3QgZm91bmQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdXNlciBvd25zIHRoZSB0cmFuc2FjdGlvbiBvciBpcyBhZG1pblxyXG4gICAgICAgIGlmICh0cmFuc2FjdGlvbi5zZWxsZXIudG9TdHJpbmcoKSAhPT0gcmVxLnVzZXIuX2lkLnRvU3RyaW5nKCkgJiYgXHJcbiAgICAgICAgICAgIHJlcS51c2VyLnJvbGUgIT09ICdhZG1pbicpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIHZpZXcgdGhpcyB0cmFuc2FjdGlvbidcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgc2VsbGVyIHRyYW5zYWN0aW9uc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS90cmFuc2FjdGlvbnMvc2VsbGVyXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlciBvbmx5KVxyXG5leHBvcnRzLmdldFNlbGxlclRyYW5zYWN0aW9ucyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB0cmFuc2FjdGlvbnMgPSBhd2FpdCBUcmFuc2FjdGlvbi5maW5kKHsgc2VsbGVyOiByZXEudXNlci5faWQgfSlcclxuICAgICAgICAgICAgLnNvcnQoJy1jcmVhdGVkQXQnKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbnNcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBhZG1pbiB0cmFuc2FjdGlvbnNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvdHJhbnNhY3Rpb25zL2FkbWluXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluIG9ubHkpXHJcbmV4cG9ydHMuZ2V0QWRtaW5UcmFuc2FjdGlvbnMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25zID0gYXdhaXQgVHJhbnNhY3Rpb24uZmluZCgpXHJcbiAgICAgICAgICAgIC5wb3B1bGF0ZSgnc2VsbGVyJywgJ2J1c2luZXNzTmFtZScpXHJcbiAgICAgICAgICAgIC5zb3J0KCctY3JlYXRlZEF0Jyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgdHJhbnNhY3Rpb25zXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBDcmVhdGUgdHJhbnNhY3Rpb25cclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3RyYW5zYWN0aW9uc1xyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuY3JlYXRlVHJhbnNhY3Rpb24gPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBhd2FpdCBUcmFuc2FjdGlvbi5jcmVhdGUoe1xyXG4gICAgICAgICAgICBzZWxsZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgLi4ucmVxLmJvZHlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICB0cmFuc2FjdGlvblxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgVXBkYXRlIHRyYW5zYWN0aW9uIHN0YXR1c1xyXG4vLyBAcm91dGUgICBQVVQgL2FwaS90cmFuc2FjdGlvbnMvOmlkL3N0YXR1c1xyXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbiBvbmx5KVxyXG5leHBvcnRzLnVwZGF0ZVRyYW5zYWN0aW9uU3RhdHVzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgc3RhdHVzIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBhd2FpdCBUcmFuc2FjdGlvbi5maW5kQnlJZEFuZFVwZGF0ZShcclxuICAgICAgICAgICAgcmVxLnBhcmFtcy5pZCxcclxuICAgICAgICAgICAgeyBzdGF0dXMgfSxcclxuICAgICAgICAgICAgeyBuZXc6IHRydWUgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICghdHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RyYW5zYWN0aW9uIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsdUJBQXVCLENBQUM7O0FBRXBEO0FBQ0E7QUFDQTtBQUNBQyxPQUFPLENBQUNDLGVBQWUsR0FBRyxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUMxQyxJQUFJO0lBQ0EsTUFBTUMsWUFBWSxHQUFHLE1BQU1OLFdBQVcsQ0FBQ08sSUFBSSxDQUFDO01BQUVDLE1BQU0sRUFBRUosR0FBRyxDQUFDSyxJQUFJLENBQUNDO0lBQUksQ0FBQyxDQUFDLENBQ2hFQyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBRXZCTixHQUFHLENBQUNPLElBQUksQ0FBQztNQUNMQyxPQUFPLEVBQUUsSUFBSTtNQUNiUDtJQUNKLENBQUMsQ0FBQztFQUNOLENBQUMsQ0FBQyxPQUFPUSxLQUFLLEVBQUU7SUFDWkMs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","map":{"version":3,"names":["Transaction","require","exports","getTransactions","req","res","transactions","find","seller","user","_id","sort","json","success","error","console","status","message","getTransactionById","transaction","findById","params","id","toString","role","getSellerTransactions","getAdminTransactions","populate","createTransaction","create","body","updateTransactionStatus","findByIdAndUpdate","new"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["transaction.controller.js"],"sourcesContent":["const Transaction = require('../models/Transaction');\r\n\r\n// @desc    Get all transactions\r\n// @route   GET /api/transactions\r\n// @access  Private\r\nexports.getTransactions = async (req, res) => {\r\n    try {\r\n        const transactions = await Transaction.find({ seller: req.user._id })\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            transactions\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get transaction by ID\r\n// @route   GET /api/transactions/:id\r\n// @access  Private\r\nexports.getTransactionById = async (req, res) => {\r\n    try {\r\n        const transaction = await Transaction.findById(req.params.id);\r\n\r\n        if (!transaction) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Transaction not found'\r\n            });\r\n        }\r\n\r\n        // Check if user owns the transaction or is admin\r\n        if (transaction.seller.toString() !== req.user._id.toString() && \r\n            req.user.role !== 'admin') {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to view this transaction'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            transaction\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller transactions\r\n// @route   GET /api/transactions/seller\r\n// @access  Private (Seller only)\r\nexports.getSellerTransactions = async (req, res) => {\r\n    try {\r\n        const transactions = await Transaction.find({ seller: req.user._id })\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            transactions\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get admin transactions\r\n// @route   GET /api/transactions/admin\r\n// @access  Private (Admin only)\r\nexports.getAdminTransactions = async (req, res) => {\r\n    try {\r\n        const transactions = await Transaction.find()\r\n            .populate('seller', 'businessName')\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            transactions\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Create transaction\r\n// @route   POST /api/transactions\r\n// @access  Private\r\nexports.createTransaction = async (req, res) => {\r\n    try {\r\n        const transaction = await Transaction.create({\r\n            seller: req.user._id,\r\n            ...req.body\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            transaction\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update transaction status\r\n// @route   PUT /api/transactions/:id/status\r\n// @access  Private (Admin only)\r\nexports.updateTransactionStatus = async (req, res) => {\r\n    try {\r\n        const { status } = req.body;\r\n\r\n        const transaction = await Transaction.findByIdAndUpdate(\r\n            req.params.id,\r\n            { status },\r\n            { new: true }\r\n        );\r\n\r\n        if (!transaction) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Transaction not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            transaction\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734035875873},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\admin.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middlewares/auth.middleware');\nconst User = require('../models/User');\nconst Transaction = require('../models/Transaction');\nconst Horse = require('../models/Horse');\nconst Seller = require('../models/Seller');\n\n// @desc    Get all users\n// @route   GET /api/admin/users\n// @access  Private (Admin)\nrouter.get('/users', protect, authorize('admin'), async (req, res) => {\n  try {\n    const users = await User.find().select('-password');\n    res.json({\n      success: true,\n      users\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @desc    Get all transactions\n// @route   GET /api/admin/transactions\n// @access  Private (Admin)\nrouter.get('/transactions', protect, authorize('admin'), async (req, res) => {\n  try {\n    const transactions = await Transaction.find().populate('seller', 'businessName').sort('-createdAt');\n    res.json({\n      success: true,\n      transactions\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @desc    Get platform stats\n// @route   GET /api/admin/stats\n// @access  Private (Admin)\nrouter.get('/stats', protect, authorize('admin'), async (req, res) => {\n  try {\n    // Get counts\n    const userCount = await User.countDocuments();\n    const sellerCount = await Seller.countDocuments();\n    const horseCount = await Horse.countDocuments();\n    const transactionCount = await Transaction.countDocuments();\n\n    // Get total transaction amount\n    const transactions = await Transaction.find({\n      status: 'completed'\n    });\n    const totalRevenue = transactions.reduce((acc, curr) => acc + curr.amount, 0);\n\n    // Get active listings\n    const activeListings = await Horse.countDocuments({\n      listingStatus: 'active'\n    });\n\n    // Get recent transactions\n    const recentTransactions = await Transaction.find().populate('seller', 'businessName').sort('-createdAt').limit(5);\n    res.json({\n      success: true,\n      stats: {\n        users: {\n          total: userCount,\n          sellers: sellerCount,\n          buyers: userCount - sellerCount\n        },\n        horses: {\n          total: horseCount,\n          active: activeListings\n        },\n        transactions: {\n          total: transactionCount,\n          totalRevenue,\n          recent: recentTransactions\n        }\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJVc2VyIiwiVHJhbnNhY3Rpb24iLCJIb3JzZSIsIlNlbGxlciIsImdldCIsInJlcSIsInJlcyIsInVzZXJzIiwiZmluZCIsInNlbGVjdCIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJjb25zb2xlIiwic3RhdHVzIiwibWVzc2FnZSIsInRyYW5zYWN0aW9ucyIsInBvcHVsYXRlIiwic29ydCIsInVzZXJDb3VudCIsImNvdW50RG9jdW1lbnRzIiwic2VsbGVyQ291bnQiLCJob3JzZUNvdW50IiwidHJhbnNhY3Rpb25Db3VudCIsInRvdGFsUmV2ZW51ZSIsInJlZHVjZSIsImFjYyIsImN1cnIiLCJhbW91bnQiLCJhY3RpdmVMaXN0aW5ncyIsImxpc3RpbmdTdGF0dXMiLCJyZWNlbnRUcmFuc2FjdGlvbnMiLCJsaW1pdCIsInN0YXRzIiwidG90YWwiLCJzZWxsZXJzIiwiYnV5ZXJzIiwiaG9yc2VzIiwiYWN0aXZlIiwicmVjZW50IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xccm91dGVzXFwiLCJzb3VyY2VzIjpbImFkbWluLnJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCB7IHByb3RlY3QsIGF1dGhvcml6ZSB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZXMvYXV0aC5taWRkbGV3YXJlJyk7XHJcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xyXG5jb25zdCBUcmFuc2FjdGlvbiA9IHJlcXVpcmUoJy4uL21vZGVscy9UcmFuc2FjdGlvbicpO1xyXG5jb25zdCBIb3JzZSA9IHJlcXVpcmUoJy4uL21vZGVscy9Ib3JzZScpO1xyXG5jb25zdCBTZWxsZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvU2VsbGVyJyk7XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgYWxsIHVzZXJzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL3VzZXJzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKEFkbWluKVxyXG5yb3V0ZXIuZ2V0KCcvdXNlcnMnLCBwcm90ZWN0LCBhdXRob3JpemUoJ2FkbWluJyksIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VycyA9IGF3YWl0IFVzZXIuZmluZCgpLnNlbGVjdCgnLXBhc3N3b3JkJyk7XHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICB1c2Vyc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBhbGwgdHJhbnNhY3Rpb25zXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2FkbWluL3RyYW5zYWN0aW9uc1xyXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbilcclxucm91dGVyLmdldCgnL3RyYW5zYWN0aW9ucycsIHByb3RlY3QsIGF1dGhvcml6ZSgnYWRtaW4nKSwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9ucyA9IGF3YWl0IFRyYW5zYWN0aW9uLmZpbmQoKVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3NlbGxlcicsICdidXNpbmVzc05hbWUnKVxyXG4gICAgICAgICAgICAuc29ydCgnLWNyZWF0ZWRBdCcpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uc1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBwbGF0Zm9ybSBzdGF0c1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9hZG1pbi9zdGF0c1xyXG4vLyBAYWNjZXNzICBQcml2YXRlIChBZG1pbilcclxucm91dGVyLmdldCgnL3N0YXRzJywgcHJvdGVjdCwgYXV0aG9yaXplKCdhZG1pbicpLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gR2V0IGNvdW50c1xyXG4gICAgICAgIGNvbnN0IHVzZXJDb3VudCA9IGF3YWl0IFVzZXIuY291bnREb2N1bWVudHMoKTtcclxuICAgICAgICBjb25zdCBzZWxsZXJDb3VudCA9IGF3YWl0IFNlbGxlci5jb3VudERvY3VtZW50cygpO1xyXG4gICAgICAgIGNvbnN0IGhvcnNlQ291bnQgPSBhd2FpdCBIb3JzZS5jb3VudERvY3VtZW50cygpO1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uQ291bnQgPSBhd2FpdCBUcmFuc2FjdGlvbi5jb3VudERvY3VtZW50cygpO1xyXG5cclxuICAgICAgICAvLyBHZXQgdG90YWwgdHJhbnNhY3Rpb24gYW1vdW50XHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25zID0gYXdhaXQgVHJhbnNhY3Rpb24uZmluZCh7IHN0YXR1czogJ2NvbXBsZXRlZCcgfSk7XHJcbiAgICAgICAgY29uc3QgdG90YWxSZXZlbnVlID0gdHJhbnNhY3Rpb25zLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiBhY2MgKyBjdXJyLmFtb3VudCwgMCk7XHJcblxyXG4gICAgICAgIC8vIEdldCBhY3RpdmUgbGlzdGluZ3NcclxuICAgICAgICBjb25zdCBhY3RpdmVMaXN0aW5ncyA9IGF3YWl0IEhvcnNlLmNvdW50RG9jdW1lbnRzKHsgbGlzdGluZ1N0YXR1czogJ2FjdGl2ZScgfSk7XHJcblxyXG4gICAgICAgIC8vIEdldCByZWNlbnQgdHJhbnNhY3Rpb25zXHJcbiAgICAgICAgY29uc3QgcmVjZW50VHJhbnNhY3Rpb25zID0gYXdhaXQgVHJhbnNhY3Rpb24uZmluZCgpXHJcbiAgICAgICAgICAgIC5wb3B1bGF0ZSgnc2VsbGVyJywgJ2J1c2luZXNzTmFtZScpXHJcbiAgICAgICAgICAgIC5zb3J0KCctY3JlYXRlZEF0JylcclxuICAgICAgICAgICAgLmxpbWl0KDUpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHN0YXRzOiB7XHJcbiAgICAgICAgICAgICAgICB1c2Vyczoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB1c2VyQ291bnQsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsbGVyczogc2VsbGVyQ291bnQsXHJcbiAgICAgICAgICAgICAgICAgICAgYnV5ZXJzOiB1c2VyQ291bnQgLSBzZWxsZXJDb3VudFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGhvcnNlczoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiBob3JzZUNvdW50LFxyXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZTogYWN0aXZlTGlzdGluZ3NcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogdHJhbnNhY3Rpb25Db3VudCxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbFJldmVudWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVjZW50OiByZWNlbnRUcmFuc2FjdGlvbnNcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTTtFQUFFQyxPQUFPO0VBQUVDO0FBQVUsQ0FBQyxHQUFHSixPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDeEUsTUFBTUssSUFBSSxHQUFHTCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDdEMsTUFBTU0sV0FBVyxHQUFHTixPQUFPLENBQUMsdUJBQXVCLENBQUM7QUFDcEQsTUFBTU8sS0FBSyxHQUFHUCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTVEsTUFBTSxHQUFHUixPQUFPLENBQUMsa0JBQWtCLENBQUM7O0FBRTFDO0FBQ0E7QUFDQTtBQUNBQyxNQUFNLENBQUNRLEdBQUcsQ0FBQyxRQUFRLEVBQUVOLE9BQU8sRUFBRUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFLE9B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","map":{"version":3,"names":["express","require","router","Router","protect","authorize","User","Transaction","Horse","Seller","get","req","res","users","find","select","json","success","error","console","status","message","transactions","populate","sort","userCount","countDocuments","sellerCount","horseCount","transactionCount","totalRevenue","reduce","acc","curr","amount","activeListings","listingStatus","recentTransactions","limit","stats","total","sellers","buyers","horses","active","recent","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["admin.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect, authorize } = require('../middlewares/auth.middleware');\r\nconst User = require('../models/User');\r\nconst Transaction = require('../models/Transaction');\r\nconst Horse = require('../models/Horse');\r\nconst Seller = require('../models/Seller');\r\n\r\n// @desc    Get all users\r\n// @route   GET /api/admin/users\r\n// @access  Private (Admin)\r\nrouter.get('/users', protect, authorize('admin'), async (req, res) => {\r\n    try {\r\n        const users = await User.find().select('-password');\r\n        res.json({\r\n            success: true,\r\n            users\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// @desc    Get all transactions\r\n// @route   GET /api/admin/transactions\r\n// @access  Private (Admin)\r\nrouter.get('/transactions', protect, authorize('admin'), async (req, res) => {\r\n    try {\r\n        const transactions = await Transaction.find()\r\n            .populate('seller', 'businessName')\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            transactions\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// @desc    Get platform stats\r\n// @route   GET /api/admin/stats\r\n// @access  Private (Admin)\r\nrouter.get('/stats', protect, authorize('admin'), async (req, res) => {\r\n    try {\r\n        // Get counts\r\n        const userCount = await User.countDocuments();\r\n        const sellerCount = await Seller.countDocuments();\r\n        const horseCount = await Horse.countDocuments();\r\n        const transactionCount = await Transaction.countDocuments();\r\n\r\n        // Get total transaction amount\r\n        const transactions = await Transaction.find({ status: 'completed' });\r\n        const totalRevenue = transactions.reduce((acc, curr) => acc + curr.amount, 0);\r\n\r\n        // Get active listings\r\n        const activeListings = await Horse.countDocuments({ listingStatus: 'active' });\r\n\r\n        // Get recent transactions\r\n        const recentTransactions = await Transaction.find()\r\n            .populate('seller', 'businessName')\r\n            .sort('-createdAt')\r\n            .limit(5);\r\n\r\n        res.json({\r\n            success: true,\r\n            stats: {\r\n                users: {\r\n                    total: userCount,\r\n                    sellers: sellerCount,\r\n                    buyers: userCount - sellerCount\r\n                },\r\n                horses: {\r\n                    total: horseCount,\r\n                    active: activeListings\r\n                },\r\n                transactions: {\r\n                    total: transactionCount,\r\n                    totalRevenue,\r\n                    recent: recentTransactions\r\n                }\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\nmodule.exports = router; "],"mappings":"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","ignoreList":[]}},"mtime":1734031122711},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\seller.dashboard.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middlewares/auth.middleware');\nconst {\n  getDashboardStats,\n  getPerformanceMetrics,\n  getListingAnalytics,\n  getInquiryAnalytics\n} = require('../controllers/seller.dashboard.controller');\n\n// All routes are protected and require seller role\nrouter.use(protect);\nrouter.use(authorize('seller'));\n\n// Get dashboard stats\nrouter.get('/stats', getDashboardStats);\n\n// Get performance metrics\nrouter.get('/performance', getPerformanceMetrics);\n\n// Get listing analytics\nrouter.get('/analytics/listings', getListingAnalytics);\n\n// Get inquiry analytics\nrouter.get('/analytics/inquiries', getInquiryAnalytics);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJnZXREYXNoYm9hcmRTdGF0cyIsImdldFBlcmZvcm1hbmNlTWV0cmljcyIsImdldExpc3RpbmdBbmFseXRpY3MiLCJnZXRJbnF1aXJ5QW5hbHl0aWNzIiwidXNlIiwiZ2V0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xccm91dGVzXFwiLCJzb3VyY2VzIjpbInNlbGxlci5kYXNoYm9hcmQucm91dGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHsgcHJvdGVjdCwgYXV0aG9yaXplIH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlcy9hdXRoLm1pZGRsZXdhcmUnKTtcclxuY29uc3Qge1xyXG4gICAgZ2V0RGFzaGJvYXJkU3RhdHMsXHJcbiAgICBnZXRQZXJmb3JtYW5jZU1ldHJpY3MsXHJcbiAgICBnZXRMaXN0aW5nQW5hbHl0aWNzLFxyXG4gICAgZ2V0SW5xdWlyeUFuYWx5dGljc1xyXG59ID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvc2VsbGVyLmRhc2hib2FyZC5jb250cm9sbGVyJyk7XHJcblxyXG4vLyBBbGwgcm91dGVzIGFyZSBwcm90ZWN0ZWQgYW5kIHJlcXVpcmUgc2VsbGVyIHJvbGVcclxucm91dGVyLnVzZShwcm90ZWN0KTtcclxucm91dGVyLnVzZShhdXRob3JpemUoJ3NlbGxlcicpKTtcclxuXHJcbi8vIEdldCBkYXNoYm9hcmQgc3RhdHNcclxucm91dGVyLmdldCgnL3N0YXRzJywgZ2V0RGFzaGJvYXJkU3RhdHMpO1xyXG5cclxuLy8gR2V0IHBlcmZvcm1hbmNlIG1ldHJpY3Ncclxucm91dGVyLmdldCgnL3BlcmZvcm1hbmNlJywgZ2V0UGVyZm9ybWFuY2VNZXRyaWNzKTtcclxuXHJcbi8vIEdldCBsaXN0aW5nIGFuYWx5dGljc1xyXG5yb3V0ZXIuZ2V0KCcvYW5hbHl0aWNzL2xpc3RpbmdzJywgZ2V0TGlzdGluZ0FuYWx5dGljcyk7XHJcblxyXG4vLyBHZXQgaW5xdWlyeSBhbmFseXRpY3Ncclxucm91dGVyLmdldCgnL2FuYWx5dGljcy9pbnF1aXJpZXMnLCBnZXRJbnF1aXJ5QW5hbHl0aWNzKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFNBQVMsQ0FBQztBQUNsQyxNQUFNQyxNQUFNLEdBQUdGLE9BQU8sQ0FBQ0csTUFBTSxDQUFDLENBQUM7QUFDL0IsTUFBTTtFQUFFQyxPQUFPO0VBQUVDO0FBQVUsQ0FBQyxHQUFHSixPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDeEUsTUFBTTtFQUNGSyxpQkFBaUI7RUFDakJDLHFCQUFxQjtFQUNyQkMsbUJBQW1CO0VBQ25CQztBQUNKLENBQUMsR0FBR1IsT0FBTyxDQUFDLDRDQUE0QyxDQUFDOztBQUV6RDtBQUNBQyxNQUFNLENBQUNRLEdBQUcsQ0FBQ04sT0FBTyxDQUFDO0FBQ25CRixNQUFNLENBQUNRLEdBQUcsQ0FBQ0wsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDOztBQUUvQjtBQUNBSCxNQUFNLENBQUNTLEdBQUcsQ0FBQyxRQUFRLEVBQUVMLGlCQUFpQixDQUFDOztBQUV2QztBQUNBSixNQUFNLENBQUNTLEdBQUcsQ0FBQyxjQUFjLEVBQUVKLHFCQUFxQixDQUFDOztBQUVqRDtBQUNBTCxNQUFNLENBQUNTLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRUgsbUJBQW1CLENBQUM7O0FBRXREO0FBQ0FOLE1BQU0sQ0FBQ1MsR0FBRyxDQUFDLHNCQUFzQixFQUFFRixtQkFBbUIsQ0FBQztBQUV2REcsTUFBTSxDQUFDQyxPQUFPLEdBQUdYLE1BQU0iLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["express","require","router","Router","protect","authorize","getDashboardStats","getPerformanceMetrics","getListingAnalytics","getInquiryAnalytics","use","get","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["seller.dashboard.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect, authorize } = require('../middlewares/auth.middleware');\r\nconst {\r\n    getDashboardStats,\r\n    getPerformanceMetrics,\r\n    getListingAnalytics,\r\n    getInquiryAnalytics\r\n} = require('../controllers/seller.dashboard.controller');\r\n\r\n// All routes are protected and require seller role\r\nrouter.use(protect);\r\nrouter.use(authorize('seller'));\r\n\r\n// Get dashboard stats\r\nrouter.get('/stats', getDashboardStats);\r\n\r\n// Get performance metrics\r\nrouter.get('/performance', getPerformanceMetrics);\r\n\r\n// Get listing analytics\r\nrouter.get('/analytics/listings', getListingAnalytics);\r\n\r\n// Get inquiry analytics\r\nrouter.get('/analytics/inquiries', getInquiryAnalytics);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC,OAAO;EAAEC;AAAU,CAAC,GAAGJ,OAAO,CAAC,gCAAgC,CAAC;AACxE,MAAM;EACFK,iBAAiB;EACjBC,qBAAqB;EACrBC,mBAAmB;EACnBC;AACJ,CAAC,GAAGR,OAAO,CAAC,4CAA4C,CAAC;;AAEzD;AACAC,MAAM,CAACQ,GAAG,CAACN,OAAO,CAAC;AACnBF,MAAM,CAACQ,GAAG,CAACL,SAAS,CAAC,QAAQ,CAAC,CAAC;;AAE/B;AACAH,MAAM,CAACS,GAAG,CAAC,QAAQ,EAAEL,iBAAiB,CAAC;;AAEvC;AACAJ,MAAM,CAACS,GAAG,CAAC,cAAc,EAAEJ,qBAAqB,CAAC;;AAEjD;AACAL,MAAM,CAACS,GAAG,CAAC,qBAAqB,EAAEH,mBAAmB,CAAC;;AAEtD;AACAN,MAAM,CAACS,GAAG,CAAC,sBAAsB,EAAEF,mBAAmB,CAAC;AAEvDG,MAAM,CAACC,OAAO,GAAGX,MAAM","ignoreList":[]}},"mtime":1734032317159},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\seller.dashboard.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Horse = require('../models/Horse');\nconst Inquiry = require('../models/Inquiry');\nconst Transaction = require('../models/Transaction');\nconst Seller = require('../models/Seller');\n\n// @desc    Get seller dashboard stats\n// @route   GET /api/seller/dashboard/stats\n// @access  Private (Seller)\nexports.getDashboardStats = async (req, res) => {\n  try {\n    // Get seller's horses count\n    const totalHorses = await Horse.countDocuments({\n      seller: req.seller._id\n    });\n    const activeHorses = await Horse.countDocuments({\n      seller: req.seller._id,\n      listingStatus: 'active'\n    });\n    const draftHorses = await Horse.countDocuments({\n      seller: req.seller._id,\n      listingStatus: 'draft'\n    });\n\n    // Get seller's inquiries stats\n    const totalInquiries = await Inquiry.countDocuments({\n      seller: req.seller._id\n    });\n    const pendingInquiries = await Inquiry.countDocuments({\n      seller: req.seller._id,\n      status: 'pending'\n    });\n    const respondedInquiries = await Inquiry.countDocuments({\n      seller: req.seller._id,\n      status: 'responded'\n    });\n\n    // Get seller's transactions stats\n    const transactions = await Transaction.find({\n      seller: req.seller._id,\n      status: 'completed'\n    });\n    const totalRevenue = transactions.reduce((acc, curr) => acc + curr.amount, 0);\n\n    // Get recent activities\n    const recentHorses = await Horse.find({\n      seller: req.seller._id\n    }).sort('-createdAt').limit(5).select('name price listingStatus createdAt');\n    const recentInquiries = await Inquiry.find({\n      seller: req.seller._id\n    }).sort('-createdAt').limit(5).populate('horse', 'name').populate('user', 'name');\n    const recentTransactions = await Transaction.find({\n      seller: req.seller._id\n    }).sort('-createdAt').limit(5);\n\n    // Get subscription info\n    const seller = await Seller.findById(req.seller._id).select('subscription businessName');\n    res.json({\n      success: true,\n      dashboard: {\n        subscription: seller.subscription,\n        listings: {\n          total: totalHorses,\n          active: activeHorses,\n          draft: draftHorses,\n          recent: recentHorses\n        },\n        inquiries: {\n          total: totalInquiries,\n          pending: pendingInquiries,\n          responded: respondedInquiries,\n          recent: recentInquiries\n        },\n        transactions: {\n          total: transactions.length,\n          totalRevenue,\n          recent: recentTransactions\n        }\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller's performance metrics\n// @route   GET /api/seller/dashboard/performance\n// @access  Private (Seller)\nexports.getPerformanceMetrics = async (req, res) => {\n  try {\n    const thirtyDaysAgo = new Date();\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n\n    // Get listing views\n    const horses = await Horse.find({\n      seller: req.seller._id,\n      createdAt: {\n        $gte: thirtyDaysAgo\n      }\n    }).select('statistics');\n    const totalViews = horses.reduce((acc, horse) => acc + horse.statistics.views, 0);\n    const totalInquiryRate = horses.reduce((acc, horse) => acc + horse.statistics.inquiries, 0);\n\n    // Get response rate\n    const inquiries = await Inquiry.find({\n      seller: req.seller._id,\n      createdAt: {\n        $gte: thirtyDaysAgo\n      }\n    });\n    const responseRate = inquiries.length > 0 ? inquiries.filter(i => i.status === 'responded').length / inquiries.length * 100 : 0;\n\n    // Get average response time\n    const respondedInquiries = inquiries.filter(i => i.status === 'responded' && i.response);\n    const avgResponseTime = respondedInquiries.length > 0 ? respondedInquiries.reduce((acc, curr) => {\n      const responseTime = new Date(curr.response.date) - new Date(curr.createdAt);\n      return acc + responseTime;\n    }, 0) / respondedInquiries.length : 0;\n    res.json({\n      success: true,\n      performance: {\n        thirtyDayMetrics: {\n          totalViews,\n          totalInquiries: totalInquiryRate,\n          responseRate: Math.round(responseRate),\n          averageResponseTime: Math.round(avgResponseTime / (1000 * 60 * 60)),\n          // Convert to hours\n          listingCount: horses.length\n        }\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller's listing analytics\n// @route   GET /api/seller/dashboard/analytics/listings\n// @access  Private (Seller)\nexports.getListingAnalytics = async (req, res) => {\n  try {\n    const {\n      period = '30'\n    } = req.query; // Default to 30 days\n    const startDate = new Date();\n    startDate.setDate(startDate.getDate() - parseInt(period));\n    const horses = await Horse.find({\n      seller: req.seller._id,\n      createdAt: {\n        $gte: startDate\n      }\n    }).select('statistics createdAt price listingStatus');\n\n    // Group data by date\n    const dailyStats = {};\n    horses.forEach(horse => {\n      const date = horse.createdAt.toISOString().split('T')[0];\n      if (!dailyStats[date]) {\n        dailyStats[date] = {\n          views: 0,\n          inquiries: 0,\n          listings: 0,\n          averagePrice: 0\n        };\n      }\n      dailyStats[date].views += horse.statistics.views;\n      dailyStats[date].inquiries += horse.statistics.inquiries;\n      dailyStats[date].listings += 1;\n      dailyStats[date].averagePrice = (dailyStats[date].averagePrice * (dailyStats[date].listings - 1) + horse.price) / dailyStats[date].listings;\n    });\n    res.json({\n      success: true,\n      analytics: {\n        period,\n        dailyStats\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get seller's inquiry analytics\n// @route   GET /api/seller/dashboard/analytics/inquiries\n// @access  Private (Seller)\nexports.getInquiryAnalytics = async (req, res) => {\n  try {\n    const {\n      period = '30'\n    } = req.query; // Default to 30 days\n    const startDate = new Date();\n    startDate.setDate(startDate.getDate() - parseInt(period));\n    const inquiries = await Inquiry.find({\n      seller: req.seller._id,\n      createdAt: {\n        $gte: startDate\n      }\n    }).populate('horse', 'name price');\n\n    // Group data by date and status\n    const dailyStats = {};\n    inquiries.forEach(inquiry => {\n      const date = inquiry.createdAt.toISOString().split('T')[0];\n      if (!dailyStats[date]) {\n        dailyStats[date] = {\n          total: 0,\n          byStatus: {\n            pending: 0,\n            responded: 0,\n            closed: 0\n          },\n          byContactPreference: {\n            email: 0,\n            phone: 0,\n            whatsapp: 0\n          }\n        };\n      }\n      dailyStats[date].total += 1;\n      dailyStats[date].byStatus[inquiry.status] += 1;\n      dailyStats[date].byContactPreference[inquiry.contactPreference] += 1;\n    });\n    res.json({\n      success: true,\n      analytics: {\n        period,\n        dailyStats,\n        totalInquiries: inquiries.length\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIb3JzZSIsInJlcXVpcmUiLCJJbnF1aXJ5IiwiVHJhbnNhY3Rpb24iLCJTZWxsZXIiLCJleHBvcnRzIiwiZ2V0RGFzaGJvYXJkU3RhdHMiLCJyZXEiLCJyZXMiLCJ0b3RhbEhvcnNlcyIsImNvdW50RG9jdW1lbnRzIiwic2VsbGVyIiwiX2lkIiwiYWN0aXZlSG9yc2VzIiwibGlzdGluZ1N0YXR1cyIsImRyYWZ0SG9yc2VzIiwidG90YWxJbnF1aXJpZXMiLCJwZW5kaW5nSW5xdWlyaWVzIiwic3RhdHVzIiwicmVzcG9uZGVkSW5xdWlyaWVzIiwidHJhbnNhY3Rpb25zIiwiZmluZCIsInRvdGFsUmV2ZW51ZSIsInJlZHVjZSIsImFjYyIsImN1cnIiLCJhbW91bnQiLCJyZWNlbnRIb3JzZXMiLCJzb3J0IiwibGltaXQiLCJzZWxlY3QiLCJyZWNlbnRJbnF1aXJpZXMiLCJwb3B1bGF0ZSIsInJlY2VudFRyYW5zYWN0aW9ucyIsImZpbmRCeUlkIiwianNvbiIsInN1Y2Nlc3MiLCJkYXNoYm9hcmQiLCJzdWJzY3JpcHRpb24iLCJsaXN0aW5ncyIsInRvdGFsIiwiYWN0aXZlIiwiZHJhZnQiLCJyZWNlbnQiLCJpbnF1aXJpZXMiLCJwZW5kaW5nIiwicmVzcG9uZGVkIiwibGVuZ3RoIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsImdldFBlcmZvcm1hbmNlTWV0cmljcyIsInRoaXJ0eURheXNBZ28iLCJEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJob3JzZXMiLCJjcmVhdGVkQXQiLCIkZ3RlIiwidG90YWxWaWV3cyIsImhvcnNlIiwic3RhdGlzdGljcyIsInZpZXdzIiwidG90YWxJbnF1aXJ5UmF0ZSIsInJlc3BvbnNlUmF0ZSIsImZpbHRlciIsImkiLCJyZXNwb25zZSIsImF2Z1Jlc3BvbnNlVGltZSIsInJlc3BvbnNlVGltZSIsImRhdGUiLCJwZXJmb3JtYW5jZSIsInRoaXJ0eURheU1ldHJpY3MiLCJNYXRoIiwicm91bmQiLCJhdmVyYWdlUmVzcG9uc2VUaW1lIiwibGlzdGluZ0NvdW50IiwiZ2V0TGlzdGluZ0FuYWx5dGljcyIsInBlcmlvZCIsInF1ZXJ5Iiwic3RhcnREYXRlIiwicGFyc2VJbnQiLCJkYWlseVN0YXRzIiwiZm9yRWFjaCIsInRvSVNPU3RyaW5nIiwic3BsaXQiLCJhdmVyYWdlUHJpY2UiLCJwcmljZSIsImFuYWx5dGljcyIsImdldElucXVpcnlBbmFseXRpY3MiLCJpbnF1aXJ5IiwiYnlTdGF0dXMiLCJjbG9zZWQiLCJieUNvbnRhY3RQcmVmZXJlbmNlIiwiZW1haWwiLCJwaG9uZSIsIndoYXRzYXBwIiwiY29udGFjdFByZWZlcmVuY2UiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXGNvbnRyb2xsZXJzXFwiLCJzb3VyY2VzIjpbInNlbGxlci5kYXNoYm9hcmQuY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBIb3JzZSA9IHJlcXVpcmUoJy4uL21vZGVscy9Ib3JzZScpO1xyXG5jb25zdCBJbnF1aXJ5ID0gcmVxdWlyZSgnLi4vbW9kZWxzL0lucXVpcnknKTtcclxuY29uc3QgVHJhbnNhY3Rpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvVHJhbnNhY3Rpb24nKTtcclxuY29uc3QgU2VsbGVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1NlbGxlcicpO1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHNlbGxlciBkYXNoYm9hcmQgc3RhdHNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvc2VsbGVyL2Rhc2hib2FyZC9zdGF0c1xyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIpXHJcbmV4cG9ydHMuZ2V0RGFzaGJvYXJkU3RhdHMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gR2V0IHNlbGxlcidzIGhvcnNlcyBjb3VudFxyXG4gICAgICAgIGNvbnN0IHRvdGFsSG9yc2VzID0gYXdhaXQgSG9yc2UuY291bnREb2N1bWVudHMoeyBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkIH0pO1xyXG4gICAgICAgIGNvbnN0IGFjdGl2ZUhvcnNlcyA9IGF3YWl0IEhvcnNlLmNvdW50RG9jdW1lbnRzKHsgXHJcbiAgICAgICAgICAgIHNlbGxlcjogcmVxLnNlbGxlci5faWQsIFxyXG4gICAgICAgICAgICBsaXN0aW5nU3RhdHVzOiAnYWN0aXZlJyBcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zdCBkcmFmdEhvcnNlcyA9IGF3YWl0IEhvcnNlLmNvdW50RG9jdW1lbnRzKHsgXHJcbiAgICAgICAgICAgIHNlbGxlcjogcmVxLnNlbGxlci5faWQsIFxyXG4gICAgICAgICAgICBsaXN0aW5nU3RhdHVzOiAnZHJhZnQnIFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBHZXQgc2VsbGVyJ3MgaW5xdWlyaWVzIHN0YXRzXHJcbiAgICAgICAgY29uc3QgdG90YWxJbnF1aXJpZXMgPSBhd2FpdCBJbnF1aXJ5LmNvdW50RG9jdW1lbnRzKHsgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCB9KTtcclxuICAgICAgICBjb25zdCBwZW5kaW5nSW5xdWlyaWVzID0gYXdhaXQgSW5xdWlyeS5jb3VudERvY3VtZW50cyh7IFxyXG4gICAgICAgICAgICBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvbnN0IHJlc3BvbmRlZElucXVpcmllcyA9IGF3YWl0IElucXVpcnkuY291bnREb2N1bWVudHMoeyBcclxuICAgICAgICAgICAgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCxcclxuICAgICAgICAgICAgc3RhdHVzOiAncmVzcG9uZGVkJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBHZXQgc2VsbGVyJ3MgdHJhbnNhY3Rpb25zIHN0YXRzXHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb25zID0gYXdhaXQgVHJhbnNhY3Rpb24uZmluZCh7IFxyXG4gICAgICAgICAgICBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgdG90YWxSZXZlbnVlID0gdHJhbnNhY3Rpb25zLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiBhY2MgKyBjdXJyLmFtb3VudCwgMCk7XHJcblxyXG4gICAgICAgIC8vIEdldCByZWNlbnQgYWN0aXZpdGllc1xyXG4gICAgICAgIGNvbnN0IHJlY2VudEhvcnNlcyA9IGF3YWl0IEhvcnNlLmZpbmQoeyBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkIH0pXHJcbiAgICAgICAgICAgIC5zb3J0KCctY3JlYXRlZEF0JylcclxuICAgICAgICAgICAgLmxpbWl0KDUpXHJcbiAgICAgICAgICAgIC5zZWxlY3QoJ25hbWUgcHJpY2UgbGlzdGluZ1N0YXR1cyBjcmVhdGVkQXQnKTtcclxuXHJcbiAgICAgICAgY29uc3QgcmVjZW50SW5xdWlyaWVzID0gYXdhaXQgSW5xdWlyeS5maW5kKHsgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCB9KVxyXG4gICAgICAgICAgICAuc29ydCgnLWNyZWF0ZWRBdCcpXHJcbiAgICAgICAgICAgIC5saW1pdCg1KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ2hvcnNlJywgJ25hbWUnKVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3VzZXInLCAnbmFtZScpO1xyXG5cclxuICAgICAgICBjb25zdCByZWNlbnRUcmFuc2FjdGlvbnMgPSBhd2FpdCBUcmFuc2FjdGlvbi5maW5kKHsgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCB9KVxyXG4gICAgICAgICAgICAuc29ydCgnLWNyZWF0ZWRBdCcpXHJcbiAgICAgICAgICAgIC5saW1pdCg1KTtcclxuXHJcbiAgICAgICAgLy8gR2V0IHN1YnNjcmlwdGlvbiBpbmZvXHJcbiAgICAgICAgY29uc3Qgc2VsbGVyID0gYXdhaXQgU2VsbGVyLmZpbmRCeUlkKHJlcS5zZWxsZXIuX2lkKVxyXG4gICAgICAgICAgICAuc2VsZWN0KCdzdWJzY3JpcHRpb24gYnVzaW5lc3NOYW1lJyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgZGFzaGJvYXJkOiB7XHJcbiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb246IHNlbGxlci5zdWJzY3JpcHRpb24sXHJcbiAgICAgICAgICAgICAgICBsaXN0aW5nczoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbEhvcnNlcyxcclxuICAgICAgICAgICAgICAgICAgICBhY3RpdmU6IGFjdGl2ZUhvcnNlcyxcclxuICAgICAgICAgICAgICAgICAgICBkcmFmdDogZHJhZnRIb3JzZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVjZW50OiByZWNlbnRIb3JzZXNcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBpbnF1aXJpZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxJbnF1aXJpZXMsXHJcbiAgICAgICAgICAgICAgICAgICAgcGVuZGluZzogcGVuZGluZ0lucXVpcmllcyxcclxuICAgICAgICAgICAgICAgICAgICByZXNwb25kZWQ6IHJlc3BvbmRlZElucXVpcmllcyxcclxuICAgICAgICAgICAgICAgICAgICByZWNlbnQ6IHJlY2VudElucXVpcmllc1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uczoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0cmFuc2FjdGlvbnMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsUmV2ZW51ZSxcclxuICAgICAgICAgICAgICAgICAgICByZWNlbnQ6IHJlY2VudFRyYW5zYWN0aW9uc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgc2VsbGVyJ3MgcGVyZm9ybWFuY2UgbWV0cmljc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zZWxsZXIvZGFzaGJvYXJkL3BlcmZvcm1hbmNlXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlcilcclxuZXhwb3J0cy5nZXRQZXJmb3JtYW5jZU1ldHJpY3MgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdGhpcnR5RGF5c0FnbyA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgdGhpcnR5RGF5c0Fnby5zZXREYXRlKHRoaXJ0eURheXNBZ28uZ2V0RGF0ZSgpIC0gMzApO1xyXG5cclxuICAgICAgICAvLyBHZXQgbGlzdGluZyB2aWV3c1xyXG4gICAgICAgIGNvbnN0IGhvcnNlcyA9IGF3YWl0IEhvcnNlLmZpbmQoeyBcclxuICAgICAgICAgICAgc2VsbGVyOiByZXEuc2VsbGVyLl9pZCxcclxuICAgICAgICAgICAgY3JlYXRlZEF0OiB7ICRndGU6IHRoaXJ0eURheXNBZ28gfVxyXG4gICAgICAgIH0pLnNlbGVjdCgnc3RhdGlzdGljcycpO1xyXG5cclxuICAgICAgICBjb25zdCB0b3RhbFZpZXdzID0gaG9yc2VzLnJlZHVjZSgoYWNjLCBob3JzZSkgPT4gYWNjICsgaG9yc2Uuc3RhdGlzdGljcy52aWV3cywgMCk7XHJcbiAgICAgICAgY29uc3QgdG90YWxJbnF1aXJ5UmF0ZSA9IGhvcnNlcy5yZWR1Y2UoKGFjYywgaG9yc2UpID0+IGFjYyArIGhvcnNlLnN0YXRpc3RpY3MuaW5xdWlyaWVzLCAwKTtcclxuXHJcbiAgICAgICAgLy8gR2V0IHJlc3BvbnNlIHJhdGVcclxuICAgICAgICBjb25zdCBpbnF1aXJpZXMgPSBhd2FpdCBJbnF1aXJ5LmZpbmQoe1xyXG4gICAgICAgICAgICBzZWxsZXI6IHJlcS5zZWxsZXIuX2lkLFxyXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHsgJGd0ZTogdGhpcnR5RGF5c0FnbyB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlUmF0ZSA9IGlucXVpcmllcy5sZW5ndGggPiAwIFxyXG4gICAgICAgICAgICA/IChpbnF1aXJpZXMuZmlsdGVyKGkgPT4gaS5zdGF0dXMgPT09ICdyZXNwb25kZWQnKS5sZW5ndGggLyBpbnF1aXJpZXMubGVuZ3RoKSAqIDEwMCBcclxuICAgICAgICAgICAgOiAwO1xyXG5cclxuICAgICAgICAvLyBHZXQgYXZlcmFnZSByZXNwb25zZSB0aW1lXHJcbiAgICAgICAgY29uc3QgcmVzcG9uZGVkSW5xdWlyaWVzID0gaW5xdWlyaWVzLmZpbHRlcihpID0+IGkuc3RhdHVzID09PSAncmVzcG9uZGVkJyAmJiBpLnJlc3BvbnNlKTtcclxuICAgICAgICBjb25zdCBhdmdSZXNwb25zZVRpbWUgPSByZXNwb25kZWRJbnF1aXJpZXMubGVuZ3RoID4gMFxyXG4gICAgICAgICAgICA/IHJlc3BvbmRlZElucXVpcmllcy5yZWR1Y2UoKGFjYywgY3VycikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VUaW1lID0gbmV3IERhdGUoY3Vyci5yZXNwb25zZS5kYXRlKSAtIG5ldyBEYXRlKGN1cnIuY3JlYXRlZEF0KTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhY2MgKyByZXNwb25zZVRpbWU7XHJcbiAgICAgICAgICAgIH0sIDApIC8gcmVzcG9uZGVkSW5xdWlyaWVzLmxlbmd0aFxyXG4gICAgICAgICAgICA6IDA7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgcGVyZm9ybWFuY2U6IHtcclxuICAgICAgICAgICAgICAgIHRoaXJ0eURheU1ldHJpY3M6IHtcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbFZpZXdzLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsSW5xdWlyaWVzOiB0b3RhbElucXVpcnlSYXRlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlUmF0ZTogTWF0aC5yb3VuZChyZXNwb25zZVJhdGUpLFxyXG4gICAgICAgICAgICAgICAgICAgIGF2ZXJhZ2VSZXNwb25zZVRpbWU6IE1hdGgucm91bmQoYXZnUmVzcG9uc2VUaW1lIC8gKDEwMDAgKiA2MCAqIDYwKSksIC8vIENvbnZlcnQgdG8gaG91cnNcclxuICAgICAgICAgICAgICAgICAgICBsaXN0aW5nQ291bnQ6IGhvcnNlcy5sZW5ndGhcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHNlbGxlcidzIGxpc3RpbmcgYW5hbHl0aWNzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3NlbGxlci9kYXNoYm9hcmQvYW5hbHl0aWNzL2xpc3RpbmdzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGUgKFNlbGxlcilcclxuZXhwb3J0cy5nZXRMaXN0aW5nQW5hbHl0aWNzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgcGVyaW9kID0gJzMwJyB9ID0gcmVxLnF1ZXJ5OyAvLyBEZWZhdWx0IHRvIDMwIGRheXNcclxuICAgICAgICBjb25zdCBzdGFydERhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgICAgIHN0YXJ0RGF0ZS5zZXREYXRlKHN0YXJ0RGF0ZS5nZXREYXRlKCkgLSBwYXJzZUludChwZXJpb2QpKTtcclxuXHJcbiAgICAgICAgY29uc3QgaG9yc2VzID0gYXdhaXQgSG9yc2UuZmluZCh7XHJcbiAgICAgICAgICAgIHNlbGxlcjogcmVxLnNlbGxlci5faWQsXHJcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogeyAkZ3RlOiBzdGFydERhdGUgfVxyXG4gICAgICAgIH0pLnNlbGVjdCgnc3RhdGlzdGljcyBjcmVhdGVkQXQgcHJpY2UgbGlzdGluZ1N0YXR1cycpO1xyXG5cclxuICAgICAgICAvLyBHcm91cCBkYXRhIGJ5IGRhdGVcclxuICAgICAgICBjb25zdCBkYWlseVN0YXRzID0ge307XHJcbiAgICAgICAgaG9yc2VzLmZvckVhY2goaG9yc2UgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gaG9yc2UuY3JlYXRlZEF0LnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcclxuICAgICAgICAgICAgaWYgKCFkYWlseVN0YXRzW2RhdGVdKSB7XHJcbiAgICAgICAgICAgICAgICBkYWlseVN0YXRzW2RhdGVdID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdzOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGlucXVpcmllczogMCxcclxuICAgICAgICAgICAgICAgICAgICBsaXN0aW5nczogMCxcclxuICAgICAgICAgICAgICAgICAgICBhdmVyYWdlUHJpY2U6IDBcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGFpbHlTdGF0c1tkYXRlXS52aWV3cyArPSBob3JzZS5zdGF0aXN0aWNzLnZpZXdzO1xyXG4gICAgICAgICAgICBkYWlseVN0YXRzW2RhdGVdLmlucXVpcmllcyArPSBob3JzZS5zdGF0aXN0aWNzLmlucXVpcmllcztcclxuICAgICAgICAgICAgZGFpbHlTdGF0c1tkYXRlXS5saXN0aW5ncyArPSAxO1xyXG4gICAgICAgICAgICBkYWlseVN0YXRzW2RhdGVdLmF2ZXJhZ2VQcmljZSA9IFxyXG4gICAgICAgICAgICAgICAgKGRhaWx5U3RhdHNbZGF0ZV0uYXZlcmFnZVByaWNlICogKGRhaWx5U3RhdHNbZGF0ZV0ubGlzdGluZ3MgLSAxKSArIGhvcnNlLnByaWNlKSAvIFxyXG4gICAgICAgICAgICAgICAgZGFpbHlTdGF0c1tkYXRlXS5saXN0aW5ncztcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBhbmFseXRpY3M6IHtcclxuICAgICAgICAgICAgICAgIHBlcmlvZCxcclxuICAgICAgICAgICAgICAgIGRhaWx5U3RhdHNcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHNlbGxlcidzIGlucXVpcnkgYW5hbHl0aWNzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3NlbGxlci9kYXNoYm9hcmQvYW5hbHl0aWNzL2lucXVpcmllc1xyXG4vLyBAYWNjZXNzICBQcml2YXRlIChTZWxsZXIpXHJcbmV4cG9ydHMuZ2V0SW5xdWlyeUFuYWx5dGljcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IHBlcmlvZCA9ICczMCcgfSA9IHJlcS5xdWVyeTsgLy8gRGVmYXVsdCB0byAzMCBkYXlzXHJcbiAgICAgICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICBzdGFydERhdGUuc2V0RGF0ZShzdGFydERhdGUuZ2V0RGF0ZSgpIC0gcGFyc2VJbnQocGVyaW9kKSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGlucXVpcmllcyA9IGF3YWl0IElucXVpcnkuZmluZCh7XHJcbiAgICAgICAgICAgIHNlbGxlcjogcmVxLnNlbGxlci5faWQsXHJcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogeyAkZ3RlOiBzdGFydERhdGUgfVxyXG4gICAgICAgIH0pLnBvcHVsYXRlKCdob3JzZScsICduYW1lIHByaWNlJyk7XHJcblxyXG4gICAgICAgIC8vIEdyb3VwIGRhdGEgYnkgZGF0ZSBhbmQgc3RhdHVzXHJcbiAgICAgICAgY29uc3QgZGFpbHlTdGF0cyA9IHt9O1xyXG4gICAgICAgIGlucXVpcmllcy5mb3JFYWNoKGlucXVpcnkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBkYXRlID0gaW5xdWlyeS5jcmVhdGVkQXQudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdO1xyXG4gICAgICAgICAgICBpZiAoIWRhaWx5U3RhdHNbZGF0ZV0pIHtcclxuICAgICAgICAgICAgICAgIGRhaWx5U3RhdHNbZGF0ZV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgYnlTdGF0dXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZzogMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uZGVkOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZWQ6IDBcclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGJ5Q29udGFjdFByZWZlcmVuY2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBob25lOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aGF0c2FwcDogMFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZGFpbHlTdGF0c1tkYXRlXS50b3RhbCArPSAxO1xyXG4gICAgICAgICAgICBkYWlseVN0YXRzW2RhdGVdLmJ5U3RhdHVzW2lucXVpcnkuc3RhdHVzXSArPSAxO1xyXG4gICAgICAgICAgICBkYWlseVN0YXRzW2RhdGVdLmJ5Q29udGFjdFByZWZlcmVuY2VbaW5xdWlyeS5jb250YWN0UHJlZmVyZW5jZV0gKz0gMTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBhbmFseXRpY3M6IHtcclxuICAgICAgICAgICAgICAgIHBlcmlvZCxcclxuICAgICAgICAgICAgICAgIGRhaWx5U3RhdHMsXHJcbiAgICAgICAgICAgICAgICB0b3RhbElucXVpcmllczogaW5xdWlyaWVzLmxlbmd0aFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDNUMs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","map":{"version":3,"names":["Horse","require","Inquiry","Transaction","Seller","exports","getDashboardStats","req","res","totalHorses","countDocuments","seller","_id","activeHorses","listingStatus","draftHorses","totalInquiries","pendingInquiries","status","respondedInquiries","transactions","find","totalRevenue","reduce","acc","curr","amount","recentHorses","sort","limit","select","recentInquiries","populate","recentTransactions","findById","json","success","dashboard","subscription","listings","total","active","draft","recent","inquiries","pending","responded","length","error","console","message","getPerformanceMetrics","thirtyDaysAgo","Date","setDate","getDate","horses","createdAt","$gte","totalViews","horse","statistics","views","totalInquiryRate","responseRate","filter","i","response","avgResponseTime","responseTime","date","performance","thirtyDayMetrics","Math","round","averageResponseTime","listingCount","getListingAnalytics","period","query","startDate","parseInt","dailyStats","forEach","toISOString","split","averagePrice","price","analytics","getInquiryAnalytics","inquiry","byStatus","closed","byContactPreference","email","phone","whatsapp","contactPreference"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["seller.dashboard.controller.js"],"sourcesContent":["const Horse = require('../models/Horse');\r\nconst Inquiry = require('../models/Inquiry');\r\nconst Transaction = require('../models/Transaction');\r\nconst Seller = require('../models/Seller');\r\n\r\n// @desc    Get seller dashboard stats\r\n// @route   GET /api/seller/dashboard/stats\r\n// @access  Private (Seller)\r\nexports.getDashboardStats = async (req, res) => {\r\n    try {\r\n        // Get seller's horses count\r\n        const totalHorses = await Horse.countDocuments({ seller: req.seller._id });\r\n        const activeHorses = await Horse.countDocuments({ \r\n            seller: req.seller._id, \r\n            listingStatus: 'active' \r\n        });\r\n        const draftHorses = await Horse.countDocuments({ \r\n            seller: req.seller._id, \r\n            listingStatus: 'draft' \r\n        });\r\n\r\n        // Get seller's inquiries stats\r\n        const totalInquiries = await Inquiry.countDocuments({ seller: req.seller._id });\r\n        const pendingInquiries = await Inquiry.countDocuments({ \r\n            seller: req.seller._id,\r\n            status: 'pending'\r\n        });\r\n        const respondedInquiries = await Inquiry.countDocuments({ \r\n            seller: req.seller._id,\r\n            status: 'responded'\r\n        });\r\n\r\n        // Get seller's transactions stats\r\n        const transactions = await Transaction.find({ \r\n            seller: req.seller._id,\r\n            status: 'completed'\r\n        });\r\n        const totalRevenue = transactions.reduce((acc, curr) => acc + curr.amount, 0);\r\n\r\n        // Get recent activities\r\n        const recentHorses = await Horse.find({ seller: req.seller._id })\r\n            .sort('-createdAt')\r\n            .limit(5)\r\n            .select('name price listingStatus createdAt');\r\n\r\n        const recentInquiries = await Inquiry.find({ seller: req.seller._id })\r\n            .sort('-createdAt')\r\n            .limit(5)\r\n            .populate('horse', 'name')\r\n            .populate('user', 'name');\r\n\r\n        const recentTransactions = await Transaction.find({ seller: req.seller._id })\r\n            .sort('-createdAt')\r\n            .limit(5);\r\n\r\n        // Get subscription info\r\n        const seller = await Seller.findById(req.seller._id)\r\n            .select('subscription businessName');\r\n\r\n        res.json({\r\n            success: true,\r\n            dashboard: {\r\n                subscription: seller.subscription,\r\n                listings: {\r\n                    total: totalHorses,\r\n                    active: activeHorses,\r\n                    draft: draftHorses,\r\n                    recent: recentHorses\r\n                },\r\n                inquiries: {\r\n                    total: totalInquiries,\r\n                    pending: pendingInquiries,\r\n                    responded: respondedInquiries,\r\n                    recent: recentInquiries\r\n                },\r\n                transactions: {\r\n                    total: transactions.length,\r\n                    totalRevenue,\r\n                    recent: recentTransactions\r\n                }\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller's performance metrics\r\n// @route   GET /api/seller/dashboard/performance\r\n// @access  Private (Seller)\r\nexports.getPerformanceMetrics = async (req, res) => {\r\n    try {\r\n        const thirtyDaysAgo = new Date();\r\n        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n\r\n        // Get listing views\r\n        const horses = await Horse.find({ \r\n            seller: req.seller._id,\r\n            createdAt: { $gte: thirtyDaysAgo }\r\n        }).select('statistics');\r\n\r\n        const totalViews = horses.reduce((acc, horse) => acc + horse.statistics.views, 0);\r\n        const totalInquiryRate = horses.reduce((acc, horse) => acc + horse.statistics.inquiries, 0);\r\n\r\n        // Get response rate\r\n        const inquiries = await Inquiry.find({\r\n            seller: req.seller._id,\r\n            createdAt: { $gte: thirtyDaysAgo }\r\n        });\r\n\r\n        const responseRate = inquiries.length > 0 \r\n            ? (inquiries.filter(i => i.status === 'responded').length / inquiries.length) * 100 \r\n            : 0;\r\n\r\n        // Get average response time\r\n        const respondedInquiries = inquiries.filter(i => i.status === 'responded' && i.response);\r\n        const avgResponseTime = respondedInquiries.length > 0\r\n            ? respondedInquiries.reduce((acc, curr) => {\r\n                const responseTime = new Date(curr.response.date) - new Date(curr.createdAt);\r\n                return acc + responseTime;\r\n            }, 0) / respondedInquiries.length\r\n            : 0;\r\n\r\n        res.json({\r\n            success: true,\r\n            performance: {\r\n                thirtyDayMetrics: {\r\n                    totalViews,\r\n                    totalInquiries: totalInquiryRate,\r\n                    responseRate: Math.round(responseRate),\r\n                    averageResponseTime: Math.round(avgResponseTime / (1000 * 60 * 60)), // Convert to hours\r\n                    listingCount: horses.length\r\n                }\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller's listing analytics\r\n// @route   GET /api/seller/dashboard/analytics/listings\r\n// @access  Private (Seller)\r\nexports.getListingAnalytics = async (req, res) => {\r\n    try {\r\n        const { period = '30' } = req.query; // Default to 30 days\r\n        const startDate = new Date();\r\n        startDate.setDate(startDate.getDate() - parseInt(period));\r\n\r\n        const horses = await Horse.find({\r\n            seller: req.seller._id,\r\n            createdAt: { $gte: startDate }\r\n        }).select('statistics createdAt price listingStatus');\r\n\r\n        // Group data by date\r\n        const dailyStats = {};\r\n        horses.forEach(horse => {\r\n            const date = horse.createdAt.toISOString().split('T')[0];\r\n            if (!dailyStats[date]) {\r\n                dailyStats[date] = {\r\n                    views: 0,\r\n                    inquiries: 0,\r\n                    listings: 0,\r\n                    averagePrice: 0\r\n                };\r\n            }\r\n            dailyStats[date].views += horse.statistics.views;\r\n            dailyStats[date].inquiries += horse.statistics.inquiries;\r\n            dailyStats[date].listings += 1;\r\n            dailyStats[date].averagePrice = \r\n                (dailyStats[date].averagePrice * (dailyStats[date].listings - 1) + horse.price) / \r\n                dailyStats[date].listings;\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            analytics: {\r\n                period,\r\n                dailyStats\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get seller's inquiry analytics\r\n// @route   GET /api/seller/dashboard/analytics/inquiries\r\n// @access  Private (Seller)\r\nexports.getInquiryAnalytics = async (req, res) => {\r\n    try {\r\n        const { period = '30' } = req.query; // Default to 30 days\r\n        const startDate = new Date();\r\n        startDate.setDate(startDate.getDate() - parseInt(period));\r\n\r\n        const inquiries = await Inquiry.find({\r\n            seller: req.seller._id,\r\n            createdAt: { $gte: startDate }\r\n        }).populate('horse', 'name price');\r\n\r\n        // Group data by date and status\r\n        const dailyStats = {};\r\n        inquiries.forEach(inquiry => {\r\n            const date = inquiry.createdAt.toISOString().split('T')[0];\r\n            if (!dailyStats[date]) {\r\n                dailyStats[date] = {\r\n                    total: 0,\r\n                    byStatus: {\r\n                        pending: 0,\r\n                        responded: 0,\r\n                        closed: 0\r\n                    },\r\n                    byContactPreference: {\r\n                        email: 0,\r\n                        phone: 0,\r\n                        whatsapp: 0\r\n                    }\r\n                };\r\n            }\r\n            dailyStats[date].total += 1;\r\n            dailyStats[date].byStatus[inquiry.status] += 1;\r\n            dailyStats[date].byContactPreference[inquiry.contactPreference] += 1;\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            analytics: {\r\n                period,\r\n                dailyStats,\r\n                totalInquiries: inquiries.length\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734034576567},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\payment.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect\n} = require('../middlewares/auth.middleware');\nconst Razorpay = require('razorpay');\nconst crypto = require('crypto');\nconst Transaction = require('../models/Transaction');\n\n// Initialize Razorpay\nconst razorpay = new Razorpay({\n  key_id: process.env.RAZORPAY_KEY_ID,\n  key_secret: process.env.RAZORPAY_KEY_SECRET\n});\n\n// @desc    Get Razorpay key\n// @route   GET /api/payments/key\n// @access  Public\nrouter.get('/key', (req, res) => {\n  res.json({\n    success: true,\n    key: process.env.RAZORPAY_KEY_ID\n  });\n});\n\n// @desc    Create payment order\n// @route   POST /api/payments/create\n// @access  Private\nrouter.post('/create', protect, async (req, res) => {\n  try {\n    const {\n      amount,\n      currency = 'INR',\n      notes\n    } = req.body;\n\n    // Create Razorpay order\n    const order = await razorpay.orders.create({\n      amount: Math.round(amount * 100),\n      // Convert to paise\n      currency,\n      receipt: `order_${Date.now()}`,\n      notes: {\n        ...notes,\n        userId: req.user._id.toString()\n      },\n      payment_capture: 1\n    });\n\n    // Create a pending transaction\n    const transaction = await Transaction.create({\n      seller: req.user._id,\n      type: notes?.type || 'subscription',\n      amount: amount,\n      currency,\n      status: 'pending',\n      razorpayOrderId: order.id,\n      paymentMethod: 'razorpay',\n      subscriptionDetails: {\n        package: notes?.package || 'Royal Stallion',\n        duration: notes?.duration || 1\n      }\n    });\n    res.json({\n      success: true,\n      order: {\n        id: order.id,\n        amount: order.amount,\n        currency: order.currency\n      },\n      transaction: transaction._id\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @desc    Verify payment\n// @route   POST /api/payments/verify\n// @access  Private\nrouter.post('/verify', protect, async (req, res) => {\n  try {\n    const {\n      razorpay_payment_id,\n      razorpay_order_id,\n      razorpay_signature\n    } = req.body;\n\n    // Verify signature\n    const body = razorpay_order_id + '|' + razorpay_payment_id;\n    const expectedSignature = crypto.createHmac('sha256', process.env.RAZORPAY_KEY_SECRET).update(body).digest('hex');\n    const isAuthentic = expectedSignature === razorpay_signature;\n    if (!isAuthentic) {\n      return res.status(400).json({\n        success: false,\n        message: 'Invalid payment signature'\n      });\n    }\n\n    // Update transaction status\n    const transaction = await Transaction.findOneAndUpdate({\n      razorpayOrderId: razorpay_order_id\n    }, {\n      status: 'completed',\n      razorpayPaymentId: razorpay_payment_id,\n      razorpaySignature: razorpay_signature\n    }, {\n      new: true\n    });\n    if (!transaction) {\n      return res.status(404).json({\n        success: false,\n        message: 'Transaction not found'\n      });\n    }\n\n    // Handle subscription activation if it's a subscription payment\n    if (transaction.type === 'subscription') {\n      const seller = await req.user.model('Seller').findOne({\n        user: req.user._id\n      });\n      if (seller) {\n        const duration = transaction.subscriptionDetails?.duration || 1;\n        const expiryDate = new Date();\n        expiryDate.setDate(expiryDate.getDate() + duration * 30); // Add months\n\n        seller.subscription = {\n          plan: transaction.subscriptionDetails?.package || 'Royal Stallion',\n          status: 'active',\n          startDate: new Date(),\n          expiresAt: expiryDate\n        };\n        await seller.save();\n      }\n    }\n    res.json({\n      success: true,\n      transaction\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @desc    Get payment details\n// @route   GET /api/payments/:paymentId\n// @access  Private\nrouter.get('/:paymentId', protect, async (req, res) => {\n  try {\n    const payment = await razorpay.payments.fetch(req.params.paymentId);\n    res.json({\n      success: true,\n      payment\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\n\n// @desc    Create test payment (only in development)\n// @route   POST /api/payments/test\n// @access  Private\nrouter.post('/test', protect, async (req, res) => {\n  if (process.env.NODE_ENV !== 'development') {\n    return res.status(404).json({\n      success: false,\n      message: 'Endpoint not available in production'\n    });\n  }\n  try {\n    const {\n      amount = 500,\n      currency = 'INR'\n    } = req.body;\n\n    // Create a test order\n    const order = await razorpay.orders.create({\n      amount: amount * 100,\n      currency,\n      receipt: `test_${Date.now()}`,\n      notes: {\n        isTest: true,\n        userId: req.user._id.toString()\n      },\n      payment_capture: 1\n    });\n\n    // Create a test transaction\n    const transaction = await Transaction.create({\n      seller: req.user._id,\n      type: 'subscription',\n      amount,\n      currency,\n      status: 'pending',\n      razorpayOrderId: order.id,\n      paymentMethod: 'razorpay',\n      subscriptionDetails: {\n        package: 'Royal Stallion',\n        duration: 1\n      }\n    });\n    res.json({\n      success: true,\n      message: 'Test payment initiated',\n      testData: {\n        key: process.env.RAZORPAY_KEY_ID,\n        amount: order.amount,\n        currency: order.currency,\n        name: \"Galloping Gears\",\n        description: \"Test Payment\",\n        order_id: order.id,\n        prefill: {\n          name: req.user.name,\n          email: req.user.email\n        },\n        notes: {\n          transactionId: transaction._id.toString()\n        }\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJSYXpvcnBheSIsImNyeXB0byIsIlRyYW5zYWN0aW9uIiwicmF6b3JwYXkiLCJrZXlfaWQiLCJwcm9jZXNzIiwiZW52IiwiUkFaT1JQQVlfS0VZX0lEIiwia2V5X3NlY3JldCIsIlJBWk9SUEFZX0tFWV9TRUNSRVQiLCJnZXQiLCJyZXEiLCJyZXMiLCJqc29uIiwic3VjY2VzcyIsImtleSIsInBvc3QiLCJhbW91bnQiLCJjdXJyZW5jeSIsIm5vdGVzIiwiYm9keSIsIm9yZGVyIiwib3JkZXJzIiwiY3JlYXRlIiwiTWF0aCIsInJvdW5kIiwicmVjZWlwdCIsIkRhdGUiLCJub3ciLCJ1c2VySWQiLCJ1c2VyIiwiX2lkIiwidG9TdHJpbmciLCJwYXltZW50X2NhcHR1cmUiLCJ0cmFuc2FjdGlvbiIsInNlbGxlciIsInR5cGUiLCJzdGF0dXMiLCJyYXpvcnBheU9yZGVySWQiLCJpZCIsInBheW1lbnRNZXRob2QiLCJzdWJzY3JpcHRpb25EZXRhaWxzIiwicGFja2FnZSIsImR1cmF0aW9uIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsInJhem9ycGF5X3BheW1lbnRfaWQiLCJyYXpvcnBheV9vcmRlcl9pZCIsInJhem9ycGF5X3NpZ25hdHVyZSIsImV4cGVjdGVkU2lnbmF0dXJlIiwiY3JlYXRlSG1hYyIsInVwZGF0ZSIsImRpZ2VzdCIsImlzQXV0aGVudGljIiwiZmluZE9uZUFuZFVwZGF0ZSIsInJhem9ycGF5UGF5bWVudElkIiwicmF6b3JwYXlTaWduYXR1cmUiLCJuZXciLCJtb2RlbCIsImZpbmRPbmUiLCJleHBpcnlEYXRlIiwic2V0RGF0ZSIsImdldERhdGUiLCJzdWJzY3JpcHRpb24iLCJwbGFuIiwic3RhcnREYXRlIiwiZXhwaXJlc0F0Iiwic2F2ZSIsInBheW1lbnQiLCJwYXltZW50cyIsImZldGNoIiwicGFyYW1zIiwicGF5bWVudElkIiwiTk9ERV9FTlYiLCJpc1Rlc3QiLCJ0ZXN0RGF0YSIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsIm9yZGVyX2lkIiwicHJlZmlsbCIsImVtYWlsIiwidHJhbnNhY3Rpb25JZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJwYXltZW50LnJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCB7IHByb3RlY3QgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmVzL2F1dGgubWlkZGxld2FyZScpO1xyXG5jb25zdCBSYXpvcnBheSA9IHJlcXVpcmUoJ3Jhem9ycGF5Jyk7XHJcbmNvbnN0IGNyeXB0byA9IHJlcXVpcmUoJ2NyeXB0bycpO1xyXG5jb25zdCBUcmFuc2FjdGlvbiA9IHJlcXVpcmUoJy4uL21vZGVscy9UcmFuc2FjdGlvbicpO1xyXG5cclxuLy8gSW5pdGlhbGl6ZSBSYXpvcnBheVxyXG5jb25zdCByYXpvcnBheSA9IG5ldyBSYXpvcnBheSh7XHJcbiAgICBrZXlfaWQ6IHByb2Nlc3MuZW52LlJBWk9SUEFZX0tFWV9JRCxcclxuICAgIGtleV9zZWNyZXQ6IHByb2Nlc3MuZW52LlJBWk9SUEFZX0tFWV9TRUNSRVRcclxufSk7XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgUmF6b3JwYXkga2V5XHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3BheW1lbnRzL2tleVxyXG4vLyBAYWNjZXNzICBQdWJsaWNcclxucm91dGVyLmdldCgnL2tleScsIChyZXEsIHJlcykgPT4ge1xyXG4gICAgcmVzLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAga2V5OiBwcm9jZXNzLmVudi5SQVpPUlBBWV9LRVlfSURcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbi8vIEBkZXNjICAgIENyZWF0ZSBwYXltZW50IG9yZGVyXHJcbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9wYXltZW50cy9jcmVhdGVcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5yb3V0ZXIucG9zdCgnL2NyZWF0ZScsIHByb3RlY3QsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IGFtb3VudCwgY3VycmVuY3kgPSAnSU5SJywgbm90ZXMgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICAvLyBDcmVhdGUgUmF6b3JwYXkgb3JkZXJcclxuICAgICAgICBjb25zdCBvcmRlciA9IGF3YWl0IHJhem9ycGF5Lm9yZGVycy5jcmVhdGUoe1xyXG4gICAgICAgICAgICBhbW91bnQ6IE1hdGgucm91bmQoYW1vdW50ICogMTAwKSwgLy8gQ29udmVydCB0byBwYWlzZVxyXG4gICAgICAgICAgICBjdXJyZW5jeSxcclxuICAgICAgICAgICAgcmVjZWlwdDogYG9yZGVyXyR7RGF0ZS5ub3coKX1gLFxyXG4gICAgICAgICAgICBub3Rlczoge1xyXG4gICAgICAgICAgICAgICAgLi4ubm90ZXMsXHJcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHJlcS51c2VyLl9pZC50b1N0cmluZygpXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHBheW1lbnRfY2FwdHVyZTogMVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBDcmVhdGUgYSBwZW5kaW5nIHRyYW5zYWN0aW9uXHJcbiAgICAgICAgY29uc3QgdHJhbnNhY3Rpb24gPSBhd2FpdCBUcmFuc2FjdGlvbi5jcmVhdGUoe1xyXG4gICAgICAgICAgICBzZWxsZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgdHlwZTogbm90ZXM/LnR5cGUgfHwgJ3N1YnNjcmlwdGlvbicsXHJcbiAgICAgICAgICAgIGFtb3VudDogYW1vdW50LFxyXG4gICAgICAgICAgICBjdXJyZW5jeSxcclxuICAgICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXHJcbiAgICAgICAgICAgIHJhem9ycGF5T3JkZXJJZDogb3JkZXIuaWQsXHJcbiAgICAgICAgICAgIHBheW1lbnRNZXRob2Q6ICdyYXpvcnBheScsXHJcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbkRldGFpbHM6IHtcclxuICAgICAgICAgICAgICAgIHBhY2thZ2U6IG5vdGVzPy5wYWNrYWdlIHx8ICdSb3lhbCBTdGFsbGlvbicsXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogbm90ZXM/LmR1cmF0aW9uIHx8IDFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG9yZGVyOiB7XHJcbiAgICAgICAgICAgICAgICBpZDogb3JkZXIuaWQsXHJcbiAgICAgICAgICAgICAgICBhbW91bnQ6IG9yZGVyLmFtb3VudCxcclxuICAgICAgICAgICAgICAgIGN1cnJlbmN5OiBvcmRlci5jdXJyZW5jeVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0cmFuc2FjdGlvbjogdHJhbnNhY3Rpb24uX2lkXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLy8gQGRlc2MgICAgVmVyaWZ5IHBheW1lbnRcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3BheW1lbnRzL3ZlcmlmeVxyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbnJvdXRlci5wb3N0KCcvdmVyaWZ5JywgcHJvdGVjdCwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgcmF6b3JwYXlfcGF5bWVudF9pZCwgcmF6b3JwYXlfb3JkZXJfaWQsIHJhem9ycGF5X3NpZ25hdHVyZSB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAgIC8vIFZlcmlmeSBzaWduYXR1cmVcclxuICAgICAgICBjb25zdCBib2R5ID0gcmF6b3JwYXlfb3JkZXJfaWQgKyAnfCcgKyByYXpvcnBheV9wYXltZW50X2lkO1xyXG4gICAgICAgIGNvbnN0IGV4cGVjdGVkU2lnbmF0dXJlID0gY3J5cHRvXHJcbiAgICAgICAgICAgIC5jcmVhdGVIbWFjKCdzaGEyNTYnLCBwcm9jZXNzLmVudi5SQVpPUlBBWV9LRVlfU0VDUkVUKVxyXG4gICAgICAgICAgICAudXBkYXRlKGJvZHkpXHJcbiAgICAgICAgICAgIC5kaWdlc3QoJ2hleCcpO1xyXG5cclxuICAgICAgICBjb25zdCBpc0F1dGhlbnRpYyA9IGV4cGVjdGVkU2lnbmF0dXJlID09PSByYXpvcnBheV9zaWduYXR1cmU7XHJcblxyXG4gICAgICAgIGlmICghaXNBdXRoZW50aWMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcGF5bWVudCBzaWduYXR1cmUnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHRyYW5zYWN0aW9uIHN0YXR1c1xyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gYXdhaXQgVHJhbnNhY3Rpb24uZmluZE9uZUFuZFVwZGF0ZShcclxuICAgICAgICAgICAgeyByYXpvcnBheU9yZGVySWQ6IHJhem9ycGF5X29yZGVyX2lkIH0sXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXHJcbiAgICAgICAgICAgICAgICByYXpvcnBheVBheW1lbnRJZDogcmF6b3JwYXlfcGF5bWVudF9pZCxcclxuICAgICAgICAgICAgICAgIHJhem9ycGF5U2lnbmF0dXJlOiByYXpvcnBheV9zaWduYXR1cmVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeyBuZXc6IHRydWUgfVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmICghdHJhbnNhY3Rpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ1RyYW5zYWN0aW9uIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBIYW5kbGUgc3Vic2NyaXB0aW9uIGFjdGl2YXRpb24gaWYgaXQncyBhIHN1YnNjcmlwdGlvbiBwYXltZW50XHJcbiAgICAgICAgaWYgKHRyYW5zYWN0aW9uLnR5cGUgPT09ICdzdWJzY3JpcHRpb24nKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNlbGxlciA9IGF3YWl0IHJlcS51c2VyLm1vZGVsKCdTZWxsZXInKS5maW5kT25lKHsgdXNlcjogcmVxLnVzZXIuX2lkIH0pO1xyXG4gICAgICAgICAgICBpZiAoc2VsbGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IHRyYW5zYWN0aW9uLnN1YnNjcmlwdGlvbkRldGFpbHM/LmR1cmF0aW9uIHx8IDE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBleHBpcnlEYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgICAgICAgICAgIGV4cGlyeURhdGUuc2V0RGF0ZShleHBpcnlEYXRlLmdldERhdGUoKSArIChkdXJhdGlvbiAqIDMwKSk7IC8vIEFkZCBtb250aHNcclxuXHJcbiAgICAgICAgICAgICAgICBzZWxsZXIuc3Vic2NyaXB0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHBsYW46IHRyYW5zYWN0aW9uLnN1YnNjcmlwdGlvbkRldGFpbHM/LnBhY2thZ2UgfHwgJ1JveWFsIFN0YWxsaW9uJyxcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgICAgICAgICBleHBpcmVzQXQ6IGV4cGlyeURhdGVcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBzZWxsZXIuc2F2ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRyYW5zYWN0aW9uXHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHBheW1lbnQgZGV0YWlsc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9wYXltZW50cy86cGF5bWVudElkXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxucm91dGVyLmdldCgnLzpwYXltZW50SWQnLCBwcm90ZWN0LCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcGF5bWVudCA9IGF3YWl0IHJhem9ycGF5LnBheW1lbnRzLmZldGNoKHJlcS5wYXJhbXMucGF5bWVudElkKTtcclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHBheW1lbnRcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSk7XHJcblxyXG4vLyBAZGVzYyAgICBDcmVhdGUgdGVzdCBwYXltZW50IChvbmx5IGluIGRldmVsb3BtZW50KVxyXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvcGF5bWVudHMvdGVzdFxyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbnJvdXRlci5wb3N0KCcvdGVzdCcsIHByb3RlY3QsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAnZGV2ZWxvcG1lbnQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdFbmRwb2ludCBub3QgYXZhaWxhYmxlIGluIHByb2R1Y3Rpb24nXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IGFtb3VudCA9IDUwMCwgY3VycmVuY3kgPSAnSU5SJyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBhIHRlc3Qgb3JkZXJcclxuICAgICAgICBjb25zdCBvcmRlciA9IGF3YWl0IHJhem9ycGF5Lm9yZGVycy5jcmVhdGUoe1xyXG4gICAgICAgICAgICBhbW91bnQ6IGFtb3VudCAqIDEwMCxcclxuICAgICAgICAgICAgY3VycmVuY3ksXHJcbiAgICAgICAgICAgIHJlY2VpcHQ6IGB0ZXN0XyR7RGF0ZS5ub3coKX1gLFxyXG4gICAgICAgICAgICBub3Rlczoge1xyXG4gICAgICAgICAgICAgICAgaXNUZXN0OiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdXNlcklkOiByZXEudXNlci5faWQudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwYXltZW50X2NhcHR1cmU6IDFcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIGEgdGVzdCB0cmFuc2FjdGlvblxyXG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gYXdhaXQgVHJhbnNhY3Rpb24uY3JlYXRlKHtcclxuICAgICAgICAgICAgc2VsbGVyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIHR5cGU6ICdzdWJzY3JpcHRpb24nLFxyXG4gICAgICAgICAgICBhbW91bnQsXHJcbiAgICAgICAgICAgIGN1cnJlbmN5LFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcclxuICAgICAgICAgICAgcmF6b3JwYXlPcmRlcklkOiBvcmRlci5pZCxcclxuICAgICAgICAgICAgcGF5bWVudE1ldGhvZDogJ3Jhem9ycGF5JyxcclxuICAgICAgICAgICAgc3Vic2NyaXB0aW9uRGV0YWlsczoge1xyXG4gICAgICAgICAgICAgICAgcGFja2FnZTogJ1JveWFsIFN0YWxsaW9uJyxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnVGVzdCBwYXltZW50IGluaXRpYXRlZCcsXHJcbiAgICAgICAgICAgIHRlc3REYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBrZXk6IHByb2Nlc3MuZW52LlJBWk9SUEFZX0tFWV9JRCxcclxuICAgICAgICAgICAgICAgIGFtb3VudDogb3JkZXIuYW1vdW50LFxyXG4gICAgICAgICAgICAgICAgY3VycmVuY3k6IG9yZGVyLmN1cnJlbmN5LFxyXG4gICAgICAgICAgICAgICAgbmFtZTogXCJHYWxsb3BpbmcgR2VhcnNcIixcclxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlRlc3QgUGF5bWVudFwiLFxyXG4gICAgICAgICAgICAgICAgb3JkZXJfaWQ6IG9yZGVyLmlkLFxyXG4gICAgICAgICAgICAgICAgcHJlZmlsbDoge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHJlcS51c2VyLm5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHJlcS51c2VyLmVtYWlsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbm90ZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbklkOiB0cmFuc2FjdGlvbi5faWQudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNO0VBQUVDO0FBQVEsQ0FBQyxHQUFHSCxPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFD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","map":{"version":3,"names":["express","require","router","Router","protect","Razorpay","crypto","Transaction","razorpay","key_id","process","env","RAZORPAY_KEY_ID","key_secret","RAZORPAY_KEY_SECRET","get","req","res","json","success","key","post","amount","currency","notes","body","order","orders","create","Math","round","receipt","Date","now","userId","user","_id","toString","payment_capture","transaction","seller","type","status","razorpayOrderId","id","paymentMethod","subscriptionDetails","package","duration","error","console","message","razorpay_payment_id","razorpay_order_id","razorpay_signature","expectedSignature","createHmac","update","digest","isAuthentic","findOneAndUpdate","razorpayPaymentId","razorpaySignature","new","model","findOne","expiryDate","setDate","getDate","subscription","plan","startDate","expiresAt","save","payment","payments","fetch","params","paymentId","NODE_ENV","isTest","testData","name","description","order_id","prefill","email","transactionId","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["payment.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect } = require('../middlewares/auth.middleware');\r\nconst Razorpay = require('razorpay');\r\nconst crypto = require('crypto');\r\nconst Transaction = require('../models/Transaction');\r\n\r\n// Initialize Razorpay\r\nconst razorpay = new Razorpay({\r\n    key_id: process.env.RAZORPAY_KEY_ID,\r\n    key_secret: process.env.RAZORPAY_KEY_SECRET\r\n});\r\n\r\n// @desc    Get Razorpay key\r\n// @route   GET /api/payments/key\r\n// @access  Public\r\nrouter.get('/key', (req, res) => {\r\n    res.json({\r\n        success: true,\r\n        key: process.env.RAZORPAY_KEY_ID\r\n    });\r\n});\r\n\r\n// @desc    Create payment order\r\n// @route   POST /api/payments/create\r\n// @access  Private\r\nrouter.post('/create', protect, async (req, res) => {\r\n    try {\r\n        const { amount, currency = 'INR', notes } = req.body;\r\n\r\n        // Create Razorpay order\r\n        const order = await razorpay.orders.create({\r\n            amount: Math.round(amount * 100), // Convert to paise\r\n            currency,\r\n            receipt: `order_${Date.now()}`,\r\n            notes: {\r\n                ...notes,\r\n                userId: req.user._id.toString()\r\n            },\r\n            payment_capture: 1\r\n        });\r\n\r\n        // Create a pending transaction\r\n        const transaction = await Transaction.create({\r\n            seller: req.user._id,\r\n            type: notes?.type || 'subscription',\r\n            amount: amount,\r\n            currency,\r\n            status: 'pending',\r\n            razorpayOrderId: order.id,\r\n            paymentMethod: 'razorpay',\r\n            subscriptionDetails: {\r\n                package: notes?.package || 'Royal Stallion',\r\n                duration: notes?.duration || 1\r\n            }\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            order: {\r\n                id: order.id,\r\n                amount: order.amount,\r\n                currency: order.currency\r\n            },\r\n            transaction: transaction._id\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// @desc    Verify payment\r\n// @route   POST /api/payments/verify\r\n// @access  Private\r\nrouter.post('/verify', protect, async (req, res) => {\r\n    try {\r\n        const { razorpay_payment_id, razorpay_order_id, razorpay_signature } = req.body;\r\n\r\n        // Verify signature\r\n        const body = razorpay_order_id + '|' + razorpay_payment_id;\r\n        const expectedSignature = crypto\r\n            .createHmac('sha256', process.env.RAZORPAY_KEY_SECRET)\r\n            .update(body)\r\n            .digest('hex');\r\n\r\n        const isAuthentic = expectedSignature === razorpay_signature;\r\n\r\n        if (!isAuthentic) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: 'Invalid payment signature'\r\n            });\r\n        }\r\n\r\n        // Update transaction status\r\n        const transaction = await Transaction.findOneAndUpdate(\r\n            { razorpayOrderId: razorpay_order_id },\r\n            {\r\n                status: 'completed',\r\n                razorpayPaymentId: razorpay_payment_id,\r\n                razorpaySignature: razorpay_signature\r\n            },\r\n            { new: true }\r\n        );\r\n\r\n        if (!transaction) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Transaction not found'\r\n            });\r\n        }\r\n\r\n        // Handle subscription activation if it's a subscription payment\r\n        if (transaction.type === 'subscription') {\r\n            const seller = await req.user.model('Seller').findOne({ user: req.user._id });\r\n            if (seller) {\r\n                const duration = transaction.subscriptionDetails?.duration || 1;\r\n                const expiryDate = new Date();\r\n                expiryDate.setDate(expiryDate.getDate() + (duration * 30)); // Add months\r\n\r\n                seller.subscription = {\r\n                    plan: transaction.subscriptionDetails?.package || 'Royal Stallion',\r\n                    status: 'active',\r\n                    startDate: new Date(),\r\n                    expiresAt: expiryDate\r\n                };\r\n                await seller.save();\r\n            }\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            transaction\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// @desc    Get payment details\r\n// @route   GET /api/payments/:paymentId\r\n// @access  Private\r\nrouter.get('/:paymentId', protect, async (req, res) => {\r\n    try {\r\n        const payment = await razorpay.payments.fetch(req.params.paymentId);\r\n        res.json({\r\n            success: true,\r\n            payment\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\n// @desc    Create test payment (only in development)\r\n// @route   POST /api/payments/test\r\n// @access  Private\r\nrouter.post('/test', protect, async (req, res) => {\r\n    if (process.env.NODE_ENV !== 'development') {\r\n        return res.status(404).json({\r\n            success: false,\r\n            message: 'Endpoint not available in production'\r\n        });\r\n    }\r\n\r\n    try {\r\n        const { amount = 500, currency = 'INR' } = req.body;\r\n\r\n        // Create a test order\r\n        const order = await razorpay.orders.create({\r\n            amount: amount * 100,\r\n            currency,\r\n            receipt: `test_${Date.now()}`,\r\n            notes: {\r\n                isTest: true,\r\n                userId: req.user._id.toString()\r\n            },\r\n            payment_capture: 1\r\n        });\r\n\r\n        // Create a test transaction\r\n        const transaction = await Transaction.create({\r\n            seller: req.user._id,\r\n            type: 'subscription',\r\n            amount,\r\n            currency,\r\n            status: 'pending',\r\n            razorpayOrderId: order.id,\r\n            paymentMethod: 'razorpay',\r\n            subscriptionDetails: {\r\n                package: 'Royal Stallion',\r\n                duration: 1\r\n            }\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'Test payment initiated',\r\n            testData: {\r\n                key: process.env.RAZORPAY_KEY_ID,\r\n                amount: order.amount,\r\n                currency: order.currency,\r\n                name: \"Galloping Gears\",\r\n                description: \"Test Payment\",\r\n                order_id: order.id,\r\n                prefill: {\r\n                    name: req.user.name,\r\n                    email: req.user.email\r\n                },\r\n                notes: {\r\n                    transactionId: transaction._id.toString()\r\n                }\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC;AAAQ,CAAC,GAAGH,OAAO,CAAC,gCAAgC,CAAC;AAC7D,MAAMI,QAAQ,GAAGJ,OAAO,CAAC,UAAU,CAAC;AACpC,MAAMK,MAAM,GAAGL,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMM,WAAW,GAAGN,OAAO,CAAC,uBAAuB,CAAC;;AAEpD;AACA,MAAMO,QAAQ,GAAG,IAAIH,QAAQ,CAAC;EAC1BI,MAAM,EAAEC,OAAO,CAACC,GAAG,CAACC,eAAe;EACnCC,UAAU,EAAEH,OAAO,CAACC,GAAG,CAACG;AAC5B,CAAC,CAAC;;AAEF;AACA;AACA;AACAZ,MAAM,CAACa,GAAG,CAAC,MAAM,EAAE,CAACC,GAAG,EAAEC,GAAG,KAAK;EAC7BA,GAAG,CAACC,IAAI,CAAC;IACLC,OAAO,EAAE,IAAI;IACbC,GAAG,EAAEV,OAAO,CAACC,GAAG,CAACC;EACrB,CAAC,CAAC;AACN,CAAC,CAAC;;AAEF;AACA;AACA;AACAV,MAAM,CAACmB,IAAI,CAAC,SAAS,EAAEjB,OAAO,EAAE,OAAOY,GAAG,EAAEC,GAAG,KAAK;EAChD,IAAI;IACA,MAAM;MAAEK,MAAM;MAAEC,QAAQ,GAAG,KAAK;MAAEC;IAAM,CAAC,GAAGR,GAAG,CAACS,IAAI;;IAEpD;IACA,MAAMC,KAAK,GAAG,MAAMlB,QAAQ,CAACmB,MAAM,CAACC,MAAM,CAAC;MACvCN,MAAM,EAAEO,IAAI,CAACC,KAAK,CAACR,MAAM,GAAG,GAAG,CAAC;MAAE;MAClCC,QAAQ;MACRQ,OAAO,EAAE,SAASC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;MAC9BT,KAAK,EAAE;QACH,GAAGA,KAAK;QACRU,MAAM,EAAElB,GAAG,CAACmB,IAAI,CAACC,GAAG,CAACC,QAAQ,CAAC;MAClC,CAAC;MACDC,eAAe,EAAE;IACrB,CAAC,CAAC;;IAEF;IACA,MAAMC,WAAW,GAAG,MAAMhC,WAAW,CAACqB,MAAM,CAAC;MACzCY,MAAM,EAAExB,GAAG,CAACmB,IAAI,CAACC,GAAG;MACpBK,IAAI,EAAEjB,KAAK,EAAEiB,IAAI,IAAI,cAAc;MACnCnB,MAAM,EAAEA,MAAM;MACdC,QAAQ;MACRmB,MAAM,EAAE,SAAS;MACjBC,eAAe,EAAEjB,KAAK,CAACkB,EAAE;MACzBC,aAAa,EAAE,UAAU;MACzBC,mBAAmB,EAAE;QACjBC,OAAO,EAAEvB,KAAK,EAAEuB,OAAO,IAAI,gBAAgB;QAC3CC,QAAQ,EAAExB,KAAK,EAAEwB,QAAQ,IAAI;MACjC;IACJ,CAAC,CAAC;IAEF/B,GAAG,CAACC,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbO,KAAK,EAAE;QACHkB,EAAE,EAAElB,KAAK,CAACkB,EAAE;QACZtB,MAAM,EAAEI,KAAK,CAACJ,MAAM;QACpBC,QAAQ,EAAEG,KAAK,CAACH;MACpB,CAAC;MACDgB,WAAW,EAAEA,WAAW,CAACH;IAC7B,CAAC,CAAC;EACN,CAAC,CAAC,OAAOa,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBhC,GAAG,CAACyB,MAAM,CAAC,GAAG,CAAC,CAACxB,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdgC,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC,CAAC;;AAEF;AACA;AACA;AACAjD,MAAM,CAACmB,IAAI,CAAC,SAAS,EAAEjB,OAAO,EAAE,OAAOY,GAAG,EAAEC,GAAG,KAAK;EAChD,IAAI;IACA,MAAM;MAAEmC,mBAAmB;MAAEC,iBAAiB;MAAEC;IAAmB,CAAC,GAAGtC,GAAG,CAACS,IAAI;;IAE/E;IACA,MAAMA,IAAI,GAAG4B,iBAAiB,GAAG,GAAG,GAAGD,mBAAmB;IAC1D,MAAMG,iBAAiB,GAAGjD,MAAM,CAC3BkD,UAAU,CAAC,QAAQ,EAAE9C,OAAO,CAACC,GAAG,CAACG,mBAAmB,CAAC,CACrD2C,MAAM,CAAChC,IAAI,CAAC,CACZiC,MAAM,CAAC,KAAK,CAAC;IAElB,MAAMC,WAAW,GAAGJ,iBAAiB,KAAKD,kBAAkB;IAE5D,IAAI,CAACK,WAAW,EAAE;MACd,OAAO1C,GAAG,CAACyB,MAAM,CAAC,GAAG,CAAC,CAACxB,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdgC,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,MAAMZ,WAAW,GAAG,MAAMhC,WAAW,CAACqD,gBAAgB,CAClD;MAAEjB,eAAe,EAAEU;IAAkB,CAAC,EACtC;MACIX,MAAM,EAAE,WAAW;MACnBmB,iBAAiB,EAAET,mBAAmB;MACtCU,iBAAiB,EAAER;IACvB,CAAC,EACD;MAAES,GAAG,EAAE;IAAK,CAChB,CAAC;IAED,IAAI,CAACxB,WAAW,EAAE;MACd,OAAOtB,GAAG,CAACyB,MAAM,CAAC,GAAG,CAAC,CAACxB,IAAI,CAAC;QACxBC,OAAO,EAAE,KAAK;QACdgC,OAAO,EAAE;MACb,CAAC,CAAC;IACN;;IAEA;IACA,IAAIZ,WAAW,CAACE,IAAI,KAAK,cAAc,EAAE;MACrC,MAAMD,MAAM,GAAG,MAAMxB,GAAG,CAACmB,IAAI,CAAC6B,KAAK,CAAC,QAAQ,CAAC,CAACC,OAAO,CAAC;QAAE9B,IAAI,EAAEnB,GAAG,CAACmB,IAAI,CAACC;MAAI,CAAC,CAAC;MAC7E,IAAII,MAAM,EAAE;QACR,MAAMQ,QAAQ,GAAGT,WAAW,CAACO,mBAAmB,EAAEE,QAAQ,IAAI,CAAC;QAC/D,MAAMkB,UAAU,GAAG,IAAIlC,IAAI,CAAC,CAAC;QAC7BkC,UAAU,CAACC,OAAO,CAACD,UAAU,CAACE,OAAO,CAAC,CAAC,GAAIpB,QAAQ,GAAG,EAAG,CAAC,CAAC,CAAC;;QAE5DR,MAAM,CAAC6B,YAAY,GAAG;UAClBC,IAAI,EAAE/B,WAAW,CAACO,mBAAmB,EAAEC,OAAO,IAAI,gBAAgB;UAClEL,MAAM,EAAE,QAAQ;UAChB6B,SAAS,EAAE,IAAIvC,IAAI,CAAC,CAAC;UACrBwC,SAAS,EAAEN;QACf,CAAC;QACD,MAAM1B,MAAM,CAACiC,IAAI,CAAC,CAAC;MACvB;IACJ;IAEAxD,GAAG,CAACC,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACboB;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOU,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBhC,GAAG,CAACyB,MAAM,CAAC,GAAG,CAAC,CAACxB,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdgC,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC,CAAC;;AAEF;AACA;AACA;AACAjD,MAAM,CAACa,GAAG,CAAC,aAAa,EAAEX,OAAO,EAAE,OAAOY,GAAG,EAAEC,GAAG,KAAK;EACnD,IAAI;IACA,MAAMyD,OAAO,GAAG,MAAMlE,QAAQ,CAACmE,QAAQ,CAACC,KAAK,CAAC5D,GAAG,CAAC6D,MAAM,CAACC,SAAS,CAAC;IACnE7D,GAAG,CAACC,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbuD;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOzB,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBhC,GAAG,CAACyB,MAAM,CAAC,GAAG,CAAC,CAACxB,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdgC,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC,CAAC;;AAEF;AACA;AACA;AACAjD,MAAM,CAACmB,IAAI,CAAC,OAAO,EAAEjB,OAAO,EAAE,OAAOY,GAAG,EAAEC,GAAG,KAAK;EAC9C,IAAIP,OAAO,CAACC,GAAG,CAACoE,QAAQ,KAAK,aAAa,EAAE;IACxC,OAAO9D,GAAG,CAACyB,MAAM,CAAC,GAAG,CAAC,CAACxB,IAAI,CAAC;MACxBC,OAAO,EAAE,KAAK;MACdgC,OAAO,EAAE;IACb,CAAC,CAAC;EACN;EAEA,IAAI;IACA,MAAM;MAAE7B,MAAM,GAAG,GAAG;MAAEC,QAAQ,GAAG;IAAM,CAAC,GAAGP,GAAG,CAACS,IAAI;;IAEnD;IACA,MAAMC,KAAK,GAAG,MAAMlB,QAAQ,CAACmB,MAAM,CAACC,MAAM,CAAC;MACvCN,MAAM,EAAEA,MAAM,GAAG,GAAG;MACpBC,QAAQ;MACRQ,OAAO,EAAE,QAAQC,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;MAC7BT,KAAK,EAAE;QACHwD,MAAM,EAAE,IAAI;QACZ9C,MAAM,EAAElB,GAAG,CAACmB,IAAI,CAACC,GAAG,CAACC,QAAQ,CAAC;MAClC,CAAC;MACDC,eAAe,EAAE;IACrB,CAAC,CAAC;;IAEF;IACA,MAAMC,WAAW,GAAG,MAAMhC,WAAW,CAACqB,MAAM,CAAC;MACzCY,MAAM,EAAExB,GAAG,CAACmB,IAAI,CAACC,GAAG;MACpBK,IAAI,EAAE,cAAc;MACpBnB,MAAM;MACNC,QAAQ;MACRmB,MAAM,EAAE,SAAS;MACjBC,eAAe,EAAEjB,KAAK,CAACkB,EAAE;MACzBC,aAAa,EAAE,UAAU;MACzBC,mBAAmB,EAAE;QACjBC,OAAO,EAAE,gBAAgB;QACzBC,QAAQ,EAAE;MACd;IACJ,CAAC,CAAC;IAEF/B,GAAG,CAACC,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbgC,OAAO,EAAE,wBAAwB;MACjC8B,QAAQ,EAAE;QACN7D,GAAG,EAAEV,OAAO,CAACC,GAAG,CAACC,eAAe;QAChCU,MAAM,EAAEI,KAAK,CAACJ,MAAM;QACpBC,QAAQ,EAAEG,KAAK,CAACH,QAAQ;QACxB2D,IAAI,EAAE,iBAAiB;QACvBC,WAAW,EAAE,cAAc;QAC3BC,QAAQ,EAAE1D,KAAK,CAACkB,EAAE;QAClByC,OAAO,EAAE;UACLH,IAAI,EAAElE,GAAG,CAACmB,IAAI,CAAC+C,IAAI;UACnBI,KAAK,EAAEtE,GAAG,CAACmB,IAAI,CAACmD;QACpB,CAAC;QACD9D,KAAK,EAAE;UACH+D,aAAa,EAAEhD,WAAW,CAACH,GAAG,CAACC,QAAQ,CAAC;QAC5C;MACJ;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOY,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpBhC,GAAG,CAACyB,MAAM,CAAC,GAAG,CAAC,CAACxB,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdgC,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC,CAAC;AAEFqC,MAAM,CAACC,OAAO,GAAGvF,MAAM","ignoreList":[]}},"mtime":1734037215516},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\home.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst Horse = require('../models/Horse');\nconst Category = require('../models/Category');\nconst Seller = require('../models/Seller');\n\n// @desc    Get home page data\n// @route   GET /api/home\n// @access  Public\nrouter.get('/', async (req, res) => {\n  try {\n    // Get featured horses\n    const featuredHorses = await Horse.find({\n      listingStatus: 'active'\n    }).sort('-statistics.views').limit(6).populate('seller', 'businessName');\n\n    // Get recently added horses\n    const recentHorses = await Horse.find({\n      listingStatus: 'active'\n    }).sort('-createdAt').limit(8).populate('seller', 'businessName');\n\n    // Get popular breeds (categories)\n    const popularBreeds = await Category.find({\n      type: 'horse_breed',\n      status: 'active'\n    }).sort('-sortOrder').limit(8);\n\n    // Get featured sellers\n    const featuredSellers = await Seller.find({\n      'subscription.status': 'active',\n      'subscription.plan': {\n        $in: ['professional', 'premium']\n      }\n    }).select('businessName location images').limit(4);\n\n    // Get statistics\n    const totalHorses = await Horse.countDocuments({\n      listingStatus: 'active'\n    });\n    const totalSellers = await Seller.countDocuments({\n      'subscription.status': 'active'\n    });\n    const totalBreeds = await Category.countDocuments({\n      type: 'horse_breed',\n      status: 'active'\n    });\n    res.json({\n      success: true,\n      data: {\n        featured: {\n          horses: featuredHorses,\n          sellers: featuredSellers\n        },\n        recent: {\n          horses: recentHorses\n        },\n        categories: {\n          breeds: popularBreeds\n        },\n        stats: {\n          horses: totalHorses,\n          sellers: totalSellers,\n          breeds: totalBreeds\n        }\n      }\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n});\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsIkhvcnNlIiwiQ2F0ZWdvcnkiLCJTZWxsZXIiLCJnZXQiLCJyZXEiLCJyZXMiLCJmZWF0dXJlZEhvcnNlcyIsImZpbmQiLCJsaXN0aW5nU3RhdHVzIiwic29ydCIsImxpbWl0IiwicG9wdWxhdGUiLCJyZWNlbnRIb3JzZXMiLCJwb3B1bGFyQnJlZWRzIiwidHlwZSIsInN0YXR1cyIsImZlYXR1cmVkU2VsbGVycyIsIiRpbiIsInNlbGVjdCIsInRvdGFsSG9yc2VzIiwiY291bnREb2N1bWVudHMiLCJ0b3RhbFNlbGxlcnMiLCJ0b3RhbEJyZWVkcyIsImpzb24iLCJzdWNjZXNzIiwiZGF0YSIsImZlYXR1cmVkIiwiaG9yc2VzIiwic2VsbGVycyIsInJlY2VudCIsImNhdGVnb3JpZXMiLCJicmVlZHMiLCJzdGF0cyIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsiaG9tZS5yb3V0ZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuY29uc3QgSG9yc2UgPSByZXF1aXJlKCcuLi9tb2RlbHMvSG9yc2UnKTtcclxuY29uc3QgQ2F0ZWdvcnkgPSByZXF1aXJlKCcuLi9tb2RlbHMvQ2F0ZWdvcnknKTtcclxuY29uc3QgU2VsbGVyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1NlbGxlcicpO1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IGhvbWUgcGFnZSBkYXRhXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL2hvbWVcclxuLy8gQGFjY2VzcyAgUHVibGljXHJcbnJvdXRlci5nZXQoJy8nLCBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gR2V0IGZlYXR1cmVkIGhvcnNlc1xyXG4gICAgICAgIGNvbnN0IGZlYXR1cmVkSG9yc2VzID0gYXdhaXQgSG9yc2UuZmluZCh7IGxpc3RpbmdTdGF0dXM6ICdhY3RpdmUnIH0pXHJcbiAgICAgICAgICAgIC5zb3J0KCctc3RhdGlzdGljcy52aWV3cycpXHJcbiAgICAgICAgICAgIC5saW1pdCg2KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3NlbGxlcicsICdidXNpbmVzc05hbWUnKTtcclxuXHJcbiAgICAgICAgLy8gR2V0IHJlY2VudGx5IGFkZGVkIGhvcnNlc1xyXG4gICAgICAgIGNvbnN0IHJlY2VudEhvcnNlcyA9IGF3YWl0IEhvcnNlLmZpbmQoeyBsaXN0aW5nU3RhdHVzOiAnYWN0aXZlJyB9KVxyXG4gICAgICAgICAgICAuc29ydCgnLWNyZWF0ZWRBdCcpXHJcbiAgICAgICAgICAgIC5saW1pdCg4KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3NlbGxlcicsICdidXNpbmVzc05hbWUnKTtcclxuXHJcbiAgICAgICAgLy8gR2V0IHBvcHVsYXIgYnJlZWRzIChjYXRlZ29yaWVzKVxyXG4gICAgICAgIGNvbnN0IHBvcHVsYXJCcmVlZHMgPSBhd2FpdCBDYXRlZ29yeS5maW5kKHsgXHJcbiAgICAgICAgICAgIHR5cGU6ICdob3JzZV9icmVlZCcsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZScgXHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc29ydCgnLXNvcnRPcmRlcicpXHJcbiAgICAgICAgLmxpbWl0KDgpO1xyXG5cclxuICAgICAgICAvLyBHZXQgZmVhdHVyZWQgc2VsbGVyc1xyXG4gICAgICAgIGNvbnN0IGZlYXR1cmVkU2VsbGVycyA9IGF3YWl0IFNlbGxlci5maW5kKHtcclxuICAgICAgICAgICAgJ3N1YnNjcmlwdGlvbi5zdGF0dXMnOiAnYWN0aXZlJyxcclxuICAgICAgICAgICAgJ3N1YnNjcmlwdGlvbi5wbGFuJzogeyAkaW46IFsncHJvZmVzc2lvbmFsJywgJ3ByZW1pdW0nXSB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuc2VsZWN0KCdidXNpbmVzc05hbWUgbG9jYXRpb24gaW1hZ2VzJylcclxuICAgICAgICAubGltaXQoNCk7XHJcblxyXG4gICAgICAgIC8vIEdldCBzdGF0aXN0aWNzXHJcbiAgICAgICAgY29uc3QgdG90YWxIb3JzZXMgPSBhd2FpdCBIb3JzZS5jb3VudERvY3VtZW50cyh7IGxpc3RpbmdTdGF0dXM6ICdhY3RpdmUnIH0pO1xyXG4gICAgICAgIGNvbnN0IHRvdGFsU2VsbGVycyA9IGF3YWl0IFNlbGxlci5jb3VudERvY3VtZW50cyh7ICdzdWJzY3JpcHRpb24uc3RhdHVzJzogJ2FjdGl2ZScgfSk7XHJcbiAgICAgICAgY29uc3QgdG90YWxCcmVlZHMgPSBhd2FpdCBDYXRlZ29yeS5jb3VudERvY3VtZW50cyh7IHR5cGU6ICdob3JzZV9icmVlZCcsIHN0YXR1czogJ2FjdGl2ZScgfSk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgZmVhdHVyZWQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBob3JzZXM6IGZlYXR1cmVkSG9yc2VzLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGxlcnM6IGZlYXR1cmVkU2VsbGVyc1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlY2VudDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGhvcnNlczogcmVjZW50SG9yc2VzXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2F0ZWdvcmllczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWVkczogcG9wdWxhckJyZWVkc1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHN0YXRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaG9yc2VzOiB0b3RhbEhvcnNlcyxcclxuICAgICAgICAgICAgICAgICAgICBzZWxsZXJzOiB0b3RhbFNlbGxlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlZWRzOiB0b3RhbEJyZWVkc1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdTZXJ2ZXIgZXJyb3InXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNQyxLQUFLLEdBQUdILE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztBQUN4QyxNQUFNSSxRQUFRLEdBQUdKLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQztBQUM5QyxNQUFNSyxNQUFNLEdBQUdMLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7QUFFMUM7QUFDQTtBQUNBO0FBQ0FDLE1BQU0sQ0FBQ0ssR0FBRyxDQUFDLEdBQUcsRUFBRSxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUNoQyxJQUFJO0lBQ0E7SUFDQSxNQUFNQyxjQUFjLEdBQUcsTUFBTU4sS0FBSyxDQUFDTyxJQUFJLENBQUM7TUFBRUMsYUFBYSxFQUFFO0lBQVMsQ0FBQyxDQUFDLENBQy9EQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FDekJDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FDUkMsUUFBUSxDQUFDLFFBQVEsRUFBRSxjQUFjLENBQUM7O0lBRXZDO0lBQ0EsTUFBTUMsWUFBWSxHQUFHLE1BQU1aLEtBQUssQ0FBQ08sSUFBSSxDQUFDO01BQUVDLGFBQWEsRUFBRTtJQUFTLENBQUMsQ0FBQyxDQUM3REMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUNsQkMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUNSQyxRQUFRLENBQUMsUUFBUSxFQUFFLGNBQWMsQ0FBQzs7SUFFdkM7SUFDQSxNQUFNRSxhQUFhLEdBQUcsTUFBTVosUUFBUSxDQUFDTSxJQUFJLENBQUM7TUFDdENPLElBQUksRUFBRSxhQUFhO01BQ25CQyxNQUFNLEVBQUU7SUFDWixDQUFDLENBQUMsQ0FDRE4sSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUNsQkMsS0FBSyxDQUFDLENBQUMsQ0FBQzs7SUFFVDtJQUNBLE1BQU1NLGVBQWUsR0FBRyxNQUFNZCxNQUFNLENBQUNLLElBQUksQ0FBQztNQUN0QyxxQkFBcUIsRUFBRSxRQUFRO01BQy9CLG1CQUFtQixFQUFFO1FBQUVVLEdBQUcsRUFBRSxDQUFDLGNBQWMsRUFBRSxTQUFTO01BQUU7SUFDNUQsQ0FBQyxDQUFDLENBQ0RDLE1BQU0sQ0FBQyw4QkFBOEIsQ0FBQyxDQUN0Q1IsS0FBSyxDQUFDLENBQUMsQ0FBQzs7SUFFVDtJQUNBLE1BQU1TLFdBQVcsR0FBRyxNQUFNbkIsS0FBSyxDQUFDb0IsY0FBYyxDQUFDO01BQUVaLGFBQWEsRUFBRTtJQUFTLENBQUMsQ0FBQztJQUMzRSxNQUFNYSxZQUFZLEdBQUcsTUFBTW5CLE1BQU0sQ0FBQ2tCLGNBQWMsQ0FBQztNQUFFLHFCQUFxQixFQUFFO0lBQVMsQ0FBQyxDQUFDO0lBQ3JGLE1BQU1FLFdBQVcsR0FBRyxNQUFNckIsUUFBUSxDQUFDbUIsY0FBYyxDQUFDO01BQUVOLElBQUksRUFBRSxhQUFhO01BQUVDLE1BQU0sRUFBRTtJQUFTLENBQUMsQ0FBQztJQUU1RlYsR0FBRyxDQUFDa0IsSUFBSSxDQUFDO01BQ0xDLE9BQU8sRUFBRSxJQUFJO01BQ2JDLElBQUksRUFBRTtRQUNGQyxRQUFRLEVBQUU7VUFDTkMsTUFBTSxFQUFFckIsY0FBYztVQUN0QnNCLE9BQU8sRUFBRVo7UUFDYixDQUFDO1FBQ0RhLE1BQU0sRUFBRTtVQUNKRixNQUFNLEVBQUVmO1FBQ1osQ0FBQztRQUNEa0IsVUFBVSxFQUFFO1VBQ1JDLE1BQU0sRUFBRWxCO1FBQ1osQ0FBQztRQUNEbUIsS0FBSyxFQUFFO1VBQ0hMLE1BQU0sRUFBRVIsV0FBVztVQUNuQlMsT0FBTyxFQUFFUCxZQUFZO1VBQ3JCVSxNQUFNLEVBQUVUO1FBQ1o7TUFDSjtJQUNKLENBQUMsQ0FBQztFQUNOLENBQUMsQ0FBQyxPQUFPVyxLQUFLLEVBQUU7SUFDWkMsT0FBTyxDQUFDRCxLQUFLLENBQUNBLEtBQUssQ0FBQztJQUNwQjVCLEdBQUcsQ0FBQ1UsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDUSxJQUFJLENBQUM7TUFDakJDLE9BQU8sRUFBRSxLQUFLO01BQ2RXLE9BQU8sRUFBRTtJQUNiLENBQUMsQ0FBQztFQUNOO0FBQ0osQ0FBQyxDQUFDO0FBRUZDLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHdkMsTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["express","require","router","Router","Horse","Category","Seller","get","req","res","featuredHorses","find","listingStatus","sort","limit","populate","recentHorses","popularBreeds","type","status","featuredSellers","$in","select","totalHorses","countDocuments","totalSellers","totalBreeds","json","success","data","featured","horses","sellers","recent","categories","breeds","stats","error","console","message","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["home.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst Horse = require('../models/Horse');\r\nconst Category = require('../models/Category');\r\nconst Seller = require('../models/Seller');\r\n\r\n// @desc    Get home page data\r\n// @route   GET /api/home\r\n// @access  Public\r\nrouter.get('/', async (req, res) => {\r\n    try {\r\n        // Get featured horses\r\n        const featuredHorses = await Horse.find({ listingStatus: 'active' })\r\n            .sort('-statistics.views')\r\n            .limit(6)\r\n            .populate('seller', 'businessName');\r\n\r\n        // Get recently added horses\r\n        const recentHorses = await Horse.find({ listingStatus: 'active' })\r\n            .sort('-createdAt')\r\n            .limit(8)\r\n            .populate('seller', 'businessName');\r\n\r\n        // Get popular breeds (categories)\r\n        const popularBreeds = await Category.find({ \r\n            type: 'horse_breed',\r\n            status: 'active' \r\n        })\r\n        .sort('-sortOrder')\r\n        .limit(8);\r\n\r\n        // Get featured sellers\r\n        const featuredSellers = await Seller.find({\r\n            'subscription.status': 'active',\r\n            'subscription.plan': { $in: ['professional', 'premium'] }\r\n        })\r\n        .select('businessName location images')\r\n        .limit(4);\r\n\r\n        // Get statistics\r\n        const totalHorses = await Horse.countDocuments({ listingStatus: 'active' });\r\n        const totalSellers = await Seller.countDocuments({ 'subscription.status': 'active' });\r\n        const totalBreeds = await Category.countDocuments({ type: 'horse_breed', status: 'active' });\r\n\r\n        res.json({\r\n            success: true,\r\n            data: {\r\n                featured: {\r\n                    horses: featuredHorses,\r\n                    sellers: featuredSellers\r\n                },\r\n                recent: {\r\n                    horses: recentHorses\r\n                },\r\n                categories: {\r\n                    breeds: popularBreeds\r\n                },\r\n                stats: {\r\n                    horses: totalHorses,\r\n                    sellers: totalSellers,\r\n                    breeds: totalBreeds\r\n                }\r\n            }\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n});\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAMC,KAAK,GAAGH,OAAO,CAAC,iBAAiB,CAAC;AACxC,MAAMI,QAAQ,GAAGJ,OAAO,CAAC,oBAAoB,CAAC;AAC9C,MAAMK,MAAM,GAAGL,OAAO,CAAC,kBAAkB,CAAC;;AAE1C;AACA;AACA;AACAC,MAAM,CAACK,GAAG,CAAC,GAAG,EAAE,OAAOC,GAAG,EAAEC,GAAG,KAAK;EAChC,IAAI;IACA;IACA,MAAMC,cAAc,GAAG,MAAMN,KAAK,CAACO,IAAI,CAAC;MAAEC,aAAa,EAAE;IAAS,CAAC,CAAC,CAC/DC,IAAI,CAAC,mBAAmB,CAAC,CACzBC,KAAK,CAAC,CAAC,CAAC,CACRC,QAAQ,CAAC,QAAQ,EAAE,cAAc,CAAC;;IAEvC;IACA,MAAMC,YAAY,GAAG,MAAMZ,KAAK,CAACO,IAAI,CAAC;MAAEC,aAAa,EAAE;IAAS,CAAC,CAAC,CAC7DC,IAAI,CAAC,YAAY,CAAC,CAClBC,KAAK,CAAC,CAAC,CAAC,CACRC,QAAQ,CAAC,QAAQ,EAAE,cAAc,CAAC;;IAEvC;IACA,MAAME,aAAa,GAAG,MAAMZ,QAAQ,CAACM,IAAI,CAAC;MACtCO,IAAI,EAAE,aAAa;MACnBC,MAAM,EAAE;IACZ,CAAC,CAAC,CACDN,IAAI,CAAC,YAAY,CAAC,CAClBC,KAAK,CAAC,CAAC,CAAC;;IAET;IACA,MAAMM,eAAe,GAAG,MAAMd,MAAM,CAACK,IAAI,CAAC;MACtC,qBAAqB,EAAE,QAAQ;MAC/B,mBAAmB,EAAE;QAAEU,GAAG,EAAE,CAAC,cAAc,EAAE,SAAS;MAAE;IAC5D,CAAC,CAAC,CACDC,MAAM,CAAC,8BAA8B,CAAC,CACtCR,KAAK,CAAC,CAAC,CAAC;;IAET;IACA,MAAMS,WAAW,GAAG,MAAMnB,KAAK,CAACoB,cAAc,CAAC;MAAEZ,aAAa,EAAE;IAAS,CAAC,CAAC;IAC3E,MAAMa,YAAY,GAAG,MAAMnB,MAAM,CAACkB,cAAc,CAAC;MAAE,qBAAqB,EAAE;IAAS,CAAC,CAAC;IACrF,MAAME,WAAW,GAAG,MAAMrB,QAAQ,CAACmB,cAAc,CAAC;MAAEN,IAAI,EAAE,aAAa;MAAEC,MAAM,EAAE;IAAS,CAAC,CAAC;IAE5FV,GAAG,CAACkB,IAAI,CAAC;MACLC,OAAO,EAAE,IAAI;MACbC,IAAI,EAAE;QACFC,QAAQ,EAAE;UACNC,MAAM,EAAErB,cAAc;UACtBsB,OAAO,EAAEZ;QACb,CAAC;QACDa,MAAM,EAAE;UACJF,MAAM,EAAEf;QACZ,CAAC;QACDkB,UAAU,EAAE;UACRC,MAAM,EAAElB;QACZ,CAAC;QACDmB,KAAK,EAAE;UACHL,MAAM,EAAER,WAAW;UACnBS,OAAO,EAAEP,YAAY;UACrBU,MAAM,EAAET;QACZ;MACJ;IACJ,CAAC,CAAC;EACN,CAAC,CAAC,OAAOW,KAAK,EAAE;IACZC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;IACpB5B,GAAG,CAACU,MAAM,CAAC,GAAG,CAAC,CAACQ,IAAI,CAAC;MACjBC,OAAO,EAAE,KAAK;MACdW,OAAO,EAAE;IACb,CAAC,CAAC;EACN;AACJ,CAAC,CAAC;AAEFC,MAAM,CAACC,OAAO,GAAGvC,MAAM","ignoreList":[]}},"mtime":1734035456254},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\support.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  createTicket,\n  getTickets,\n  getTicketById,\n  updateTicket,\n  getFaqs,\n  getFaqById\n} = require('../controllers/support.controller');\n\n// Validation middleware\nconst createTicketValidation = [body('subject').notEmpty().withMessage('Subject is required'), body('category').isIn(['account', 'payment', 'listing', 'technical', 'verification', 'report', 'other']).withMessage('Valid category is required'), body('priority').isIn(['low', 'medium', 'high', 'urgent']).withMessage('Valid priority is required'), body('description').notEmpty().withMessage('Description is required')];\nconst updateTicketValidation = [body('status').optional().isIn(['open', 'in_progress', 'waiting_for_user', 'resolved', 'closed']).withMessage('Valid status is required'), body('message').optional().notEmpty().withMessage('Message is required')];\n\n// Support ticket routes\nrouter.post('/tickets', protect, createTicketValidation, createTicket);\nrouter.get('/tickets', protect, getTickets);\nrouter.get('/tickets/:id', protect, getTicketById);\nrouter.put('/tickets/:id', protect, updateTicketValidation, updateTicket);\n\n// FAQ routes\nrouter.get('/faqs', getFaqs);\nrouter.get('/faqs/:id', getFaqById);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJib2R5IiwiY3JlYXRlVGlja2V0IiwiZ2V0VGlja2V0cyIsImdldFRpY2tldEJ5SWQiLCJ1cGRhdGVUaWNrZXQiLCJnZXRGYXFzIiwiZ2V0RmFxQnlJZCIsImNyZWF0ZVRpY2tldFZhbGlkYXRpb24iLCJub3RFbXB0eSIsIndpdGhNZXNzYWdlIiwiaXNJbiIsInVwZGF0ZVRpY2tldFZhbGlkYXRpb24iLCJvcHRpb25hbCIsInBvc3QiLCJnZXQiLCJwdXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsic3VwcG9ydC5yb3V0ZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcclxuY29uc3Qgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuY29uc3QgeyBwcm90ZWN0IH0gPSByZXF1aXJlKCcuLi9taWRkbGV3YXJlcy9hdXRoLm1pZGRsZXdhcmUnKTtcclxuY29uc3QgeyBib2R5IH0gPSByZXF1aXJlKCdleHByZXNzLXZhbGlkYXRvcicpO1xyXG5jb25zdCB7XHJcbiAgICBjcmVhdGVUaWNrZXQsXHJcbiAgICBnZXRUaWNrZXRzLFxyXG4gICAgZ2V0VGlja2V0QnlJZCxcclxuICAgIHVwZGF0ZVRpY2tldCxcclxuICAgIGdldEZhcXMsXHJcbiAgICBnZXRGYXFCeUlkXHJcbn0gPSByZXF1aXJlKCcuLi9jb250cm9sbGVycy9zdXBwb3J0LmNvbnRyb2xsZXInKTtcclxuXHJcbi8vIFZhbGlkYXRpb24gbWlkZGxld2FyZVxyXG5jb25zdCBjcmVhdGVUaWNrZXRWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnc3ViamVjdCcpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ1N1YmplY3QgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2NhdGVnb3J5JylcclxuICAgICAgICAuaXNJbihbJ2FjY291bnQnLCAncGF5bWVudCcsICdsaXN0aW5nJywgJ3RlY2huaWNhbCcsICd2ZXJpZmljYXRpb24nLCAncmVwb3J0JywgJ290aGVyJ10pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdWYWxpZCBjYXRlZ29yeSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgncHJpb3JpdHknKVxyXG4gICAgICAgIC5pc0luKFsnbG93JywgJ21lZGl1bScsICdoaWdoJywgJ3VyZ2VudCddKVxyXG4gICAgICAgIC53aXRoTWVzc2FnZSgnVmFsaWQgcHJpb3JpdHkgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2Rlc2NyaXB0aW9uJykubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnRGVzY3JpcHRpb24gaXMgcmVxdWlyZWQnKVxyXG5dO1xyXG5cclxuY29uc3QgdXBkYXRlVGlja2V0VmFsaWRhdGlvbiA9IFtcclxuICAgIGJvZHkoJ3N0YXR1cycpXHJcbiAgICAgICAgLm9wdGlvbmFsKClcclxuICAgICAgICAuaXNJbihbJ29wZW4nLCAnaW5fcHJvZ3Jlc3MnLCAnd2FpdGluZ19mb3JfdXNlcicsICdyZXNvbHZlZCcsICdjbG9zZWQnXSlcclxuICAgICAgICAud2l0aE1lc3NhZ2UoJ1ZhbGlkIHN0YXR1cyBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnbWVzc2FnZScpLm9wdGlvbmFsKCkubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnTWVzc2FnZSBpcyByZXF1aXJlZCcpXHJcbl07XHJcblxyXG4vLyBTdXBwb3J0IHRpY2tldCByb3V0ZXNcclxucm91dGVyLnBvc3QoJy90aWNrZXRzJywgcHJvdGVjdCwgY3JlYXRlVGlja2V0VmFsaWRhdGlvbiwgY3JlYXRlVGlja2V0KTtcclxucm91dGVyLmdldCgnL3RpY2tldHMnLCBwcm90ZWN0LCBnZXRUaWNrZXRzKTtcclxucm91dGVyLmdldCgnL3RpY2tldHMvOmlkJywgcHJvdGVjdCwgZ2V0VGlja2V0QnlJZCk7XHJcbnJvdXRlci5wdXQoJy90aWNrZXRzLzppZCcsIHByb3RlY3QsIHVwZGF0ZVRpY2tldFZhbGlkYXRpb24sIHVwZGF0ZVRpY2tldCk7XHJcblxyXG4vLyBGQVEgcm91dGVzXHJcbnJvdXRlci5nZXQoJy9mYXFzJywgZ2V0RmFxcyk7XHJcbnJvdXRlci5nZXQoJy9mYXFzLzppZCcsIGdldEZhcUJ5SWQpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNO0VBQUVDO0FBQVEsQ0FBQyxHQUFHSCxPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDN0QsTUFBTTtFQUFFSTtBQUFLLENBQUMsR0FBR0osT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzdDLE1BQU07RUFDRkssWUFBWTtFQUNaQyxVQUFVO0VBQ1ZDLGFBQWE7RUFDYkMsWUFBWTtFQUNaQyxPQUFPO0VBQ1BDO0FBQ0osQ0FBQyxHQUFHVixPQUFPLENBQUMsbUNBQW1DLENBQUM7O0FBRWhEO0FBQ0EsTUFBTVcsc0JBQXNCLEdBQUcsQ0FDM0JQLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQ1EsUUFBUSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLHFCQUFxQixDQUFDLEVBQzdEVCxJQUFJLENBQUMsVUFBVSxDQUFDLENBQ1hVLElBQUksQ0FBQyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQ3ZGRCxXQUFXLENBQUMsNEJBQTRCLENBQUMsRUFDOUNULElBQUksQ0FBQyxVQUFVLENBQUMsQ0FDWFUsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FDekNELFdBQVcsQ0FBQyw0QkFBNEIsQ0FBQyxFQUM5Q1QsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDUSxRQUFRLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUMseUJBQXlCLENBQUMsQ0FDeEU7QUFFRCxNQUFNRSxzQkFBc0IsR0FBRyxDQUMzQlgsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUNUWSxRQUFRLENBQUMsQ0FBQyxDQUNWRixJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUUsYUFBYSxFQUFFLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUN2RUQsV0FBVyxDQUFDLDBCQUEwQixDQUFDLEVBQzVDVCxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUNZLFFBQVEsQ0FBQyxDQUFDLENBQUNKLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUMzRTs7QUFFRDtBQUNBWixNQUFNLENBQUNnQixJQUFJLENBQUMsVUFBVSxFQUFFZCxPQUFPLEVBQUVRLHNCQUFzQixFQUFFTixZQUFZLENBQUM7QUFDdEVKLE1BQU0sQ0FBQ2lCLEdBQUcsQ0FBQyxVQUFVLEVBQUVmLE9BQU8sRUFBRUcsVUFBVSxDQUFDO0FBQzNDTCxNQUFNLENBQUNpQixHQUFHLENBQUMsY0FBYyxFQUFFZixPQUFPLEVBQUVJLGFBQWEsQ0FBQztBQUNsRE4sTUFBTSxDQUFDa0IsR0FBRyxDQUFDLGNBQWMsRUFBRWhCLE9BQU8sRUFBRVksc0JBQXNCLEVBQUVQLFlBQVksQ0FBQzs7QUFFekU7QUFDQVAsTUFBTSxDQUFDaUIsR0FBRyxDQUFDLE9BQU8sRUFBRVQsT0FBTyxDQUFDO0FBQzVCUixNQUFNLENBQUNpQixHQUFHLENBQUMsV0FBVyxFQUFFUixVQUFVLENBQUM7QUFFbkNVLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHcEIsTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["express","require","router","Router","protect","body","createTicket","getTickets","getTicketById","updateTicket","getFaqs","getFaqById","createTicketValidation","notEmpty","withMessage","isIn","updateTicketValidation","optional","post","get","put","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["support.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    createTicket,\r\n    getTickets,\r\n    getTicketById,\r\n    updateTicket,\r\n    getFaqs,\r\n    getFaqById\r\n} = require('../controllers/support.controller');\r\n\r\n// Validation middleware\r\nconst createTicketValidation = [\r\n    body('subject').notEmpty().withMessage('Subject is required'),\r\n    body('category')\r\n        .isIn(['account', 'payment', 'listing', 'technical', 'verification', 'report', 'other'])\r\n        .withMessage('Valid category is required'),\r\n    body('priority')\r\n        .isIn(['low', 'medium', 'high', 'urgent'])\r\n        .withMessage('Valid priority is required'),\r\n    body('description').notEmpty().withMessage('Description is required')\r\n];\r\n\r\nconst updateTicketValidation = [\r\n    body('status')\r\n        .optional()\r\n        .isIn(['open', 'in_progress', 'waiting_for_user', 'resolved', 'closed'])\r\n        .withMessage('Valid status is required'),\r\n    body('message').optional().notEmpty().withMessage('Message is required')\r\n];\r\n\r\n// Support ticket routes\r\nrouter.post('/tickets', protect, createTicketValidation, createTicket);\r\nrouter.get('/tickets', protect, getTickets);\r\nrouter.get('/tickets/:id', protect, getTicketById);\r\nrouter.put('/tickets/:id', protect, updateTicketValidation, updateTicket);\r\n\r\n// FAQ routes\r\nrouter.get('/faqs', getFaqs);\r\nrouter.get('/faqs/:id', getFaqById);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC;AAAQ,CAAC,GAAGH,OAAO,CAAC,gCAAgC,CAAC;AAC7D,MAAM;EAAEI;AAAK,CAAC,GAAGJ,OAAO,CAAC,mBAAmB,CAAC;AAC7C,MAAM;EACFK,YAAY;EACZC,UAAU;EACVC,aAAa;EACbC,YAAY;EACZC,OAAO;EACPC;AACJ,CAAC,GAAGV,OAAO,CAAC,mCAAmC,CAAC;;AAEhD;AACA,MAAMW,sBAAsB,GAAG,CAC3BP,IAAI,CAAC,SAAS,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,qBAAqB,CAAC,EAC7DT,IAAI,CAAC,UAAU,CAAC,CACXU,IAAI,CAAC,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,WAAW,EAAE,cAAc,EAAE,QAAQ,EAAE,OAAO,CAAC,CAAC,CACvFD,WAAW,CAAC,4BAA4B,CAAC,EAC9CT,IAAI,CAAC,UAAU,CAAC,CACXU,IAAI,CAAC,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC,CACzCD,WAAW,CAAC,4BAA4B,CAAC,EAC9CT,IAAI,CAAC,aAAa,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,yBAAyB,CAAC,CACxE;AAED,MAAME,sBAAsB,GAAG,CAC3BX,IAAI,CAAC,QAAQ,CAAC,CACTY,QAAQ,CAAC,CAAC,CACVF,IAAI,CAAC,CAAC,MAAM,EAAE,aAAa,EAAE,kBAAkB,EAAE,UAAU,EAAE,QAAQ,CAAC,CAAC,CACvED,WAAW,CAAC,0BAA0B,CAAC,EAC5CT,IAAI,CAAC,SAAS,CAAC,CAACY,QAAQ,CAAC,CAAC,CAACJ,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,qBAAqB,CAAC,CAC3E;;AAED;AACAZ,MAAM,CAACgB,IAAI,CAAC,UAAU,EAAEd,OAAO,EAAEQ,sBAAsB,EAAEN,YAAY,CAAC;AACtEJ,MAAM,CAACiB,GAAG,CAAC,UAAU,EAAEf,OAAO,EAAEG,UAAU,CAAC;AAC3CL,MAAM,CAACiB,GAAG,CAAC,cAAc,EAAEf,OAAO,EAAEI,aAAa,CAAC;AAClDN,MAAM,CAACkB,GAAG,CAAC,cAAc,EAAEhB,OAAO,EAAEY,sBAAsB,EAAEP,YAAY,CAAC;;AAEzE;AACAP,MAAM,CAACiB,GAAG,CAAC,OAAO,EAAET,OAAO,CAAC;AAC5BR,MAAM,CAACiB,GAAG,CAAC,WAAW,EAAER,UAAU,CAAC;AAEnCU,MAAM,CAACC,OAAO,GAAGpB,MAAM","ignoreList":[]}},"mtime":1734037970965},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\support.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const SupportTicket = require('../models/SupportTicket');\nconst ActivityLog = require('../models/ActivityLog');\n\n// @desc    Create support ticket\n// @route   POST /api/support/tickets\n// @access  Private\nexports.createTicket = async (req, res) => {\n  try {\n    // Generate ticket number\n    const count = await SupportTicket.countDocuments();\n    const ticketNumber = `TKT${String(count + 1).padStart(6, '0')}`;\n    const ticket = await SupportTicket.create({\n      user: req.user._id,\n      ticketNumber,\n      ...req.body\n    });\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'support_ticket_create',\n      entityType: 'ticket',\n      entityId: ticket._id,\n      description: 'Support ticket created',\n      status: 'success'\n    });\n    res.status(201).json({\n      success: true,\n      ticket\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get user's tickets\n// @route   GET /api/support/tickets\n// @access  Private\nexports.getTickets = async (req, res) => {\n  try {\n    const tickets = await SupportTicket.find({\n      user: req.user._id\n    }).sort('-createdAt');\n    res.json({\n      success: true,\n      tickets\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get ticket by ID\n// @route   GET /api/support/tickets/:id\n// @access  Private\nexports.getTicketById = async (req, res) => {\n  try {\n    const ticket = await SupportTicket.findById(req.params.id);\n    if (!ticket) {\n      return res.status(404).json({\n        success: false,\n        message: 'Ticket not found'\n      });\n    }\n\n    // Check ownership\n    if (ticket.user.toString() !== req.user._id.toString() && req.user.role !== 'admin') {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to view this ticket'\n      });\n    }\n    res.json({\n      success: true,\n      ticket\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Update ticket\n// @route   PUT /api/support/tickets/:id\n// @access  Private\nexports.updateTicket = async (req, res) => {\n  try {\n    let ticket = await SupportTicket.findById(req.params.id);\n    if (!ticket) {\n      return res.status(404).json({\n        success: false,\n        message: 'Ticket not found'\n      });\n    }\n\n    // Check ownership\n    if (ticket.user.toString() !== req.user._id.toString() && req.user.role !== 'admin') {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this ticket'\n      });\n    }\n\n    // If adding a message, add to messages array\n    if (req.body.message) {\n      ticket.messages.push({\n        sender: req.user._id,\n        message: req.body.message\n      });\n      delete req.body.message;\n    }\n\n    // Update other fields\n    ticket = await SupportTicket.findByIdAndUpdate(req.params.id, {\n      ...req.body,\n      messages: ticket.messages\n    }, {\n      new: true,\n      runValidators: true\n    });\n    res.json({\n      success: true,\n      ticket\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get FAQs\n// @route   GET /api/support/faqs\n// @access  Public\nexports.getFaqs = async (req, res) => {\n  try {\n    // Static FAQs for now\n    const faqs = [{\n      id: 1,\n      category: 'General',\n      question: 'How do I create a seller account?',\n      answer: 'To create a seller account, register as a user first and then upgrade to a seller account from your profile settings.'\n    }, {\n      id: 2,\n      category: 'Listings',\n      question: 'How many horses can I list?',\n      answer: 'The number of horses you can list depends on your subscription plan. Basic users can list up to 2 horses, while premium users have unlimited listings.'\n    }, {\n      id: 3,\n      category: 'Payments',\n      question: 'What payment methods are accepted?',\n      answer: 'We accept all major credit/debit cards and UPI payments through our secure payment gateway.'\n    }, {\n      id: 4,\n      category: 'Verification',\n      question: 'How do I verify my seller account?',\n      answer: 'Upload the required documents in your seller dashboard. Our team will review and verify your account within 2-3 business days.'\n    }];\n    res.json({\n      success: true,\n      faqs\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n\n// @desc    Get FAQ by ID\n// @route   GET /api/support/faqs/:id\n// @access  Public\nexports.getFaqById = async (req, res) => {\n  try {\n    // Static FAQs for now\n    const faqs = {\n      1: {\n        category: 'General',\n        question: 'How do I create a seller account?',\n        answer: 'To create a seller account, register as a user first and then upgrade to a seller account from your profile settings.'\n      },\n      2: {\n        category: 'Listings',\n        question: 'How many horses can I list?',\n        answer: 'The number of horses you can list depends on your subscription plan. Basic users can list up to 2 horses, while premium users have unlimited listings.'\n      },\n      3: {\n        category: 'Payments',\n        question: 'What payment methods are accepted?',\n        answer: 'We accept all major credit/debit cards and UPI payments through our secure payment gateway.'\n      },\n      4: {\n        category: 'Verification',\n        question: 'How do I verify my seller account?',\n        answer: 'Upload the required documents in your seller dashboard. Our team will review and verify your account within 2-3 business days.'\n      }\n    };\n    const faq = faqs[req.params.id];\n    if (!faq) {\n      return res.status(404).json({\n        success: false,\n        message: 'FAQ not found'\n      });\n    }\n    res.json({\n      success: true,\n      faq\n    });\n  } catch (error) {\n    console.error(error);\n    res.status(500).json({\n      success: false,\n      message: 'Server error'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTdXBwb3J0VGlja2V0IiwicmVxdWlyZSIsIkFjdGl2aXR5TG9nIiwiZXhwb3J0cyIsImNyZWF0ZVRpY2tldCIsInJlcSIsInJlcyIsImNvdW50IiwiY291bnREb2N1bWVudHMiLCJ0aWNrZXROdW1iZXIiLCJTdHJpbmciLCJwYWRTdGFydCIsInRpY2tldCIsImNyZWF0ZSIsInVzZXIiLCJfaWQiLCJib2R5IiwiYWN0aW9uIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwiZGVzY3JpcHRpb24iLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJnZXRUaWNrZXRzIiwidGlja2V0cyIsImZpbmQiLCJzb3J0IiwiZ2V0VGlja2V0QnlJZCIsImZpbmRCeUlkIiwicGFyYW1zIiwiaWQiLCJ0b1N0cmluZyIsInJvbGUiLCJ1cGRhdGVUaWNrZXQiLCJtZXNzYWdlcyIsInB1c2giLCJzZW5kZXIiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIm5ldyIsInJ1blZhbGlkYXRvcnMiLCJnZXRGYXFzIiwiZmFxcyIsImNhdGVnb3J5IiwicXVlc3Rpb24iLCJhbnN3ZXIiLCJnZXRGYXFCeUlkIiwiZmFxIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxjb250cm9sbGVyc1xcIiwic291cmNlcyI6WyJzdXBwb3J0LmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU3VwcG9ydFRpY2tldCA9IHJlcXVpcmUoJy4uL21vZGVscy9TdXBwb3J0VGlja2V0Jyk7XHJcbmNvbnN0IEFjdGl2aXR5TG9nID0gcmVxdWlyZSgnLi4vbW9kZWxzL0FjdGl2aXR5TG9nJyk7XHJcblxyXG4vLyBAZGVzYyAgICBDcmVhdGUgc3VwcG9ydCB0aWNrZXRcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3N1cHBvcnQvdGlja2V0c1xyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuY3JlYXRlVGlja2V0ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIEdlbmVyYXRlIHRpY2tldCBudW1iZXJcclxuICAgICAgICBjb25zdCBjb3VudCA9IGF3YWl0IFN1cHBvcnRUaWNrZXQuY291bnREb2N1bWVudHMoKTtcclxuICAgICAgICBjb25zdCB0aWNrZXROdW1iZXIgPSBgVEtUJHtTdHJpbmcoY291bnQgKyAxKS5wYWRTdGFydCg2LCAnMCcpfWA7XHJcblxyXG4gICAgICAgIGNvbnN0IHRpY2tldCA9IGF3YWl0IFN1cHBvcnRUaWNrZXQuY3JlYXRlKHtcclxuICAgICAgICAgICAgdXNlcjogcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICB0aWNrZXROdW1iZXIsXHJcbiAgICAgICAgICAgIC4uLnJlcS5ib2R5XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIExvZyBhY3Rpdml0eVxyXG4gICAgICAgIGF3YWl0IEFjdGl2aXR5TG9nLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHVzZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgYWN0aW9uOiAnc3VwcG9ydF90aWNrZXRfY3JlYXRlJyxcclxuICAgICAgICAgICAgZW50aXR5VHlwZTogJ3RpY2tldCcsXHJcbiAgICAgICAgICAgIGVudGl0eUlkOiB0aWNrZXQuX2lkLFxyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1N1cHBvcnQgdGlja2V0IGNyZWF0ZWQnLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRpY2tldFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHVzZXIncyB0aWNrZXRzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3N1cHBvcnQvdGlja2V0c1xyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuZ2V0VGlja2V0cyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB0aWNrZXRzID0gYXdhaXQgU3VwcG9ydFRpY2tldC5maW5kKHsgdXNlcjogcmVxLnVzZXIuX2lkIH0pXHJcbiAgICAgICAgICAgIC5zb3J0KCctY3JlYXRlZEF0Jyk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgdGlja2V0c1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHRpY2tldCBieSBJRFxyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9zdXBwb3J0L3RpY2tldHMvOmlkXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5nZXRUaWNrZXRCeUlkID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHRpY2tldCA9IGF3YWl0IFN1cHBvcnRUaWNrZXQuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XHJcblxyXG4gICAgICAgIGlmICghdGlja2V0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaWNrZXQgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIG93bmVyc2hpcFxyXG4gICAgICAgIGlmICh0aWNrZXQudXNlci50b1N0cmluZygpICE9PSByZXEudXNlci5faWQudG9TdHJpbmcoKSAmJiBcclxuICAgICAgICAgICAgcmVxLnVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnTm90IGF1dGhvcml6ZWQgdG8gdmlldyB0aGlzIHRpY2tldCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRpY2tldFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgVXBkYXRlIHRpY2tldFxyXG4vLyBAcm91dGUgICBQVVQgL2FwaS9zdXBwb3J0L3RpY2tldHMvOmlkXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy51cGRhdGVUaWNrZXQgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgbGV0IHRpY2tldCA9IGF3YWl0IFN1cHBvcnRUaWNrZXQuZmluZEJ5SWQocmVxLnBhcmFtcy5pZCk7XHJcblxyXG4gICAgICAgIGlmICghdGlja2V0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdUaWNrZXQgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENoZWNrIG93bmVyc2hpcFxyXG4gICAgICAgIGlmICh0aWNrZXQudXNlci50b1N0cmluZygpICE9PSByZXEudXNlci5faWQudG9TdHJpbmcoKSAmJiBcclxuICAgICAgICAgICAgcmVxLnVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnTm90IGF1dGhvcml6ZWQgdG8gdXBkYXRlIHRoaXMgdGlja2V0J1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIElmIGFkZGluZyBhIG1lc3NhZ2UsIGFkZCB0byBtZXNzYWdlcyBhcnJheVxyXG4gICAgICAgIGlmIChyZXEuYm9keS5tZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHRpY2tldC5tZXNzYWdlcy5wdXNoKHtcclxuICAgICAgICAgICAgICAgIHNlbmRlcjogcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogcmVxLmJvZHkubWVzc2FnZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZGVsZXRlIHJlcS5ib2R5Lm1lc3NhZ2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBVcGRhdGUgb3RoZXIgZmllbGRzXHJcbiAgICAgICAgdGlja2V0ID0gYXdhaXQgU3VwcG9ydFRpY2tldC5maW5kQnlJZEFuZFVwZGF0ZShcclxuICAgICAgICAgICAgcmVxLnBhcmFtcy5pZCxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLi4ucmVxLmJvZHksXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlczogdGlja2V0Lm1lc3NhZ2VzXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHsgbmV3OiB0cnVlLCBydW5WYWxpZGF0b3JzOiB0cnVlIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRpY2tldFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnU2VydmVyIGVycm9yJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IEZBUXNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvc3VwcG9ydC9mYXFzXHJcbi8vIEBhY2Nlc3MgIFB1YmxpY1xyXG5leHBvcnRzLmdldEZhcXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgLy8gU3RhdGljIEZBUXMgZm9yIG5vd1xyXG4gICAgICAgIGNvbnN0IGZhcXMgPSBbXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIGlkOiAxLFxyXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdHZW5lcmFsJyxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnSG93IGRvIEkgY3JlYXRlIGEgc2VsbGVyIGFjY291bnQ/JyxcclxuICAgICAgICAgICAgICAgIGFuc3dlcjogJ1RvIGNyZWF0ZSBhIHNlbGxlciBhY2NvdW50LCByZWdpc3RlciBhcyBhIHVzZXIgZmlyc3QgYW5kIHRoZW4gdXBncmFkZSB0byBhIHNlbGxlciBhY2NvdW50IGZyb20geW91ciBwcm9maWxlIHNldHRpbmdzLidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6IDIsXHJcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ0xpc3RpbmdzJyxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnSG93IG1hbnkgaG9yc2VzIGNhbiBJIGxpc3Q/JyxcclxuICAgICAgICAgICAgICAgIGFuc3dlcjogJ1RoZSBudW1iZXIgb2YgaG9yc2VzIHlvdSBjYW4gbGlzdCBkZXBlbmRzIG9uIHlvdXIgc3Vic2NyaXB0aW9uIHBsYW4uIEJhc2ljIHVzZXJzIGNhbiBsaXN0IHVwIHRvIDIgaG9yc2VzLCB3aGlsZSBwcmVtaXVtIHVzZXJzIGhhdmUgdW5saW1pdGVkIGxpc3RpbmdzLidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgaWQ6IDMsXHJcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ1BheW1lbnRzJyxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnV2hhdCBwYXltZW50IG1ldGhvZHMgYXJlIGFjY2VwdGVkPycsXHJcbiAgICAgICAgICAgICAgICBhbnN3ZXI6ICdXZSBhY2NlcHQgYWxsIG1ham9yIGNyZWRpdC9kZWJpdCBjYXJkcyBhbmQgVVBJIHBheW1lbnRzIHRocm91Z2ggb3VyIHNlY3VyZSBwYXltZW50IGdhdGV3YXkuJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBpZDogNCxcclxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiAnVmVyaWZpY2F0aW9uJyxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnSG93IGRvIEkgdmVyaWZ5IG15IHNlbGxlciBhY2NvdW50PycsXHJcbiAgICAgICAgICAgICAgICBhbnN3ZXI6ICdVcGxvYWQgdGhlIHJlcXVpcmVkIGRvY3VtZW50cyBpbiB5b3VyIHNlbGxlciBkYXNoYm9hcmQuIE91ciB0ZWFtIHdpbGwgcmV2aWV3IGFuZCB2ZXJpZnkgeW91ciBhY2NvdW50IHdpdGhpbiAyLTMgYnVzaW5lc3MgZGF5cy4nXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIGZhcXNcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBGQVEgYnkgSURcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvc3VwcG9ydC9mYXFzLzppZFxyXG4vLyBAYWNjZXNzICBQdWJsaWNcclxuZXhwb3J0cy5nZXRGYXFCeUlkID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIFN0YXRpYyBGQVFzIGZvciBub3dcclxuICAgICAgICBjb25zdCBmYXFzID0ge1xyXG4gICAgICAgICAgICAxOiB7XHJcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ0dlbmVyYWwnLFxyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdIb3cgZG8gSSBjcmVhdGUgYSBzZWxsZXIgYWNjb3VudD8nLFxyXG4gICAgICAgICAgICAgICAgYW5zd2VyOiAnVG8gY3JlYXRlIGEgc2VsbGVyIGFjY291bnQsIHJlZ2lzdGVyIGFzIGEgdXNlciBmaXJzdCBhbmQgdGhlbiB1cGdyYWRlIHRvIGEgc2VsbGVyIGFjY291bnQgZnJvbSB5b3VyIHByb2ZpbGUgc2V0dGluZ3MuJ1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAyOiB7XHJcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ0xpc3RpbmdzJyxcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uOiAnSG93IG1hbnkgaG9yc2VzIGNhbiBJIGxpc3Q/JyxcclxuICAgICAgICAgICAgICAgIGFuc3dlcjogJ1RoZSBudW1iZXIgb2YgaG9yc2VzIHlvdSBjYW4gbGlzdCBkZXBlbmRzIG9uIHlvdXIgc3Vic2NyaXB0aW9uIHBsYW4uIEJhc2ljIHVzZXJzIGNhbiBsaXN0IHVwIHRvIDIgaG9yc2VzLCB3aGlsZSBwcmVtaXVtIHVzZXJzIGhhdmUgdW5saW1pdGVkIGxpc3RpbmdzLidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgMzoge1xyXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdQYXltZW50cycsXHJcbiAgICAgICAgICAgICAgICBxdWVzdGlvbjogJ1doYXQgcGF5bWVudCBtZXRob2RzIGFyZSBhY2NlcHRlZD8nLFxyXG4gICAgICAgICAgICAgICAgYW5zd2VyOiAnV2UgYWNjZXB0IGFsbCBtYWpvciBjcmVkaXQvZGViaXQgY2FyZHMgYW5kIFVQSSBwYXltZW50cyB0aHJvdWdoIG91ciBzZWN1cmUgcGF5bWVudCBnYXRld2F5LidcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgNDoge1xyXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6ICdWZXJpZmljYXRpb24nLFxyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb246ICdIb3cgZG8gSSB2ZXJpZnkgbXkgc2VsbGVyIGFjY291bnQ/JyxcclxuICAgICAgICAgICAgICAgIGFuc3dlcjogJ1VwbG9hZCB0aGUgcmVxdWlyZWQgZG9jdW1lbnRzIGluIHlvdXIgc2VsbGVyIGRhc2hib2FyZC4gT3VyIHRlYW0gd2lsbCByZXZpZXcgYW5kIHZlcmlmeSB5b3VyIGFjY291bnQgd2l0aGluIDItMyBidXNpbmVzcyBkYXlzLidcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNvbnN0IGZhcSA9IGZhcXNbcmVxLnBhcmFtcy5pZF07XHJcbiAgICAgICAgaWYgKCFmYXEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0ZBUSBub3QgZm91bmQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBmYXFcclxuICAgICAgICB9KTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBlcnJvcidcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxhQUFhLEdBQUdDLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQztBQUN4RCxNQUFNQyxXQUFXLEdBQUdELE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQzs7QUFFcEQ7QUFDQTtBQUNBO0FBQ0FFLE9BQU8sQ0FBQ0MsWUFBWSxHQUFHLE9BQU9D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","map":{"version":3,"names":["SupportTicket","require","ActivityLog","exports","createTicket","req","res","count","countDocuments","ticketNumber","String","padStart","ticket","create","user","_id","body","action","entityType","entityId","description","status","json","success","error","console","message","getTickets","tickets","find","sort","getTicketById","findById","params","id","toString","role","updateTicket","messages","push","sender","findByIdAndUpdate","new","runValidators","getFaqs","faqs","category","question","answer","getFaqById","faq"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["support.controller.js"],"sourcesContent":["const SupportTicket = require('../models/SupportTicket');\r\nconst ActivityLog = require('../models/ActivityLog');\r\n\r\n// @desc    Create support ticket\r\n// @route   POST /api/support/tickets\r\n// @access  Private\r\nexports.createTicket = async (req, res) => {\r\n    try {\r\n        // Generate ticket number\r\n        const count = await SupportTicket.countDocuments();\r\n        const ticketNumber = `TKT${String(count + 1).padStart(6, '0')}`;\r\n\r\n        const ticket = await SupportTicket.create({\r\n            user: req.user._id,\r\n            ticketNumber,\r\n            ...req.body\r\n        });\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'support_ticket_create',\r\n            entityType: 'ticket',\r\n            entityId: ticket._id,\r\n            description: 'Support ticket created',\r\n            status: 'success'\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            ticket\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get user's tickets\r\n// @route   GET /api/support/tickets\r\n// @access  Private\r\nexports.getTickets = async (req, res) => {\r\n    try {\r\n        const tickets = await SupportTicket.find({ user: req.user._id })\r\n            .sort('-createdAt');\r\n\r\n        res.json({\r\n            success: true,\r\n            tickets\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get ticket by ID\r\n// @route   GET /api/support/tickets/:id\r\n// @access  Private\r\nexports.getTicketById = async (req, res) => {\r\n    try {\r\n        const ticket = await SupportTicket.findById(req.params.id);\r\n\r\n        if (!ticket) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Ticket not found'\r\n            });\r\n        }\r\n\r\n        // Check ownership\r\n        if (ticket.user.toString() !== req.user._id.toString() && \r\n            req.user.role !== 'admin') {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to view this ticket'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            ticket\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update ticket\r\n// @route   PUT /api/support/tickets/:id\r\n// @access  Private\r\nexports.updateTicket = async (req, res) => {\r\n    try {\r\n        let ticket = await SupportTicket.findById(req.params.id);\r\n\r\n        if (!ticket) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Ticket not found'\r\n            });\r\n        }\r\n\r\n        // Check ownership\r\n        if (ticket.user.toString() !== req.user._id.toString() && \r\n            req.user.role !== 'admin') {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to update this ticket'\r\n            });\r\n        }\r\n\r\n        // If adding a message, add to messages array\r\n        if (req.body.message) {\r\n            ticket.messages.push({\r\n                sender: req.user._id,\r\n                message: req.body.message\r\n            });\r\n            delete req.body.message;\r\n        }\r\n\r\n        // Update other fields\r\n        ticket = await SupportTicket.findByIdAndUpdate(\r\n            req.params.id,\r\n            {\r\n                ...req.body,\r\n                messages: ticket.messages\r\n            },\r\n            { new: true, runValidators: true }\r\n        );\r\n\r\n        res.json({\r\n            success: true,\r\n            ticket\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get FAQs\r\n// @route   GET /api/support/faqs\r\n// @access  Public\r\nexports.getFaqs = async (req, res) => {\r\n    try {\r\n        // Static FAQs for now\r\n        const faqs = [\r\n            {\r\n                id: 1,\r\n                category: 'General',\r\n                question: 'How do I create a seller account?',\r\n                answer: 'To create a seller account, register as a user first and then upgrade to a seller account from your profile settings.'\r\n            },\r\n            {\r\n                id: 2,\r\n                category: 'Listings',\r\n                question: 'How many horses can I list?',\r\n                answer: 'The number of horses you can list depends on your subscription plan. Basic users can list up to 2 horses, while premium users have unlimited listings.'\r\n            },\r\n            {\r\n                id: 3,\r\n                category: 'Payments',\r\n                question: 'What payment methods are accepted?',\r\n                answer: 'We accept all major credit/debit cards and UPI payments through our secure payment gateway.'\r\n            },\r\n            {\r\n                id: 4,\r\n                category: 'Verification',\r\n                question: 'How do I verify my seller account?',\r\n                answer: 'Upload the required documents in your seller dashboard. Our team will review and verify your account within 2-3 business days.'\r\n            }\r\n        ];\r\n\r\n        res.json({\r\n            success: true,\r\n            faqs\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get FAQ by ID\r\n// @route   GET /api/support/faqs/:id\r\n// @access  Public\r\nexports.getFaqById = async (req, res) => {\r\n    try {\r\n        // Static FAQs for now\r\n        const faqs = {\r\n            1: {\r\n                category: 'General',\r\n                question: 'How do I create a seller account?',\r\n                answer: 'To create a seller account, register as a user first and then upgrade to a seller account from your profile settings.'\r\n            },\r\n            2: {\r\n                category: 'Listings',\r\n                question: 'How many horses can I list?',\r\n                answer: 'The number of horses you can list depends on your subscription plan. Basic users can list up to 2 horses, while premium users have unlimited listings.'\r\n            },\r\n            3: {\r\n                category: 'Payments',\r\n                question: 'What payment methods are accepted?',\r\n                answer: 'We accept all major credit/debit cards and UPI payments through our secure payment gateway.'\r\n            },\r\n            4: {\r\n                category: 'Verification',\r\n                question: 'How do I verify my seller account?',\r\n                answer: 'Upload the required documents in your seller dashboard. Our team will review and verify your account within 2-3 business days.'\r\n            }\r\n        };\r\n\r\n        const faq = faqs[req.params.id];\r\n        if (!faq) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'FAQ not found'\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            faq\r\n        });\r\n    } catch (error) {\r\n        console.error(error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: 'Server error'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734038091711},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\SupportTicket.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst supportTicketSchema = new mongoose.Schema({\n  ticketNumber: {\n    type: String,\n    required: true,\n    unique: true\n  },\n  user: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  subject: {\n    type: String,\n    required: true\n  },\n  category: {\n    type: String,\n    enum: ['account', 'payment', 'listing', 'technical', 'verification', 'report', 'other'],\n    required: true\n  },\n  priority: {\n    type: String,\n    enum: ['low', 'medium', 'high', 'urgent'],\n    default: 'medium'\n  },\n  status: {\n    type: String,\n    enum: ['open', 'in_progress', 'waiting_for_user', 'resolved', 'closed'],\n    default: 'open'\n  },\n  description: {\n    type: String,\n    required: true\n  },\n  attachments: [{\n    url: String,\n    public_id: String,\n    filename: String,\n    fileType: String\n  }],\n  messages: [{\n    sender: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true\n    },\n    message: {\n      type: String,\n      required: true\n    },\n    attachments: [{\n      url: String,\n      public_id: String,\n      filename: String,\n      fileType: String\n    }],\n    createdAt: {\n      type: Date,\n      default: Date.now\n    }\n  }],\n  assignedTo: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User'\n  },\n  relatedEntity: {\n    type: {\n      type: String,\n      enum: ['listing', 'order', 'payment', 'user']\n    },\n    id: mongoose.Schema.Types.ObjectId\n  },\n  metadata: {\n    browser: String,\n    os: String,\n    ip: String,\n    userAgent: String\n  },\n  resolution: {\n    resolvedBy: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    resolvedAt: Date,\n    resolution: String,\n    feedback: {\n      rating: Number,\n      comment: String\n    }\n  },\n  tags: [String],\n  internalNotes: [{\n    note: String,\n    createdBy: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    createdAt: {\n      type: Date,\n      default: Date.now\n    }\n  }]\n}, {\n  timestamps: true\n});\n\n// Create ticket number before saving\nsupportTicketSchema.pre('save', async function (next) {\n  if (!this.ticketNumber) {\n    const count = await mongoose.model('SupportTicket').countDocuments();\n    this.ticketNumber = `TKT${String(count + 1).padStart(6, '0')}`;\n  }\n  next();\n});\n\n// Create indexes\nsupportTicketSchema.index({\n  ticketNumber: 1\n}, {\n  unique: true\n});\nsupportTicketSchema.index({\n  user: 1\n});\nsupportTicketSchema.index({\n  status: 1\n});\nsupportTicketSchema.index({\n  assignedTo: 1\n});\nsupportTicketSchema.index({\n  'relatedEntity.type': 1,\n  'relatedEntity.id': 1\n});\nmodule.exports = mongoose.model('SupportTicket', supportTicketSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJzdXBwb3J0VGlja2V0U2NoZW1hIiwiU2NoZW1hIiwidGlja2V0TnVtYmVyIiwidHlwZSIsIlN0cmluZyIsInJlcXVpcmVkIiwidW5pcXVlIiwidXNlciIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJzdWJqZWN0IiwiY2F0ZWdvcnkiLCJlbnVtIiwicHJpb3JpdHkiLCJkZWZhdWx0Iiwic3RhdHVzIiwiZGVzY3JpcHRpb24iLCJhdHRhY2htZW50cyIsInVybCIsInB1YmxpY19pZCIsImZpbGVuYW1lIiwiZmlsZVR5cGUiLCJtZXNzYWdlcyIsInNlbmRlciIsIm1lc3NhZ2UiLCJjcmVhdGVkQXQiLCJEYXRlIiwibm93IiwiYXNzaWduZWRUbyIsInJlbGF0ZWRFbnRpdHkiLCJpZCIsIm1ldGFkYXRhIiwiYnJvd3NlciIsIm9zIiwiaXAiLCJ1c2VyQWdlbnQiLCJyZXNvbHV0aW9uIiwicmVzb2x2ZWRCeSIsInJlc29sdmVkQXQiLCJmZWVkYmFjayIsInJhdGluZyIsIk51bWJlciIsImNvbW1lbnQiLCJ0YWdzIiwiaW50ZXJuYWxOb3RlcyIsIm5vdGUiLCJjcmVhdGVkQnkiLCJ0aW1lc3RhbXBzIiwicHJlIiwibmV4dCIsImNvdW50IiwibW9kZWwiLCJjb3VudERvY3VtZW50cyIsInBhZFN0YXJ0IiwiaW5kZXgiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxtb2RlbHNcXCIsInNvdXJjZXMiOlsiU3VwcG9ydFRpY2tldC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7XHJcblxyXG5jb25zdCBzdXBwb3J0VGlja2V0U2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XHJcbiAgICB0aWNrZXROdW1iZXI6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXHJcbiAgICAgICAgdW5pcXVlOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgdXNlcjoge1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIHN1YmplY3Q6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBjYXRlZ29yeToge1xyXG4gICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICBlbnVtOiBbXHJcbiAgICAgICAgICAgICdhY2NvdW50JyxcclxuICAgICAgICAgICAgJ3BheW1lbnQnLFxyXG4gICAgICAgICAgICAnbGlzdGluZycsXHJcbiAgICAgICAgICAgICd0ZWNobmljYWwnLFxyXG4gICAgICAgICAgICAndmVyaWZpY2F0aW9uJyxcclxuICAgICAgICAgICAgJ3JlcG9ydCcsXHJcbiAgICAgICAgICAgICdvdGhlcidcclxuICAgICAgICBdLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgcHJpb3JpdHk6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZW51bTogWydsb3cnLCAnbWVkaXVtJywgJ2hpZ2gnLCAndXJnZW50J10sXHJcbiAgICAgICAgZGVmYXVsdDogJ21lZGl1bSdcclxuICAgIH0sXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZW51bTogWydvcGVuJywgJ2luX3Byb2dyZXNzJywgJ3dhaXRpbmdfZm9yX3VzZXInLCAncmVzb2x2ZWQnLCAnY2xvc2VkJ10sXHJcbiAgICAgICAgZGVmYXVsdDogJ29wZW4nXHJcbiAgICB9LFxyXG4gICAgZGVzY3JpcHRpb246IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBhdHRhY2htZW50czogW3tcclxuICAgICAgICB1cmw6IFN0cmluZyxcclxuICAgICAgICBwdWJsaWNfaWQ6IFN0cmluZyxcclxuICAgICAgICBmaWxlbmFtZTogU3RyaW5nLFxyXG4gICAgICAgIGZpbGVUeXBlOiBTdHJpbmdcclxuICAgIH1dLFxyXG4gICAgbWVzc2FnZXM6IFt7XHJcbiAgICAgICAgc2VuZGVyOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICAgICAgcmVmOiAnVXNlcicsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtZXNzYWdlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGF0dGFjaG1lbnRzOiBbe1xyXG4gICAgICAgICAgICB1cmw6IFN0cmluZyxcclxuICAgICAgICAgICAgcHVibGljX2lkOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGZpbGVuYW1lOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGZpbGVUeXBlOiBTdHJpbmdcclxuICAgICAgICB9XSxcclxuICAgICAgICBjcmVhdGVkQXQ6IHtcclxuICAgICAgICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgICAgICAgZGVmYXVsdDogRGF0ZS5ub3dcclxuICAgICAgICB9XHJcbiAgICB9XSxcclxuICAgIGFzc2lnbmVkVG86IHtcclxuICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgcmVmOiAnVXNlcidcclxuICAgIH0sXHJcbiAgICByZWxhdGVkRW50aXR5OiB7XHJcbiAgICAgICAgdHlwZToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGVudW06IFsnbGlzdGluZycsICdvcmRlcicsICdwYXltZW50JywgJ3VzZXInXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaWQ6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZFxyXG4gICAgfSxcclxuICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgYnJvd3NlcjogU3RyaW5nLFxyXG4gICAgICAgIG9zOiBTdHJpbmcsXHJcbiAgICAgICAgaXA6IFN0cmluZyxcclxuICAgICAgICB1c2VyQWdlbnQ6IFN0cmluZ1xyXG4gICAgfSxcclxuICAgIHJlc29sdXRpb246IHtcclxuICAgICAgICByZXNvbHZlZEJ5OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICAgICAgcmVmOiAnVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJlc29sdmVkQXQ6IERhdGUsXHJcbiAgICAgICAgcmVzb2x1dGlvbjogU3RyaW5nLFxyXG4gICAgICAgIGZlZWRiYWNrOiB7XHJcbiAgICAgICAgICAgIHJhdGluZzogTnVtYmVyLFxyXG4gICAgICAgICAgICBjb21tZW50OiBTdHJpbmdcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgdGFnczogW1N0cmluZ10sXHJcbiAgICBpbnRlcm5hbE5vdGVzOiBbe1xyXG4gICAgICAgIG5vdGU6IFN0cmluZyxcclxuICAgICAgICBjcmVhdGVkQnk6IHtcclxuICAgICAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgICAgICByZWY6ICdVc2VyJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgY3JlYXRlZEF0OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IERhdGUsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IERhdGUubm93XHJcbiAgICAgICAgfVxyXG4gICAgfV1cclxufSwge1xyXG4gICAgdGltZXN0YW1wczogdHJ1ZVxyXG59KTtcclxuXHJcbi8vIENyZWF0ZSB0aWNrZXQgbnVtYmVyIGJlZm9yZSBzYXZpbmdcclxuc3VwcG9ydFRpY2tldFNjaGVtYS5wcmUoJ3NhdmUnLCBhc3luYyBmdW5jdGlvbihuZXh0KSB7XHJcbiAgICBpZiAoIXRoaXMudGlja2V0TnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCBtb25nb29zZS5tb2RlbCgnU3VwcG9ydFRpY2tldCcpLmNvdW50RG9jdW1lbnRzKCk7XHJcbiAgICAgICAgdGhpcy50aWNrZXROdW1iZXIgPSBgVEtUJHtTdHJpbmcoY291bnQgKyAxKS5wYWRTdGFydCg2LCAnMCcpfWA7XHJcbiAgICB9XHJcbiAgICBuZXh0KCk7XHJcbn0pO1xyXG5cclxuLy8gQ3JlYXRlIGluZGV4ZXNcclxuc3VwcG9ydFRpY2tldFNjaGVtYS5pbmRleCh7IHRpY2tldE51bWJlcjogMSB9LCB7IHVuaXF1ZTogdHJ1ZSB9KTtcclxuc3VwcG9ydFRpY2tldFNjaGVtYS5pbmRleCh7IHVzZXI6IDEgfSk7XHJcbnN1cHBvcnRUaWNrZXRTY2hlbWEuaW5kZXgoeyBzdGF0dXM6IDEgfSk7XHJcbnN1cHBvcnRUaWNrZXRTY2hlbWEuaW5kZXgoeyBhc3NpZ25lZFRvOiAxIH0pO1xyXG5zdXBwb3J0VGlja2V0U2NoZW1hLmluZGV4KHsgJ3JlbGF0ZWRFbnRpdHkudHlwZSc6IDEsICdyZWxhdGVkRW50aXR5LmlkJzogMSB9KTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ1N1cHBvcnRUaWNrZXQnLCBzdXBwb3J0VGlja2V0U2NoZW1hKTsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxRQUFRLEdBQUdDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFFcEMsTUFBTUMsbUJBQW1CLEdBQUcsSUFBSUYsUUFBUSxDQUFDRyxNQUFNLENBQUM7RUFDNUNDLFlBQVksRUFBRTtJQUNWQyxJQUFJLEVBQUVDLE1BQU07SUFDWkMsUUFBUSxFQUFFLElBQUk7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RWpDLE1BQU07SUFDbEJvQyxRQUFRLEVBQUU7TUFDTkMsTUFBTSxFQUFFQyxNQUFNO01BQ2RDLE9BQU8sRUFBRXZDO0lBQ2I7RUFDSixDQUFDO0VBQ0R3QyxJQUFJLEVBQUUsQ0FBQ3hDLE1BQU0sQ0FBQztFQUNkeUMsYUFBYSxFQUFFLENBQUM7SUFDWkMsSUFBSSxFQUFFMUMsTUFBTTtJQUNaMkMsU0FBUyxFQUFFO01BQ1A1QyxJQUFJLEVBQUVMLFFBQVEsQ0FBQ0csTUFBTSxDQUFDTyxLQUFLLENBQUNDLFFBQVE7TUFDcENDLEdBQUcsRUFBRTtJQUNULENBQUM7SUFDRGdCLFNBQVMsRUFBRTtNQUNQdkIsSUFBSSxFQUFFd0IsSUFBSTtNQUNWWixPQUFPLEVBQUVZLElBQUksQ0FBQ0M7SUFDbEI7RUFDSixDQUFDO0FBQ0wsQ0FBQyxFQUFFO0VBQ0NvQixVQUFVLEVBQUU7QUFDaEIsQ0FBQyxDQUFDOztBQUVGO0FBQ0FoRCxtQkFBbUIsQ0FBQ2lELEdBQUcsQ0FBQyxNQUFNLEVBQUUsZ0JBQWVDLElBQUksRUFBRTtFQUNqRCxJQUFJLENBQUMsSUFBSSxDQUFDaEQsWUFBWSxFQUFFO0lBQ3BCLE1BQU1pRCxLQUFLLEdBQUcsTUFBTXJELFFBQVEsQ0FBQ3NELEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQ0MsY0FBYyxDQUFDLENBQUM7SUFDcEUsSUFBSSxDQUFDbkQsWUFBWSxHQUFHLE1BQU1FLE1BQU0sQ0FBQytDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQ0csUUFBUSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRTtFQUNsRTtFQUNBSixJQUFJLENBQUMsQ0FBQztBQUNWLENBQUMsQ0FBQzs7QUFFRjtBQUNBbEQsbUJBQW1CLENBQUN1RCxLQUFLLENBQUM7RUFBRXJELFlBQVksRUFBRTtBQUFFLENBQUMsRUFBRTtFQUFFSSxNQUFNLEVBQUU7QUFBSyxDQUFDLENBQUM7QUFDaEVOLG1CQUFtQixDQUFDdUQsS0FBSyxDQUFDO0VBQUVoRCxJQUFJLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFDdENQLG1CQUFtQixDQUFDdUQsS0FBSyxDQUFDO0VBQUV2QyxNQUFNLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFDeENoQixtQkFBbUIsQ0FBQ3VELEtBQUssQ0FBQztFQUFFMUIsVUFBVSxFQUFFO0FBQUUsQ0FBQyxDQUFDO0FBQzVDN0IsbUJBQW1CLENBQUN1RCxLQUFLLENBQUM7RUFBRSxvQkFBb0IsRUFBRSxDQUFDO0VBQUUsa0JBQWtCLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFFN0VDLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHM0QsUUFBUSxDQUFDc0QsS0FBSyxDQUFDLGVBQWUsRUFBRXBELG1CQUFtQixDQUFDIiwiaWdub3JlTGlzdCI6W119","map":{"version":3,"names":["mongoose","require","supportTicketSchema","Schema","ticketNumber","type","String","required","unique","user","Types","ObjectId","ref","subject","category","enum","priority","default","status","description","attachments","url","public_id","filename","fileType","messages","sender","message","createdAt","Date","now","assignedTo","relatedEntity","id","metadata","browser","os","ip","userAgent","resolution","resolvedBy","resolvedAt","feedback","rating","Number","comment","tags","internalNotes","note","createdBy","timestamps","pre","next","count","model","countDocuments","padStart","index","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["SupportTicket.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst supportTicketSchema = new mongoose.Schema({\r\n    ticketNumber: {\r\n        type: String,\r\n        required: true,\r\n        unique: true\r\n    },\r\n    user: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true\r\n    },\r\n    subject: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    category: {\r\n        type: String,\r\n        enum: [\r\n            'account',\r\n            'payment',\r\n            'listing',\r\n            'technical',\r\n            'verification',\r\n            'report',\r\n            'other'\r\n        ],\r\n        required: true\r\n    },\r\n    priority: {\r\n        type: String,\r\n        enum: ['low', 'medium', 'high', 'urgent'],\r\n        default: 'medium'\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['open', 'in_progress', 'waiting_for_user', 'resolved', 'closed'],\r\n        default: 'open'\r\n    },\r\n    description: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    attachments: [{\r\n        url: String,\r\n        public_id: String,\r\n        filename: String,\r\n        fileType: String\r\n    }],\r\n    messages: [{\r\n        sender: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User',\r\n            required: true\r\n        },\r\n        message: {\r\n            type: String,\r\n            required: true\r\n        },\r\n        attachments: [{\r\n            url: String,\r\n            public_id: String,\r\n            filename: String,\r\n            fileType: String\r\n        }],\r\n        createdAt: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    }],\r\n    assignedTo: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User'\r\n    },\r\n    relatedEntity: {\r\n        type: {\r\n            type: String,\r\n            enum: ['listing', 'order', 'payment', 'user']\r\n        },\r\n        id: mongoose.Schema.Types.ObjectId\r\n    },\r\n    metadata: {\r\n        browser: String,\r\n        os: String,\r\n        ip: String,\r\n        userAgent: String\r\n    },\r\n    resolution: {\r\n        resolvedBy: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        resolvedAt: Date,\r\n        resolution: String,\r\n        feedback: {\r\n            rating: Number,\r\n            comment: String\r\n        }\r\n    },\r\n    tags: [String],\r\n    internalNotes: [{\r\n        note: String,\r\n        createdBy: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        createdAt: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    }]\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Create ticket number before saving\r\nsupportTicketSchema.pre('save', async function(next) {\r\n    if (!this.ticketNumber) {\r\n        const count = await mongoose.model('SupportTicket').countDocuments();\r\n        this.ticketNumber = `TKT${String(count + 1).padStart(6, '0')}`;\r\n    }\r\n    next();\r\n});\r\n\r\n// Create indexes\r\nsupportTicketSchema.index({ ticketNumber: 1 }, { unique: true });\r\nsupportTicketSchema.index({ user: 1 });\r\nsupportTicketSchema.index({ status: 1 });\r\nsupportTicketSchema.index({ assignedTo: 1 });\r\nsupportTicketSchema.index({ 'relatedEntity.type': 1, 'relatedEntity.id': 1 });\r\n\r\nmodule.exports = mongoose.model('SupportTicket', supportTicketSchema); "],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,mBAAmB,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EAC5CC,YAAY,EAAE;IACVC,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,IAAI;IACdC,MAAM,EAAE;EACZ,CAAC;EACDC,IAAI,EAAE;IACFJ,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACO,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,MAAM;IACXL,QAAQ,EAAE;EACd,CAAC;EACDM,OAAO,EAAE;IACLR,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE;EACd,CAAC;EACDO,QAAQ,EAAE;IACNT,IAAI,EAAEC,MAAM;IACZS,IAAI,EAAE,CACF,SAAS,EACT,SAAS,EACT,SAAS,EACT,WAAW,EACX,cAAc,EACd,QAAQ,EACR,OAAO,CACV;IACDR,QAAQ,EAAE;EACd,CAAC;EACDS,QAAQ,EAAE;IACNX,IAAI,EAAEC,MAAM;IACZS,IAAI,EAAE,CAAC,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,CAAC;IACzCE,OAAO,EAAE;EACb,CAAC;EACDC,MAAM,EAAE;IACJb,IAAI,EAAEC,MAAM;IACZS,IAAI,EAAE,CAAC,MAAM,EAAE,aAAa,EAAE,kBAAkB,EAAE,UAAU,EAAE,QAAQ,CAAC;IACvEE,OAAO,EAAE;EACb,CAAC;EACDE,WAAW,EAAE;IACTd,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE;EACd,CAAC;EACDa,WAAW,EAAE,CAAC;IACVC,GAAG,EAAEf,MAAM;IACXgB,SAAS,EAAEhB,MAAM;IACjBiB,QAAQ,EAAEjB,MAAM;IAChBkB,QAAQ,EAAElB;EACd,CAAC,CAAC;EACFmB,QAAQ,EAAE,CAAC;IACPC,MAAM,EAAE;MACJrB,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACO,KAAK,CAACC,QAAQ;MACpCC,GAAG,EAAE,MAAM;MACXL,QAAQ,EAAE;IACd,CAAC;IACDoB,OAAO,EAAE;MACLtB,IAAI,EAAEC,MAAM;MACZC,QAAQ,EAAE;IACd,CAAC;IACDa,WAAW,EAAE,CAAC;MACVC,GAAG,EAAEf,MAAM;MACXgB,SAAS,EAAEhB,MAAM;MACjBiB,QAAQ,EAAEjB,MAAM;MAChBkB,QAAQ,EAAElB;IACd,CAAC,CAAC;IACFsB,SAAS,EAAE;MACPvB,IAAI,EAAEwB,IAAI;MACVZ,OAAO,EAAEY,IAAI,CAACC;IAClB;EACJ,CAAC,CAAC;EACFC,UAAU,EAAE;IACR1B,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACO,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE;EACT,CAAC;EACDoB,aAAa,EAAE;IACX3B,IAAI,EAAE;MACFA,IAAI,EAAEC,MAAM;MACZS,IAAI,EAAE,CAAC,SAAS,EAAE,OAAO,EAAE,SAAS,EAAE,MAAM;IAChD,CAAC;IACDkB,EAAE,EAAEjC,QAAQ,CAACG,MAAM,CAACO,KAAK,CAACC;EAC9B,CAAC;EACDuB,QAAQ,EAAE;IACNC,OAAO,EAAE7B,MAAM;IACf8B,EAAE,EAAE9B,MAAM;IACV+B,EAAE,EAAE/B,MAAM;IACVgC,SAAS,EAAEhC;EACf,CAAC;EACDiC,UAAU,EAAE;IACRC,UAAU,EAAE;MACRnC,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACO,KAAK,CAACC,QAAQ;MACpCC,GAAG,EAAE;IACT,CAAC;IACD6B,UAAU,EAAEZ,IAAI;IAChBU,UAAU,EAAEjC,MAAM;IAClBoC,QAAQ,EAAE;MACNC,MAAM,EAAEC,MAAM;MACdC,OAAO,EAAEvC;IACb;EACJ,CAAC;EACDwC,IAAI,EAAE,CAACxC,MAAM,CAAC;EACdyC,aAAa,EAAE,CAAC;IACZC,IAAI,EAAE1C,MAAM;IACZ2C,SAAS,EAAE;MACP5C,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACO,KAAK,CAACC,QAAQ;MACpCC,GAAG,EAAE;IACT,CAAC;IACDgB,SAAS,EAAE;MACPvB,IAAI,EAAEwB,IAAI;MACVZ,OAAO,EAAEY,IAAI,CAACC;IAClB;EACJ,CAAC;AACL,CAAC,EAAE;EACCoB,UAAU,EAAE;AAChB,CAAC,CAAC;;AAEF;AACAhD,mBAAmB,CAACiD,GAAG,CAAC,MAAM,EAAE,gBAAeC,IAAI,EAAE;EACjD,IAAI,CAAC,IAAI,CAAChD,YAAY,EAAE;IACpB,MAAMiD,KAAK,GAAG,MAAMrD,QAAQ,CAACsD,KAAK,CAAC,eAAe,CAAC,CAACC,cAAc,CAAC,CAAC;IACpE,IAAI,CAACnD,YAAY,GAAG,MAAME,MAAM,CAAC+C,KAAK,GAAG,CAAC,CAAC,CAACG,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE;EAClE;EACAJ,IAAI,CAAC,CAAC;AACV,CAAC,CAAC;;AAEF;AACAlD,mBAAmB,CAACuD,KAAK,CAAC;EAAErD,YAAY,EAAE;AAAE,CAAC,EAAE;EAAEI,MAAM,EAAE;AAAK,CAAC,CAAC;AAChEN,mBAAmB,CAACuD,KAAK,CAAC;EAAEhD,IAAI,EAAE;AAAE,CAAC,CAAC;AACtCP,mBAAmB,CAACuD,KAAK,CAAC;EAAEvC,MAAM,EAAE;AAAE,CAAC,CAAC;AACxChB,mBAAmB,CAACuD,KAAK,CAAC;EAAE1B,UAAU,EAAE;AAAE,CAAC,CAAC;AAC5C7B,mBAAmB,CAACuD,KAAK,CAAC;EAAE,oBAAoB,EAAE,CAAC;EAAE,kBAAkB,EAAE;AAAE,CAAC,CAAC;AAE7EC,MAAM,CAACC,OAAO,GAAG3D,QAAQ,CAACsD,KAAK,CAAC,eAAe,EAAEpD,mBAAmB,CAAC","ignoreList":[]}},"mtime":1734021742164},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\search.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  advancedSearch,\n  saveSearchPreferences,\n  getSavedSearches,\n  getSearchSuggestions\n} = require('../controllers/search.controller');\n\n// Validation middleware\nconst searchValidation = [body('filters').isObject().withMessage('Filters must be an object'), body('page').optional().isInt({\n  min: 1\n}).withMessage('Page must be a positive integer'), body('limit').optional().isInt({\n  min: 1,\n  max: 50\n}).withMessage('Limit must be between 1 and 50')];\nconst preferencesValidation = [body('preferences').isObject().withMessage('Preferences must be an object'), body('preferences.breeds').optional().isArray().withMessage('Breeds must be an array'), body('preferences.priceRange').optional().isObject().withMessage('Price range must be an object'), body('preferences.location').optional().isObject().withMessage('Location must be an object')];\n\n// Public routes\nrouter.post('/', searchValidation, advancedSearch);\nrouter.get('/suggestions', getSearchSuggestions);\n\n// Protected routes\nrouter.post('/preferences', protect, preferencesValidation, saveSearchPreferences);\nrouter.get('/saved', protect, getSavedSearches);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJib2R5IiwiYWR2YW5jZWRTZWFyY2giLCJzYXZlU2VhcmNoUHJlZmVyZW5jZXMiLCJnZXRTYXZlZFNlYXJjaGVzIiwiZ2V0U2VhcmNoU3VnZ2VzdGlvbnMiLCJzZWFyY2hWYWxpZGF0aW9uIiwiaXNPYmplY3QiLCJ3aXRoTWVzc2FnZSIsIm9wdGlvbmFsIiwiaXNJbnQiLCJtaW4iLCJtYXgiLCJwcmVmZXJlbmNlc1ZhbGlkYXRpb24iLCJpc0FycmF5IiwicG9zdCIsImdldCIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXHJvdXRlc1xcIiwic291cmNlcyI6WyJzZWFyY2gucm91dGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XHJcbmNvbnN0IHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XHJcbmNvbnN0IHsgcHJvdGVjdCB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZXMvYXV0aC5taWRkbGV3YXJlJyk7XHJcbmNvbnN0IHsgYm9keSB9ID0gcmVxdWlyZSgnZXhwcmVzcy12YWxpZGF0b3InKTtcclxuY29uc3Qge1xyXG4gICAgYWR2YW5jZWRTZWFyY2gsXHJcbiAgICBzYXZlU2VhcmNoUHJlZmVyZW5jZXMsXHJcbiAgICBnZXRTYXZlZFNlYXJjaGVzLFxyXG4gICAgZ2V0U2VhcmNoU3VnZ2VzdGlvbnNcclxufSA9IHJlcXVpcmUoJy4uL2NvbnRyb2xsZXJzL3NlYXJjaC5jb250cm9sbGVyJyk7XHJcblxyXG4vLyBWYWxpZGF0aW9uIG1pZGRsZXdhcmVcclxuY29uc3Qgc2VhcmNoVmFsaWRhdGlvbiA9IFtcclxuICAgIGJvZHkoJ2ZpbHRlcnMnKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdGaWx0ZXJzIG11c3QgYmUgYW4gb2JqZWN0JyksXHJcbiAgICBib2R5KCdwYWdlJykub3B0aW9uYWwoKS5pc0ludCh7IG1pbjogMSB9KS53aXRoTWVzc2FnZSgnUGFnZSBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlcicpLFxyXG4gICAgYm9keSgnbGltaXQnKS5vcHRpb25hbCgpLmlzSW50KHsgbWluOiAxLCBtYXg6IDUwIH0pLndpdGhNZXNzYWdlKCdMaW1pdCBtdXN0IGJlIGJldHdlZW4gMSBhbmQgNTAnKVxyXG5dO1xyXG5cclxuY29uc3QgcHJlZmVyZW5jZXNWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgncHJlZmVyZW5jZXMnKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdQcmVmZXJlbmNlcyBtdXN0IGJlIGFuIG9iamVjdCcpLFxyXG4gICAgYm9keSgncHJlZmVyZW5jZXMuYnJlZWRzJykub3B0aW9uYWwoKS5pc0FycmF5KCkud2l0aE1lc3NhZ2UoJ0JyZWVkcyBtdXN0IGJlIGFuIGFycmF5JyksXHJcbiAgICBib2R5KCdwcmVmZXJlbmNlcy5wcmljZVJhbmdlJykub3B0aW9uYWwoKS5pc09iamVjdCgpLndpdGhNZXNzYWdlKCdQcmljZSByYW5nZSBtdXN0IGJlIGFuIG9iamVjdCcpLFxyXG4gICAgYm9keSgncHJlZmVyZW5jZXMubG9jYXRpb24nKS5vcHRpb25hbCgpLmlzT2JqZWN0KCkud2l0aE1lc3NhZ2UoJ0xvY2F0aW9uIG11c3QgYmUgYW4gb2JqZWN0JylcclxuXTtcclxuXHJcbi8vIFB1YmxpYyByb3V0ZXNcclxucm91dGVyLnBvc3QoJy8nLCBzZWFyY2hWYWxpZGF0aW9uLCBhZHZhbmNlZFNlYXJjaCk7XHJcbnJvdXRlci5nZXQoJy9zdWdnZXN0aW9ucycsIGdldFNlYXJjaFN1Z2dlc3Rpb25zKTtcclxuXHJcbi8vIFByb3RlY3RlZCByb3V0ZXNcclxucm91dGVyLnBvc3QoJy9wcmVmZXJlbmNlcycsIHByb3RlY3QsIHByZWZlcmVuY2VzVmFsaWRhdGlvbiwgc2F2ZVNlYXJjaFByZWZlcmVuY2VzKTtcclxucm91dGVyLmdldCgnL3NhdmVkJywgcHJvdGVjdCwgZ2V0U2F2ZWRTZWFyY2hlcyk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU07RUFBRUM7QUFBUSxDQUFDLEdBQUdILE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQztBQUM3RCxNQUFNO0VBQUVJO0FBQUssQ0FBQyxHQUFHSixPQUFPLENBQUMsbUJBQW1CLENBQUM7QUFDN0MsTUFBTTtFQUNGSyxjQUFjO0VBQ2RDLHFCQUFxQjtFQUNyQkMsZ0JBQWdCO0VBQ2hCQztBQUNKLENBQUMsR0FBR1IsT0FBTyxDQUFDLGtDQUFrQyxDQUFDOztBQUUvQztBQUNBLE1BQU1TLGdCQUFnQixHQUFHLENBQ3JCTCxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUNNLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQywyQkFBMkIsQ0FBQyxFQUNuRVAsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDUSxRQUFRLENBQUMsQ0FBQyxDQUFDQyxLQUFLLENBQUM7RUFBRUMsR0FBRyxFQUFFO0FBQUUsQ0FBQyxDQUFDLENBQUNILFdBQVcsQ0FBQyxpQ0FBaUMsQ0FBQyxFQUN4RlAsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDUSxRQUFRLENBQUMsQ0FBQyxDQUFDQyxLQUFLLENBQUM7RUFBRUMsR0FBRyxFQUFFLENBQUM7RUFBRUMsR0FBRyxFQUFFO0FBQUcsQ0FBQyxDQUFDLENBQUNKLFdBQVcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUNwRztBQUVELE1BQU1LLHFCQUFxQixHQUFHLENBQzFCWixJQUFJLENBQUMsYUFBYSxDQUFDLENBQUNNLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQywrQkFBK0IsQ0FBQyxFQUMzRVAsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUNRLFFBQVEsQ0FBQyxDQUFDLENBQUNLLE9BQU8sQ0FBQyxDQUFDLENBQUNOLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxFQUN0RlAsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUNRLFFBQVEsQ0FBQyxDQUFDLENBQUNGLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQywrQkFBK0IsQ0FBQyxFQUNqR1AsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUNRLFFBQVEsQ0FBQyxDQUFDLENBQUNGLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyw0QkFBNEIsQ0FBQyxDQUMvRjs7QUFFRDtBQUNBVixNQUFNLENBQUNpQixJQUFJLENBQUMsR0FBRyxFQUFFVCxnQkFBZ0IsRUFBRUosY0FBYyxDQUFDO0FBQ2xESixNQUFNLENBQUNrQixHQUFHLENBQUMsY0FBYyxFQUFFWCxvQkFBb0IsQ0FBQzs7QUFFaEQ7QUFDQVAsTUFBTSxDQUFDaUIsSUFBSSxDQUFDLGNBQWMsRUFBRWYsT0FBTyxFQUFFYSxxQkFBcUIsRUFBRVYscUJBQXFCLENBQUM7QUFDbEZMLE1BQU0sQ0FBQ2tCLEdBQUcsQ0FBQyxRQUFRLEVBQUVoQixPQUFPLEVBQUVJLGdCQUFnQixDQUFDO0FBRS9DYSxNQUFNLENBQUNDLE9BQU8sR0FBR3BCLE1BQU0iLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["express","require","router","Router","protect","body","advancedSearch","saveSearchPreferences","getSavedSearches","getSearchSuggestions","searchValidation","isObject","withMessage","optional","isInt","min","max","preferencesValidation","isArray","post","get","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["search.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    advancedSearch,\r\n    saveSearchPreferences,\r\n    getSavedSearches,\r\n    getSearchSuggestions\r\n} = require('../controllers/search.controller');\r\n\r\n// Validation middleware\r\nconst searchValidation = [\r\n    body('filters').isObject().withMessage('Filters must be an object'),\r\n    body('page').optional().isInt({ min: 1 }).withMessage('Page must be a positive integer'),\r\n    body('limit').optional().isInt({ min: 1, max: 50 }).withMessage('Limit must be between 1 and 50')\r\n];\r\n\r\nconst preferencesValidation = [\r\n    body('preferences').isObject().withMessage('Preferences must be an object'),\r\n    body('preferences.breeds').optional().isArray().withMessage('Breeds must be an array'),\r\n    body('preferences.priceRange').optional().isObject().withMessage('Price range must be an object'),\r\n    body('preferences.location').optional().isObject().withMessage('Location must be an object')\r\n];\r\n\r\n// Public routes\r\nrouter.post('/', searchValidation, advancedSearch);\r\nrouter.get('/suggestions', getSearchSuggestions);\r\n\r\n// Protected routes\r\nrouter.post('/preferences', protect, preferencesValidation, saveSearchPreferences);\r\nrouter.get('/saved', protect, getSavedSearches);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC;AAAQ,CAAC,GAAGH,OAAO,CAAC,gCAAgC,CAAC;AAC7D,MAAM;EAAEI;AAAK,CAAC,GAAGJ,OAAO,CAAC,mBAAmB,CAAC;AAC7C,MAAM;EACFK,cAAc;EACdC,qBAAqB;EACrBC,gBAAgB;EAChBC;AACJ,CAAC,GAAGR,OAAO,CAAC,kCAAkC,CAAC;;AAE/C;AACA,MAAMS,gBAAgB,GAAG,CACrBL,IAAI,CAAC,SAAS,CAAC,CAACM,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,2BAA2B,CAAC,EACnEP,IAAI,CAAC,MAAM,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,KAAK,CAAC;EAAEC,GAAG,EAAE;AAAE,CAAC,CAAC,CAACH,WAAW,CAAC,iCAAiC,CAAC,EACxFP,IAAI,CAAC,OAAO,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACC,KAAK,CAAC;EAAEC,GAAG,EAAE,CAAC;EAAEC,GAAG,EAAE;AAAG,CAAC,CAAC,CAACJ,WAAW,CAAC,gCAAgC,CAAC,CACpG;AAED,MAAMK,qBAAqB,GAAG,CAC1BZ,IAAI,CAAC,aAAa,CAAC,CAACM,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,+BAA+B,CAAC,EAC3EP,IAAI,CAAC,oBAAoB,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACK,OAAO,CAAC,CAAC,CAACN,WAAW,CAAC,yBAAyB,CAAC,EACtFP,IAAI,CAAC,wBAAwB,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACF,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,+BAA+B,CAAC,EACjGP,IAAI,CAAC,sBAAsB,CAAC,CAACQ,QAAQ,CAAC,CAAC,CAACF,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,4BAA4B,CAAC,CAC/F;;AAED;AACAV,MAAM,CAACiB,IAAI,CAAC,GAAG,EAAET,gBAAgB,EAAEJ,cAAc,CAAC;AAClDJ,MAAM,CAACkB,GAAG,CAAC,cAAc,EAAEX,oBAAoB,CAAC;;AAEhD;AACAP,MAAM,CAACiB,IAAI,CAAC,cAAc,EAAEf,OAAO,EAAEa,qBAAqB,EAAEV,qBAAqB,CAAC;AAClFL,MAAM,CAACkB,GAAG,CAAC,QAAQ,EAAEhB,OAAO,EAAEI,gBAAgB,CAAC;AAE/Ca,MAAM,CAACC,OAAO,GAAGpB,MAAM","ignoreList":[]}},"mtime":1734040500112},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\search.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Horse = require('../models/Horse');\nconst User = require('../models/User');\nconst ActivityLog = require('../models/ActivityLog');\n\n// Helper function to build search query\nconst buildSearchQuery = filters => {\n  const query = {\n    listingStatus: 'active'\n  };\n  if (filters.breed) {\n    query.breed = {\n      $in: Array.isArray(filters.breed) ? filters.breed : [filters.breed]\n    };\n  }\n  if (filters.price) {\n    query.price = {\n      $gte: filters.price.min || 0,\n      $lte: filters.price.max || Number.MAX_SAFE_INTEGER\n    };\n  }\n  if (filters.age) {\n    query['age.years'] = {\n      $gte: filters.age.min || 0,\n      $lte: filters.age.max || Number.MAX_SAFE_INTEGER\n    };\n  }\n  if (filters.location) {\n    if (filters.location.state) {\n      query['location.state'] = filters.location.state;\n    }\n    if (filters.location.city) {\n      query['location.city'] = filters.location.city;\n    }\n  }\n  if (filters.gender) {\n    query.gender = {\n      $in: Array.isArray(filters.gender) ? filters.gender : [filters.gender]\n    };\n  }\n  if (filters.specifications) {\n    Object.entries(filters.specifications).forEach(([key, value]) => {\n      if (value) {\n        query[`specifications.${key}`] = value;\n      }\n    });\n  }\n  return query;\n};\n\n// @desc    Advanced search with filters\n// @route   POST /api/search\n// @access  Public\nexports.advancedSearch = async (req, res) => {\n  try {\n    const {\n      filters,\n      sort = {\n        createdAt: -1\n      },\n      page = 1,\n      limit = 10\n    } = req.body;\n    const query = buildSearchQuery(filters);\n    const skip = (page - 1) * limit;\n\n    // Execute search with pagination\n    const [horses, total] = await Promise.all([Horse.find(query).sort(sort).skip(skip).limit(limit).populate('seller', 'businessName location rating'), Horse.countDocuments(query)]);\n\n    // Log search activity if user is authenticated\n    if (req.user) {\n      await ActivityLog.create({\n        user: req.user._id,\n        action: 'SEARCH',\n        details: {\n          filters,\n          resultsCount: horses.length,\n          page\n        }\n      });\n\n      // Update user preferences based on search\n      await User.findByIdAndUpdate(req.user._id, {\n        $set: {\n          'preferences.lastSearch': {\n            filters,\n            timestamp: new Date()\n          }\n        }\n      });\n    }\n    res.json({\n      success: true,\n      data: {\n        horses,\n        pagination: {\n          total,\n          page,\n          pages: Math.ceil(total / limit),\n          hasMore: total > skip + horses.length\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Search error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error performing search'\n    });\n  }\n};\n\n// @desc    Save search preferences\n// @route   POST /api/search/preferences\n// @access  Private\nexports.saveSearchPreferences = async (req, res) => {\n  try {\n    const {\n      preferences\n    } = req.body;\n    const user = await User.findByIdAndUpdate(req.user._id, {\n      $set: {\n        preferences\n      }\n    }, {\n      new: true\n    });\n    res.json({\n      success: true,\n      preferences: user.preferences\n    });\n  } catch (error) {\n    console.error('Save preferences error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error saving preferences'\n    });\n  }\n};\n\n// @desc    Get saved searches\n// @route   GET /api/search/saved\n// @access  Private\nexports.getSavedSearches = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id).select('preferences.savedSearches');\n    res.json({\n      success: true,\n      savedSearches: user.preferences?.savedSearches || []\n    });\n  } catch (error) {\n    console.error('Get saved searches error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error retrieving saved searches'\n    });\n  }\n};\n\n// @desc    Get search suggestions\n// @route   GET /api/search/suggestions\n// @access  Public\nexports.getSearchSuggestions = async (req, res) => {\n  try {\n    const {\n      query,\n      type\n    } = req.query;\n    let suggestions = [];\n    switch (type) {\n      case 'breed':\n        suggestions = await Horse.distinct('breed', {\n          breed: new RegExp(query, 'i'),\n          listingStatus: 'active'\n        });\n        break;\n      case 'location':\n        suggestions = await Horse.distinct('location.city', {\n          'location.city': new RegExp(query, 'i'),\n          listingStatus: 'active'\n        });\n        break;\n      case 'price':\n        const priceRanges = await Horse.aggregate([{\n          $match: {\n            listingStatus: 'active'\n          }\n        }, {\n          $group: {\n            _id: {\n              $round: [{\n                $divide: ['$price', 100000]\n              }, -1]\n            },\n            count: {\n              $sum: 1\n            }\n          }\n        }, {\n          $sort: {\n            _id: 1\n          }\n        }]);\n        suggestions = priceRanges.map(range => ({\n          range: `${range._id * 100000}-${(range._id + 1) * 100000}`,\n          count: range.count\n        }));\n        break;\n      default:\n        suggestions = [];\n    }\n    res.json({\n      success: true,\n      suggestions\n    });\n  } catch (error) {\n    console.error('Search suggestions error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting search suggestions'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIb3JzZSIsInJlcXVpcmUiLCJVc2VyIiwiQWN0aXZpdHlMb2ciLCJidWlsZFNlYXJjaFF1ZXJ5IiwiZmlsdGVycyIsInF1ZXJ5IiwibGlzdGluZ1N0YXR1cyIsImJyZWVkIiwiJGluIiwiQXJyYXkiLCJpc0FycmF5IiwicHJpY2UiLCIkZ3RlIiwibWluIiwiJGx0ZSIsIm1heCIsIk51bWJlciIsIk1BWF9TQUZFX0lOVEVHRVIiLCJhZ2UiLCJsb2NhdGlvbiIsInN0YXRlIiwiY2l0eSIsImdlbmRlciIsInNwZWNpZmljYXRpb25zIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJrZXkiLCJ2YWx1ZSIsImV4cG9ydHMiLCJhZHZhbmNlZFNlYXJjaCIsInJlcSIsInJlcyIsInNvcnQiLCJjcmVhdGVkQXQiLCJwYWdlIiwibGltaXQiLCJib2R5Iiwic2tpcCIsImhvcnNlcyIsInRvdGFsIiwiUHJvbWlzZSIsImFsbCIsImZpbmQiLCJwb3B1bGF0ZSIsImNvdW50RG9jdW1lbnRzIiwidXNlciIsImNyZWF0ZSIsIl9pZCIsImFjdGlvbiIsImRldGFpbHMiLCJyZXN1bHRzQ291bnQiLCJsZW5ndGgiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRzZXQiLCJ0aW1lc3RhbXAiLCJEYXRlIiwianNvbiIsInN1Y2Nlc3MiLCJkYXRhIiwicGFnaW5hdGlvbiIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJoYXNNb3JlIiwiZXJyb3IiLCJjb25zb2xlIiwic3RhdHVzIiwibWVzc2FnZSIsInNhdmVTZWFyY2hQcmVmZXJlbmNlcyIsInByZWZlcmVuY2VzIiwibmV3IiwiZ2V0U2F2ZWRTZWFyY2hlcyIsImZpbmRCeUlkIiwic2VsZWN0Iiwic2F2ZWRTZWFyY2hlcyIsImdldFNlYXJjaFN1Z2dlc3Rpb25zIiwidHlwZSIsInN1Z2dlc3Rpb25zIiwiZGlzdGluY3QiLCJSZWdFeHAiLCJwcmljZVJhbmdlcyIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIiRncm91cCIsIiRyb3VuZCIsIiRkaXZpZGUiLCJjb3VudCIsIiRzdW0iLCIkc29ydCIsIm1hcCIsInJhbmdlIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxjb250cm9sbGVyc1xcIiwic291cmNlcyI6WyJzZWFyY2guY29udHJvbGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBIb3JzZSA9IHJlcXVpcmUoJy4uL21vZGVscy9Ib3JzZScpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuY29uc3QgQWN0aXZpdHlMb2cgPSByZXF1aXJlKCcuLi9tb2RlbHMvQWN0aXZpdHlMb2cnKTtcclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB0byBidWlsZCBzZWFyY2ggcXVlcnlcclxuY29uc3QgYnVpbGRTZWFyY2hRdWVyeSA9IChmaWx0ZXJzKSA9PiB7XHJcbiAgICBjb25zdCBxdWVyeSA9IHsgbGlzdGluZ1N0YXR1czogJ2FjdGl2ZScgfTtcclxuXHJcbiAgICBpZiAoZmlsdGVycy5icmVlZCkge1xyXG4gICAgICAgIHF1ZXJ5LmJyZWVkID0geyAkaW46IEFycmF5LmlzQXJyYXkoZmlsdGVycy5icmVlZCkgPyBmaWx0ZXJzLmJyZWVkIDogW2ZpbHRlcnMuYnJlZWRdIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlcnMucHJpY2UpIHtcclxuICAgICAgICBxdWVyeS5wcmljZSA9IHtcclxuICAgICAgICAgICAgJGd0ZTogZmlsdGVycy5wcmljZS5taW4gfHwgMCxcclxuICAgICAgICAgICAgJGx0ZTogZmlsdGVycy5wcmljZS5tYXggfHwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVJcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChmaWx0ZXJzLmFnZSkge1xyXG4gICAgICAgIHF1ZXJ5WydhZ2UueWVhcnMnXSA9IHtcclxuICAgICAgICAgICAgJGd0ZTogZmlsdGVycy5hZ2UubWluIHx8IDAsXHJcbiAgICAgICAgICAgICRsdGU6IGZpbHRlcnMuYWdlLm1heCB8fCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUlxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlcnMubG9jYXRpb24pIHtcclxuICAgICAgICBpZiAoZmlsdGVycy5sb2NhdGlvbi5zdGF0ZSkge1xyXG4gICAgICAgICAgICBxdWVyeVsnbG9jYXRpb24uc3RhdGUnXSA9IGZpbHRlcnMubG9jYXRpb24uc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmaWx0ZXJzLmxvY2F0aW9uLmNpdHkpIHtcclxuICAgICAgICAgICAgcXVlcnlbJ2xvY2F0aW9uLmNpdHknXSA9IGZpbHRlcnMubG9jYXRpb24uY2l0eTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlcnMuZ2VuZGVyKSB7XHJcbiAgICAgICAgcXVlcnkuZ2VuZGVyID0geyAkaW46IEFycmF5LmlzQXJyYXkoZmlsdGVycy5nZW5kZXIpID8gZmlsdGVycy5nZW5kZXIgOiBbZmlsdGVycy5nZW5kZXJdIH07XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGZpbHRlcnMuc3BlY2lmaWNhdGlvbnMpIHtcclxuICAgICAgICBPYmplY3QuZW50cmllcyhmaWx0ZXJzLnNwZWNpZmljYXRpb25zKS5mb3JFYWNoKChba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBxdWVyeVtgc3BlY2lmaWNhdGlvbnMuJHtrZXl9YF0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBxdWVyeTtcclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEFkdmFuY2VkIHNlYXJjaCB3aXRoIGZpbHRlcnNcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3NlYXJjaFxyXG4vLyBAYWNjZXNzICBQdWJsaWNcclxuZXhwb3J0cy5hZHZhbmNlZFNlYXJjaCA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7XHJcbiAgICAgICAgICAgIGZpbHRlcnMsXHJcbiAgICAgICAgICAgIHNvcnQgPSB7IGNyZWF0ZWRBdDogLTEgfSxcclxuICAgICAgICAgICAgcGFnZSA9IDEsXHJcbiAgICAgICAgICAgIGxpbWl0ID0gMTBcclxuICAgICAgICB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gYnVpbGRTZWFyY2hRdWVyeShmaWx0ZXJzKTtcclxuICAgICAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xyXG5cclxuICAgICAgICAvLyBFeGVjdXRlIHNlYXJjaCB3aXRoIHBhZ2luYXRpb25cclxuICAgICAgICBjb25zdCBbaG9yc2VzLCB0b3RhbF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgICAgIEhvcnNlLmZpbmQocXVlcnkpXHJcbiAgICAgICAgICAgICAgICAuc29ydChzb3J0KVxyXG4gICAgICAgICAgICAgICAgLnNraXAoc2tpcClcclxuICAgICAgICAgICAgICAgIC5saW1pdChsaW1pdClcclxuICAgICAgICAgICAgICAgIC5wb3B1bGF0ZSgnc2VsbGVyJywgJ2J1c2luZXNzTmFtZSBsb2NhdGlvbiByYXRpbmcnKSxcclxuICAgICAgICAgICAgSG9yc2UuY291bnREb2N1bWVudHMocXVlcnkpXHJcbiAgICAgICAgXSk7XHJcblxyXG4gICAgICAgIC8vIExvZyBzZWFyY2ggYWN0aXZpdHkgaWYgdXNlciBpcyBhdXRoZW50aWNhdGVkXHJcbiAgICAgICAgaWYgKHJlcS51c2VyKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IEFjdGl2aXR5TG9nLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgICAgICB1c2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgICAgICBhY3Rpb246ICdTRUFSQ0gnLFxyXG4gICAgICAgICAgICAgICAgZGV0YWlsczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c0NvdW50OiBob3JzZXMubGVuZ3RoLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvLyBVcGRhdGUgdXNlciBwcmVmZXJlbmNlcyBiYXNlZCBvbiBzZWFyY2hcclxuICAgICAgICAgICAgYXdhaXQgVXNlci5maW5kQnlJZEFuZFVwZGF0ZShyZXEudXNlci5faWQsIHtcclxuICAgICAgICAgICAgICAgICRzZXQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAncHJlZmVyZW5jZXMubGFzdFNlYXJjaCc6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVycyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgaG9yc2VzLFxyXG4gICAgICAgICAgICAgICAgcGFnaW5hdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2UsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFnZXM6IE1hdGguY2VpbCh0b3RhbCAvIGxpbWl0KSxcclxuICAgICAgICAgICAgICAgICAgICBoYXNNb3JlOiB0b3RhbCA+IHNraXAgKyBob3JzZXMubGVuZ3RoXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NlYXJjaCBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3IgcGVyZm9ybWluZyBzZWFyY2gnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBTYXZlIHNlYXJjaCBwcmVmZXJlbmNlc1xyXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvc2VhcmNoL3ByZWZlcmVuY2VzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5zYXZlU2VhcmNoUHJlZmVyZW5jZXMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBwcmVmZXJlbmNlcyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKFxyXG4gICAgICAgICAgICByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICRzZXQ6IHsgcHJlZmVyZW5jZXMgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7IG5ldzogdHJ1ZSB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBwcmVmZXJlbmNlczogdXNlci5wcmVmZXJlbmNlc1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignU2F2ZSBwcmVmZXJlbmNlcyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3Igc2F2aW5nIHByZWZlcmVuY2VzJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IHNhdmVkIHNlYXJjaGVzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3NlYXJjaC9zYXZlZFxyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMuZ2V0U2F2ZWRTZWFyY2hlcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpXHJcbiAgICAgICAgICAgIC5zZWxlY3QoJ3ByZWZlcmVuY2VzLnNhdmVkU2VhcmNoZXMnKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBzYXZlZFNlYXJjaGVzOiB1c2VyLnByZWZlcmVuY2VzPy5zYXZlZFNlYXJjaGVzIHx8IFtdXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdHZXQgc2F2ZWQgc2VhcmNoZXMgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0Vycm9yIHJldHJpZXZpbmcgc2F2ZWQgc2VhcmNoZXMnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgc2VhcmNoIHN1Z2dlc3Rpb25zXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3NlYXJjaC9zdWdnZXN0aW9uc1xyXG4vLyBAYWNjZXNzICBQdWJsaWNcclxuZXhwb3J0cy5nZXRTZWFyY2hTdWdnZXN0aW9ucyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IHF1ZXJ5LCB0eXBlIH0gPSByZXEucXVlcnk7XHJcblxyXG4gICAgICAgIGxldCBzdWdnZXN0aW9ucyA9IFtdO1xyXG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xyXG4gICAgICAgICAgICBjYXNlICdicmVlZCc6XHJcbiAgICAgICAgICAgICAgICBzdWdnZXN0aW9ucyA9IGF3YWl0IEhvcnNlLmRpc3RpbmN0KCdicmVlZCcsIHtcclxuICAgICAgICAgICAgICAgICAgICBicmVlZDogbmV3IFJlZ0V4cChxdWVyeSwgJ2knKSxcclxuICAgICAgICAgICAgICAgICAgICBsaXN0aW5nU3RhdHVzOiAnYWN0aXZlJ1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnbG9jYXRpb24nOlxyXG4gICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMgPSBhd2FpdCBIb3JzZS5kaXN0aW5jdCgnbG9jYXRpb24uY2l0eScsIHtcclxuICAgICAgICAgICAgICAgICAgICAnbG9jYXRpb24uY2l0eSc6IG5ldyBSZWdFeHAocXVlcnksICdpJyksXHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdGluZ1N0YXR1czogJ2FjdGl2ZSdcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3ByaWNlJzpcclxuICAgICAgICAgICAgICAgIGNvbnN0IHByaWNlUmFuZ2VzID0gYXdhaXQgSG9yc2UuYWdncmVnYXRlKFtcclxuICAgICAgICAgICAgICAgICAgICB7ICRtYXRjaDogeyBsaXN0aW5nU3RhdHVzOiAnYWN0aXZlJyB9IH0sXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkZ3JvdXA6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pZDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb3VuZDogW1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ICRkaXZpZGU6IFsnJHByaWNlJywgMTAwMDAwXSB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAtMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudDogeyAkc3VtOiAxIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyAkc29ydDogeyBfaWQ6IDEgfSB9XHJcbiAgICAgICAgICAgICAgICBdKTtcclxuICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25zID0gcHJpY2VSYW5nZXMubWFwKHJhbmdlID0+ICh7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2U6IGAke3JhbmdlLl9pZCAqIDEwMDAwMH0tJHsocmFuZ2UuX2lkICsgMSkgKiAxMDAwMDB9YCxcclxuICAgICAgICAgICAgICAgICAgICBjb3VudDogcmFuZ2UuY291bnRcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgc3VnZ2VzdGlvbnMgPSBbXTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgc3VnZ2VzdGlvbnNcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NlYXJjaCBzdWdnZXN0aW9ucyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3IgZ2V0dGluZyBzZWFyY2ggc3VnZ2VzdGlvbnMnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDdEMsTUFBTUUsV0FBVyxHQUFHRixPQUFPLENBQUMsdUJBQXVCLENBQUM7O0FBRXBEO0FBQ0EsTUFBTUcsZ0JBQWdCLEdBQUlDLE9BQU8sSUFBSztFQUNsQyxNQUFNQyxLQUFLLEdBQUc7SUFBRUMsYUFBYSxFQUFFO0VBQVMsQ0FBQztFQUV6QyxJQUFJRixPQUFPLENBQUNHLEtBQUssRUFBRTtJQUNmRixLQUFLLENBQUNFLEtBQUssR0FBRztNQUFFQyxHQUFHLEVBQUVDLEtBQUssQ0FBQ0MsT0FBTyxDQUFDTixPQUFPLENBQUNHLEtBQUssQ0FBQyxHQUFHSCxPQUFPLENBQUNHLEtBQUssR0FBRyxDQUFDSCxPQUFPLENBQUNHLEtBQUs7SUFBRSxDQUFDO0VBQ3pGO0VBRUEsSUFBSUgsT0FBTyxDQUFDTyxLQUFLLEVBQUU7SUFDZk4sS0FBSyxDQUFDTSxLQUFLLEdBQUc7TUFDVkMsSUFBSSxFQUFFUixPQUFPLENBQUNPLEtBQUssQ0FBQ0UsR0FBRyxJQUFJLENBQUM7TUFDNUJDLElBQUksRUFBRVYsT0FBTyxDQUFDTyxLQUFLLENBQUNJLEdBQUcsSUFBSUMsTUFBTSxDQUFDQztJQUN0QyxDQUFDO0VBQ0w7RUFFQSxJQUFJYixPQUFPLENBQUNjLEdBQUcsRUFBRTtJQUNiYixLQUFLLENB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","map":{"version":3,"names":["Horse","require","User","ActivityLog","buildSearchQuery","filters","query","listingStatus","breed","$in","Array","isArray","price","$gte","min","$lte","max","Number","MAX_SAFE_INTEGER","age","location","state","city","gender","specifications","Object","entries","forEach","key","value","exports","advancedSearch","req","res","sort","createdAt","page","limit","body","skip","horses","total","Promise","all","find","populate","countDocuments","user","create","_id","action","details","resultsCount","length","findByIdAndUpdate","$set","timestamp","Date","json","success","data","pagination","pages","Math","ceil","hasMore","error","console","status","message","saveSearchPreferences","preferences","new","getSavedSearches","findById","select","savedSearches","getSearchSuggestions","type","suggestions","distinct","RegExp","priceRanges","aggregate","$match","$group","$round","$divide","count","$sum","$sort","map","range"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["search.controller.js"],"sourcesContent":["const Horse = require('../models/Horse');\r\nconst User = require('../models/User');\r\nconst ActivityLog = require('../models/ActivityLog');\r\n\r\n// Helper function to build search query\r\nconst buildSearchQuery = (filters) => {\r\n    const query = { listingStatus: 'active' };\r\n\r\n    if (filters.breed) {\r\n        query.breed = { $in: Array.isArray(filters.breed) ? filters.breed : [filters.breed] };\r\n    }\r\n\r\n    if (filters.price) {\r\n        query.price = {\r\n            $gte: filters.price.min || 0,\r\n            $lte: filters.price.max || Number.MAX_SAFE_INTEGER\r\n        };\r\n    }\r\n\r\n    if (filters.age) {\r\n        query['age.years'] = {\r\n            $gte: filters.age.min || 0,\r\n            $lte: filters.age.max || Number.MAX_SAFE_INTEGER\r\n        };\r\n    }\r\n\r\n    if (filters.location) {\r\n        if (filters.location.state) {\r\n            query['location.state'] = filters.location.state;\r\n        }\r\n        if (filters.location.city) {\r\n            query['location.city'] = filters.location.city;\r\n        }\r\n    }\r\n\r\n    if (filters.gender) {\r\n        query.gender = { $in: Array.isArray(filters.gender) ? filters.gender : [filters.gender] };\r\n    }\r\n\r\n    if (filters.specifications) {\r\n        Object.entries(filters.specifications).forEach(([key, value]) => {\r\n            if (value) {\r\n                query[`specifications.${key}`] = value;\r\n            }\r\n        });\r\n    }\r\n\r\n    return query;\r\n};\r\n\r\n// @desc    Advanced search with filters\r\n// @route   POST /api/search\r\n// @access  Public\r\nexports.advancedSearch = async (req, res) => {\r\n    try {\r\n        const {\r\n            filters,\r\n            sort = { createdAt: -1 },\r\n            page = 1,\r\n            limit = 10\r\n        } = req.body;\r\n\r\n        const query = buildSearchQuery(filters);\r\n        const skip = (page - 1) * limit;\r\n\r\n        // Execute search with pagination\r\n        const [horses, total] = await Promise.all([\r\n            Horse.find(query)\r\n                .sort(sort)\r\n                .skip(skip)\r\n                .limit(limit)\r\n                .populate('seller', 'businessName location rating'),\r\n            Horse.countDocuments(query)\r\n        ]);\r\n\r\n        // Log search activity if user is authenticated\r\n        if (req.user) {\r\n            await ActivityLog.create({\r\n                user: req.user._id,\r\n                action: 'SEARCH',\r\n                details: {\r\n                    filters,\r\n                    resultsCount: horses.length,\r\n                    page\r\n                }\r\n            });\r\n\r\n            // Update user preferences based on search\r\n            await User.findByIdAndUpdate(req.user._id, {\r\n                $set: {\r\n                    'preferences.lastSearch': {\r\n                        filters,\r\n                        timestamp: new Date()\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            data: {\r\n                horses,\r\n                pagination: {\r\n                    total,\r\n                    page,\r\n                    pages: Math.ceil(total / limit),\r\n                    hasMore: total > skip + horses.length\r\n                }\r\n            }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Search error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error performing search'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Save search preferences\r\n// @route   POST /api/search/preferences\r\n// @access  Private\r\nexports.saveSearchPreferences = async (req, res) => {\r\n    try {\r\n        const { preferences } = req.body;\r\n\r\n        const user = await User.findByIdAndUpdate(\r\n            req.user._id,\r\n            {\r\n                $set: { preferences }\r\n            },\r\n            { new: true }\r\n        );\r\n\r\n        res.json({\r\n            success: true,\r\n            preferences: user.preferences\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Save preferences error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error saving preferences'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get saved searches\r\n// @route   GET /api/search/saved\r\n// @access  Private\r\nexports.getSavedSearches = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id)\r\n            .select('preferences.savedSearches');\r\n\r\n        res.json({\r\n            success: true,\r\n            savedSearches: user.preferences?.savedSearches || []\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Get saved searches error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error retrieving saved searches'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get search suggestions\r\n// @route   GET /api/search/suggestions\r\n// @access  Public\r\nexports.getSearchSuggestions = async (req, res) => {\r\n    try {\r\n        const { query, type } = req.query;\r\n\r\n        let suggestions = [];\r\n        switch (type) {\r\n            case 'breed':\r\n                suggestions = await Horse.distinct('breed', {\r\n                    breed: new RegExp(query, 'i'),\r\n                    listingStatus: 'active'\r\n                });\r\n                break;\r\n            case 'location':\r\n                suggestions = await Horse.distinct('location.city', {\r\n                    'location.city': new RegExp(query, 'i'),\r\n                    listingStatus: 'active'\r\n                });\r\n                break;\r\n            case 'price':\r\n                const priceRanges = await Horse.aggregate([\r\n                    { $match: { listingStatus: 'active' } },\r\n                    {\r\n                        $group: {\r\n                            _id: {\r\n                                $round: [\r\n                                    { $divide: ['$price', 100000] },\r\n                                    -1\r\n                                ]\r\n                            },\r\n                            count: { $sum: 1 }\r\n                        }\r\n                    },\r\n                    { $sort: { _id: 1 } }\r\n                ]);\r\n                suggestions = priceRanges.map(range => ({\r\n                    range: `${range._id * 100000}-${(range._id + 1) * 100000}`,\r\n                    count: range.count\r\n                }));\r\n                break;\r\n            default:\r\n                suggestions = [];\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            suggestions\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Search suggestions error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting search suggestions'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734040480176},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\messaging.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  startConversation,\n  sendMessage,\n  getConversations,\n  getMessages,\n  updateConversationSettings\n} = require('../controllers/messaging.controller');\n\n// Validation middleware\nconst startConversationValidation = [body('recipientId').notEmpty().withMessage('Recipient ID is required'), body('entityType').isIn(['horse', 'inquiry', 'transaction']).withMessage('Valid entity type is required'), body('entityId').notEmpty().withMessage('Entity ID is required')];\nconst sendMessageValidation = [body('conversationId').notEmpty().withMessage('Conversation ID is required'), body('content').notEmpty().withMessage('Message content is required'), body('attachments').optional().isArray().withMessage('Attachments must be an array')];\nconst settingsValidation = [body('muted').optional().isBoolean().withMessage('Muted must be a boolean'), body('autoResponder').optional().isObject().withMessage('Auto responder must be an object'), body('notifications').optional().isObject().withMessage('Notifications must be an object')];\n\n// All routes require authentication\nrouter.use(protect);\n\n// Conversation routes\nrouter.post('/conversations', startConversationValidation, startConversation);\nrouter.get('/conversations', getConversations);\nrouter.get('/conversations/:conversationId/messages', getMessages);\nrouter.put('/conversations/:conversationId/settings', settingsValidation, updateConversationSettings);\n\n// Message routes\nrouter.post('/messages', sendMessageValidation, sendMessage);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJib2R5Iiwic3RhcnRDb252ZXJzYXRpb24iLCJzZW5kTWVzc2FnZSIsImdldENvbnZlcnNhdGlvbnMiLCJnZXRNZXNzYWdlcyIsInVwZGF0ZUNvbnZlcnNhdGlvblNldHRpbmdzIiwic3RhcnRDb252ZXJzYXRpb25WYWxpZGF0aW9uIiwibm90RW1wdHkiLCJ3aXRoTWVzc2FnZSIsImlzSW4iLCJzZW5kTWVzc2FnZVZhbGlkYXRpb24iLCJvcHRpb25hbCIsImlzQXJyYXkiLCJzZXR0aW5nc1ZhbGlkYXRpb24iLCJpc0Jvb2xlYW4iLCJpc09iamVjdCIsInVzZSIsInBvc3QiLCJnZXQiLCJwdXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsibWVzc2FnaW5nLnJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCB7IHByb3RlY3QgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmVzL2F1dGgubWlkZGxld2FyZScpO1xyXG5jb25zdCB7IGJvZHkgfSA9IHJlcXVpcmUoJ2V4cHJlc3MtdmFsaWRhdG9yJyk7XHJcbmNvbnN0IHtcclxuICAgIHN0YXJ0Q29udmVyc2F0aW9uLFxyXG4gICAgc2VuZE1lc3NhZ2UsXHJcbiAgICBnZXRDb252ZXJzYXRpb25zLFxyXG4gICAgZ2V0TWVzc2FnZXMsXHJcbiAgICB1cGRhdGVDb252ZXJzYXRpb25TZXR0aW5nc1xyXG59ID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvbWVzc2FnaW5nLmNvbnRyb2xsZXInKTtcclxuXHJcbi8vIFZhbGlkYXRpb24gbWlkZGxld2FyZVxyXG5jb25zdCBzdGFydENvbnZlcnNhdGlvblZhbGlkYXRpb24gPSBbXHJcbiAgICBib2R5KCdyZWNpcGllbnRJZCcpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ1JlY2lwaWVudCBJRCBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnZW50aXR5VHlwZScpXHJcbiAgICAgICAgLmlzSW4oWydob3JzZScsICdpbnF1aXJ5JywgJ3RyYW5zYWN0aW9uJ10pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdWYWxpZCBlbnRpdHkgdHlwZSBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnZW50aXR5SWQnKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdFbnRpdHkgSUQgaXMgcmVxdWlyZWQnKVxyXG5dO1xyXG5cclxuY29uc3Qgc2VuZE1lc3NhZ2VWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnY29udmVyc2F0aW9uSWQnKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdDb252ZXJzYXRpb24gSUQgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2NvbnRlbnQnKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdNZXNzYWdlIGNvbnRlbnQgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ2F0dGFjaG1lbnRzJykub3B0aW9uYWwoKS5pc0FycmF5KCkud2l0aE1lc3NhZ2UoJ0F0dGFjaG1lbnRzIG11c3QgYmUgYW4gYXJyYXknKVxyXG5dO1xyXG5cclxuY29uc3Qgc2V0dGluZ3NWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnbXV0ZWQnKS5vcHRpb25hbCgpLmlzQm9vbGVhbigpLndpdGhNZXNzYWdlKCdNdXRlZCBtdXN0IGJlIGEgYm9vbGVhbicpLFxyXG4gICAgYm9keSgnYXV0b1Jlc3BvbmRlcicpLm9wdGlvbmFsKCkuaXNPYmplY3QoKS53aXRoTWVzc2FnZSgnQXV0byByZXNwb25kZXIgbXVzdCBiZSBhbiBvYmplY3QnKSxcclxuICAgIGJvZHkoJ25vdGlmaWNhdGlvbnMnKS5vcHRpb25hbCgpLmlzT2JqZWN0KCkud2l0aE1lc3NhZ2UoJ05vdGlmaWNhdGlvbnMgbXVzdCBiZSBhbiBvYmplY3QnKVxyXG5dO1xyXG5cclxuLy8gQWxsIHJvdXRlcyByZXF1aXJlIGF1dGhlbnRpY2F0aW9uXHJcbnJvdXRlci51c2UocHJvdGVjdCk7XHJcblxyXG4vLyBDb252ZXJzYXRpb24gcm91dGVzXHJcbnJvdXRlci5wb3N0KCcvY29udmVyc2F0aW9ucycsIHN0YXJ0Q29udmVyc2F0aW9uVmFsaWRhdGlvbiwgc3RhcnRDb252ZXJzYXRpb24pO1xyXG5yb3V0ZXIuZ2V0KCcvY29udmVyc2F0aW9ucycsIGdldENvbnZlcnNhdGlvbnMpO1xyXG5yb3V0ZXIuZ2V0KCcvY29udmVyc2F0aW9ucy86Y29udmVyc2F0aW9uSWQvbWVzc2FnZXMnLCBnZXRNZXNzYWdlcyk7XHJcbnJvdXRlci5wdXQoJy9jb252ZXJzYXRpb25zLzpjb252ZXJzYXRpb25JZC9zZXR0aW5ncycsIHNldHRpbmdzVmFsaWRhdGlvbiwgdXBkYXRlQ29udmVyc2F0aW9uU2V0dGluZ3MpO1xyXG5cclxuLy8gTWVzc2FnZSByb3V0ZXNcclxucm91dGVyLnBvc3QoJy9tZXNzYWdlcycsIHNlbmRNZXNzYWdlVmFsaWRhdGlvbiwgc2VuZE1lc3NhZ2UpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNO0VBQUVDO0FBQVEsQ0FBQyxHQUFHSCxPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDN0QsTUFBTTtFQUFFSTtBQUFLLENBQUMsR0FBR0osT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzdDLE1BQU07RUFDRkssaUJBQWlCO0VBQ2pCQyxXQUFXO0VBQ1hDLGdCQUFnQjtFQUNoQkMsV0FBVztFQUNYQztBQUNKLENBQUMsR0FBR1QsT0FBTyxDQUFDLHFDQUFxQyxDQUFDOztBQUVsRDtBQUNBLE1BQU1VLDJCQUEyQixHQUFHLENBQ2hDTixJQUFJLENBQUMsYUFBYSxDQUFDLENBQUNPLFFBQVEsQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQywwQkFBMEIsQ0FBQyxFQUN0RVIsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUNiUyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQ3pDRCxXQUFXLENBQUMsK0JBQStCLENBQUMsRUFDakRSLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQ08sUUFBUSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLHVCQUF1QixDQUFDLENBQ25FO0FBRUQsTUFBTUUscUJBQXFCLEdBQUcsQ0FDMUJWLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDTyxRQUFRLENBQUMsQ0FBQyxDQUFDQyxXQUFXLENBQUMsNkJBQTZCLENBQUMsRUFDNUVSLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQ08sUUFBUSxDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLDZCQUE2QixDQUFDLEVBQ3JFUixJQUFJLENBQUMsYUFBYSxDQUFDLENBQUNXLFFBQVEsQ0FBQyxDQUFDLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUNKLFdBQVcsQ0FBQyw4QkFBOEIsQ0FBQyxDQUN2RjtBQUVELE1BQU1LLGtCQUFrQixHQUFHLENBQ3ZCYixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUNXLFFBQVEsQ0FBQyxDQUFDLENBQUNHLFNBQVMsQ0FBQyxDQUFDLENBQUNOLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxFQUMzRVIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDVyxRQUFRLENBQUMsQ0FBQyxDQUFDSSxRQUFRLENBQUMsQ0FBQyxDQUFDUCxXQUFXLENBQUMsa0NBQWtDLENBQUMsRUFDM0ZSLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQ1csUUFBUSxDQUFDLENBQUMsQ0FBQ0ksUUFBUSxDQUFDLENBQUMsQ0FBQ1AsV0FBVyxDQUFDLGlDQUFpQyxDQUFDLENBQzdGOztBQUVEO0FBQ0FYLE1BQU0sQ0FBQ21CLEdBQUcsQ0FBQ2pCLE9BQU8sQ0FBQzs7QUFFbkI7QUFDQUYsTUFBTSxDQUFDb0IsSUFBSSxDQUFDLGdCQUFnQixFQUFFWCwyQkFBMkIsRUFBRUwsaUJBQWlCLENBQUM7QUFDN0VKLE1BQU0sQ0FBQ3FCLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRWYsZ0JBQWdCLENBQUM7QUFDOUNOLE1BQU0sQ0FBQ3FCLEdBQUcsQ0FBQyx5Q0FBeUMsRUFBRWQsV0FBVyxDQUFDO0FBQ2xFUCxNQUFNLENBQUNzQixHQUFHLENBQUMseUNBQXlDLEVBQUVOLGtCQUFrQixFQUFFUiwwQkFBMEIsQ0FBQzs7QUFFckc7QUFDQVIsTUFBTSxDQUFDb0IsSUFBSSxDQUFDLFdBQVcsRUFBRVAscUJBQXFCLEVBQUVSLFdBQVcsQ0FBQztBQUU1RGtCLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHeEIsTUFBTSIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["express","require","router","Router","protect","body","startConversation","sendMessage","getConversations","getMessages","updateConversationSettings","startConversationValidation","notEmpty","withMessage","isIn","sendMessageValidation","optional","isArray","settingsValidation","isBoolean","isObject","use","post","get","put","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["messaging.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    startConversation,\r\n    sendMessage,\r\n    getConversations,\r\n    getMessages,\r\n    updateConversationSettings\r\n} = require('../controllers/messaging.controller');\r\n\r\n// Validation middleware\r\nconst startConversationValidation = [\r\n    body('recipientId').notEmpty().withMessage('Recipient ID is required'),\r\n    body('entityType')\r\n        .isIn(['horse', 'inquiry', 'transaction'])\r\n        .withMessage('Valid entity type is required'),\r\n    body('entityId').notEmpty().withMessage('Entity ID is required')\r\n];\r\n\r\nconst sendMessageValidation = [\r\n    body('conversationId').notEmpty().withMessage('Conversation ID is required'),\r\n    body('content').notEmpty().withMessage('Message content is required'),\r\n    body('attachments').optional().isArray().withMessage('Attachments must be an array')\r\n];\r\n\r\nconst settingsValidation = [\r\n    body('muted').optional().isBoolean().withMessage('Muted must be a boolean'),\r\n    body('autoResponder').optional().isObject().withMessage('Auto responder must be an object'),\r\n    body('notifications').optional().isObject().withMessage('Notifications must be an object')\r\n];\r\n\r\n// All routes require authentication\r\nrouter.use(protect);\r\n\r\n// Conversation routes\r\nrouter.post('/conversations', startConversationValidation, startConversation);\r\nrouter.get('/conversations', getConversations);\r\nrouter.get('/conversations/:conversationId/messages', getMessages);\r\nrouter.put('/conversations/:conversationId/settings', settingsValidation, updateConversationSettings);\r\n\r\n// Message routes\r\nrouter.post('/messages', sendMessageValidation, sendMessage);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC;AAAQ,CAAC,GAAGH,OAAO,CAAC,gCAAgC,CAAC;AAC7D,MAAM;EAAEI;AAAK,CAAC,GAAGJ,OAAO,CAAC,mBAAmB,CAAC;AAC7C,MAAM;EACFK,iBAAiB;EACjBC,WAAW;EACXC,gBAAgB;EAChBC,WAAW;EACXC;AACJ,CAAC,GAAGT,OAAO,CAAC,qCAAqC,CAAC;;AAElD;AACA,MAAMU,2BAA2B,GAAG,CAChCN,IAAI,CAAC,aAAa,CAAC,CAACO,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,0BAA0B,CAAC,EACtER,IAAI,CAAC,YAAY,CAAC,CACbS,IAAI,CAAC,CAAC,OAAO,EAAE,SAAS,EAAE,aAAa,CAAC,CAAC,CACzCD,WAAW,CAAC,+BAA+B,CAAC,EACjDR,IAAI,CAAC,UAAU,CAAC,CAACO,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,uBAAuB,CAAC,CACnE;AAED,MAAME,qBAAqB,GAAG,CAC1BV,IAAI,CAAC,gBAAgB,CAAC,CAACO,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,6BAA6B,CAAC,EAC5ER,IAAI,CAAC,SAAS,CAAC,CAACO,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,6BAA6B,CAAC,EACrER,IAAI,CAAC,aAAa,CAAC,CAACW,QAAQ,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAACJ,WAAW,CAAC,8BAA8B,CAAC,CACvF;AAED,MAAMK,kBAAkB,GAAG,CACvBb,IAAI,CAAC,OAAO,CAAC,CAACW,QAAQ,CAAC,CAAC,CAACG,SAAS,CAAC,CAAC,CAACN,WAAW,CAAC,yBAAyB,CAAC,EAC3ER,IAAI,CAAC,eAAe,CAAC,CAACW,QAAQ,CAAC,CAAC,CAACI,QAAQ,CAAC,CAAC,CAACP,WAAW,CAAC,kCAAkC,CAAC,EAC3FR,IAAI,CAAC,eAAe,CAAC,CAACW,QAAQ,CAAC,CAAC,CAACI,QAAQ,CAAC,CAAC,CAACP,WAAW,CAAC,iCAAiC,CAAC,CAC7F;;AAED;AACAX,MAAM,CAACmB,GAAG,CAACjB,OAAO,CAAC;;AAEnB;AACAF,MAAM,CAACoB,IAAI,CAAC,gBAAgB,EAAEX,2BAA2B,EAAEL,iBAAiB,CAAC;AAC7EJ,MAAM,CAACqB,GAAG,CAAC,gBAAgB,EAAEf,gBAAgB,CAAC;AAC9CN,MAAM,CAACqB,GAAG,CAAC,yCAAyC,EAAEd,WAAW,CAAC;AAClEP,MAAM,CAACsB,GAAG,CAAC,yCAAyC,EAAEN,kBAAkB,EAAER,0BAA0B,CAAC;;AAErG;AACAR,MAAM,CAACoB,IAAI,CAAC,WAAW,EAAEP,qBAAqB,EAAER,WAAW,CAAC;AAE5DkB,MAAM,CAACC,OAAO,GAAGxB,MAAM","ignoreList":[]}},"mtime":1734040749442},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\messaging.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Message = require('../models/Message');\nconst Conversation = require('../models/Conversation');\nconst User = require('../models/User');\nconst ActivityLog = require('../models/ActivityLog');\n\n// @desc    Start or get conversation\n// @route   POST /api/messaging/conversations\n// @access  Private\nexports.startConversation = async (req, res) => {\n  try {\n    const {\n      recipientId,\n      entityType,\n      entityId\n    } = req.body;\n\n    // Check if conversation already exists\n    let conversation = await Conversation.findOne({\n      'participants.user': {\n        $all: [req.user._id, recipientId]\n      },\n      'relatedEntity.type': entityType,\n      'relatedEntity.id': entityId\n    });\n    if (conversation) {\n      return res.json({\n        success: true,\n        conversation\n      });\n    }\n\n    // Get recipient user\n    const recipient = await User.findById(recipientId);\n    if (!recipient) {\n      return res.status(404).json({\n        success: false,\n        message: 'Recipient not found'\n      });\n    }\n\n    // Create new conversation\n    conversation = await Conversation.create({\n      participants: [{\n        user: req.user._id,\n        role: req.user.role === 'seller' ? 'seller' : 'buyer'\n      }, {\n        user: recipientId,\n        role: recipient.role === 'seller' ? 'seller' : 'buyer'\n      }],\n      relatedEntity: {\n        type: entityType,\n        id: entityId\n      }\n    });\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'START_CONVERSATION',\n      target: conversation._id,\n      targetModel: 'Conversation'\n    });\n    res.status(201).json({\n      success: true,\n      conversation\n    });\n  } catch (error) {\n    console.error('Start conversation error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error starting conversation'\n    });\n  }\n};\n\n// @desc    Send message\n// @route   POST /api/messaging/messages\n// @access  Private\nexports.sendMessage = async (req, res) => {\n  try {\n    const {\n      conversationId,\n      content,\n      attachments\n    } = req.body;\n    const conversation = await Conversation.findById(conversationId);\n    if (!conversation) {\n      return res.status(404).json({\n        success: false,\n        message: 'Conversation not found'\n      });\n    }\n\n    // Verify participant\n    if (!conversation.isParticipant(req.user._id)) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to send messages in this conversation'\n      });\n    }\n\n    // Create message\n    const message = await Message.create({\n      conversation: conversationId,\n      sender: req.user._id,\n      content,\n      attachments: attachments || []\n    });\n\n    // Update conversation\n    await conversation.updateLastMessage(message);\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'SEND_MESSAGE',\n      target: message._id,\n      targetModel: 'Message'\n    });\n    res.status(201).json({\n      success: true,\n      message\n    });\n  } catch (error) {\n    console.error('Send message error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error sending message'\n    });\n  }\n};\n\n// @desc    Get conversations\n// @route   GET /api/messaging/conversations\n// @access  Private\nexports.getConversations = async (req, res) => {\n  try {\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 20;\n    const skip = (page - 1) * limit;\n    const conversations = await Conversation.find({\n      'participants.user': req.user._id,\n      status: 'active'\n    }).sort('-updatedAt').skip(skip).limit(limit).populate('participants.user', 'name email role').populate('lastMessage.sender', 'name');\n    const total = await Conversation.countDocuments({\n      'participants.user': req.user._id,\n      status: 'active'\n    });\n    res.json({\n      success: true,\n      data: {\n        conversations,\n        pagination: {\n          page,\n          pages: Math.ceil(total / limit),\n          total\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Get conversations error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting conversations'\n    });\n  }\n};\n\n// @desc    Get conversation messages\n// @route   GET /api/messaging/conversations/:conversationId/messages\n// @access  Private\nexports.getMessages = async (req, res) => {\n  try {\n    const {\n      conversationId\n    } = req.params;\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 50;\n    const skip = (page - 1) * limit;\n    const conversation = await Conversation.findById(conversationId);\n    if (!conversation) {\n      return res.status(404).json({\n        success: false,\n        message: 'Conversation not found'\n      });\n    }\n\n    // Verify participant\n    if (!conversation.isParticipant(req.user._id)) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to view this conversation'\n      });\n    }\n    const messages = await Message.find({\n      conversation: conversationId\n    }).sort('-createdAt').skip(skip).limit(limit).populate('sender', 'name role');\n\n    // Mark messages as read\n    await Message.updateMany({\n      conversation: conversationId,\n      sender: {\n        $ne: req.user._id\n      },\n      'readBy.user': {\n        $ne: req.user._id\n      }\n    }, {\n      $push: {\n        readBy: {\n          user: req.user._id,\n          readAt: new Date()\n        }\n      }\n    });\n\n    // Update participant's last read timestamp\n    await Conversation.updateOne({\n      _id: conversationId,\n      'participants.user': req.user._id\n    }, {\n      $set: {\n        'participants.$.lastRead': new Date()\n      }\n    });\n    res.json({\n      success: true,\n      messages\n    });\n  } catch (error) {\n    console.error('Get messages error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting messages'\n    });\n  }\n};\n\n// @desc    Update conversation settings\n// @route   PUT /api/messaging/conversations/:conversationId/settings\n// @access  Private\nexports.updateConversationSettings = async (req, res) => {\n  try {\n    const {\n      conversationId\n    } = req.params;\n    const {\n      muted,\n      autoResponder,\n      notifications\n    } = req.body;\n    const conversation = await Conversation.findById(conversationId);\n    if (!conversation) {\n      return res.status(404).json({\n        success: false,\n        message: 'Conversation not found'\n      });\n    }\n\n    // Verify participant\n    if (!conversation.isParticipant(req.user._id)) {\n      return res.status(403).json({\n        success: false,\n        message: 'Not authorized to update this conversation'\n      });\n    }\n\n    // Update participant settings\n    if (typeof muted === 'boolean') {\n      await Conversation.updateOne({\n        _id: conversationId,\n        'participants.user': req.user._id\n      }, {\n        $set: {\n          'participants.$.muted': muted\n        }\n      });\n    }\n\n    // Update conversation settings\n    if (autoResponder || notifications) {\n      const update = {};\n      if (autoResponder) {\n        update['settings.autoResponder'] = autoResponder;\n      }\n      if (notifications) {\n        update['settings.notifications'] = notifications;\n      }\n      await conversation.updateOne({\n        $set: update\n      });\n    }\n    res.json({\n      success: true,\n      message: 'Conversation settings updated'\n    });\n  } catch (error) {\n    console.error('Update conversation settings error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error updating conversation settings'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNZXNzYWdlIiwicmVxdWlyZSIsIkNvbnZlcnNhdGlvbiIsIlVzZXIiLCJBY3Rpdml0eUxvZyIsImV4cG9ydHMiLCJzdGFydENvbnZlcnNhdGlvbiIsInJlcSIsInJlcyIsInJlY2lwaWVudElkIiwiZW50aXR5VHlwZSIsImVudGl0eUlkIiwiYm9keSIsImNvbnZlcnNhdGlvbiIsImZpbmRPbmUiLCIkYWxsIiwidXNlciIsIl9pZCIsImpzb24iLCJzdWNjZXNzIiwicmVjaXBpZW50IiwiZmluZEJ5SWQiLCJzdGF0dXMiLCJtZXNzYWdlIiwiY3JlYXRlIiwicGFydGljaXBhbnRzIiwicm9sZSIsInJlbGF0ZWRFbnRpdHkiLCJ0eXBlIiwiaWQiLCJhY3Rpb24iLCJ0YXJnZXQiLCJ0YXJnZXRNb2RlbCIsImVycm9yIiwiY29uc29sZSIsInNlbmRNZXNzYWdlIiwiY29udmVyc2F0aW9uSWQiLCJjb250ZW50IiwiYXR0YWNobWVudHMiLCJpc1BhcnRpY2lwYW50Iiwic2VuZGVyIiwidXBkYXRlTGFzdE1lc3NhZ2UiLCJnZXRDb252ZXJzYXRpb25zIiwicGFnZSIsInBhcnNlSW50IiwicXVlcnkiLCJsaW1pdCIsInNraXAiLCJjb252ZXJzYXRpb25zIiwiZmluZCIsInNvcnQiLCJwb3B1bGF0ZSIsInRvdGFsIiwiY291bnREb2N1bWVudHMiLCJkYXRhIiwicGFnaW5hdGlvbiIsInBhZ2VzIiwiTWF0aCIsImNlaWwiLCJnZXRNZXNzYWdlcyIsInBhcmFtcyIsIm1lc3NhZ2VzIiwidXBkYXRlTWFueSIsIiRuZSIsIiRwdXNoIiwicmVhZEJ5IiwicmVhZEF0IiwiRGF0ZSIsInVwZGF0ZU9uZSIsIiRzZXQiLCJ1cGRhdGVDb252ZXJzYXRpb25TZXR0aW5ncyIsIm11dGVkIiwiYXV0b1Jlc3BvbmRlciIsIm5vdGlmaWNhdGlvbnMiLCJ1cGRhdGUiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXGNvbnRyb2xsZXJzXFwiLCJzb3VyY2VzIjpbIm1lc3NhZ2luZy5jb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IE1lc3NhZ2UgPSByZXF1aXJlKCcuLi9tb2RlbHMvTWVzc2FnZScpO1xyXG5jb25zdCBDb252ZXJzYXRpb24gPSByZXF1aXJlKCcuLi9tb2RlbHMvQ29udmVyc2F0aW9uJyk7XHJcbmNvbnN0IFVzZXIgPSByZXF1aXJlKCcuLi9tb2RlbHMvVXNlcicpO1xyXG5jb25zdCBBY3Rpdml0eUxvZyA9IHJlcXVpcmUoJy4uL21vZGVscy9BY3Rpdml0eUxvZycpO1xyXG5cclxuLy8gQGRlc2MgICAgU3RhcnQgb3IgZ2V0IGNvbnZlcnNhdGlvblxyXG4vLyBAcm91dGUgICBQT1NUIC9hcGkvbWVzc2FnaW5nL2NvbnZlcnNhdGlvbnNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLnN0YXJ0Q29udmVyc2F0aW9uID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgcmVjaXBpZW50SWQsIGVudGl0eVR5cGUsIGVudGl0eUlkIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgY29udmVyc2F0aW9uIGFscmVhZHkgZXhpc3RzXHJcbiAgICAgICAgbGV0IGNvbnZlcnNhdGlvbiA9IGF3YWl0IENvbnZlcnNhdGlvbi5maW5kT25lKHtcclxuICAgICAgICAgICAgJ3BhcnRpY2lwYW50cy51c2VyJzogeyAkYWxsOiBbcmVxLnVzZXIuX2lkLCByZWNpcGllbnRJZF0gfSxcclxuICAgICAgICAgICAgJ3JlbGF0ZWRFbnRpdHkudHlwZSc6IGVudGl0eVR5cGUsXHJcbiAgICAgICAgICAgICdyZWxhdGVkRW50aXR5LmlkJzogZW50aXR5SWRcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaWYgKGNvbnZlcnNhdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNvbnZlcnNhdGlvblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIEdldCByZWNpcGllbnQgdXNlclxyXG4gICAgICAgIGNvbnN0IHJlY2lwaWVudCA9IGF3YWl0IFVzZXIuZmluZEJ5SWQocmVjaXBpZW50SWQpO1xyXG4gICAgICAgIGlmICghcmVjaXBpZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdSZWNpcGllbnQgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgY29udmVyc2F0aW9uXHJcbiAgICAgICAgY29udmVyc2F0aW9uID0gYXdhaXQgQ29udmVyc2F0aW9uLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHBhcnRpY2lwYW50czogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHVzZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgICAgICAgICByb2xlOiByZXEudXNlci5yb2xlID09PSAnc2VsbGVyJyA/ICdzZWxsZXInIDogJ2J1eWVyJ1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB1c2VyOiByZWNpcGllbnRJZCxcclxuICAgICAgICAgICAgICAgICAgICByb2xlOiByZWNpcGllbnQucm9sZSA9PT0gJ3NlbGxlcicgPyAnc2VsbGVyJyA6ICdidXllcidcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXSxcclxuICAgICAgICAgICAgcmVsYXRlZEVudGl0eToge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogZW50aXR5VHlwZSxcclxuICAgICAgICAgICAgICAgIGlkOiBlbnRpdHlJZFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIExvZyBhY3Rpdml0eVxyXG4gICAgICAgIGF3YWl0IEFjdGl2aXR5TG9nLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHVzZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgYWN0aW9uOiAnU1RBUlRfQ09OVkVSU0FUSU9OJyxcclxuICAgICAgICAgICAgdGFyZ2V0OiBjb252ZXJzYXRpb24uX2lkLFxyXG4gICAgICAgICAgICB0YXJnZXRNb2RlbDogJ0NvbnZlcnNhdGlvbidcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBjb252ZXJzYXRpb25cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1N0YXJ0IGNvbnZlcnNhdGlvbiBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3Igc3RhcnRpbmcgY29udmVyc2F0aW9uJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgU2VuZCBtZXNzYWdlXHJcbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9tZXNzYWdpbmcvbWVzc2FnZXNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLnNlbmRNZXNzYWdlID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udmVyc2F0aW9uSWQsIGNvbnRlbnQsIGF0dGFjaG1lbnRzIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAgICAgY29uc3QgY29udmVyc2F0aW9uID0gYXdhaXQgQ29udmVyc2F0aW9uLmZpbmRCeUlkKGNvbnZlcnNhdGlvbklkKTtcclxuICAgICAgICBpZiAoIWNvbnZlcnNhdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQ29udmVyc2F0aW9uIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBWZXJpZnkgcGFydGljaXBhbnRcclxuICAgICAgICBpZiAoIWNvbnZlcnNhdGlvbi5pc1BhcnRpY2lwYW50KHJlcS51c2VyLl9pZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIHNlbmQgbWVzc2FnZXMgaW4gdGhpcyBjb252ZXJzYXRpb24nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQ3JlYXRlIG1lc3NhZ2VcclxuICAgICAgICBjb25zdCBtZXNzYWdlID0gYXdhaXQgTWVzc2FnZS5jcmVhdGUoe1xyXG4gICAgICAgICAgICBjb252ZXJzYXRpb246IGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgICAgICBzZW5kZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgY29udGVudCxcclxuICAgICAgICAgICAgYXR0YWNobWVudHM6IGF0dGFjaG1lbnRzIHx8IFtdXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIFVwZGF0ZSBjb252ZXJzYXRpb25cclxuICAgICAgICBhd2FpdCBjb252ZXJzYXRpb24udXBkYXRlTGFzdE1lc3NhZ2UobWVzc2FnZSk7XHJcblxyXG4gICAgICAgIC8vIExvZyBhY3Rpdml0eVxyXG4gICAgICAgIGF3YWl0IEFjdGl2aXR5TG9nLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHVzZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgYWN0aW9uOiAnU0VORF9NRVNTQUdFJyxcclxuICAgICAgICAgICAgdGFyZ2V0OiBtZXNzYWdlLl9pZCxcclxuICAgICAgICAgICAgdGFyZ2V0TW9kZWw6ICdNZXNzYWdlJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2VcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NlbmQgbWVzc2FnZSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3Igc2VuZGluZyBtZXNzYWdlJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IGNvbnZlcnNhdGlvbnNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvbWVzc2FnaW5nL2NvbnZlcnNhdGlvbnNcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLmdldENvbnZlcnNhdGlvbnMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgcGFnZSA9IHBhcnNlSW50KHJlcS5xdWVyeS5wYWdlKSB8fCAxO1xyXG4gICAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0KSB8fCAyMDtcclxuICAgICAgICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xyXG5cclxuICAgICAgICBjb25zdCBjb252ZXJzYXRpb25zID0gYXdhaXQgQ29udmVyc2F0aW9uLmZpbmQoe1xyXG4gICAgICAgICAgICAncGFydGljaXBhbnRzLnVzZXInOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIHN0YXR1czogJ2FjdGl2ZSdcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc29ydCgnLXVwZGF0ZWRBdCcpXHJcbiAgICAgICAgICAgIC5za2lwKHNraXApXHJcbiAgICAgICAgICAgIC5saW1pdChsaW1pdClcclxuICAgICAgICAgICAgLnBvcHVsYXRlKCdwYXJ0aWNpcGFudHMudXNlcicsICduYW1lIGVtYWlsIHJvbGUnKVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ2xhc3RNZXNzYWdlLnNlbmRlcicsICduYW1lJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRvdGFsID0gYXdhaXQgQ29udmVyc2F0aW9uLmNvdW50RG9jdW1lbnRzKHtcclxuICAgICAgICAgICAgJ3BhcnRpY2lwYW50cy51c2VyJzogcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdhY3RpdmUnXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgY29udmVyc2F0aW9ucyxcclxuICAgICAgICAgICAgICAgIHBhZ2luYXRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBwYWdlLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhZ2VzOiBNYXRoLmNlaWwodG90YWwgLyBsaW1pdCksXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWxcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignR2V0IGNvbnZlcnNhdGlvbnMgZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0Vycm9yIGdldHRpbmcgY29udmVyc2F0aW9ucydcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBjb252ZXJzYXRpb24gbWVzc2FnZXNcclxuLy8gQHJvdXRlICAgR0VUIC9hcGkvbWVzc2FnaW5nL2NvbnZlcnNhdGlvbnMvOmNvbnZlcnNhdGlvbklkL21lc3NhZ2VzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5nZXRNZXNzYWdlcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IGNvbnZlcnNhdGlvbklkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgICAgIGNvbnN0IHBhZ2UgPSBwYXJzZUludChyZXEucXVlcnkucGFnZSkgfHwgMTtcclxuICAgICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCkgfHwgNTA7XHJcbiAgICAgICAgY29uc3Qgc2tpcCA9IChwYWdlIC0gMSkgKiBsaW1pdDtcclxuXHJcbiAgICAgICAgY29uc3QgY29udmVyc2F0aW9uID0gYXdhaXQgQ29udmVyc2F0aW9uLmZpbmRCeUlkKGNvbnZlcnNhdGlvbklkKTtcclxuICAgICAgICBpZiAoIWNvbnZlcnNhdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQ29udmVyc2F0aW9uIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBWZXJpZnkgcGFydGljaXBhbnRcclxuICAgICAgICBpZiAoIWNvbnZlcnNhdGlvbi5pc1BhcnRpY2lwYW50KHJlcS51c2VyLl9pZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ05vdCBhdXRob3JpemVkIHRvIHZpZXcgdGhpcyBjb252ZXJzYXRpb24nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCBNZXNzYWdlLmZpbmQoeyBjb252ZXJzYXRpb246IGNvbnZlcnNhdGlvbklkIH0pXHJcbiAgICAgICAgICAgIC5zb3J0KCctY3JlYXRlZEF0JylcclxuICAgICAgICAgICAgLnNraXAoc2tpcClcclxuICAgICAgICAgICAgLmxpbWl0KGxpbWl0KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3NlbmRlcicsICduYW1lIHJvbGUnKTtcclxuXHJcbiAgICAgICAgLy8gTWFyayBtZXNzYWdlcyBhcyByZWFkXHJcbiAgICAgICAgYXdhaXQgTWVzc2FnZS51cGRhdGVNYW55KFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBjb252ZXJzYXRpb246IGNvbnZlcnNhdGlvbklkLFxyXG4gICAgICAgICAgICAgICAgc2VuZGVyOiB7ICRuZTogcmVxLnVzZXIuX2lkIH0sXHJcbiAgICAgICAgICAgICAgICAncmVhZEJ5LnVzZXInOiB7ICRuZTogcmVxLnVzZXIuX2lkIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgJHB1c2g6IHtcclxuICAgICAgICAgICAgICAgICAgICByZWFkQnk6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcjogcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFkQXQ6IG5ldyBEYXRlKClcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG5cclxuICAgICAgICAvLyBVcGRhdGUgcGFydGljaXBhbnQncyBsYXN0IHJlYWQgdGltZXN0YW1wXHJcbiAgICAgICAgYXdhaXQgQ29udmVyc2F0aW9uLnVwZGF0ZU9uZShcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgX2lkOiBjb252ZXJzYXRpb25JZCxcclxuICAgICAgICAgICAgICAgICdwYXJ0aWNpcGFudHMudXNlcic6IHJlcS51c2VyLl9pZFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkc2V0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJ3BhcnRpY2lwYW50cy4kLmxhc3RSZWFkJzogbmV3IERhdGUoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBtZXNzYWdlc1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignR2V0IG1lc3NhZ2VzIGVycm9yOicsIGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBnZXR0aW5nIG1lc3NhZ2VzJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgVXBkYXRlIGNvbnZlcnNhdGlvbiBzZXR0aW5nc1xyXG4vLyBAcm91dGUgICBQVVQgL2FwaS9tZXNzYWdpbmcvY29udmVyc2F0aW9ucy86Y29udmVyc2F0aW9uSWQvc2V0dGluZ3NcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLnVwZGF0ZUNvbnZlcnNhdGlvblNldHRpbmdzID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgY29udmVyc2F0aW9uSWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICAgICAgY29uc3QgeyBtdXRlZCwgYXV0b1Jlc3BvbmRlciwgbm90aWZpY2F0aW9ucyB9ID0gcmVxLmJvZHk7XHJcblxyXG4gICAgICAgIGNvbnN0IGNvbnZlcnNhdGlvbiA9IGF3YWl0IENvbnZlcnNhdGlvbi5maW5kQnlJZChjb252ZXJzYXRpb25JZCk7XHJcbiAgICAgICAgaWYgKCFjb252ZXJzYXRpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0NvbnZlcnNhdGlvbiBub3QgZm91bmQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVmVyaWZ5IHBhcnRpY2lwYW50XHJcbiAgICAgICAgaWYgKCFjb252ZXJzYXRpb24uaXNQYXJ0aWNpcGFudChyZXEudXNlci5faWQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdOb3QgYXV0aG9yaXplZCB0byB1cGRhdGUgdGhpcyBjb252ZXJzYXRpb24nXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gVXBkYXRlIHBhcnRpY2lwYW50IHNldHRpbmdzXHJcbiAgICAgICAgaWYgKHR5cGVvZiBtdXRlZCA9PT0gJ2Jvb2xlYW4nKSB7XHJcbiAgICAgICAgICAgIGF3YWl0IENvbnZlcnNhdGlvbi51cGRhdGVPbmUoXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgX2lkOiBjb252ZXJzYXRpb25JZCxcclxuICAgICAgICAgICAgICAgICAgICAncGFydGljaXBhbnRzLnVzZXInOiByZXEudXNlci5faWRcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHNldDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAncGFydGljaXBhbnRzLiQubXV0ZWQnOiBtdXRlZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFVwZGF0ZSBjb252ZXJzYXRpb24gc2V0dGluZ3NcclxuICAgICAgICBpZiAoYXV0b1Jlc3BvbmRlciB8fCBub3RpZmljYXRpb25zKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IHt9O1xyXG4gICAgICAgICAgICBpZiAoYXV0b1Jlc3BvbmRlcikge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlWydzZXR0aW5ncy5hdXRvUmVzcG9uZGVyJ10gPSBhdXRvUmVzcG9uZGVyO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChub3RpZmljYXRpb25zKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVbJ3NldHRpbmdzLm5vdGlmaWNhdGlvbnMnXSA9IG5vdGlmaWNhdGlvbnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYXdhaXQgY29udmVyc2F0aW9uLnVwZGF0ZU9uZSh7ICRzZXQ6IHVwZGF0ZSB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlcy5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogJ0NvbnZlcnNhdGlvbiBzZXR0aW5ncyB1cGRhdGVkJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignVXBkYXRlIGNvbnZlcnNhdGlvbiBzZXR0aW5ncyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3IgdXBkYXRpbmcgY29udmVyc2F0aW9uIHNldHRpbmdzJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59OyAiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDO0FBQzVDLE1BQU1DLFlBQVksR0FBR0QsT0FBTyxDQUFDLHdCQUF3QixDQUFDO0FBQ3RELE1BQU1FLElBQUksR0FBR0YsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBQ3RDLE1BQU1HLFdBQVcsR0FBR0gsT0FBTyxDQUFDLHVCQUF1QixDQUFDOztBQUVwRDtBQUNBO0FBQ0E7QUFDQUksT0FBTyxDQUFDQyxpQkFBaUIsR0FBRyxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUM1QyxJQUFJO0lBQ0EsTUFBTTtNQUFFQyxXQUFXO01BQUVDLFVBQVU7TUFBRUM7SUFBUyxDQUFDLEdBQUdKLEdBQUcsQ0FBQ0ssSUFBSTs7SUFFdEQ7SUFDQSxJQUFJQyxZQUFZLEdBQUcsTUFBTVgsWUFBWSxDQUFDWSxPQUFPLENBQUM7TUFDMUMsbUJBQW1CLEVBQUU7UUFBRUMsSUFBSSxFQUFFLENBQUNSLEdBQUcsQ0FBQ1MsSUFBSSxDQUFDQyxHQUFHLEVBQUVSLFdBQVc7TUFBRSxDQUFD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","map":{"version":3,"names":["Message","require","Conversation","User","ActivityLog","exports","startConversation","req","res","recipientId","entityType","entityId","body","conversation","findOne","$all","user","_id","json","success","recipient","findById","status","message","create","participants","role","relatedEntity","type","id","action","target","targetModel","error","console","sendMessage","conversationId","content","attachments","isParticipant","sender","updateLastMessage","getConversations","page","parseInt","query","limit","skip","conversations","find","sort","populate","total","countDocuments","data","pagination","pages","Math","ceil","getMessages","params","messages","updateMany","$ne","$push","readBy","readAt","Date","updateOne","$set","updateConversationSettings","muted","autoResponder","notifications","update"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["messaging.controller.js"],"sourcesContent":["const Message = require('../models/Message');\r\nconst Conversation = require('../models/Conversation');\r\nconst User = require('../models/User');\r\nconst ActivityLog = require('../models/ActivityLog');\r\n\r\n// @desc    Start or get conversation\r\n// @route   POST /api/messaging/conversations\r\n// @access  Private\r\nexports.startConversation = async (req, res) => {\r\n    try {\r\n        const { recipientId, entityType, entityId } = req.body;\r\n\r\n        // Check if conversation already exists\r\n        let conversation = await Conversation.findOne({\r\n            'participants.user': { $all: [req.user._id, recipientId] },\r\n            'relatedEntity.type': entityType,\r\n            'relatedEntity.id': entityId\r\n        });\r\n\r\n        if (conversation) {\r\n            return res.json({\r\n                success: true,\r\n                conversation\r\n            });\r\n        }\r\n\r\n        // Get recipient user\r\n        const recipient = await User.findById(recipientId);\r\n        if (!recipient) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Recipient not found'\r\n            });\r\n        }\r\n\r\n        // Create new conversation\r\n        conversation = await Conversation.create({\r\n            participants: [\r\n                {\r\n                    user: req.user._id,\r\n                    role: req.user.role === 'seller' ? 'seller' : 'buyer'\r\n                },\r\n                {\r\n                    user: recipientId,\r\n                    role: recipient.role === 'seller' ? 'seller' : 'buyer'\r\n                }\r\n            ],\r\n            relatedEntity: {\r\n                type: entityType,\r\n                id: entityId\r\n            }\r\n        });\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'START_CONVERSATION',\r\n            target: conversation._id,\r\n            targetModel: 'Conversation'\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            conversation\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Start conversation error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error starting conversation'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Send message\r\n// @route   POST /api/messaging/messages\r\n// @access  Private\r\nexports.sendMessage = async (req, res) => {\r\n    try {\r\n        const { conversationId, content, attachments } = req.body;\r\n\r\n        const conversation = await Conversation.findById(conversationId);\r\n        if (!conversation) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Conversation not found'\r\n            });\r\n        }\r\n\r\n        // Verify participant\r\n        if (!conversation.isParticipant(req.user._id)) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to send messages in this conversation'\r\n            });\r\n        }\r\n\r\n        // Create message\r\n        const message = await Message.create({\r\n            conversation: conversationId,\r\n            sender: req.user._id,\r\n            content,\r\n            attachments: attachments || []\r\n        });\r\n\r\n        // Update conversation\r\n        await conversation.updateLastMessage(message);\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'SEND_MESSAGE',\r\n            target: message._id,\r\n            targetModel: 'Message'\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            message\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Send message error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error sending message'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get conversations\r\n// @route   GET /api/messaging/conversations\r\n// @access  Private\r\nexports.getConversations = async (req, res) => {\r\n    try {\r\n        const page = parseInt(req.query.page) || 1;\r\n        const limit = parseInt(req.query.limit) || 20;\r\n        const skip = (page - 1) * limit;\r\n\r\n        const conversations = await Conversation.find({\r\n            'participants.user': req.user._id,\r\n            status: 'active'\r\n        })\r\n            .sort('-updatedAt')\r\n            .skip(skip)\r\n            .limit(limit)\r\n            .populate('participants.user', 'name email role')\r\n            .populate('lastMessage.sender', 'name');\r\n\r\n        const total = await Conversation.countDocuments({\r\n            'participants.user': req.user._id,\r\n            status: 'active'\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            data: {\r\n                conversations,\r\n                pagination: {\r\n                    page,\r\n                    pages: Math.ceil(total / limit),\r\n                    total\r\n                }\r\n            }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Get conversations error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting conversations'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get conversation messages\r\n// @route   GET /api/messaging/conversations/:conversationId/messages\r\n// @access  Private\r\nexports.getMessages = async (req, res) => {\r\n    try {\r\n        const { conversationId } = req.params;\r\n        const page = parseInt(req.query.page) || 1;\r\n        const limit = parseInt(req.query.limit) || 50;\r\n        const skip = (page - 1) * limit;\r\n\r\n        const conversation = await Conversation.findById(conversationId);\r\n        if (!conversation) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Conversation not found'\r\n            });\r\n        }\r\n\r\n        // Verify participant\r\n        if (!conversation.isParticipant(req.user._id)) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to view this conversation'\r\n            });\r\n        }\r\n\r\n        const messages = await Message.find({ conversation: conversationId })\r\n            .sort('-createdAt')\r\n            .skip(skip)\r\n            .limit(limit)\r\n            .populate('sender', 'name role');\r\n\r\n        // Mark messages as read\r\n        await Message.updateMany(\r\n            {\r\n                conversation: conversationId,\r\n                sender: { $ne: req.user._id },\r\n                'readBy.user': { $ne: req.user._id }\r\n            },\r\n            {\r\n                $push: {\r\n                    readBy: {\r\n                        user: req.user._id,\r\n                        readAt: new Date()\r\n                    }\r\n                }\r\n            }\r\n        );\r\n\r\n        // Update participant's last read timestamp\r\n        await Conversation.updateOne(\r\n            {\r\n                _id: conversationId,\r\n                'participants.user': req.user._id\r\n            },\r\n            {\r\n                $set: {\r\n                    'participants.$.lastRead': new Date()\r\n                }\r\n            }\r\n        );\r\n\r\n        res.json({\r\n            success: true,\r\n            messages\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Get messages error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting messages'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Update conversation settings\r\n// @route   PUT /api/messaging/conversations/:conversationId/settings\r\n// @access  Private\r\nexports.updateConversationSettings = async (req, res) => {\r\n    try {\r\n        const { conversationId } = req.params;\r\n        const { muted, autoResponder, notifications } = req.body;\r\n\r\n        const conversation = await Conversation.findById(conversationId);\r\n        if (!conversation) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Conversation not found'\r\n            });\r\n        }\r\n\r\n        // Verify participant\r\n        if (!conversation.isParticipant(req.user._id)) {\r\n            return res.status(403).json({\r\n                success: false,\r\n                message: 'Not authorized to update this conversation'\r\n            });\r\n        }\r\n\r\n        // Update participant settings\r\n        if (typeof muted === 'boolean') {\r\n            await Conversation.updateOne(\r\n                {\r\n                    _id: conversationId,\r\n                    'participants.user': req.user._id\r\n                },\r\n                {\r\n                    $set: {\r\n                        'participants.$.muted': muted\r\n                    }\r\n                }\r\n            );\r\n        }\r\n\r\n        // Update conversation settings\r\n        if (autoResponder || notifications) {\r\n            const update = {};\r\n            if (autoResponder) {\r\n                update['settings.autoResponder'] = autoResponder;\r\n            }\r\n            if (notifications) {\r\n                update['settings.notifications'] = notifications;\r\n            }\r\n            await conversation.updateOne({ $set: update });\r\n        }\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'Conversation settings updated'\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Update conversation settings error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error updating conversation settings'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734040729256},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Message.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst messageSchema = new mongoose.Schema({\n  conversation: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'Conversation',\n    required: true\n  },\n  sender: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  content: {\n    type: String,\n    required: true\n  },\n  attachments: [{\n    url: String,\n    public_id: String,\n    type: {\n      type: String,\n      enum: ['image', 'document']\n    },\n    name: String,\n    size: Number\n  }],\n  readBy: [{\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    readAt: {\n      type: Date,\n      default: Date.now\n    }\n  }],\n  metadata: {\n    template: {\n      type: Boolean,\n      default: false\n    },\n    templateId: String,\n    autoResponse: Boolean\n  },\n  status: {\n    type: String,\n    enum: ['sent', 'delivered', 'read', 'failed'],\n    default: 'sent'\n  }\n}, {\n  timestamps: true\n});\n\n// Create indexes\nmessageSchema.index({\n  conversation: 1,\n  createdAt: -1\n});\nmessageSchema.index({\n  sender: 1\n});\nmessageSchema.index({\n  'readBy.user': 1\n});\nmodule.exports = mongoose.model('Message', messageSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJtZXNzYWdlU2NoZW1hIiwiU2NoZW1hIiwiY29udmVyc2F0aW9uIiwidHlwZSIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJyZXF1aXJlZCIsInNlbmRlciIsImNvbnRlbnQiLCJTdHJpbmciLCJhdHRhY2htZW50cyIsInVybCIsInB1YmxpY19pZCIsImVudW0iLCJuYW1lIiwic2l6ZSIsIk51bWJlciIsInJlYWRCeSIsInVzZXIiLCJyZWFkQXQiLCJEYXRlIiwiZGVmYXVsdCIsIm5vdyIsIm1ldGFkYXRhIiwidGVtcGxhdGUiLCJCb29sZWFuIiwidGVtcGxhdGVJZCIsImF1dG9SZXNwb25zZSIsInN0YXR1cyIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJtb2RlbCJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcbW9kZWxzXFwiLCJzb3VyY2VzIjpbIk1lc3NhZ2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5cclxuY29uc3QgbWVzc2FnZVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gICAgY29udmVyc2F0aW9uOiB7XHJcbiAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlZjogJ0NvbnZlcnNhdGlvbicsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBzZW5kZXI6IHtcclxuICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgcmVmOiAnVXNlcicsXHJcbiAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgIH0sXHJcbiAgICBjb250ZW50OiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICB9LFxyXG4gICAgYXR0YWNobWVudHM6IFt7XHJcbiAgICAgICAgdXJsOiBTdHJpbmcsXHJcbiAgICAgICAgcHVibGljX2lkOiBTdHJpbmcsXHJcbiAgICAgICAgdHlwZToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGVudW06IFsnaW1hZ2UnLCAnZG9jdW1lbnQnXVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbmFtZTogU3RyaW5nLFxyXG4gICAgICAgIHNpemU6IE51bWJlclxyXG4gICAgfV0sXHJcbiAgICByZWFkQnk6IFt7XHJcbiAgICAgICAgdXNlcjoge1xyXG4gICAgICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgICAgIHJlZjogJ1VzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWFkQXQ6IHtcclxuICAgICAgICAgICAgdHlwZTogRGF0ZSxcclxuICAgICAgICAgICAgZGVmYXVsdDogRGF0ZS5ub3dcclxuICAgICAgICB9XHJcbiAgICB9XSxcclxuICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgdGVtcGxhdGU6IHtcclxuICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRlbXBsYXRlSWQ6IFN0cmluZyxcclxuICAgICAgICBhdXRvUmVzcG9uc2U6IEJvb2xlYW5cclxuICAgIH0sXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZW51bTogWydzZW50JywgJ2RlbGl2ZXJlZCcsICdyZWFkJywgJ2ZhaWxlZCddLFxyXG4gICAgICAgIGRlZmF1bHQ6ICdzZW50J1xyXG4gICAgfVxyXG59LCB7XHJcbiAgICB0aW1lc3RhbXBzOiB0cnVlXHJcbn0pO1xyXG5cclxuLy8gQ3JlYXRlIGluZGV4ZXNcclxubWVzc2FnZVNjaGVtYS5pbmRleCh7IGNvbnZlcnNhdGlvbjogMSwgY3JlYXRlZEF0OiAtMSB9KTtcclxubWVzc2FnZVNjaGVtYS5pbmRleCh7IHNlbmRlcjogMSB9KTtcclxubWVzc2FnZVNjaGVtYS5pbmRleCh7ICdyZWFkQnkudXNlcic6IDEgfSk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IG1vbmdvb3NlLm1vZGVsKCdNZXNzYWdlJywgbWVzc2FnZVNjaGVtYSk7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLGFBQWEsR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUN0Q0MsWUFBWSxFQUFFO0lBQ1ZDLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNHLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFLGNBQWM7SUFDbkJDLFFBQVEsRUFBRTtFQUNkLENBQUM7RUFDREMsTUFBTSxFQUFFO0lBQ0pMLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNHLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFLE1BQU07SUFDWEMsUUFBUSxFQUFFO0VBQ2QsQ0FBQztFQUNERSxPQUFPLEVBQUU7SUFDTE4sSUFBSSxFQUFFTyxNQUFNO0lBQ1pILFFBQVEsRUFBRTtFQUNkLENBQUM7RUFDREksV0FBVyxFQUFFLENBQUM7SUFDVkMsR0FBRyxFQUFFRixNQUFNO0lBQ1hHLFNBQVMsRUFBRUgsTUFBTTtJQUNqQlAsSUFBSSxFQUFFO01BQ0ZBLElBQUksRUFBRU8sTUFBTTtNQUNaSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVTtJQUM5QixDQUFDO0lBQ0RDLElBQUksRUFBRUwsTUFBTTtJQUNaTSxJQUFJLEVBQUVDO0VBQ1YsQ0FBQyxDQUFDO0VBQ0ZDLE1BQU0sRUFBRSxDQUFDO0lBQ0xDLElBQUksRUFBRTtNQUNGaEIsSUFBSSxFQUFFTCxRQUFRLENBQUNHLE1BQU0sQ0FBQ0csS0FBSyxDQUFDQyxRQUFRO01BQ3BDQyxHQUFHLEVBQUU7SUFDVCxDQUFDO0lBQ0RjLE1BQU0sRUFBRTtNQUNKakIsSUFBSSxFQUFFa0IsSUFBSTtNQUNWQyxPQUFPLEVBQUVELElBQUksQ0FBQ0U7SUFDbEI7RUFDSixDQUFDLENBQUM7RUFDRkMsUUFBUSxFQUFFO0lBQ05DLFFBQVEsRUFBRTtNQUNOdEIsSUFBSSxFQUFFdUIsT0FBTztNQUNiSixPQUFPLEVBQUU7SUFDYixDQUFDO0lBQ0RLLFVBQVUsRUFBRWpCLE1BQU07SUFDbEJrQixZQUFZLEVBQUVGO0VBQ2xCLENBQUM7RUFDREcsTUFBTSxFQUFFO0lBQ0oxQixJQUFJLEVBQUVPLE1BQU07SUFDWkksSUFBSSxFQUFFLENBQUMsTUFBTSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDO0lBQzdDUSxPQUFPLEVBQUU7RUFDYjtBQUNKLENBQUMsRUFBRTtFQUNDUSxVQUFVLEVBQUU7QUFDaEIsQ0FBQyxDQUFDOztBQUVGO0FBQ0E5QixhQUFhLENBQUMrQixLQUFLLENBQUM7RUFBRTdCLFlBQVksRUFBRSxDQUFDO0VBQUU4QixTQUFTLEVBQUUsQ0FBQztBQUFFLENBQUMsQ0FBQztBQUN2RGhDLGFBQWEsQ0FBQytCLEtBQUssQ0FBQztFQUFFdkIsTUFBTSxFQUFFO0FBQUUsQ0FBQyxDQUFDO0FBQ2xDUixhQUFhLENBQUMrQixLQUFLLENBQUM7RUFBRSxhQUFhLEVBQUU7QUFBRSxDQUFDLENBQUM7QUFFekNFLE1BQU0sQ0FBQ0MsT0FBTyxHQUFHcEMsUUFBUSxDQUFDcUMsS0FBSyxDQUFDLFNBQVMsRUFBRW5DLGFBQWEsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==","map":{"version":3,"names":["mongoose","require","messageSchema","Schema","conversation","type","Types","ObjectId","ref","required","sender","content","String","attachments","url","public_id","enum","name","size","Number","readBy","user","readAt","Date","default","now","metadata","template","Boolean","templateId","autoResponse","status","timestamps","index","createdAt","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Message.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst messageSchema = new mongoose.Schema({\r\n    conversation: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'Conversation',\r\n        required: true\r\n    },\r\n    sender: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true\r\n    },\r\n    content: {\r\n        type: String,\r\n        required: true\r\n    },\r\n    attachments: [{\r\n        url: String,\r\n        public_id: String,\r\n        type: {\r\n            type: String,\r\n            enum: ['image', 'document']\r\n        },\r\n        name: String,\r\n        size: Number\r\n    }],\r\n    readBy: [{\r\n        user: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        readAt: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    }],\r\n    metadata: {\r\n        template: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n        templateId: String,\r\n        autoResponse: Boolean\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['sent', 'delivered', 'read', 'failed'],\r\n        default: 'sent'\r\n    }\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Create indexes\r\nmessageSchema.index({ conversation: 1, createdAt: -1 });\r\nmessageSchema.index({ sender: 1 });\r\nmessageSchema.index({ 'readBy.user': 1 });\r\n\r\nmodule.exports = mongoose.model('Message', messageSchema); "],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAU,CAAC;AAEpC,MAAMC,aAAa,GAAG,IAAIF,QAAQ,CAACG,MAAM,CAAC;EACtCC,YAAY,EAAE;IACVC,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,cAAc;IACnBC,QAAQ,EAAE;EACd,CAAC;EACDC,MAAM,EAAE;IACJL,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;IACpCC,GAAG,EAAE,MAAM;IACXC,QAAQ,EAAE;EACd,CAAC;EACDE,OAAO,EAAE;IACLN,IAAI,EAAEO,MAAM;IACZH,QAAQ,EAAE;EACd,CAAC;EACDI,WAAW,EAAE,CAAC;IACVC,GAAG,EAAEF,MAAM;IACXG,SAAS,EAAEH,MAAM;IACjBP,IAAI,EAAE;MACFA,IAAI,EAAEO,MAAM;MACZI,IAAI,EAAE,CAAC,OAAO,EAAE,UAAU;IAC9B,CAAC;IACDC,IAAI,EAAEL,MAAM;IACZM,IAAI,EAAEC;EACV,CAAC,CAAC;EACFC,MAAM,EAAE,CAAC;IACLC,IAAI,EAAE;MACFhB,IAAI,EAAEL,QAAQ,CAACG,MAAM,CAACG,KAAK,CAACC,QAAQ;MACpCC,GAAG,EAAE;IACT,CAAC;IACDc,MAAM,EAAE;MACJjB,IAAI,EAAEkB,IAAI;MACVC,OAAO,EAAED,IAAI,CAACE;IAClB;EACJ,CAAC,CAAC;EACFC,QAAQ,EAAE;IACNC,QAAQ,EAAE;MACNtB,IAAI,EAAEuB,OAAO;MACbJ,OAAO,EAAE;IACb,CAAC;IACDK,UAAU,EAAEjB,MAAM;IAClBkB,YAAY,EAAEF;EAClB,CAAC;EACDG,MAAM,EAAE;IACJ1B,IAAI,EAAEO,MAAM;IACZI,IAAI,EAAE,CAAC,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,QAAQ,CAAC;IAC7CQ,OAAO,EAAE;EACb;AACJ,CAAC,EAAE;EACCQ,UAAU,EAAE;AAChB,CAAC,CAAC;;AAEF;AACA9B,aAAa,CAAC+B,KAAK,CAAC;EAAE7B,YAAY,EAAE,CAAC;EAAE8B,SAAS,EAAE,CAAC;AAAE,CAAC,CAAC;AACvDhC,aAAa,CAAC+B,KAAK,CAAC;EAAEvB,MAAM,EAAE;AAAE,CAAC,CAAC;AAClCR,aAAa,CAAC+B,KAAK,CAAC;EAAE,aAAa,EAAE;AAAE,CAAC,CAAC;AAEzCE,MAAM,CAACC,OAAO,GAAGpC,QAAQ,CAACqC,KAAK,CAAC,SAAS,EAAEnC,aAAa,CAAC","ignoreList":[]}},"mtime":1734040621627},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Conversation.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst conversationSchema = new mongoose.Schema({\n  participants: [{\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User',\n      required: true\n    },\n    role: {\n      type: String,\n      enum: ['buyer', 'seller'],\n      required: true\n    },\n    lastRead: Date,\n    muted: {\n      type: Boolean,\n      default: false\n    }\n  }],\n  relatedEntity: {\n    type: {\n      type: String,\n      enum: ['horse', 'inquiry', 'transaction'],\n      required: true\n    },\n    id: {\n      type: mongoose.Schema.Types.ObjectId,\n      required: true,\n      refPath: 'relatedEntity.type'\n    }\n  },\n  status: {\n    type: String,\n    enum: ['active', 'archived', 'blocked'],\n    default: 'active'\n  },\n  lastMessage: {\n    content: String,\n    sender: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    timestamp: Date\n  },\n  metadata: {\n    blockedBy: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    blockedReason: String,\n    archivedAt: Date,\n    archivedBy: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    }\n  },\n  settings: {\n    autoResponder: {\n      enabled: {\n        type: Boolean,\n        default: false\n      },\n      message: String\n    },\n    notifications: {\n      enabled: {\n        type: Boolean,\n        default: true\n      },\n      schedule: {\n        start: String,\n        end: String,\n        timezone: String\n      }\n    }\n  }\n}, {\n  timestamps: true\n});\n\n// Create indexes\nconversationSchema.index({\n  'participants.user': 1\n});\nconversationSchema.index({\n  status: 1\n});\nconversationSchema.index({\n  'relatedEntity.type': 1,\n  'relatedEntity.id': 1\n});\nconversationSchema.index({\n  updatedAt: -1\n});\n\n// Methods\nconversationSchema.methods.isParticipant = function (userId) {\n  return this.participants.some(p => p.user.toString() === userId.toString());\n};\nconversationSchema.methods.getOtherParticipant = function (userId) {\n  return this.participants.find(p => p.user.toString() !== userId.toString());\n};\nconversationSchema.methods.updateLastMessage = function (message) {\n  this.lastMessage = {\n    content: message.content,\n    sender: message.sender,\n    timestamp: message.createdAt\n  };\n  return this.save();\n};\nmodule.exports = mongoose.model('Conversation', conversationSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJjb252ZXJzYXRpb25TY2hlbWEiLCJTY2hlbWEiLCJwYXJ0aWNpcGFudHMiLCJ1c2VyIiwidHlwZSIsIlR5cGVzIiwiT2JqZWN0SWQiLCJyZWYiLCJyZXF1aXJlZCIsInJvbGUiLCJTdHJpbmciLCJlbnVtIiwibGFzdFJlYWQiLCJEYXRlIiwibXV0ZWQiLCJCb29sZWFuIiwiZGVmYXVsdCIsInJlbGF0ZWRFbnRpdHkiLCJpZCIsInJlZlBhdGgiLCJzdGF0dXMiLCJsYXN0TWVzc2FnZSIsImNvbnRlbnQiLCJzZW5kZXIiLCJ0aW1lc3RhbXAiLCJtZXRhZGF0YSIsImJsb2NrZWRCeSIsImJsb2NrZWRSZWFzb24iLCJhcmNoaXZlZEF0IiwiYXJjaGl2ZWRCeSIsInNldHRpbmdzIiwiYXV0b1Jlc3BvbmRlciIsImVuYWJsZWQiLCJtZXNzYWdlIiwibm90aWZpY2F0aW9ucyIsInNjaGVkdWxlIiwic3RhcnQiLCJlbmQiLCJ0aW1lem9uZSIsInRpbWVzdGFtcHMiLCJpbmRleCIsInVwZGF0ZWRBdCIsIm1ldGhvZHMiLCJpc1BhcnRpY2lwYW50IiwidXNlcklkIiwic29tZSIsInAiLCJ0b1N0cmluZyIsImdldE90aGVyUGFydGljaXBhbnQiLCJmaW5kIiwidXBkYXRlTGFzdE1lc3NhZ2UiLCJjcmVhdGVkQXQiLCJzYXZlIiwibW9kdWxlIiwiZXhwb3J0cyIsIm1vZGVsIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxtb2RlbHNcXCIsInNvdXJjZXMiOlsiQ29udmVyc2F0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTtcclxuXHJcbmNvbnN0IGNvbnZlcnNhdGlvblNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xyXG4gICAgcGFydGljaXBhbnRzOiBbe1xyXG4gICAgICAgIHVzZXI6IHtcclxuICAgICAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcclxuICAgICAgICB9LFxyXG4gICAgICAgIHJvbGU6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICBlbnVtOiBbJ2J1eWVyJywgJ3NlbGxlciddLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGFzdFJlYWQ6IERhdGUsXHJcbiAgICAgICAgbXV0ZWQ6IHtcclxuICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgZGVmYXVsdDogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICB9XSxcclxuICAgIHJlbGF0ZWRFbnRpdHk6IHtcclxuICAgICAgICB0eXBlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgZW51bTogWydob3JzZScsICdpbnF1aXJ5JywgJ3RyYW5zYWN0aW9uJ10sXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpZDoge1xyXG4gICAgICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICByZWZQYXRoOiAncmVsYXRlZEVudGl0eS50eXBlJ1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzdGF0dXM6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZW51bTogWydhY3RpdmUnLCAnYXJjaGl2ZWQnLCAnYmxvY2tlZCddLFxyXG4gICAgICAgIGRlZmF1bHQ6ICdhY3RpdmUnXHJcbiAgICB9LFxyXG4gICAgbGFzdE1lc3NhZ2U6IHtcclxuICAgICAgICBjb250ZW50OiBTdHJpbmcsXHJcbiAgICAgICAgc2VuZGVyOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICAgICAgcmVmOiAnVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZVxyXG4gICAgfSxcclxuICAgIG1ldGFkYXRhOiB7XHJcbiAgICAgICAgYmxvY2tlZEJ5OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICAgICAgcmVmOiAnVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJsb2NrZWRSZWFzb246IFN0cmluZyxcclxuICAgICAgICBhcmNoaXZlZEF0OiBEYXRlLFxyXG4gICAgICAgIGFyY2hpdmVkQnk6IHtcclxuICAgICAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgICAgICByZWY6ICdVc2VyJ1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBzZXR0aW5nczoge1xyXG4gICAgICAgIGF1dG9SZXNwb25kZXI6IHtcclxuICAgICAgICAgICAgZW5hYmxlZDoge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogQm9vbGVhbixcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IFN0cmluZ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbm90aWZpY2F0aW9uczoge1xyXG4gICAgICAgICAgICBlbmFibGVkOiB7XHJcbiAgICAgICAgICAgICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogdHJ1ZVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzY2hlZHVsZToge1xyXG4gICAgICAgICAgICAgICAgc3RhcnQ6IFN0cmluZyxcclxuICAgICAgICAgICAgICAgIGVuZDogU3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgdGltZXpvbmU6IFN0cmluZ1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59LCB7XHJcbiAgICB0aW1lc3RhbXBzOiB0cnVlXHJcbn0pO1xyXG5cclxuLy8gQ3JlYXRlIGluZGV4ZXNcclxuY29udmVyc2F0aW9uU2NoZW1hLmluZGV4KHsgJ3BhcnRpY2lwYW50cy51c2VyJzogMSB9KTtcclxuY29udmVyc2F0aW9uU2NoZW1hLmluZGV4KHsgc3RhdHVzOiAxIH0pO1xyXG5jb252ZXJzYXRpb25TY2hlbWEuaW5kZXgoeyAncmVsYXRlZEVudGl0eS50eXBlJzogMSwgJ3JlbGF0ZWRFbnRpdHkuaWQnOiAxIH0pO1xyXG5jb252ZXJzYXRpb25TY2hlbWEuaW5kZXgoeyB1cGRhdGVkQXQ6IC0xIH0pO1xyXG5cclxuLy8gTWV0aG9kc1xyXG5jb252ZXJzYXRpb25TY2hlbWEubWV0aG9kcy5pc1BhcnRpY2lwYW50ID0gZnVuY3Rpb24odXNlcklkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYXJ0aWNpcGFudHMuc29tZShwID0+IHAudXNlci50b1N0cmluZygpID09PSB1c2VySWQudG9TdHJpbmcoKSk7XHJcbn07XHJcblxyXG5jb252ZXJzYXRpb25TY2hlbWEubWV0aG9kcy5nZXRPdGhlclBhcnRpY2lwYW50ID0gZnVuY3Rpb24odXNlcklkKSB7XHJcbiAgICByZXR1cm4gdGhpcy5wYXJ0aWNpcGFudHMuZmluZChwID0+IHAudXNlci50b1N0cmluZygpICE9PSB1c2VySWQudG9TdHJpbmcoKSk7XHJcbn07XHJcblxyXG5jb252ZXJzYXRpb25TY2hlbWEubWV0aG9kcy51cGRhdGVMYXN0TWVzc2FnZSA9IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcclxuICAgIHRoaXMubGFzdE1lc3NhZ2UgPSB7XHJcbiAgICAgICAgY29udGVudDogbWVzc2FnZS5jb250ZW50LFxyXG4gICAgICAgIHNlbmRlcjogbWVzc2FnZS5zZW5kZXIsXHJcbiAgICAgICAgdGltZXN0YW1wOiBtZXNzYWdlLmNyZWF0ZWRBdFxyXG4gICAgfTtcclxuICAgIHJldHVybiB0aGlzLnNhdmUoKTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ0NvbnZlcnNhdGlvbicsIGNvbnZlcnNhdGlvblNjaGVtYSk7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLGtCQUFrQixHQUFHLElBQUlGLFFBQVEsQ0FBQ0csTUFBTSxDQUFDO0VBQzNDQyxZQUFZLEVBQUUsQ0FBQztJQUNYQyxJQUFJLEVBQUU7TUFDRkMsSUFBSSxFQUFFTixRQUFRLENBQUNHLE1BQU0sQ0FBQ0ksS0FBSyxDQUFDQyxRQUFRO01BQ3BDQyxHQUFHLEVBQUUsTUFBTTtNQUNYQyxRQUFRLEVBQUU7SUFDZCxDQUFDO0lBQ0RDLElBQUksRUFBRTtNQUNGTCxJQUFJLEVBQUVNLE1BQU07TUFDWkMsSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQztNQUN6QkgsUUFBUSxFQUFFO0lBQ2QsQ0FBQztJQUNESSxRQUFRLEVBQUVDLElBQUk7SUFDZEMsS0FBSyxFQUFFO01BQ0hWLElBQUksRUFBRVcsT0FBTztNQUNiQyxPQUFPLEVBQUU7SUFDYjtFQUNKLENBQUMsQ0FBQztFQUNGQyxhQUFhLEVBQUU7SUFDWGIsSUFBSSxFQUFFO01BQ0ZBLElBQUksRUFBRU0sTUFBTTtNQUNaQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLGFBQWEsQ0FBQztNQUN6Q0gsUUFBUSxFQUFFO0lBQ2QsQ0FBQztJQUNEVSxFQUFFLEVBQUU7TUFDQWQsSUFBSSxFQUFFTixRQUFRLENBQUNHLE1BQU0sQ0FBQ0ksS0FBSyxDQUFDQyxRQUFRO01BQ3BDRSxRQUFRLEVBQUUsSUFBSTtNQUNkVyxPQUFPLEVBQUU7SUFDYjtFQUNKLENBQUM7RUFDREMsTUFBTSxF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","map":{"version":3,"names":["mongoose","require","conversationSchema","Schema","participants","user","type","Types","ObjectId","ref","required","role","String","enum","lastRead","Date","muted","Boolean","default","relatedEntity","id","refPath","status","lastMessage","content","sender","timestamp","metadata","blockedBy","blockedReason","archivedAt","archivedBy","settings","autoResponder","enabled","message","notifications","schedule","start","end","timezone","timestamps","index","updatedAt","methods","isParticipant","userId","some","p","toString","getOtherParticipant","find","updateLastMessage","createdAt","save","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Conversation.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst conversationSchema = new mongoose.Schema({\r\n    participants: [{\r\n        user: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User',\r\n            required: true\r\n        },\r\n        role: {\r\n            type: String,\r\n            enum: ['buyer', 'seller'],\r\n            required: true\r\n        },\r\n        lastRead: Date,\r\n        muted: {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    }],\r\n    relatedEntity: {\r\n        type: {\r\n            type: String,\r\n            enum: ['horse', 'inquiry', 'transaction'],\r\n            required: true\r\n        },\r\n        id: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            required: true,\r\n            refPath: 'relatedEntity.type'\r\n        }\r\n    },\r\n    status: {\r\n        type: String,\r\n        enum: ['active', 'archived', 'blocked'],\r\n        default: 'active'\r\n    },\r\n    lastMessage: {\r\n        content: String,\r\n        sender: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        timestamp: Date\r\n    },\r\n    metadata: {\r\n        blockedBy: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        blockedReason: String,\r\n        archivedAt: Date,\r\n        archivedBy: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        }\r\n    },\r\n    settings: {\r\n        autoResponder: {\r\n            enabled: {\r\n                type: Boolean,\r\n                default: false\r\n            },\r\n            message: String\r\n        },\r\n        notifications: {\r\n            enabled: {\r\n                type: Boolean,\r\n                default: true\r\n            },\r\n            schedule: {\r\n                start: String,\r\n                end: String,\r\n                timezone: String\r\n            }\r\n        }\r\n    }\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Create indexes\r\nconversationSchema.index({ 'participants.user': 1 });\r\nconversationSchema.index({ status: 1 });\r\nconversationSchema.index({ 'relatedEntity.type': 1, 'relatedEntity.id': 1 });\r\nconversationSchema.index({ updatedAt: -1 });\r\n\r\n// Methods\r\nconversationSchema.methods.isParticipant = function(userId) {\r\n    return this.participants.some(p => p.user.toString() === userId.toString());\r\n};\r\n\r\nconversationSchema.methods.getOtherParticipant = function(userId) {\r\n    return this.participants.find(p => p.user.toString() !== userId.toString());\r\n};\r\n\r\nconversationSchema.methods.updateLastMessage = function(message) {\r\n    this.lastMessage = {\r\n        content: message.content,\r\n        sender: message.sender,\r\n        timestamp: message.createdAt\r\n    };\r\n    return this.save();\r\n};\r\n\r\nmodule.exports = mongoose.model('Conversation', conversationSchema); "],"mappings":"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","ignoreList":[]}},"mtime":1734040644032},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\review.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect,\n  authorize\n} = require('../middlewares/auth.middleware');\nconst {\n  body\n} = require('express-validator');\nconst {\n  createReview,\n  getEntityReviews,\n  moderateReview,\n  voteReview,\n  reportReview\n} = require('../controllers/review.controller');\n\n// Validation middleware\nconst createReviewValidation = [body('entityType').isIn(['seller', 'horse', 'transaction']).withMessage('Valid entity type is required'), body('entityId').notEmpty().withMessage('Entity ID is required'), body('rating.overall').isInt({\n  min: 1,\n  max: 5\n}).withMessage('Overall rating must be between 1 and 5'), body('rating.aspects.*').optional().isInt({\n  min: 1,\n  max: 5\n}).withMessage('Aspect ratings must be between 1 and 5'), body('content.description').isLength({\n  min: 10,\n  max: 1000\n}).withMessage('Review description must be between 10 and 1000 characters'), body('content.pros').optional().isArray().withMessage('Pros must be an array'), body('content.cons').optional().isArray().withMessage('Cons must be an array'), body('media').optional().isArray().withMessage('Media must be an array')];\nconst moderationValidation = [body('status').isIn(['approved', 'rejected', 'reported']).withMessage('Valid status is required'), body('reason').notEmpty().withMessage('Moderation reason is required'), body('action').notEmpty().withMessage('Moderation action is required')];\nconst reportValidation = [body('reason').notEmpty().withMessage('Report reason is required'), body('details').optional().isString().withMessage('Report details must be a string')];\n\n// Public routes\nrouter.get('/:entityType/:entityId', getEntityReviews);\n\n// Protected routes\nrouter.use(protect);\n\n// Review creation\nrouter.post('/', createReviewValidation, createReview);\n\n// Review moderation (Admin only)\nrouter.put('/:reviewId/moderate', authorize('admin'), moderationValidation, moderateReview);\n\n// Review interaction\nrouter.post('/:reviewId/vote', voteReview);\nrouter.post('/:reviewId/report', reportValidation, reportReview);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJhdXRob3JpemUiLCJib2R5IiwiY3JlYXRlUmV2aWV3IiwiZ2V0RW50aXR5UmV2aWV3cyIsIm1vZGVyYXRlUmV2aWV3Iiwidm90ZVJldmlldyIsInJlcG9ydFJldmlldyIsImNyZWF0ZVJldmlld1ZhbGlkYXRpb24iLCJpc0luIiwid2l0aE1lc3NhZ2UiLCJub3RFbXB0eSIsImlzSW50IiwibWluIiwibWF4Iiwib3B0aW9uYWwiLCJpc0xlbmd0aCIsImlzQXJyYXkiLCJtb2RlcmF0aW9uVmFsaWRhdGlvbiIsInJlcG9ydFZhbGlkYXRpb24iLCJpc1N0cmluZyIsImdldCIsInVzZSIsInBvc3QiLCJwdXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJDOlxcVXNlcnNcXEpvZWwgUGV0ZXJcXERvY3VtZW50c1xcV29ya1xcZ2FsbG9waW5nIGdlYXJzXFxyb3V0ZXNcXCIsInNvdXJjZXMiOlsicmV2aWV3LnJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCB7IHByb3RlY3QsIGF1dGhvcml6ZSB9ID0gcmVxdWlyZSgnLi4vbWlkZGxld2FyZXMvYXV0aC5taWRkbGV3YXJlJyk7XHJcbmNvbnN0IHsgYm9keSB9ID0gcmVxdWlyZSgnZXhwcmVzcy12YWxpZGF0b3InKTtcclxuY29uc3Qge1xyXG4gICAgY3JlYXRlUmV2aWV3LFxyXG4gICAgZ2V0RW50aXR5UmV2aWV3cyxcclxuICAgIG1vZGVyYXRlUmV2aWV3LFxyXG4gICAgdm90ZVJldmlldyxcclxuICAgIHJlcG9ydFJldmlld1xyXG59ID0gcmVxdWlyZSgnLi4vY29udHJvbGxlcnMvcmV2aWV3LmNvbnRyb2xsZXInKTtcclxuXHJcbi8vIFZhbGlkYXRpb24gbWlkZGxld2FyZVxyXG5jb25zdCBjcmVhdGVSZXZpZXdWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnZW50aXR5VHlwZScpXHJcbiAgICAgICAgLmlzSW4oWydzZWxsZXInLCAnaG9yc2UnLCAndHJhbnNhY3Rpb24nXSlcclxuICAgICAgICAud2l0aE1lc3NhZ2UoJ1ZhbGlkIGVudGl0eSB0eXBlIGlzIHJlcXVpcmVkJyksXHJcbiAgICBib2R5KCdlbnRpdHlJZCcpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ0VudGl0eSBJRCBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgncmF0aW5nLm92ZXJhbGwnKVxyXG4gICAgICAgIC5pc0ludCh7IG1pbjogMSwgbWF4OiA1IH0pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdPdmVyYWxsIHJhdGluZyBtdXN0IGJlIGJldHdlZW4gMSBhbmQgNScpLFxyXG4gICAgYm9keSgncmF0aW5nLmFzcGVjdHMuKicpXHJcbiAgICAgICAgLm9wdGlvbmFsKClcclxuICAgICAgICAuaXNJbnQoeyBtaW46IDEsIG1heDogNSB9KVxyXG4gICAgICAgIC53aXRoTWVzc2FnZSgnQXNwZWN0IHJhdGluZ3MgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDUnKSxcclxuICAgIGJvZHkoJ2NvbnRlbnQuZGVzY3JpcHRpb24nKVxyXG4gICAgICAgIC5pc0xlbmd0aCh7IG1pbjogMTAsIG1heDogMTAwMCB9KVxyXG4gICAgICAgIC53aXRoTWVzc2FnZSgnUmV2aWV3IGRlc2NyaXB0aW9uIG11c3QgYmUgYmV0d2VlbiAxMCBhbmQgMTAwMCBjaGFyYWN0ZXJzJyksXHJcbiAgICBib2R5KCdjb250ZW50LnByb3MnKS5vcHRpb25hbCgpLmlzQXJyYXkoKS53aXRoTWVzc2FnZSgnUHJvcyBtdXN0IGJlIGFuIGFycmF5JyksXHJcbiAgICBib2R5KCdjb250ZW50LmNvbnMnKS5vcHRpb25hbCgpLmlzQXJyYXkoKS53aXRoTWVzc2FnZSgnQ29ucyBtdXN0IGJlIGFuIGFycmF5JyksXHJcbiAgICBib2R5KCdtZWRpYScpLm9wdGlvbmFsKCkuaXNBcnJheSgpLndpdGhNZXNzYWdlKCdNZWRpYSBtdXN0IGJlIGFuIGFycmF5JylcclxuXTtcclxuXHJcbmNvbnN0IG1vZGVyYXRpb25WYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgnc3RhdHVzJylcclxuICAgICAgICAuaXNJbihbJ2FwcHJvdmVkJywgJ3JlamVjdGVkJywgJ3JlcG9ydGVkJ10pXHJcbiAgICAgICAgLndpdGhNZXNzYWdlKCdWYWxpZCBzdGF0dXMgaXMgcmVxdWlyZWQnKSxcclxuICAgIGJvZHkoJ3JlYXNvbicpLm5vdEVtcHR5KCkud2l0aE1lc3NhZ2UoJ01vZGVyYXRpb24gcmVhc29uIGlzIHJlcXVpcmVkJyksXHJcbiAgICBib2R5KCdhY3Rpb24nKS5ub3RFbXB0eSgpLndpdGhNZXNzYWdlKCdNb2RlcmF0aW9uIGFjdGlvbiBpcyByZXF1aXJlZCcpXHJcbl07XHJcblxyXG5jb25zdCByZXBvcnRWYWxpZGF0aW9uID0gW1xyXG4gICAgYm9keSgncmVhc29uJykubm90RW1wdHkoKS53aXRoTWVzc2FnZSgnUmVwb3J0IHJlYXNvbiBpcyByZXF1aXJlZCcpLFxyXG4gICAgYm9keSgnZGV0YWlscycpLm9wdGlvbmFsKCkuaXNTdHJpbmcoKS53aXRoTWVzc2FnZSgnUmVwb3J0IGRldGFpbHMgbXVzdCBiZSBhIHN0cmluZycpXHJcbl07XHJcblxyXG4vLyBQdWJsaWMgcm91dGVzXHJcbnJvdXRlci5nZXQoJy86ZW50aXR5VHlwZS86ZW50aXR5SWQnLCBnZXRFbnRpdHlSZXZpZXdzKTtcclxuXHJcbi8vIFByb3RlY3RlZCByb3V0ZXNcclxucm91dGVyLnVzZShwcm90ZWN0KTtcclxuXHJcbi8vIFJldmlldyBjcmVhdGlvblxyXG5yb3V0ZXIucG9zdCgnLycsIGNyZWF0ZVJldmlld1ZhbGlkYXRpb24sIGNyZWF0ZVJldmlldyk7XHJcblxyXG4vLyBSZXZpZXcgbW9kZXJhdGlvbiAoQWRtaW4gb25seSlcclxucm91dGVyLnB1dCgnLzpyZXZpZXdJZC9tb2RlcmF0ZScsIGF1dGhvcml6ZSgnYWRtaW4nKSwgbW9kZXJhdGlvblZhbGlkYXRpb24sIG1vZGVyYXRlUmV2aWV3KTtcclxuXHJcbi8vIFJldmlldyBpbnRlcmFjdGlvblxyXG5yb3V0ZXIucG9zdCgnLzpyZXZpZXdJZC92b3RlJywgdm90ZVJldmlldyk7XHJcbnJvdXRlci5wb3N0KCcvOnJldmlld0lkL3JlcG9ydCcsIHJlcG9ydFZhbGlkYXRpb24sIHJlcG9ydFJldmlldyk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFTLENBQUM7QUFDbEMsTUFBTUMsTUFBTSxHQUFHRixPQUFPLENBQUNHLE1BQU0sQ0FBQyxDQUFDO0FBQy9CLE1BQU07RUFBRUMsT0FBTztFQUFFQztBQUFVLENBQUMsR0FBR0osT0FBTyxDQUFDLGdDQUFnQyxDQUFDO0FBQ3hFLE1BQU07RUFBRUs7QUFBSyxDQUFDLEdBQUdMLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztBQUM3QyxNQUFNO0VBQ0ZNLFlBQVk7RUFDWkMsZ0JBQWdCO0VBQ2hCQyxjQUFjO0VBQ2RDLFVBQVU7RUFDVkM7QUFDSixDQUFDLEdBQUdWLE9BQU8sQ0FBQyxrQ0FBa0MsQ0FBQzs7QUFFL0M7QUFDQSxNQUFNVyxzQkFBc0IsR0FBRyxDQUMzQk4sSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUNiTyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQ3hDQyxXQUFXLENBQUMsK0JBQStCLENBQUMsRUFDakRSLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQ1MsUUFBUSxDQUFDLENBQUMsQ0FBQ0QsV0FBVyxDQUFDLHVCQUF1QixDQUFDLEVBQ2hFUixJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FDakJVLEtBQUssQ0FBQztFQUFFQyxHQUFHLEVBQUUsQ0FBQztFQUFFQyxHQUFHLEVBQUU7QUFBRSxDQUFDLENBQUMsQ0FDekJKLFdB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","map":{"version":3,"names":["express","require","router","Router","protect","authorize","body","createReview","getEntityReviews","moderateReview","voteReview","reportReview","createReviewValidation","isIn","withMessage","notEmpty","isInt","min","max","optional","isLength","isArray","moderationValidation","reportValidation","isString","get","use","post","put","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["review.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect, authorize } = require('../middlewares/auth.middleware');\r\nconst { body } = require('express-validator');\r\nconst {\r\n    createReview,\r\n    getEntityReviews,\r\n    moderateReview,\r\n    voteReview,\r\n    reportReview\r\n} = require('../controllers/review.controller');\r\n\r\n// Validation middleware\r\nconst createReviewValidation = [\r\n    body('entityType')\r\n        .isIn(['seller', 'horse', 'transaction'])\r\n        .withMessage('Valid entity type is required'),\r\n    body('entityId').notEmpty().withMessage('Entity ID is required'),\r\n    body('rating.overall')\r\n        .isInt({ min: 1, max: 5 })\r\n        .withMessage('Overall rating must be between 1 and 5'),\r\n    body('rating.aspects.*')\r\n        .optional()\r\n        .isInt({ min: 1, max: 5 })\r\n        .withMessage('Aspect ratings must be between 1 and 5'),\r\n    body('content.description')\r\n        .isLength({ min: 10, max: 1000 })\r\n        .withMessage('Review description must be between 10 and 1000 characters'),\r\n    body('content.pros').optional().isArray().withMessage('Pros must be an array'),\r\n    body('content.cons').optional().isArray().withMessage('Cons must be an array'),\r\n    body('media').optional().isArray().withMessage('Media must be an array')\r\n];\r\n\r\nconst moderationValidation = [\r\n    body('status')\r\n        .isIn(['approved', 'rejected', 'reported'])\r\n        .withMessage('Valid status is required'),\r\n    body('reason').notEmpty().withMessage('Moderation reason is required'),\r\n    body('action').notEmpty().withMessage('Moderation action is required')\r\n];\r\n\r\nconst reportValidation = [\r\n    body('reason').notEmpty().withMessage('Report reason is required'),\r\n    body('details').optional().isString().withMessage('Report details must be a string')\r\n];\r\n\r\n// Public routes\r\nrouter.get('/:entityType/:entityId', getEntityReviews);\r\n\r\n// Protected routes\r\nrouter.use(protect);\r\n\r\n// Review creation\r\nrouter.post('/', createReviewValidation, createReview);\r\n\r\n// Review moderation (Admin only)\r\nrouter.put('/:reviewId/moderate', authorize('admin'), moderationValidation, moderateReview);\r\n\r\n// Review interaction\r\nrouter.post('/:reviewId/vote', voteReview);\r\nrouter.post('/:reviewId/report', reportValidation, reportReview);\r\n\r\nmodule.exports = router; "],"mappings":"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","ignoreList":[]}},"mtime":1734040946628},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\review.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Review = require('../models/Review');\nconst User = require('../models/User');\nconst ActivityLog = require('../models/ActivityLog');\n\n// @desc    Create review\n// @route   POST /api/reviews\n// @access  Private\nexports.createReview = async (req, res) => {\n  try {\n    const {\n      entityType,\n      entityId,\n      rating,\n      content,\n      media\n    } = req.body;\n\n    // Check if user has already reviewed\n    const existingReview = await Review.findOne({\n      reviewer: req.user._id,\n      entityType,\n      entityId\n    });\n    if (existingReview) {\n      return res.status(400).json({\n        success: false,\n        message: 'You have already reviewed this entity'\n      });\n    }\n\n    // Create review\n    const review = await Review.create({\n      reviewer: req.user._id,\n      entityType,\n      entityId,\n      rating,\n      content,\n      media: media || []\n    });\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'CREATE_REVIEW',\n      target: review._id,\n      targetModel: 'Review',\n      details: {\n        entityType,\n        entityId,\n        rating: rating.overall\n      }\n    });\n    res.status(201).json({\n      success: true,\n      review\n    });\n  } catch (error) {\n    console.error('Create review error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error creating review'\n    });\n  }\n};\n\n// @desc    Get reviews for entity\n// @route   GET /api/reviews/:entityType/:entityId\n// @access  Public\nexports.getEntityReviews = async (req, res) => {\n  try {\n    const {\n      entityType,\n      entityId\n    } = req.params;\n    const page = parseInt(req.query.page) || 1;\n    const limit = parseInt(req.query.limit) || 10;\n    const sort = req.query.sort || '-createdAt';\n    const filter = req.query.filter || 'all';\n    const query = {\n      entityType,\n      entityId,\n      status: 'approved'\n    };\n    if (filter === 'verified') {\n      query.verified = true;\n    } else if (filter === 'media') {\n      query['media.0'] = {\n        $exists: true\n      };\n    }\n    const reviews = await Review.find(query).sort(sort).skip((page - 1) * limit).limit(limit).populate('reviewer', 'name');\n    const total = await Review.countDocuments(query);\n\n    // Get average rating\n    const stats = await Review.getAverageRating(entityType, entityId);\n    res.json({\n      success: true,\n      data: {\n        reviews,\n        stats,\n        pagination: {\n          page,\n          pages: Math.ceil(total / limit),\n          total\n        }\n      }\n    });\n  } catch (error) {\n    console.error('Get reviews error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting reviews'\n    });\n  }\n};\n\n// @desc    Moderate review\n// @route   PUT /api/reviews/:reviewId/moderate\n// @access  Private (Admin)\nexports.moderateReview = async (req, res) => {\n  try {\n    const {\n      reviewId\n    } = req.params;\n    const {\n      status,\n      reason,\n      action\n    } = req.body;\n    const review = await Review.findById(reviewId);\n    if (!review) {\n      return res.status(404).json({\n        success: false,\n        message: 'Review not found'\n      });\n    }\n    review.status = status;\n    review.moderation = {\n      moderatedBy: req.user._id,\n      moderatedAt: new Date(),\n      reason,\n      action\n    };\n    await review.save();\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'MODERATE_REVIEW',\n      target: review._id,\n      targetModel: 'Review',\n      details: {\n        status,\n        reason\n      }\n    });\n    res.json({\n      success: true,\n      review\n    });\n  } catch (error) {\n    console.error('Moderate review error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error moderating review'\n    });\n  }\n};\n\n// @desc    Vote on review helpfulness\n// @route   POST /api/reviews/:reviewId/vote\n// @access  Private\nexports.voteReview = async (req, res) => {\n  try {\n    const {\n      reviewId\n    } = req.params;\n    const {\n      helpful\n    } = req.body;\n    const review = await Review.findById(reviewId);\n    if (!review) {\n      return res.status(404).json({\n        success: false,\n        message: 'Review not found'\n      });\n    }\n\n    // Check if user has already voted\n    const existingVote = review.helpfulVotes.find(vote => vote.user.toString() === req.user._id.toString());\n    if (existingVote) {\n      existingVote.helpful = helpful;\n    } else {\n      review.helpfulVotes.push({\n        user: req.user._id,\n        helpful\n      });\n    }\n    await review.save();\n    res.json({\n      success: true,\n      message: 'Vote recorded successfully'\n    });\n  } catch (error) {\n    console.error('Vote review error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error voting on review'\n    });\n  }\n};\n\n// @desc    Report review\n// @route   POST /api/reviews/:reviewId/report\n// @access  Private\nexports.reportReview = async (req, res) => {\n  try {\n    const {\n      reviewId\n    } = req.params;\n    const {\n      reason,\n      details\n    } = req.body;\n    const review = await Review.findById(reviewId);\n    if (!review) {\n      return res.status(404).json({\n        success: false,\n        message: 'Review not found'\n      });\n    }\n    review.status = 'reported';\n    review.moderation = {\n      moderatedBy: req.user._id,\n      moderatedAt: new Date(),\n      reason,\n      action: 'reported',\n      details\n    };\n    await review.save();\n\n    // Log activity\n    await ActivityLog.create({\n      user: req.user._id,\n      action: 'REPORT_REVIEW',\n      target: review._id,\n      targetModel: 'Review',\n      details: {\n        reason\n      }\n    });\n    res.json({\n      success: true,\n      message: 'Review reported successfully'\n    });\n  } catch (error) {\n    console.error('Report review error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error reporting review'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZXZpZXciLCJyZXF1aXJlIiwiVXNlciIsIkFjdGl2aXR5TG9nIiwiZXhwb3J0cyIsImNyZWF0ZVJldmlldyIsInJlcSIsInJlcyIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsInJhdGluZyIsImNvbnRlbnQiLCJtZWRpYSIsImJvZHkiLCJleGlzdGluZ1JldmlldyIsImZpbmRPbmUiLCJyZXZpZXdlciIsInVzZXIiLCJfaWQiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJyZXZpZXciLCJjcmVhdGUiLCJhY3Rpb24iLCJ0YXJnZXQiLCJ0YXJnZXRNb2RlbCIsImRldGFpbHMiLCJvdmVyYWxsIiwiZXJyb3IiLCJjb25zb2xlIiwiZ2V0RW50aXR5UmV2aWV3cyIsInBhcmFtcyIsInBhZ2UiLCJwYXJzZUludCIsInF1ZXJ5IiwibGltaXQiLCJzb3J0IiwiZmlsdGVyIiwidmVyaWZpZWQiLCIkZXhpc3RzIiwicmV2aWV3cyIsImZpbmQiLCJza2lwIiwicG9wdWxhdGUiLCJ0b3RhbCIsImNvdW50RG9jdW1lbnRzIiwic3RhdHMiLCJnZXRBdmVyYWdlUmF0aW5nIiwiZGF0YSIsInBhZ2luYXRpb24iLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwibW9kZXJhdGVSZXZpZXciLCJyZXZpZXdJZCIsInJlYXNvbiIsImZpbmRCeUlkIiwibW9kZXJhdGlvbiIsIm1vZGVyYXRlZEJ5IiwibW9kZXJhdGVkQXQiLCJEYXRlIiwic2F2ZSIsInZvdGVSZXZpZXciLCJoZWxwZnVsIiwiZXhpc3RpbmdWb3RlIiwiaGVscGZ1bFZvdGVzIiwidm90ZSIsInRvU3RyaW5nIiwicHVzaCIsInJlcG9ydFJldmlldyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xcY29udHJvbGxlcnNcXCIsInNvdXJjZXMiOlsicmV2aWV3LmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUmV2aWV3ID0gcmVxdWlyZSgnLi4vbW9kZWxzL1JldmlldycpO1xyXG5jb25zdCBVc2VyID0gcmVxdWlyZSgnLi4vbW9kZWxzL1VzZXInKTtcclxuY29uc3QgQWN0aXZpdHlMb2cgPSByZXF1aXJlKCcuLi9tb2RlbHMvQWN0aXZpdHlMb2cnKTtcclxuXHJcbi8vIEBkZXNjICAgIENyZWF0ZSByZXZpZXdcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3Jldmlld3NcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZVxyXG5leHBvcnRzLmNyZWF0ZVJldmlldyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7XHJcbiAgICAgICAgICAgIGVudGl0eVR5cGUsXHJcbiAgICAgICAgICAgIGVudGl0eUlkLFxyXG4gICAgICAgICAgICByYXRpbmcsXHJcbiAgICAgICAgICAgIGNvbnRlbnQsXHJcbiAgICAgICAgICAgIG1lZGlhXHJcbiAgICAgICAgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhbHJlYWR5IHJldmlld2VkXHJcbiAgICAgICAgY29uc3QgZXhpc3RpbmdSZXZpZXcgPSBhd2FpdCBSZXZpZXcuZmluZE9uZSh7XHJcbiAgICAgICAgICAgIHJldmlld2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIGVudGl0eVR5cGUsXHJcbiAgICAgICAgICAgIGVudGl0eUlkXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGlmIChleGlzdGluZ1Jldmlldykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnWW91IGhhdmUgYWxyZWFkeSByZXZpZXdlZCB0aGlzIGVudGl0eSdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDcmVhdGUgcmV2aWV3XHJcbiAgICAgICAgY29uc3QgcmV2aWV3ID0gYXdhaXQgUmV2aWV3LmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHJldmlld2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIGVudGl0eVR5cGUsXHJcbiAgICAgICAgICAgIGVudGl0eUlkLFxyXG4gICAgICAgICAgICByYXRpbmcsXHJcbiAgICAgICAgICAgIGNvbnRlbnQsXHJcbiAgICAgICAgICAgIG1lZGlhOiBtZWRpYSB8fCBbXVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBMb2cgYWN0aXZpdHlcclxuICAgICAgICBhd2FpdCBBY3Rpdml0eUxvZy5jcmVhdGUoe1xyXG4gICAgICAgICAgICB1c2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIGFjdGlvbjogJ0NSRUFURV9SRVZJRVcnLFxyXG4gICAgICAgICAgICB0YXJnZXQ6IHJldmlldy5faWQsXHJcbiAgICAgICAgICAgIHRhcmdldE1vZGVsOiAnUmV2aWV3JyxcclxuICAgICAgICAgICAgZGV0YWlsczoge1xyXG4gICAgICAgICAgICAgICAgZW50aXR5VHlwZSxcclxuICAgICAgICAgICAgICAgIGVudGl0eUlkLFxyXG4gICAgICAgICAgICAgICAgcmF0aW5nOiByYXRpbmcub3ZlcmFsbFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgcmV2aWV3XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdDcmVhdGUgcmV2aWV3IGVycm9yOicsIGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBjcmVhdGluZyByZXZpZXcnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgcmV2aWV3cyBmb3IgZW50aXR5XHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3Jldmlld3MvOmVudGl0eVR5cGUvOmVudGl0eUlkXHJcbi8vIEBhY2Nlc3MgIFB1YmxpY1xyXG5leHBvcnRzLmdldEVudGl0eVJldmlld3MgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBlbnRpdHlUeXBlLCBlbnRpdHlJZCB9ID0gcmVxLnBhcmFtcztcclxuICAgICAgICBjb25zdCBwYWdlID0gcGFyc2VJbnQocmVxLnF1ZXJ5LnBhZ2UpIHx8IDE7XHJcbiAgICAgICAgY29uc3QgbGltaXQgPSBwYXJzZUludChyZXEucXVlcnkubGltaXQpIHx8IDEwO1xyXG4gICAgICAgIGNvbnN0IHNvcnQgPSByZXEucXVlcnkuc29ydCB8fCAnLWNyZWF0ZWRBdCc7XHJcbiAgICAgICAgY29uc3QgZmlsdGVyID0gcmVxLnF1ZXJ5LmZpbHRlciB8fCAnYWxsJztcclxuXHJcbiAgICAgICAgY29uc3QgcXVlcnkgPSB7XHJcbiAgICAgICAgICAgIGVudGl0eVR5cGUsXHJcbiAgICAgICAgICAgIGVudGl0eUlkLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdhcHByb3ZlZCdcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBpZiAoZmlsdGVyID09PSAndmVyaWZpZWQnKSB7XHJcbiAgICAgICAgICAgIHF1ZXJ5LnZlcmlmaWVkID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYgKGZpbHRlciA9PT0gJ21lZGlhJykge1xyXG4gICAgICAgICAgICBxdWVyeVsnbWVkaWEuMCddID0geyAkZXhpc3RzOiB0cnVlIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCByZXZpZXdzID0gYXdhaXQgUmV2aWV3LmZpbmQocXVlcnkpXHJcbiAgICAgICAgICAgIC5zb3J0KHNvcnQpXHJcbiAgICAgICAgICAgIC5za2lwKChwYWdlIC0gMSkgKiBsaW1pdClcclxuICAgICAgICAgICAgLmxpbWl0KGxpbWl0KVxyXG4gICAgICAgICAgICAucG9wdWxhdGUoJ3Jldmlld2VyJywgJ25hbWUnKTtcclxuXHJcbiAgICAgICAgY29uc3QgdG90YWwgPSBhd2FpdCBSZXZpZXcuY291bnREb2N1bWVudHMocXVlcnkpO1xyXG5cclxuICAgICAgICAvLyBHZXQgYXZlcmFnZSByYXRpbmdcclxuICAgICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IFJldmlldy5nZXRBdmVyYWdlUmF0aW5nKGVudGl0eVR5cGUsIGVudGl0eUlkKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICByZXZpZXdzLFxyXG4gICAgICAgICAgICAgICAgc3RhdHMsXHJcbiAgICAgICAgICAgICAgICBwYWdpbmF0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFnZSxcclxuICAgICAgICAgICAgICAgICAgICBwYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0dldCByZXZpZXdzIGVycm9yOicsIGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBnZXR0aW5nIHJldmlld3MnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBNb2RlcmF0ZSByZXZpZXdcclxuLy8gQHJvdXRlICAgUFVUIC9hcGkvcmV2aWV3cy86cmV2aWV3SWQvbW9kZXJhdGVcclxuLy8gQGFjY2VzcyAgUHJpdmF0ZSAoQWRtaW4pXHJcbmV4cG9ydHMubW9kZXJhdGVSZXZpZXcgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyByZXZpZXdJZCB9ID0gcmVxLnBhcmFtcztcclxuICAgICAgICBjb25zdCB7IHN0YXR1cywgcmVhc29uLCBhY3Rpb24gfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICBjb25zdCByZXZpZXcgPSBhd2FpdCBSZXZpZXcuZmluZEJ5SWQocmV2aWV3SWQpO1xyXG4gICAgICAgIGlmICghcmV2aWV3KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdSZXZpZXcgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldmlldy5zdGF0dXMgPSBzdGF0dXM7XHJcbiAgICAgICAgcmV2aWV3Lm1vZGVyYXRpb24gPSB7XHJcbiAgICAgICAgICAgIG1vZGVyYXRlZEJ5OiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIG1vZGVyYXRlZEF0OiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgICAgICByZWFzb24sXHJcbiAgICAgICAgICAgIGFjdGlvblxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGF3YWl0IHJldmlldy5zYXZlKCk7XHJcblxyXG4gICAgICAgIC8vIExvZyBhY3Rpdml0eVxyXG4gICAgICAgIGF3YWl0IEFjdGl2aXR5TG9nLmNyZWF0ZSh7XHJcbiAgICAgICAgICAgIHVzZXI6IHJlcS51c2VyLl9pZCxcclxuICAgICAgICAgICAgYWN0aW9uOiAnTU9ERVJBVEVfUkVWSUVXJyxcclxuICAgICAgICAgICAgdGFyZ2V0OiByZXZpZXcuX2lkLFxyXG4gICAgICAgICAgICB0YXJnZXRNb2RlbDogJ1JldmlldycsXHJcbiAgICAgICAgICAgIGRldGFpbHM6IHsgc3RhdHVzLCByZWFzb24gfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHJldmlld1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignTW9kZXJhdGUgcmV2aWV3IGVycm9yOicsIGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBtb2RlcmF0aW5nIHJldmlldydcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIFZvdGUgb24gcmV2aWV3IGhlbHBmdWxuZXNzXHJcbi8vIEByb3V0ZSAgIFBPU1QgL2FwaS9yZXZpZXdzLzpyZXZpZXdJZC92b3RlXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy52b3RlUmV2aWV3ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgcmV2aWV3SWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICAgICAgY29uc3QgeyBoZWxwZnVsIH0gPSByZXEuYm9keTtcclxuXHJcbiAgICAgICAgY29uc3QgcmV2aWV3ID0gYXdhaXQgUmV2aWV3LmZpbmRCeUlkKHJldmlld0lkKTtcclxuICAgICAgICBpZiAoIXJldmlldykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnUmV2aWV3IG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhbHJlYWR5IHZvdGVkXHJcbiAgICAgICAgY29uc3QgZXhpc3RpbmdWb3RlID0gcmV2aWV3LmhlbHBmdWxWb3Rlcy5maW5kKFxyXG4gICAgICAgICAgICB2b3RlID0+IHZvdGUudXNlci50b1N0cmluZygpID09PSByZXEudXNlci5faWQudG9TdHJpbmcoKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGlmIChleGlzdGluZ1ZvdGUpIHtcclxuICAgICAgICAgICAgZXhpc3RpbmdWb3RlLmhlbHBmdWwgPSBoZWxwZnVsO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldmlldy5oZWxwZnVsVm90ZXMucHVzaCh7XHJcbiAgICAgICAgICAgICAgICB1c2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgICAgICBoZWxwZnVsXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgYXdhaXQgcmV2aWV3LnNhdmUoKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnVm90ZSByZWNvcmRlZCBzdWNjZXNzZnVsbHknXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdWb3RlIHJldmlldyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3Igdm90aW5nIG9uIHJldmlldydcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIFJlcG9ydCByZXZpZXdcclxuLy8gQHJvdXRlICAgUE9TVCAvYXBpL3Jldmlld3MvOnJldmlld0lkL3JlcG9ydFxyXG4vLyBAYWNjZXNzICBQcml2YXRlXHJcbmV4cG9ydHMucmVwb3J0UmV2aWV3ID0gYXN5bmMgKHJlcSwgcmVzKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHsgcmV2aWV3SWQgfSA9IHJlcS5wYXJhbXM7XHJcbiAgICAgICAgY29uc3QgeyByZWFzb24sIGRldGFpbHMgfSA9IHJlcS5ib2R5O1xyXG5cclxuICAgICAgICBjb25zdCByZXZpZXcgPSBhd2FpdCBSZXZpZXcuZmluZEJ5SWQocmV2aWV3SWQpO1xyXG4gICAgICAgIGlmICghcmV2aWV3KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdSZXZpZXcgbm90IGZvdW5kJ1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldmlldy5zdGF0dXMgPSAncmVwb3J0ZWQnO1xyXG4gICAgICAgIHJldmlldy5tb2RlcmF0aW9uID0ge1xyXG4gICAgICAgICAgICBtb2RlcmF0ZWRCeTogcmVxLnVzZXIuX2lkLFxyXG4gICAgICAgICAgICBtb2RlcmF0ZWRBdDogbmV3IERhdGUoKSxcclxuICAgICAgICAgICAgcmVhc29uLFxyXG4gICAgICAgICAgICBhY3Rpb246ICdyZXBvcnRlZCcsXHJcbiAgICAgICAgICAgIGRldGFpbHNcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhd2FpdCByZXZpZXcuc2F2ZSgpO1xyXG5cclxuICAgICAgICAvLyBMb2cgYWN0aXZpdHlcclxuICAgICAgICBhd2FpdCBBY3Rpdml0eUxvZy5jcmVhdGUoe1xyXG4gICAgICAgICAgICB1c2VyOiByZXEudXNlci5faWQsXHJcbiAgICAgICAgICAgIGFjdGlvbjogJ1JFUE9SVF9SRVZJRVcnLFxyXG4gICAgICAgICAgICB0YXJnZXQ6IHJldmlldy5faWQsXHJcbiAgICAgICAgICAgIHRhcmdldE1vZGVsOiAnUmV2aWV3JyxcclxuICAgICAgICAgICAgZGV0YWlsczogeyByZWFzb24gfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdSZXZpZXcgcmVwb3J0ZWQgc3VjY2Vzc2Z1bGx5J1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignUmVwb3J0IHJldmlldyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3IgcmVwb3J0aW5nIHJldmlldydcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTsgIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxNQUFNLEdBQUdDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQztBQUMxQyxNQUFNQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztBQUN0QyxNQUFNRSxXQUFXLEdBQUdGLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQzs7QUFFcEQ7QUFDQTtBQUNBO0FBQ0FHLE9BQU8sQ0FBQ0MsWUFBWSxHQUFHLE9BQU9DLEdBQUcsRUFBRUMsR0FBRyxLQUFLO0VBQ3ZDLElBQUk7SUFDQSxNQUFNO01BQ0ZDLFVBQVU7TUFDVkMsUUFBUTtNQUNSQyxNQUFNO01BQ05DLE9BQU87TUFDUEM7SUFD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","map":{"version":3,"names":["Review","require","User","ActivityLog","exports","createReview","req","res","entityType","entityId","rating","content","media","body","existingReview","findOne","reviewer","user","_id","status","json","success","message","review","create","action","target","targetModel","details","overall","error","console","getEntityReviews","params","page","parseInt","query","limit","sort","filter","verified","$exists","reviews","find","skip","populate","total","countDocuments","stats","getAverageRating","data","pagination","pages","Math","ceil","moderateReview","reviewId","reason","findById","moderation","moderatedBy","moderatedAt","Date","save","voteReview","helpful","existingVote","helpfulVotes","vote","toString","push","reportReview"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["review.controller.js"],"sourcesContent":["const Review = require('../models/Review');\r\nconst User = require('../models/User');\r\nconst ActivityLog = require('../models/ActivityLog');\r\n\r\n// @desc    Create review\r\n// @route   POST /api/reviews\r\n// @access  Private\r\nexports.createReview = async (req, res) => {\r\n    try {\r\n        const {\r\n            entityType,\r\n            entityId,\r\n            rating,\r\n            content,\r\n            media\r\n        } = req.body;\r\n\r\n        // Check if user has already reviewed\r\n        const existingReview = await Review.findOne({\r\n            reviewer: req.user._id,\r\n            entityType,\r\n            entityId\r\n        });\r\n\r\n        if (existingReview) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: 'You have already reviewed this entity'\r\n            });\r\n        }\r\n\r\n        // Create review\r\n        const review = await Review.create({\r\n            reviewer: req.user._id,\r\n            entityType,\r\n            entityId,\r\n            rating,\r\n            content,\r\n            media: media || []\r\n        });\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'CREATE_REVIEW',\r\n            target: review._id,\r\n            targetModel: 'Review',\r\n            details: {\r\n                entityType,\r\n                entityId,\r\n                rating: rating.overall\r\n            }\r\n        });\r\n\r\n        res.status(201).json({\r\n            success: true,\r\n            review\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Create review error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error creating review'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get reviews for entity\r\n// @route   GET /api/reviews/:entityType/:entityId\r\n// @access  Public\r\nexports.getEntityReviews = async (req, res) => {\r\n    try {\r\n        const { entityType, entityId } = req.params;\r\n        const page = parseInt(req.query.page) || 1;\r\n        const limit = parseInt(req.query.limit) || 10;\r\n        const sort = req.query.sort || '-createdAt';\r\n        const filter = req.query.filter || 'all';\r\n\r\n        const query = {\r\n            entityType,\r\n            entityId,\r\n            status: 'approved'\r\n        };\r\n\r\n        if (filter === 'verified') {\r\n            query.verified = true;\r\n        } else if (filter === 'media') {\r\n            query['media.0'] = { $exists: true };\r\n        }\r\n\r\n        const reviews = await Review.find(query)\r\n            .sort(sort)\r\n            .skip((page - 1) * limit)\r\n            .limit(limit)\r\n            .populate('reviewer', 'name');\r\n\r\n        const total = await Review.countDocuments(query);\r\n\r\n        // Get average rating\r\n        const stats = await Review.getAverageRating(entityType, entityId);\r\n\r\n        res.json({\r\n            success: true,\r\n            data: {\r\n                reviews,\r\n                stats,\r\n                pagination: {\r\n                    page,\r\n                    pages: Math.ceil(total / limit),\r\n                    total\r\n                }\r\n            }\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Get reviews error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting reviews'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Moderate review\r\n// @route   PUT /api/reviews/:reviewId/moderate\r\n// @access  Private (Admin)\r\nexports.moderateReview = async (req, res) => {\r\n    try {\r\n        const { reviewId } = req.params;\r\n        const { status, reason, action } = req.body;\r\n\r\n        const review = await Review.findById(reviewId);\r\n        if (!review) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Review not found'\r\n            });\r\n        }\r\n\r\n        review.status = status;\r\n        review.moderation = {\r\n            moderatedBy: req.user._id,\r\n            moderatedAt: new Date(),\r\n            reason,\r\n            action\r\n        };\r\n\r\n        await review.save();\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'MODERATE_REVIEW',\r\n            target: review._id,\r\n            targetModel: 'Review',\r\n            details: { status, reason }\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            review\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Moderate review error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error moderating review'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Vote on review helpfulness\r\n// @route   POST /api/reviews/:reviewId/vote\r\n// @access  Private\r\nexports.voteReview = async (req, res) => {\r\n    try {\r\n        const { reviewId } = req.params;\r\n        const { helpful } = req.body;\r\n\r\n        const review = await Review.findById(reviewId);\r\n        if (!review) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Review not found'\r\n            });\r\n        }\r\n\r\n        // Check if user has already voted\r\n        const existingVote = review.helpfulVotes.find(\r\n            vote => vote.user.toString() === req.user._id.toString()\r\n        );\r\n\r\n        if (existingVote) {\r\n            existingVote.helpful = helpful;\r\n        } else {\r\n            review.helpfulVotes.push({\r\n                user: req.user._id,\r\n                helpful\r\n            });\r\n        }\r\n\r\n        await review.save();\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'Vote recorded successfully'\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Vote review error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error voting on review'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Report review\r\n// @route   POST /api/reviews/:reviewId/report\r\n// @access  Private\r\nexports.reportReview = async (req, res) => {\r\n    try {\r\n        const { reviewId } = req.params;\r\n        const { reason, details } = req.body;\r\n\r\n        const review = await Review.findById(reviewId);\r\n        if (!review) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Review not found'\r\n            });\r\n        }\r\n\r\n        review.status = 'reported';\r\n        review.moderation = {\r\n            moderatedBy: req.user._id,\r\n            moderatedAt: new Date(),\r\n            reason,\r\n            action: 'reported',\r\n            details\r\n        };\r\n\r\n        await review.save();\r\n\r\n        // Log activity\r\n        await ActivityLog.create({\r\n            user: req.user._id,\r\n            action: 'REPORT_REVIEW',\r\n            target: review._id,\r\n            targetModel: 'Review',\r\n            details: { reason }\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            message: 'Review reported successfully'\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Report review error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error reporting review'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734040926001},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\models\\\\Review.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const mongoose = require('mongoose');\nconst reviewSchema = new mongoose.Schema({\n  reviewer: {\n    type: mongoose.Schema.Types.ObjectId,\n    ref: 'User',\n    required: true\n  },\n  entityType: {\n    type: String,\n    enum: ['seller', 'horse', 'transaction'],\n    required: true\n  },\n  entityId: {\n    type: mongoose.Schema.Types.ObjectId,\n    required: true,\n    refPath: 'entityType'\n  },\n  rating: {\n    overall: {\n      type: Number,\n      required: true,\n      min: 1,\n      max: 5\n    },\n    aspects: {\n      communication: {\n        type: Number,\n        min: 1,\n        max: 5\n      },\n      accuracy: {\n        type: Number,\n        min: 1,\n        max: 5\n      },\n      value: {\n        type: Number,\n        min: 1,\n        max: 5\n      },\n      experience: {\n        type: Number,\n        min: 1,\n        max: 5\n      }\n    }\n  },\n  content: {\n    title: String,\n    description: {\n      type: String,\n      required: true,\n      minlength: 10,\n      maxlength: 1000\n    },\n    pros: [String],\n    cons: [String]\n  },\n  media: [{\n    url: String,\n    public_id: String,\n    type: {\n      type: String,\n      enum: ['image', 'video']\n    }\n  }],\n  status: {\n    type: String,\n    enum: ['pending', 'approved', 'rejected', 'reported'],\n    default: 'pending'\n  },\n  moderation: {\n    moderatedBy: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    moderatedAt: Date,\n    reason: String,\n    action: String\n  },\n  helpfulVotes: [{\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'User'\n    },\n    helpful: Boolean,\n    votedAt: {\n      type: Date,\n      default: Date.now\n    }\n  }],\n  verified: {\n    type: Boolean,\n    default: false\n  },\n  verificationDetails: {\n    transactionId: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: 'Transaction'\n    },\n    purchaseDate: Date,\n    verifiedAt: Date\n  }\n}, {\n  timestamps: true\n});\n\n// Create indexes\nreviewSchema.index({\n  entityType: 1,\n  entityId: 1\n});\nreviewSchema.index({\n  reviewer: 1\n});\nreviewSchema.index({\n  status: 1\n});\nreviewSchema.index({\n  'rating.overall': -1\n});\nreviewSchema.index({\n  createdAt: -1\n});\n\n// Static methods\nreviewSchema.statics.getAverageRating = async function (entityType, entityId) {\n  const aggregation = await this.aggregate([{\n    $match: {\n      entityType,\n      entityId,\n      status: 'approved'\n    }\n  }, {\n    $group: {\n      _id: null,\n      averageRating: {\n        $avg: '$rating.overall'\n      },\n      totalReviews: {\n        $sum: 1\n      },\n      aspects: {\n        $avg: {\n          communication: '$rating.aspects.communication',\n          accuracy: '$rating.aspects.accuracy',\n          value: '$rating.aspects.value',\n          experience: '$rating.aspects.experience'\n        }\n      }\n    }\n  }]);\n  return aggregation[0] || {\n    averageRating: 0,\n    totalReviews: 0,\n    aspects: {\n      communication: 0,\n      accuracy: 0,\n      value: 0,\n      experience: 0\n    }\n  };\n};\n\n// Methods\nreviewSchema.methods.isHelpful = function () {\n  const helpfulCount = this.helpfulVotes.filter(vote => vote.helpful).length;\n  const totalVotes = this.helpfulVotes.length;\n  return totalVotes > 0 ? helpfulCount / totalVotes > 0.5 : false;\n};\nmodule.exports = mongoose.model('Review', reviewSchema);\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtb25nb29zZSIsInJlcXVpcmUiLCJyZXZpZXdTY2hlbWEiLCJTY2hlbWEiLCJyZXZpZXdlciIsInR5cGUiLCJUeXBlcyIsIk9iamVjdElkIiwicmVmIiwicmVxdWlyZWQiLCJlbnRpdHlUeXBlIiwiU3RyaW5nIiwiZW51bSIsImVudGl0eUlkIiwicmVmUGF0aCIsInJhdGluZyIsIm92ZXJhbGwiLCJOdW1iZXIiLCJtaW4iLCJtYXgiLCJhc3BlY3RzIiwiY29tbXVuaWNhdGlvbiIsImFjY3VyYWN5IiwidmFsdWUiLCJleHBlcmllbmNlIiwiY29udGVudCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJtaW5sZW5ndGgiLCJtYXhsZW5ndGgiLCJwcm9zIiwiY29ucyIsIm1lZGlhIiwidXJsIiwicHVibGljX2lkIiwic3RhdHVzIiwiZGVmYXVsdCIsIm1vZGVyYXRpb24iLCJtb2RlcmF0ZWRCeSIsIm1vZGVyYXRlZEF0IiwiRGF0ZSIsInJlYXNvbiIsImFjdGlvbiIsImhlbHBmdWxWb3RlcyIsInVzZXIiLCJoZWxwZnVsIiwiQm9vbGVhbiIsInZvdGVkQXQiLCJub3ciLCJ2ZXJpZmllZCIsInZlcmlmaWNhdGlvbkRldGFpbHMiLCJ0cmFuc2FjdGlvbklkIiwicHVyY2hhc2VEYXRlIiwidmVyaWZpZWRBdCIsInRpbWVzdGFtcHMiLCJpbmRleCIsImNyZWF0ZWRBdCIsInN0YXRpY3MiLCJnZXRBdmVyYWdlUmF0aW5nIiwiYWdncmVnYXRpb24iLCJhZ2dyZWdhdGUiLCIkbWF0Y2giLCIkZ3JvdXAiLCJfaWQiLCJhdmVyYWdlUmF0aW5nIiwiJGF2ZyIsInRvdGFsUmV2aWV3cyIsIiRzdW0iLCJtZXRob2RzIiwiaXNIZWxwZnVsIiwiaGVscGZ1bENvdW50IiwiZmlsdGVyIiwidm90ZSIsImxlbmd0aCIsInRvdGFsVm90ZXMiLCJtb2R1bGUiLCJleHBvcnRzIiwibW9kZWwiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXG1vZGVsc1xcIiwic291cmNlcyI6WyJSZXZpZXcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgbW9uZ29vc2UgPSByZXF1aXJlKCdtb25nb29zZScpO1xyXG5cclxuY29uc3QgcmV2aWV3U2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XHJcbiAgICByZXZpZXdlcjoge1xyXG4gICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICByZWY6ICdVc2VyJyxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGVudGl0eVR5cGU6IHtcclxuICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgZW51bTogWydzZWxsZXInLCAnaG9yc2UnLCAndHJhbnNhY3Rpb24nXSxcclxuICAgICAgICByZXF1aXJlZDogdHJ1ZVxyXG4gICAgfSxcclxuICAgIGVudGl0eUlkOiB7XHJcbiAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgIHJlZlBhdGg6ICdlbnRpdHlUeXBlJ1xyXG4gICAgfSxcclxuICAgIHJhdGluZzoge1xyXG4gICAgICAgIG92ZXJhbGw6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcclxuICAgICAgICAgICAgbWluOiAxLFxyXG4gICAgICAgICAgICBtYXg6IDVcclxuICAgICAgICB9LFxyXG4gICAgICAgIGFzcGVjdHM6IHtcclxuICAgICAgICAgICAgY29tbXVuaWNhdGlvbjogeyB0eXBlOiBOdW1iZXIsIG1pbjogMSwgbWF4OiA1IH0sXHJcbiAgICAgICAgICAgIGFjY3VyYWN5OiB7IHR5cGU6IE51bWJlciwgbWluOiAxLCBtYXg6IDUgfSxcclxuICAgICAgICAgICAgdmFsdWU6IHsgdHlwZTogTnVtYmVyLCBtaW46IDEsIG1heDogNSB9LFxyXG4gICAgICAgICAgICBleHBlcmllbmNlOiB7IHR5cGU6IE51bWJlciwgbWluOiAxLCBtYXg6IDUgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjb250ZW50OiB7XHJcbiAgICAgICAgdGl0bGU6IFN0cmluZyxcclxuICAgICAgICBkZXNjcmlwdGlvbjoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxyXG4gICAgICAgICAgICBtaW5sZW5ndGg6IDEwLFxyXG4gICAgICAgICAgICBtYXhsZW5ndGg6IDEwMDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByb3M6IFtTdHJpbmddLFxyXG4gICAgICAgIGNvbnM6IFtTdHJpbmddXHJcbiAgICB9LFxyXG4gICAgbWVkaWE6IFt7XHJcbiAgICAgICAgdXJsOiBTdHJpbmcsXHJcbiAgICAgICAgcHVibGljX2lkOiBTdHJpbmcsXHJcbiAgICAgICAgdHlwZToge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIGVudW06IFsnaW1hZ2UnLCAndmlkZW8nXVxyXG4gICAgICAgIH1cclxuICAgIH1dLFxyXG4gICAgc3RhdHVzOiB7XHJcbiAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgIGVudW06IFsncGVuZGluZycsICdhcHByb3ZlZCcsICdyZWplY3RlZCcsICdyZXBvcnRlZCddLFxyXG4gICAgICAgIGRlZmF1bHQ6ICdwZW5kaW5nJ1xyXG4gICAgfSxcclxuICAgIG1vZGVyYXRpb246IHtcclxuICAgICAgICBtb2RlcmF0ZWRCeToge1xyXG4gICAgICAgICAgICB0eXBlOiBtb25nb29zZS5TY2hlbWEuVHlwZXMuT2JqZWN0SWQsXHJcbiAgICAgICAgICAgIHJlZjogJ1VzZXInXHJcbiAgICAgICAgfSxcclxuICAgICAgICBtb2RlcmF0ZWRBdDogRGF0ZSxcclxuICAgICAgICByZWFzb246IFN0cmluZyxcclxuICAgICAgICBhY3Rpb246IFN0cmluZ1xyXG4gICAgfSxcclxuICAgIGhlbHBmdWxWb3RlczogW3tcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IG1vbmdvb3NlLlNjaGVtYS5UeXBlcy5PYmplY3RJZCxcclxuICAgICAgICAgICAgcmVmOiAnVXNlcidcclxuICAgICAgICB9LFxyXG4gICAgICAgIGhlbHBmdWw6IEJvb2xlYW4sXHJcbiAgICAgICAgdm90ZWRBdDoge1xyXG4gICAgICAgICAgICB0eXBlOiBEYXRlLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiBEYXRlLm5vd1xyXG4gICAgICAgIH1cclxuICAgIH1dLFxyXG4gICAgdmVyaWZpZWQ6IHtcclxuICAgICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICAgIGRlZmF1bHQ6IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgdmVyaWZpY2F0aW9uRGV0YWlsczoge1xyXG4gICAgICAgIHRyYW5zYWN0aW9uSWQ6IHtcclxuICAgICAgICAgICAgdHlwZTogbW9uZ29vc2UuU2NoZW1hLlR5cGVzLk9iamVjdElkLFxyXG4gICAgICAgICAgICByZWY6ICdUcmFuc2FjdGlvbidcclxuICAgICAgICB9LFxyXG4gICAgICAgIHB1cmNoYXNlRGF0ZTogRGF0ZSxcclxuICAgICAgICB2ZXJpZmllZEF0OiBEYXRlXHJcbiAgICB9XHJcbn0sIHtcclxuICAgIHRpbWVzdGFtcHM6IHRydWVcclxufSk7XHJcblxyXG4vLyBDcmVhdGUgaW5kZXhlc1xyXG5yZXZpZXdTY2hlbWEuaW5kZXgoeyBlbnRpdHlUeXBlOiAxLCBlbnRpdHlJZDogMSB9KTtcclxucmV2aWV3U2NoZW1hLmluZGV4KHsgcmV2aWV3ZXI6IDEgfSk7XHJcbnJldmlld1NjaGVtYS5pbmRleCh7IHN0YXR1czogMSB9KTtcclxucmV2aWV3U2NoZW1hLmluZGV4KHsgJ3JhdGluZy5vdmVyYWxsJzogLTEgfSk7XHJcbnJldmlld1NjaGVtYS5pbmRleCh7IGNyZWF0ZWRBdDogLTEgfSk7XHJcblxyXG4vLyBTdGF0aWMgbWV0aG9kc1xyXG5yZXZpZXdTY2hlbWEuc3RhdGljcy5nZXRBdmVyYWdlUmF0aW5nID0gYXN5bmMgZnVuY3Rpb24oZW50aXR5VHlwZSwgZW50aXR5SWQpIHtcclxuICAgIGNvbnN0IGFnZ3JlZ2F0aW9uID0gYXdhaXQgdGhpcy5hZ2dyZWdhdGUoW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJG1hdGNoOiB7XHJcbiAgICAgICAgICAgICAgICBlbnRpdHlUeXBlLFxyXG4gICAgICAgICAgICAgICAgZW50aXR5SWQsXHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdhcHByb3ZlZCdcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICAkZ3JvdXA6IHtcclxuICAgICAgICAgICAgICAgIF9pZDogbnVsbCxcclxuICAgICAgICAgICAgICAgIGF2ZXJhZ2VSYXRpbmc6IHsgJGF2ZzogJyRyYXRpbmcub3ZlcmFsbCcgfSxcclxuICAgICAgICAgICAgICAgIHRvdGFsUmV2aWV3czogeyAkc3VtOiAxIH0sXHJcbiAgICAgICAgICAgICAgICBhc3BlY3RzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGF2Zzoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tdW5pY2F0aW9uOiAnJHJhdGluZy5hc3BlY3RzLmNvbW11bmljYXRpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhY2N1cmFjeTogJyRyYXRpbmcuYXNwZWN0cy5hY2N1cmFjeScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJHJhdGluZy5hc3BlY3RzLnZhbHVlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwZXJpZW5jZTogJyRyYXRpbmcuYXNwZWN0cy5leHBlcmllbmNlJ1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIF0pO1xyXG5cclxuICAgIHJldHVybiBhZ2dyZWdhdGlvblswXSB8fCB7XHJcbiAgICAgICAgYXZlcmFnZVJhdGluZzogMCxcclxuICAgICAgICB0b3RhbFJldmlld3M6IDAsXHJcbiAgICAgICAgYXNwZWN0czoge1xyXG4gICAgICAgICAgICBjb21tdW5pY2F0aW9uOiAwLFxyXG4gICAgICAgICAgICBhY2N1cmFjeTogMCxcclxuICAgICAgICAgICAgdmFsdWU6IDAsXHJcbiAgICAgICAgICAgIGV4cGVyaWVuY2U6IDBcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59O1xyXG5cclxuLy8gTWV0aG9kc1xyXG5yZXZpZXdTY2hlbWEubWV0aG9kcy5pc0hlbHBmdWwgPSBmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IGhlbHBmdWxDb3VudCA9IHRoaXMuaGVscGZ1bFZvdGVzLmZpbHRlcih2b3RlID0+IHZvdGUuaGVscGZ1bCkubGVuZ3RoO1xyXG4gICAgY29uc3QgdG90YWxWb3RlcyA9IHRoaXMuaGVscGZ1bFZvdGVzLmxlbmd0aDtcclxuICAgIHJldHVybiB0b3RhbFZvdGVzID4gMCA/IGhlbHBmdWxDb3VudCAvIHRvdGFsVm90ZXMgPiAwLjUgOiBmYWxzZTtcclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gbW9uZ29vc2UubW9kZWwoJ1JldmlldycsIHJldmlld1NjaGVtYSk7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsUUFBUSxHQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBRXBDLE1BQU1DLFlBQVksR0FBRyxJQUFJRixRQUFRLENBQUNHLE1BQU0sQ0FBQztFQUNyQ0MsUUFBUSxFQUFFO0lBQ05DLElBQUksRUFBRUwsUUFBUSxDQUFDRyxNQUFNLENBQUNHLEtBQUssQ0FBQ0MsUUFBUTtJQUNwQ0MsR0FBRyxFQUFFLE1BQU07SUFDWEMsUUFBUSxFQUFFO0VBQ2QsQ0FBQztFQUNEQyxVQUFVLEVBQUU7SUFDUkwsSUFBSSxFQUFFTSxNQUFNO0lBQ1pDLElBQUksRUFB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","map":{"version":3,"names":["mongoose","require","reviewSchema","Schema","reviewer","type","Types","ObjectId","ref","required","entityType","String","enum","entityId","refPath","rating","overall","Number","min","max","aspects","communication","accuracy","value","experience","content","title","description","minlength","maxlength","pros","cons","media","url","public_id","status","default","moderation","moderatedBy","moderatedAt","Date","reason","action","helpfulVotes","user","helpful","Boolean","votedAt","now","verified","verificationDetails","transactionId","purchaseDate","verifiedAt","timestamps","index","createdAt","statics","getAverageRating","aggregation","aggregate","$match","$group","_id","averageRating","$avg","totalReviews","$sum","methods","isHelpful","helpfulCount","filter","vote","length","totalVotes","module","exports","model"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\models\\","sources":["Review.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst reviewSchema = new mongoose.Schema({\r\n    reviewer: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: 'User',\r\n        required: true\r\n    },\r\n    entityType: {\r\n        type: String,\r\n        enum: ['seller', 'horse', 'transaction'],\r\n        required: true\r\n    },\r\n    entityId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        required: true,\r\n        refPath: 'entityType'\r\n    },\r\n    rating: {\r\n        overall: {\r\n            type: Number,\r\n            required: true,\r\n            min: 1,\r\n            max: 5\r\n        },\r\n        aspects: {\r\n            communication: { type: Number, min: 1, max: 5 },\r\n            accuracy: { type: Number, min: 1, max: 5 },\r\n            value: { type: Number, min: 1, max: 5 },\r\n            experience: { type: Number, min: 1, max: 5 }\r\n        }\r\n    },\r\n    content: {\r\n        title: String,\r\n        description: {\r\n            type: String,\r\n            required: true,\r\n            minlength: 10,\r\n            maxlength: 1000\r\n        },\r\n        pros: [String],\r\n        cons: [String]\r\n    },\r\n    media: [{\r\n        url: String,\r\n        public_id: String,\r\n        type: {\r\n            type: String,\r\n            enum: ['image', 'video']\r\n        }\r\n    }],\r\n    status: {\r\n        type: String,\r\n        enum: ['pending', 'approved', 'rejected', 'reported'],\r\n        default: 'pending'\r\n    },\r\n    moderation: {\r\n        moderatedBy: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        moderatedAt: Date,\r\n        reason: String,\r\n        action: String\r\n    },\r\n    helpfulVotes: [{\r\n        user: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'User'\r\n        },\r\n        helpful: Boolean,\r\n        votedAt: {\r\n            type: Date,\r\n            default: Date.now\r\n        }\r\n    }],\r\n    verified: {\r\n        type: Boolean,\r\n        default: false\r\n    },\r\n    verificationDetails: {\r\n        transactionId: {\r\n            type: mongoose.Schema.Types.ObjectId,\r\n            ref: 'Transaction'\r\n        },\r\n        purchaseDate: Date,\r\n        verifiedAt: Date\r\n    }\r\n}, {\r\n    timestamps: true\r\n});\r\n\r\n// Create indexes\r\nreviewSchema.index({ entityType: 1, entityId: 1 });\r\nreviewSchema.index({ reviewer: 1 });\r\nreviewSchema.index({ status: 1 });\r\nreviewSchema.index({ 'rating.overall': -1 });\r\nreviewSchema.index({ createdAt: -1 });\r\n\r\n// Static methods\r\nreviewSchema.statics.getAverageRating = async function(entityType, entityId) {\r\n    const aggregation = await this.aggregate([\r\n        {\r\n            $match: {\r\n                entityType,\r\n                entityId,\r\n                status: 'approved'\r\n            }\r\n        },\r\n        {\r\n            $group: {\r\n                _id: null,\r\n                averageRating: { $avg: '$rating.overall' },\r\n                totalReviews: { $sum: 1 },\r\n                aspects: {\r\n                    $avg: {\r\n                        communication: '$rating.aspects.communication',\r\n                        accuracy: '$rating.aspects.accuracy',\r\n                        value: '$rating.aspects.value',\r\n                        experience: '$rating.aspects.experience'\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    ]);\r\n\r\n    return aggregation[0] || {\r\n        averageRating: 0,\r\n        totalReviews: 0,\r\n        aspects: {\r\n            communication: 0,\r\n            accuracy: 0,\r\n            value: 0,\r\n            experience: 0\r\n        }\r\n    };\r\n};\r\n\r\n// Methods\r\nreviewSchema.methods.isHelpful = function() {\r\n    const helpfulCount = this.helpfulVotes.filter(vote => vote.helpful).length;\r\n    const totalVotes = this.helpfulVotes.length;\r\n    return totalVotes > 0 ? helpfulCount / totalVotes > 0.5 : false;\r\n};\r\n\r\nmodule.exports = mongoose.model('Review', reviewSchema); "],"mappings":"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","ignoreList":[]}},"mtime":1734040885951},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\routes\\\\recommendation.routes.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const express = require('express');\nconst router = express.Router();\nconst {\n  protect\n} = require('../middlewares/auth.middleware');\nconst {\n  getPersonalizedRecommendations,\n  getSimilarListings,\n  getBreedRecommendations,\n  getPriceRangeMatches\n} = require('../controllers/recommendation.controller');\n\n// Public routes\nrouter.get('/similar/:horseId', getSimilarListings);\n\n// Protected routes\nrouter.use(protect);\nrouter.get('/personalized', getPersonalizedRecommendations);\nrouter.get('/breeds', getBreedRecommendations);\nrouter.get('/price-matches', getPriceRangeMatches);\nmodule.exports = router;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsInJvdXRlciIsIlJvdXRlciIsInByb3RlY3QiLCJnZXRQZXJzb25hbGl6ZWRSZWNvbW1lbmRhdGlvbnMiLCJnZXRTaW1pbGFyTGlzdGluZ3MiLCJnZXRCcmVlZFJlY29tbWVuZGF0aW9ucyIsImdldFByaWNlUmFuZ2VNYXRjaGVzIiwiZ2V0IiwidXNlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiQzpcXFVzZXJzXFxKb2VsIFBldGVyXFxEb2N1bWVudHNcXFdvcmtcXGdhbGxvcGluZyBnZWFyc1xccm91dGVzXFwiLCJzb3VyY2VzIjpbInJlY29tbWVuZGF0aW9uLnJvdXRlcy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xyXG5jb25zdCB7IHByb3RlY3QgfSA9IHJlcXVpcmUoJy4uL21pZGRsZXdhcmVzL2F1dGgubWlkZGxld2FyZScpO1xyXG5jb25zdCB7XHJcbiAgICBnZXRQZXJzb25hbGl6ZWRSZWNvbW1lbmRhdGlvbnMsXHJcbiAgICBnZXRTaW1pbGFyTGlzdGluZ3MsXHJcbiAgICBnZXRCcmVlZFJlY29tbWVuZGF0aW9ucyxcclxuICAgIGdldFByaWNlUmFuZ2VNYXRjaGVzXHJcbn0gPSByZXF1aXJlKCcuLi9jb250cm9sbGVycy9yZWNvbW1lbmRhdGlvbi5jb250cm9sbGVyJyk7XHJcblxyXG4vLyBQdWJsaWMgcm91dGVzXHJcbnJvdXRlci5nZXQoJy9zaW1pbGFyLzpob3JzZUlkJywgZ2V0U2ltaWxhckxpc3RpbmdzKTtcclxuXHJcbi8vIFByb3RlY3RlZCByb3V0ZXNcclxucm91dGVyLnVzZShwcm90ZWN0KTtcclxucm91dGVyLmdldCgnL3BlcnNvbmFsaXplZCcsIGdldFBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9ucyk7XHJcbnJvdXRlci5nZXQoJy9icmVlZHMnLCBnZXRCcmVlZFJlY29tbWVuZGF0aW9ucyk7XHJcbnJvdXRlci5nZXQoJy9wcmljZS1tYXRjaGVzJywgZ2V0UHJpY2VSYW5nZU1hdGNoZXMpO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsT0FBTyxHQUFHQyxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1DLE1BQU0sR0FBR0YsT0FBTyxDQUFDRyxNQUFNLENBQUMsQ0FBQztBQUMvQixNQUFNO0VBQUVDO0FBQVEsQ0FBQyxHQUFHSCxPQUFPLENBQUMsZ0NBQWdDLENBQUM7QUFDN0QsTUFBTTtFQUNGSSw4QkFBOEI7RUFDOUJDLGtCQUFrQjtFQUNsQkMsdUJBQXVCO0VBQ3ZCQztBQUNKLENBQUMsR0FBR1AsT0FBTyxDQUFDLDBDQUEwQyxDQUFDOztBQUV2RDtBQUNBQyxNQUFNLENBQUNPLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRUgsa0JBQWtCLENBQUM7O0FBRW5EO0FBQ0FKLE1BQU0sQ0FBQ1EsR0FBRyxDQUFDTixPQUFPLENBQUM7QUFDbkJGLE1BQU0sQ0FBQ08sR0FBRyxDQUFDLGVBQWUsRUFBRUosOEJBQThCLENBQUM7QUFDM0RILE1BQU0sQ0FBQ08sR0FBRyxDQUFDLFNBQVMsRUFBRUYsdUJBQXVCLENBQUM7QUFDOUNMLE1BQU0sQ0FBQ08sR0FBRyxDQUFDLGdCQUFnQixFQUFFRCxvQkFBb0IsQ0FBQztBQUVsREcsTUFBTSxDQUFDQyxPQUFPLEdBQUdWLE1BQU0iLCJpZ25vcmVMaXN0IjpbXX0=","map":{"version":3,"names":["express","require","router","Router","protect","getPersonalizedRecommendations","getSimilarListings","getBreedRecommendations","getPriceRangeMatches","get","use","module","exports"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\routes\\","sources":["recommendation.routes.js"],"sourcesContent":["const express = require('express');\r\nconst router = express.Router();\r\nconst { protect } = require('../middlewares/auth.middleware');\r\nconst {\r\n    getPersonalizedRecommendations,\r\n    getSimilarListings,\r\n    getBreedRecommendations,\r\n    getPriceRangeMatches\r\n} = require('../controllers/recommendation.controller');\r\n\r\n// Public routes\r\nrouter.get('/similar/:horseId', getSimilarListings);\r\n\r\n// Protected routes\r\nrouter.use(protect);\r\nrouter.get('/personalized', getPersonalizedRecommendations);\r\nrouter.get('/breeds', getBreedRecommendations);\r\nrouter.get('/price-matches', getPriceRangeMatches);\r\n\r\nmodule.exports = router; "],"mappings":"AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAC,SAAS,CAAC;AAClC,MAAMC,MAAM,GAAGF,OAAO,CAACG,MAAM,CAAC,CAAC;AAC/B,MAAM;EAAEC;AAAQ,CAAC,GAAGH,OAAO,CAAC,gCAAgC,CAAC;AAC7D,MAAM;EACFI,8BAA8B;EAC9BC,kBAAkB;EAClBC,uBAAuB;EACvBC;AACJ,CAAC,GAAGP,OAAO,CAAC,0CAA0C,CAAC;;AAEvD;AACAC,MAAM,CAACO,GAAG,CAAC,mBAAmB,EAAEH,kBAAkB,CAAC;;AAEnD;AACAJ,MAAM,CAACQ,GAAG,CAACN,OAAO,CAAC;AACnBF,MAAM,CAACO,GAAG,CAAC,eAAe,EAAEJ,8BAA8B,CAAC;AAC3DH,MAAM,CAACO,GAAG,CAAC,SAAS,EAAEF,uBAAuB,CAAC;AAC9CL,MAAM,CAACO,GAAG,CAAC,gBAAgB,EAAED,oBAAoB,CAAC;AAElDG,MAAM,CAACC,OAAO,GAAGV,MAAM","ignoreList":[]}},"mtime":1734041153640},"{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\\",\"caller\":{\"name\":\"@babel/register\"},\"cwd\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"filename\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\\\\controllers\\\\recommendation.controller.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\Joel Peter\\\\Documents\\\\Work\\\\galloping gears\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.26.0:development":{"value":{"code":"const Horse = require('../models/Horse');\nconst User = require('../models/User');\nconst Review = require('../models/Review');\nconst ActivityLog = require('../models/ActivityLog');\n\n// Helper function to calculate similarity score\nconst calculateSimilarityScore = (userPreferences, horse) => {\n  let score = 0;\n  const weights = {\n    breed: 3,\n    price: 2,\n    location: 2,\n    purpose: 1.5,\n    age: 1\n  };\n\n  // Breed match\n  if (userPreferences.breeds && userPreferences.breeds.includes(horse.breed)) {\n    score += weights.breed;\n  }\n\n  // Price range match\n  if (userPreferences.priceRange) {\n    if (horse.price >= userPreferences.priceRange.min && horse.price <= userPreferences.priceRange.max) {\n      score += weights.price;\n    }\n  }\n\n  // Location match\n  if (userPreferences.location && userPreferences.location.states) {\n    if (userPreferences.location.states.includes(horse.location.state)) {\n      score += weights.location;\n    }\n  }\n\n  // Purpose match\n  if (userPreferences.purposes && horse.specifications.discipline) {\n    const matchingPurposes = userPreferences.purposes.filter(p => horse.specifications.discipline.includes(p));\n    score += matchingPurposes.length / userPreferences.purposes.length * weights.purpose;\n  }\n\n  // Age preference match\n  if (userPreferences.ageRange && horse.age) {\n    if (horse.age.years >= userPreferences.ageRange.min && horse.age.years <= userPreferences.ageRange.max) {\n      score += weights.age;\n    }\n  }\n  return score;\n};\n\n// @desc    Get personalized recommendations\n// @route   GET /api/recommendations/personalized\n// @access  Private\nexports.getPersonalizedRecommendations = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n    const limit = parseInt(req.query.limit) || 10;\n\n    // Get user's viewing history\n    const viewingHistory = await ActivityLog.find({\n      user: user._id,\n      action: 'VIEW_LISTING',\n      createdAt: {\n        $gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)\n      }\n    }).populate('target');\n\n    // Get active listings\n    let horses = await Horse.find({\n      listingStatus: 'active',\n      _id: {\n        $nin: viewingHistory.map(h => h.target._id)\n      }\n    }).populate('seller', 'businessName location rating');\n\n    // Calculate similarity scores\n    const scoredHorses = horses.map(horse => ({\n      horse,\n      score: calculateSimilarityScore(user.preferences || {}, horse)\n    }));\n\n    // Sort by score and get top recommendations\n    const recommendations = scoredHorses.sort((a, b) => b.score - a.score).slice(0, limit).map(sh => sh.horse);\n    res.json({\n      success: true,\n      recommendations\n    });\n  } catch (error) {\n    console.error('Personalized recommendations error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting recommendations'\n    });\n  }\n};\n\n// @desc    Get similar listings\n// @route   GET /api/recommendations/similar/:horseId\n// @access  Public\nexports.getSimilarListings = async (req, res) => {\n  try {\n    const {\n      horseId\n    } = req.params;\n    const limit = parseInt(req.query.limit) || 6;\n    const sourceHorse = await Horse.findById(horseId);\n    if (!sourceHorse) {\n      return res.status(404).json({\n        success: false,\n        message: 'Horse not found'\n      });\n    }\n\n    // Find similar horses based on attributes\n    const similarHorses = await Horse.find({\n      _id: {\n        $ne: horseId\n      },\n      listingStatus: 'active',\n      $or: [{\n        breed: sourceHorse.breed\n      }, {\n        'specifications.discipline': {\n          $in: sourceHorse.specifications.discipline\n        }\n      }, {\n        price: {\n          $gte: sourceHorse.price * 0.8,\n          $lte: sourceHorse.price * 1.2\n        }\n      }]\n    }).limit(limit).populate('seller', 'businessName location rating');\n    res.json({\n      success: true,\n      similarListings: similarHorses\n    });\n  } catch (error) {\n    console.error('Similar listings error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting similar listings'\n    });\n  }\n};\n\n// @desc    Get breed recommendations\n// @route   GET /api/recommendations/breeds\n// @access  Private\nexports.getBreedRecommendations = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n    const limit = parseInt(req.query.limit) || 5;\n\n    // Get user's favorite breeds from preferences and history\n    const favoriteBreeds = new Set(user.preferences?.breeds || []);\n\n    // Add breeds from highly rated reviews\n    const userReviews = await Review.find({\n      reviewer: user._id,\n      'rating.overall': {\n        $gte: 4\n      }\n    }).populate('entityId');\n    userReviews.forEach(review => {\n      if (review.entityType === 'horse' && review.entityId.breed) {\n        favoriteBreeds.add(review.entityId.breed);\n      }\n    });\n\n    // Get popular horses of favorite breeds\n    const recommendations = await Horse.aggregate([{\n      $match: {\n        breed: {\n          $in: Array.from(favoriteBreeds)\n        },\n        listingStatus: 'active'\n      }\n    }, {\n      $lookup: {\n        from: 'reviews',\n        localField: '_id',\n        foreignField: 'entityId',\n        as: 'reviews'\n      }\n    }, {\n      $addFields: {\n        averageRating: {\n          $avg: '$reviews.rating.overall'\n        }\n      }\n    }, {\n      $sort: {\n        averageRating: -1\n      }\n    }, {\n      $limit: limit\n    }]);\n    await Horse.populate(recommendations, {\n      path: 'seller',\n      select: 'businessName location rating'\n    });\n    res.json({\n      success: true,\n      recommendations\n    });\n  } catch (error) {\n    console.error('Breed recommendations error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting breed recommendations'\n    });\n  }\n};\n\n// @desc    Get price range matches\n// @route   GET /api/recommendations/price-matches\n// @access  Private\nexports.getPriceRangeMatches = async (req, res) => {\n  try {\n    const user = await User.findById(req.user._id);\n    const limit = parseInt(req.query.limit) || 10;\n    if (!user.preferences?.priceRange) {\n      return res.status(400).json({\n        success: false,\n        message: 'No price range preferences set'\n      });\n    }\n    const {\n      min,\n      max\n    } = user.preferences.priceRange;\n\n    // Find horses within user's price range\n    const matches = await Horse.find({\n      listingStatus: 'active',\n      price: {\n        $gte: min,\n        $lte: max\n      }\n    }).sort({\n      createdAt: -1\n    }).limit(limit).populate('seller', 'businessName location rating');\n    res.json({\n      success: true,\n      matches\n    });\n  } catch (error) {\n    console.error('Price range matches error:', error);\n    res.status(500).json({\n      success: false,\n      message: error.message || 'Error getting price range matches'\n    });\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIb3JzZSIsInJlcXVpcmUiLCJVc2VyIiwiUmV2aWV3IiwiQWN0aXZpdHlMb2ciLCJjYWxjdWxhdGVTaW1pbGFyaXR5U2NvcmUiLCJ1c2VyUHJlZmVyZW5jZXMiLCJob3JzZSIsInNjb3JlIiwid2VpZ2h0cyIsImJyZWVkIiwicHJpY2UiLCJsb2NhdGlvbiIsInB1cnBvc2UiLCJhZ2UiLCJicmVlZHMiLCJpbmNsdWRlcyIsInByaWNlUmFuZ2UiLCJtaW4iLCJtYXgiLCJzdGF0ZXMiLCJzdGF0ZSIsInB1cnBvc2VzIiwic3BlY2lmaWNhdGlvbnMiLCJkaXNjaXBsaW5lIiwibWF0Y2hpbmdQdXJwb3NlcyIsImZpbHRlciIsInAiLCJsZW5ndGgiLCJhZ2VSYW5nZSIsInllYXJzIiwiZXhwb3J0cyIsImdldFBlcnNvbmFsaXplZFJlY29tbWVuZGF0aW9ucyIsInJlcSIsInJlcyIsInVzZXIiLCJmaW5kQnlJZCIsIl9pZCIsImxpbWl0IiwicGFyc2VJbnQiLCJxdWVyeSIsInZpZXdpbmdIaXN0b3J5IiwiZmluZCIsImFjdGlvbiIsImNyZWF0ZWRBdCIsIiRndGUiLCJEYXRlIiwibm93IiwicG9wdWxhdGUiLCJob3JzZXMiLCJsaXN0aW5nU3RhdHVzIiwiJG5pbiIsIm1hcCIsImgiLCJ0YXJnZXQiLCJzY29yZWRIb3JzZXMiLCJwcmVmZXJlbmNlcyIsInJlY29tbWVuZGF0aW9ucyIsInNvcnQiLCJhIiwiYiIsInNsaWNlIiwic2giLCJqc29uIiwic3VjY2VzcyIsImVycm9yIiwiY29uc29sZSIsInN0YXR1cyIsIm1lc3NhZ2UiLCJnZXRTaW1pbGFyTGlzdGluZ3MiLCJob3JzZUlkIiwicGFyYW1zIiwic291cmNlSG9yc2UiLCJzaW1pbGFySG9yc2VzIiwiJG5lIiwiJG9yIiwiJGluIiwiJGx0ZSIsInNpbWlsYXJMaXN0aW5ncyIsImdldEJyZWVkUmVjb21tZW5kYXRpb25zIiwiZmF2b3JpdGVCcmVlZHMiLCJTZXQiLCJ1c2VyUmV2aWV3cyIsInJldmlld2VyIiwiZm9yRWFjaCIsInJldmlldyIsImVudGl0eVR5cGUiLCJlbnRpdHlJZCIsImFkZCIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIkFycmF5IiwiZnJvbSIsIiRsb29rdXAiLCJsb2NhbEZpZWxkIiwiZm9yZWlnbkZpZWxkIiwiYXMiLCIkYWRkRmllbGRzIiwiYXZlcmFnZVJhdGluZyIsIiRhdmciLCIkc29ydCIsIiRsaW1pdCIsInBhdGgiLCJzZWxlY3QiLCJnZXRQcmljZVJhbmdlTWF0Y2hlcyIsIm1hdGNoZXMiXSwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcSm9lbCBQZXRlclxcRG9jdW1lbnRzXFxXb3JrXFxnYWxsb3BpbmcgZ2VhcnNcXGNvbnRyb2xsZXJzXFwiLCJzb3VyY2VzIjpbInJlY29tbWVuZGF0aW9uLmNvbnRyb2xsZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgSG9yc2UgPSByZXF1aXJlKCcuLi9tb2RlbHMvSG9yc2UnKTtcclxuY29uc3QgVXNlciA9IHJlcXVpcmUoJy4uL21vZGVscy9Vc2VyJyk7XHJcbmNvbnN0IFJldmlldyA9IHJlcXVpcmUoJy4uL21vZGVscy9SZXZpZXcnKTtcclxuY29uc3QgQWN0aXZpdHlMb2cgPSByZXF1aXJlKCcuLi9tb2RlbHMvQWN0aXZpdHlMb2cnKTtcclxuXHJcbi8vIEhlbHBlciBmdW5jdGlvbiB0byBjYWxjdWxhdGUgc2ltaWxhcml0eSBzY29yZVxyXG5jb25zdCBjYWxjdWxhdGVTaW1pbGFyaXR5U2NvcmUgPSAodXNlclByZWZlcmVuY2VzLCBob3JzZSkgPT4ge1xyXG4gICAgbGV0IHNjb3JlID0gMDtcclxuICAgIGNvbnN0IHdlaWdodHMgPSB7XHJcbiAgICAgICAgYnJlZWQ6IDMsXHJcbiAgICAgICAgcHJpY2U6IDIsXHJcbiAgICAgICAgbG9jYXRpb246IDIsXHJcbiAgICAgICAgcHVycG9zZTogMS41LFxyXG4gICAgICAgIGFnZTogMVxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBCcmVlZCBtYXRjaFxyXG4gICAgaWYgKHVzZXJQcmVmZXJlbmNlcy5icmVlZHMgJiYgdXNlclByZWZlcmVuY2VzLmJyZWVkcy5pbmNsdWRlcyhob3JzZS5icmVlZCkpIHtcclxuICAgICAgICBzY29yZSArPSB3ZWlnaHRzLmJyZWVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFByaWNlIHJhbmdlIG1hdGNoXHJcbiAgICBpZiAodXNlclByZWZlcmVuY2VzLnByaWNlUmFuZ2UpIHtcclxuICAgICAgICBpZiAoaG9yc2UucHJpY2UgPj0gdXNlclByZWZlcmVuY2VzLnByaWNlUmFuZ2UubWluICYmIFxyXG4gICAgICAgICAgICBob3JzZS5wcmljZSA8PSB1c2VyUHJlZmVyZW5jZXMucHJpY2VSYW5nZS5tYXgpIHtcclxuICAgICAgICAgICAgc2NvcmUgKz0gd2VpZ2h0cy5wcmljZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTG9jYXRpb24gbWF0Y2hcclxuICAgIGlmICh1c2VyUHJlZmVyZW5jZXMubG9jYXRpb24gJiYgdXNlclByZWZlcmVuY2VzLmxvY2F0aW9uLnN0YXRlcykge1xyXG4gICAgICAgIGlmICh1c2VyUHJlZmVyZW5jZXMubG9jYXRpb24uc3RhdGVzLmluY2x1ZGVzKGhvcnNlLmxvY2F0aW9uLnN0YXRlKSkge1xyXG4gICAgICAgICAgICBzY29yZSArPSB3ZWlnaHRzLmxvY2F0aW9uO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBQdXJwb3NlIG1hdGNoXHJcbiAgICBpZiAodXNlclByZWZlcmVuY2VzLnB1cnBvc2VzICYmIGhvcnNlLnNwZWNpZmljYXRpb25zLmRpc2NpcGxpbmUpIHtcclxuICAgICAgICBjb25zdCBtYXRjaGluZ1B1cnBvc2VzID0gdXNlclByZWZlcmVuY2VzLnB1cnBvc2VzLmZpbHRlcihcclxuICAgICAgICAgICAgcCA9PiBob3JzZS5zcGVjaWZpY2F0aW9ucy5kaXNjaXBsaW5lLmluY2x1ZGVzKHApXHJcbiAgICAgICAgKTtcclxuICAgICAgICBzY29yZSArPSAobWF0Y2hpbmdQdXJwb3Nlcy5sZW5ndGggLyB1c2VyUHJlZmVyZW5jZXMucHVycG9zZXMubGVuZ3RoKSAqIHdlaWdodHMucHVycG9zZTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBBZ2UgcHJlZmVyZW5jZSBtYXRjaFxyXG4gICAgaWYgKHVzZXJQcmVmZXJlbmNlcy5hZ2VSYW5nZSAmJiBob3JzZS5hZ2UpIHtcclxuICAgICAgICBpZiAoaG9yc2UuYWdlLnllYXJzID49IHVzZXJQcmVmZXJlbmNlcy5hZ2VSYW5nZS5taW4gJiYgXHJcbiAgICAgICAgICAgIGhvcnNlLmFnZS55ZWFycyA8PSB1c2VyUHJlZmVyZW5jZXMuYWdlUmFuZ2UubWF4KSB7XHJcbiAgICAgICAgICAgIHNjb3JlICs9IHdlaWdodHMuYWdlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gc2NvcmU7XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgcGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9uc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9yZWNvbW1lbmRhdGlvbnMvcGVyc29uYWxpemVkXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5nZXRQZXJzb25hbGl6ZWRSZWNvbW1lbmRhdGlvbnMgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXIuZmluZEJ5SWQocmVxLnVzZXIuX2lkKTtcclxuICAgICAgICBjb25zdCBsaW1pdCA9IHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCkgfHwgMTA7XHJcblxyXG4gICAgICAgIC8vIEdldCB1c2VyJ3Mgdmlld2luZyBoaXN0b3J5XHJcbiAgICAgICAgY29uc3Qgdmlld2luZ0hpc3RvcnkgPSBhd2FpdCBBY3Rpdml0eUxvZy5maW5kKHtcclxuICAgICAgICAgICAgdXNlcjogdXNlci5faWQsXHJcbiAgICAgICAgICAgIGFjdGlvbjogJ1ZJRVdfTElTVElORycsXHJcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogeyAkZ3RlOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKSB9XHJcbiAgICAgICAgfSkucG9wdWxhdGUoJ3RhcmdldCcpO1xyXG5cclxuICAgICAgICAvLyBHZXQgYWN0aXZlIGxpc3RpbmdzXHJcbiAgICAgICAgbGV0IGhvcnNlcyA9IGF3YWl0IEhvcnNlLmZpbmQoe1xyXG4gICAgICAgICAgICBsaXN0aW5nU3RhdHVzOiAnYWN0aXZlJyxcclxuICAgICAgICAgICAgX2lkOiB7ICRuaW46IHZpZXdpbmdIaXN0b3J5Lm1hcChoID0+IGgudGFyZ2V0Ll9pZCkgfVxyXG4gICAgICAgIH0pLnBvcHVsYXRlKCdzZWxsZXInLCAnYnVzaW5lc3NOYW1lIGxvY2F0aW9uIHJhdGluZycpO1xyXG5cclxuICAgICAgICAvLyBDYWxjdWxhdGUgc2ltaWxhcml0eSBzY29yZXNcclxuICAgICAgICBjb25zdCBzY29yZWRIb3JzZXMgPSBob3JzZXMubWFwKGhvcnNlID0+ICh7XHJcbiAgICAgICAgICAgIGhvcnNlLFxyXG4gICAgICAgICAgICBzY29yZTogY2FsY3VsYXRlU2ltaWxhcml0eVNjb3JlKHVzZXIucHJlZmVyZW5jZXMgfHwge30sIGhvcnNlKVxyXG4gICAgICAgIH0pKTtcclxuXHJcbiAgICAgICAgLy8gU29ydCBieSBzY29yZSBhbmQgZ2V0IHRvcCByZWNvbW1lbmRhdGlvbnNcclxuICAgICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBzY29yZWRIb3JzZXNcclxuICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKVxyXG4gICAgICAgICAgICAuc2xpY2UoMCwgbGltaXQpXHJcbiAgICAgICAgICAgIC5tYXAoc2ggPT4gc2guaG9yc2UpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignUGVyc29uYWxpemVkIHJlY29tbWVuZGF0aW9ucyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3IgZ2V0dGluZyByZWNvbW1lbmRhdGlvbnMnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07XHJcblxyXG4vLyBAZGVzYyAgICBHZXQgc2ltaWxhciBsaXN0aW5nc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9yZWNvbW1lbmRhdGlvbnMvc2ltaWxhci86aG9yc2VJZFxyXG4vLyBAYWNjZXNzICBQdWJsaWNcclxuZXhwb3J0cy5nZXRTaW1pbGFyTGlzdGluZ3MgPSBhc3luYyAocmVxLCByZXMpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgICAgY29uc3QgeyBob3JzZUlkIH0gPSByZXEucGFyYW1zO1xyXG4gICAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0KSB8fCA2O1xyXG5cclxuICAgICAgICBjb25zdCBzb3VyY2VIb3JzZSA9IGF3YWl0IEhvcnNlLmZpbmRCeUlkKGhvcnNlSWQpO1xyXG4gICAgICAgIGlmICghc291cmNlSG9yc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogJ0hvcnNlIG5vdCBmb3VuZCdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBGaW5kIHNpbWlsYXIgaG9yc2VzIGJhc2VkIG9uIGF0dHJpYnV0ZXNcclxuICAgICAgICBjb25zdCBzaW1pbGFySG9yc2VzID0gYXdhaXQgSG9yc2UuZmluZCh7XHJcbiAgICAgICAgICAgIF9pZDogeyAkbmU6IGhvcnNlSWQgfSxcclxuICAgICAgICAgICAgbGlzdGluZ1N0YXR1czogJ2FjdGl2ZScsXHJcbiAgICAgICAgICAgICRvcjogW1xyXG4gICAgICAgICAgICAgICAgeyBicmVlZDogc291cmNlSG9yc2UuYnJlZWQgfSxcclxuICAgICAgICAgICAgICAgIHsgJ3NwZWNpZmljYXRpb25zLmRpc2NpcGxpbmUnOiB7ICRpbjogc291cmNlSG9yc2Uuc3BlY2lmaWNhdGlvbnMuZGlzY2lwbGluZSB9IH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJpY2U6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJGd0ZTogc291cmNlSG9yc2UucHJpY2UgKiAwLjgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRsdGU6IHNvdXJjZUhvcnNlLnByaWNlICogMS4yXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfSlcclxuICAgICAgICAubGltaXQobGltaXQpXHJcbiAgICAgICAgLnBvcHVsYXRlKCdzZWxsZXInLCAnYnVzaW5lc3NOYW1lIGxvY2F0aW9uIHJhdGluZycpO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHNpbWlsYXJMaXN0aW5nczogc2ltaWxhckhvcnNlc1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignU2ltaWxhciBsaXN0aW5ncyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRXJyb3IgZ2V0dGluZyBzaW1pbGFyIGxpc3RpbmdzJ1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59O1xyXG5cclxuLy8gQGRlc2MgICAgR2V0IGJyZWVkIHJlY29tbWVuZGF0aW9uc1xyXG4vLyBAcm91dGUgICBHRVQgL2FwaS9yZWNvbW1lbmRhdGlvbnMvYnJlZWRzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5nZXRCcmVlZFJlY29tbWVuZGF0aW9ucyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpO1xyXG4gICAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0KSB8fCA1O1xyXG5cclxuICAgICAgICAvLyBHZXQgdXNlcidzIGZhdm9yaXRlIGJyZWVkcyBmcm9tIHByZWZlcmVuY2VzIGFuZCBoaXN0b3J5XHJcbiAgICAgICAgY29uc3QgZmF2b3JpdGVCcmVlZHMgPSBuZXcgU2V0KHVzZXIucHJlZmVyZW5jZXM/LmJyZWVkcyB8fCBbXSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gQWRkIGJyZWVkcyBmcm9tIGhpZ2hseSByYXRlZCByZXZpZXdzXHJcbiAgICAgICAgY29uc3QgdXNlclJldmlld3MgPSBhd2FpdCBSZXZpZXcuZmluZCh7XHJcbiAgICAgICAgICAgIHJldmlld2VyOiB1c2VyLl9pZCxcclxuICAgICAgICAgICAgJ3JhdGluZy5vdmVyYWxsJzogeyAkZ3RlOiA0IH1cclxuICAgICAgICB9KS5wb3B1bGF0ZSgnZW50aXR5SWQnKTtcclxuICAgICAgICBcclxuICAgICAgICB1c2VyUmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgICAgICAgIGlmIChyZXZpZXcuZW50aXR5VHlwZSA9PT0gJ2hvcnNlJyAmJiByZXZpZXcuZW50aXR5SWQuYnJlZWQpIHtcclxuICAgICAgICAgICAgICAgIGZhdm9yaXRlQnJlZWRzLmFkZChyZXZpZXcuZW50aXR5SWQuYnJlZWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIEdldCBwb3B1bGFyIGhvcnNlcyBvZiBmYXZvcml0ZSBicmVlZHNcclxuICAgICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBhd2FpdCBIb3JzZS5hZ2dyZWdhdGUoW1xyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkbWF0Y2g6IHtcclxuICAgICAgICAgICAgICAgICAgICBicmVlZDogeyAkaW46IEFycmF5LmZyb20oZmF2b3JpdGVCcmVlZHMpIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdGluZ1N0YXR1czogJ2FjdGl2ZSdcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdyZXZpZXdzJyxcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAnX2lkJyxcclxuICAgICAgICAgICAgICAgICAgICBmb3JlaWduRmllbGQ6ICdlbnRpdHlJZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgYXM6ICdyZXZpZXdzJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkYWRkRmllbGRzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXZlcmFnZVJhdGluZzogeyAkYXZnOiAnJHJldmlld3MucmF0aW5nLm92ZXJhbGwnIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgJHNvcnQ6IHsgYXZlcmFnZVJhdGluZzogLTEgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAkbGltaXQ6IGxpbWl0XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICBdKTtcclxuXHJcbiAgICAgICAgYXdhaXQgSG9yc2UucG9wdWxhdGUocmVjb21tZW5kYXRpb25zLCB7XHJcbiAgICAgICAgICAgIHBhdGg6ICdzZWxsZXInLFxyXG4gICAgICAgICAgICBzZWxlY3Q6ICdidXNpbmVzc05hbWUgbG9jYXRpb24gcmF0aW5nJ1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXMuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHJlY29tbWVuZGF0aW9uc1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignQnJlZWQgcmVjb21tZW5kYXRpb25zIGVycm9yOicsIGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBnZXR0aW5nIGJyZWVkIHJlY29tbWVuZGF0aW9ucydcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufTtcclxuXHJcbi8vIEBkZXNjICAgIEdldCBwcmljZSByYW5nZSBtYXRjaGVzXHJcbi8vIEByb3V0ZSAgIEdFVCAvYXBpL3JlY29tbWVuZGF0aW9ucy9wcmljZS1tYXRjaGVzXHJcbi8vIEBhY2Nlc3MgIFByaXZhdGVcclxuZXhwb3J0cy5nZXRQcmljZVJhbmdlTWF0Y2hlcyA9IGFzeW5jIChyZXEsIHJlcykgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlJZChyZXEudXNlci5faWQpO1xyXG4gICAgICAgIGNvbnN0IGxpbWl0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5LmxpbWl0KSB8fCAxMDtcclxuXHJcbiAgICAgICAgaWYgKCF1c2VyLnByZWZlcmVuY2VzPy5wcmljZVJhbmdlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XHJcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdObyBwcmljZSByYW5nZSBwcmVmZXJlbmNlcyBzZXQnXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgeyBtaW4sIG1heCB9ID0gdXNlci5wcmVmZXJlbmNlcy5wcmljZVJhbmdlO1xyXG5cclxuICAgICAgICAvLyBGaW5kIGhvcnNlcyB3aXRoaW4gdXNlcidzIHByaWNlIHJhbmdlXHJcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IGF3YWl0IEhvcnNlLmZpbmQoe1xyXG4gICAgICAgICAgICBsaXN0aW5nU3RhdHVzOiAnYWN0aXZlJyxcclxuICAgICAgICAgICAgcHJpY2U6IHsgJGd0ZTogbWluLCAkbHRlOiBtYXggfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnNvcnQoeyBjcmVhdGVkQXQ6IC0xIH0pXHJcbiAgICAgICAgLmxpbWl0KGxpbWl0KVxyXG4gICAgICAgIC5wb3B1bGF0ZSgnc2VsbGVyJywgJ2J1c2luZXNzTmFtZSBsb2NhdGlvbiByYXRpbmcnKTtcclxuXHJcbiAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICBtYXRjaGVzXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdQcmljZSByYW5nZSBtYXRjaGVzIGVycm9yOicsIGVycm9yKTtcclxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8ICdFcnJvciBnZXR0aW5nIHByaWNlIHJhbmdlIG1hdGNoZXMnXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn07ICJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFDeEMsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsZ0JBQWdCLENBQUM7QUFDdEMsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsa0JBQWtCLENBQUM7QUFDMUMsTUFBTUcsV0FBVyxHQUFHSCxPQUFPLENBQUMsdUJBQXVCLENBQUM7O0FBRXBEO0FBQ0EsTUFBTUksd0JBQXdCLEdBQUdBLENBQUNDLGVBQWUsRUFBRUMsS0FBSyxLQUFLO0VBQ3pELElBQUlDLEtBQUssR0FBRyxDQUFDO0VBQ2IsTUFBTUMsT0FBTyxHQUFHO0lBQ1pDLEtBQUssRUFBRSxDQUFDO0lBQ1JDLEtBQUssRUFBRSxDQUFDO0lBQ1JDLFFBQVEsRUFBRSxDQUFDO0lBQ1hDLE9BQU8sRUFBRSxHQUFHO0lBQ1pDLEdBQUcsRUFBRTtFQUNULENBQUM7O0VBRUQ7RUFDQSxJQUFJUixlQUFlLENBQUNTLE1BQU0sSUFBSVQsZUFBZSxDQUFDUyxNQUFNLENBQUNDLFFBQVEsQ0FBQ1QsS0FBSyxDQUFDRyxLQUFLLENBQUMsRUFBRTtJQUN4RUYsS0FBSyxJQUFJQyxPQUFPLENBQUNDLEtBQUs7RUFDMUI7O0VBRUE7RUFDQSxJQUFJSixlQUFlLENBQUNXLFVBQVUsRUFBRTtJQUM1QixJQUFJVixLQUFLLENBQUNJLEtBQUssSUFBSUwsZUFBZSxDQUFDVyxVQUFVLENBQUNDLEdBQUcsSUFDN0NYLEtBQUssQ0FBQ0ksS0FBSyxJQUFJTCxlQUFlLENBQUNXLFVBQVUsQ0FBQ0UsR0FBRyxFQUFFO01BQy9DWCxLQUFLLElBQUlDLE9BQU8sQ0FBQ0UsS0FBSztJQUMxQjtFQUNKOztFQUVBO0VBQ0EsSUFBSUwsZUFBZSxDQUFDTSxRQUFRLElBQUlOLGVBQWUsQ0FBQ00sUUFBUSxD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","map":{"version":3,"names":["Horse","require","User","Review","ActivityLog","calculateSimilarityScore","userPreferences","horse","score","weights","breed","price","location","purpose","age","breeds","includes","priceRange","min","max","states","state","purposes","specifications","discipline","matchingPurposes","filter","p","length","ageRange","years","exports","getPersonalizedRecommendations","req","res","user","findById","_id","limit","parseInt","query","viewingHistory","find","action","createdAt","$gte","Date","now","populate","horses","listingStatus","$nin","map","h","target","scoredHorses","preferences","recommendations","sort","a","b","slice","sh","json","success","error","console","status","message","getSimilarListings","horseId","params","sourceHorse","similarHorses","$ne","$or","$in","$lte","similarListings","getBreedRecommendations","favoriteBreeds","Set","userReviews","reviewer","forEach","review","entityType","entityId","add","aggregate","$match","Array","from","$lookup","localField","foreignField","as","$addFields","averageRating","$avg","$sort","$limit","path","select","getPriceRangeMatches","matches"],"sourceRoot":"C:\\Users\\Joel Peter\\Documents\\Work\\galloping gears\\controllers\\","sources":["recommendation.controller.js"],"sourcesContent":["const Horse = require('../models/Horse');\r\nconst User = require('../models/User');\r\nconst Review = require('../models/Review');\r\nconst ActivityLog = require('../models/ActivityLog');\r\n\r\n// Helper function to calculate similarity score\r\nconst calculateSimilarityScore = (userPreferences, horse) => {\r\n    let score = 0;\r\n    const weights = {\r\n        breed: 3,\r\n        price: 2,\r\n        location: 2,\r\n        purpose: 1.5,\r\n        age: 1\r\n    };\r\n\r\n    // Breed match\r\n    if (userPreferences.breeds && userPreferences.breeds.includes(horse.breed)) {\r\n        score += weights.breed;\r\n    }\r\n\r\n    // Price range match\r\n    if (userPreferences.priceRange) {\r\n        if (horse.price >= userPreferences.priceRange.min && \r\n            horse.price <= userPreferences.priceRange.max) {\r\n            score += weights.price;\r\n        }\r\n    }\r\n\r\n    // Location match\r\n    if (userPreferences.location && userPreferences.location.states) {\r\n        if (userPreferences.location.states.includes(horse.location.state)) {\r\n            score += weights.location;\r\n        }\r\n    }\r\n\r\n    // Purpose match\r\n    if (userPreferences.purposes && horse.specifications.discipline) {\r\n        const matchingPurposes = userPreferences.purposes.filter(\r\n            p => horse.specifications.discipline.includes(p)\r\n        );\r\n        score += (matchingPurposes.length / userPreferences.purposes.length) * weights.purpose;\r\n    }\r\n\r\n    // Age preference match\r\n    if (userPreferences.ageRange && horse.age) {\r\n        if (horse.age.years >= userPreferences.ageRange.min && \r\n            horse.age.years <= userPreferences.ageRange.max) {\r\n            score += weights.age;\r\n        }\r\n    }\r\n\r\n    return score;\r\n};\r\n\r\n// @desc    Get personalized recommendations\r\n// @route   GET /api/recommendations/personalized\r\n// @access  Private\r\nexports.getPersonalizedRecommendations = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id);\r\n        const limit = parseInt(req.query.limit) || 10;\r\n\r\n        // Get user's viewing history\r\n        const viewingHistory = await ActivityLog.find({\r\n            user: user._id,\r\n            action: 'VIEW_LISTING',\r\n            createdAt: { $gte: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000) }\r\n        }).populate('target');\r\n\r\n        // Get active listings\r\n        let horses = await Horse.find({\r\n            listingStatus: 'active',\r\n            _id: { $nin: viewingHistory.map(h => h.target._id) }\r\n        }).populate('seller', 'businessName location rating');\r\n\r\n        // Calculate similarity scores\r\n        const scoredHorses = horses.map(horse => ({\r\n            horse,\r\n            score: calculateSimilarityScore(user.preferences || {}, horse)\r\n        }));\r\n\r\n        // Sort by score and get top recommendations\r\n        const recommendations = scoredHorses\r\n            .sort((a, b) => b.score - a.score)\r\n            .slice(0, limit)\r\n            .map(sh => sh.horse);\r\n\r\n        res.json({\r\n            success: true,\r\n            recommendations\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Personalized recommendations error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting recommendations'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get similar listings\r\n// @route   GET /api/recommendations/similar/:horseId\r\n// @access  Public\r\nexports.getSimilarListings = async (req, res) => {\r\n    try {\r\n        const { horseId } = req.params;\r\n        const limit = parseInt(req.query.limit) || 6;\r\n\r\n        const sourceHorse = await Horse.findById(horseId);\r\n        if (!sourceHorse) {\r\n            return res.status(404).json({\r\n                success: false,\r\n                message: 'Horse not found'\r\n            });\r\n        }\r\n\r\n        // Find similar horses based on attributes\r\n        const similarHorses = await Horse.find({\r\n            _id: { $ne: horseId },\r\n            listingStatus: 'active',\r\n            $or: [\r\n                { breed: sourceHorse.breed },\r\n                { 'specifications.discipline': { $in: sourceHorse.specifications.discipline } },\r\n                {\r\n                    price: {\r\n                        $gte: sourceHorse.price * 0.8,\r\n                        $lte: sourceHorse.price * 1.2\r\n                    }\r\n                }\r\n            ]\r\n        })\r\n        .limit(limit)\r\n        .populate('seller', 'businessName location rating');\r\n\r\n        res.json({\r\n            success: true,\r\n            similarListings: similarHorses\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Similar listings error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting similar listings'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get breed recommendations\r\n// @route   GET /api/recommendations/breeds\r\n// @access  Private\r\nexports.getBreedRecommendations = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id);\r\n        const limit = parseInt(req.query.limit) || 5;\r\n\r\n        // Get user's favorite breeds from preferences and history\r\n        const favoriteBreeds = new Set(user.preferences?.breeds || []);\r\n        \r\n        // Add breeds from highly rated reviews\r\n        const userReviews = await Review.find({\r\n            reviewer: user._id,\r\n            'rating.overall': { $gte: 4 }\r\n        }).populate('entityId');\r\n        \r\n        userReviews.forEach(review => {\r\n            if (review.entityType === 'horse' && review.entityId.breed) {\r\n                favoriteBreeds.add(review.entityId.breed);\r\n            }\r\n        });\r\n\r\n        // Get popular horses of favorite breeds\r\n        const recommendations = await Horse.aggregate([\r\n            {\r\n                $match: {\r\n                    breed: { $in: Array.from(favoriteBreeds) },\r\n                    listingStatus: 'active'\r\n                }\r\n            },\r\n            {\r\n                $lookup: {\r\n                    from: 'reviews',\r\n                    localField: '_id',\r\n                    foreignField: 'entityId',\r\n                    as: 'reviews'\r\n                }\r\n            },\r\n            {\r\n                $addFields: {\r\n                    averageRating: { $avg: '$reviews.rating.overall' }\r\n                }\r\n            },\r\n            {\r\n                $sort: { averageRating: -1 }\r\n            },\r\n            {\r\n                $limit: limit\r\n            }\r\n        ]);\r\n\r\n        await Horse.populate(recommendations, {\r\n            path: 'seller',\r\n            select: 'businessName location rating'\r\n        });\r\n\r\n        res.json({\r\n            success: true,\r\n            recommendations\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Breed recommendations error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting breed recommendations'\r\n        });\r\n    }\r\n};\r\n\r\n// @desc    Get price range matches\r\n// @route   GET /api/recommendations/price-matches\r\n// @access  Private\r\nexports.getPriceRangeMatches = async (req, res) => {\r\n    try {\r\n        const user = await User.findById(req.user._id);\r\n        const limit = parseInt(req.query.limit) || 10;\r\n\r\n        if (!user.preferences?.priceRange) {\r\n            return res.status(400).json({\r\n                success: false,\r\n                message: 'No price range preferences set'\r\n            });\r\n        }\r\n\r\n        const { min, max } = user.preferences.priceRange;\r\n\r\n        // Find horses within user's price range\r\n        const matches = await Horse.find({\r\n            listingStatus: 'active',\r\n            price: { $gte: min, $lte: max }\r\n        })\r\n        .sort({ createdAt: -1 })\r\n        .limit(limit)\r\n        .populate('seller', 'businessName location rating');\r\n\r\n        res.json({\r\n            success: true,\r\n            matches\r\n        });\r\n\r\n    } catch (error) {\r\n        console.error('Price range matches error:', error);\r\n        res.status(500).json({\r\n            success: false,\r\n            message: error.message || 'Error getting price range matches'\r\n        });\r\n    }\r\n}; "],"mappings":"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","ignoreList":[]}},"mtime":1734041137143}}